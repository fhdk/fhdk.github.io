{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"@linux-aarhus Notes and bookmarks resurrected Most of this is also found on Manjaro Forum","title":"Home"},{"location":"#linux-aarhus","text":"Notes and bookmarks resurrected Most of this is also found on Manjaro Forum","title":"@linux-aarhus"},{"location":"bookmarks/bookmark-linux-finding-port-origin/","text":"Bookmark Source: https://serverfault.com/a/847910 Based on hint from @user202173 and others I have been able to use the following to track down the process that owns a port even when it is listed as - in netstat. Here was my starting situation. sudo netstat shows port with PID/Program of -. lsof -i shows nothing. $ sudo netstat -ltpna | awk 'NR2 || /:8785/' Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp6 0 0 :::8785 :::* LISTEN - tcp6 1 0 ::1:8785 ::1:45518 CLOSE_WAIT - $ sudo lsof -i :8785 $ Now let's go fishing. First let's get the inode by adding -e to our netstat call. $ sudo netstat -ltpnae | awk 'NR2 || /:8785/' Proto Recv-Q Send-Q Local Address Foreign Address State User Inode PID/Program name tcp6 0 0 :::8785 :::* LISTEN 199179 212698803 - tcp6 1 0 ::1:8785 ::1:45518 CLOSE_WAIT 0 0 - Next use lsof to get the process attached to that inode. $ sudo lsof | awk 'NR1 || /212698803/' COMMAND PID TID USER FD TYPE DEVICE SIZE/OFF NODE NAME envelope_ 145661 145766 drees 15u IPv6 212698803 0t0 TCP :8785 (LISTEN) Now we know the process id so we can look at the process. And unfortunately it's a defunct process. And its PPID is 1 so we can't kill its parent either (see How can I kill a process whose parent is init?). In theory init might eventually clean it up, but I got tired of waiting and rebooted. $ ps -lf -p 145661 F S UID PID PPID C PRI NI ADDR SZ WCHAN STIME TTY TIME CMD 0 Z drees 145661 1 2 80 0 - 0 exit May01 ? 00:40:10 envelope <defunct>","title":"Linux finding port origin"},{"location":"dotnet/blazor-wasm-collapsible-sidebar/","text":"Convert Standard menu To be able to better serve a smaller device in landscape mode - I began looking at a collapsible icon menu to fit into the Blazor WASM ecosystem. I found an article on Microsoft Tech Community covering this and a comment pointing to the commenters Github repo . With some minor modifications to suit my ideas - it became doable and I keeping this around for support my memory.","title":"Blazor WASM collapsible menu"},{"location":"dotnet/blazor-wasm-collapsible-sidebar/#convert-standard-menu","text":"To be able to better serve a smaller device in landscape mode - I began looking at a collapsible icon menu to fit into the Blazor WASM ecosystem. I found an article on Microsoft Tech Community covering this and a comment pointing to the commenters Github repo . With some minor modifications to suit my ideas - it became doable and I keeping this around for support my memory.","title":"Convert Standard menu"},{"location":"dotnet/blazor-wasm-pwa-service-worker/","text":"Update notifier Using a sw-registrator.js to expose service-worker.js and an update notification to be consumed by the Blazor WASM PWA. Drawing attention to outdated versions of a deployed web application is cumbersome and explaing the enduser they need to close all tabs and windows related to the app is equally cumbersome, and they tend to forget in heartbeat. Lucky for me - others have had the same issue - I found a nice workaround on Microsoft Tech Community with a reference to the original author Wouter Huysentruit and I am keeping them here to support my memory (flash memory, the kind that is gone in a flash)","title":"Blazor WASM PWA service-worker"},{"location":"dotnet/blazor-wasm-pwa-service-worker/#update-notifier","text":"Using a sw-registrator.js to expose service-worker.js and an update notification to be consumed by the Blazor WASM PWA. Drawing attention to outdated versions of a deployed web application is cumbersome and explaing the enduser they need to close all tabs and windows related to the app is equally cumbersome, and they tend to forget in heartbeat. Lucky for me - others have had the same issue - I found a nice workaround on Microsoft Tech Community with a reference to the original author Wouter Huysentruit and I am keeping them here to support my memory (flash memory, the kind that is gone in a flash)","title":"Update notifier"},{"location":"dotnet/csharp-api-response-custom-header/","text":"Customize API response with Custom Header and Expose the header to the client. using System.Collections.Generic; using System.Net.Http; using System.Net.Http.Formatting; using System.Threading; using System.Threading.Tasks; using System.Web.Http; using System.Web.Http.Results; namespace Inno.Api.Results { public class CustomOkResult<T> : OkNegotiatedContentResult<T> { public CustomOkResult(T content, IContentNegotiator contentNegotiator, HttpRequestMessage request, IEnumerable<MediaTypeFormatter> formatters) : base(content, contentNegotiator, request, formatters) { } public CustomOkResult(T content, ApiController controller) : base(content, controller) { } public string XPaginationContent { get; set; } public override async Task<HttpResponseMessage> ExecuteAsync(CancellationToken cancellationToken) { var response = await base.ExecuteAsync(cancellationToken); response.Headers.Add(\"Access-Control-Expose-Headers\", \"X-Pagination\"); response.Headers.Add(\"X-Pagination\", XPaginationContent); return response; } } } In controller response return new CustomOkResult<List<CrmCompany>>(companies, this) { XPaginationContent = JsonConvert.SerializeObject(companies.MetaData) };","title":"Web API2 Expose Custom Header"},{"location":"dotnet/dotnet-different-versions/","text":"Source https://aur.archlinux.org/packages/dotnet-host-bin IMPORTANT INSTALLATION INFO (a reminder for myself as well): For dotnet to work you need to EXPLICITLY install: ONE dotnet-host - highest version possible ANY NUMBER of dotnet-runtimes (and its sdks after if you want to build as well) If you keep the install order in mind and you don't rely on pacman to resolve your dependencies you will be fine. Longer explanation: Every dotnet-sdk is dependent on a specific version of dotnet-runtime, this is built into dotnet. Technically you only need the latest dotnet-sdk because it can build to any earlier versions.","title":"Different dotnet versions"},{"location":"dotnet/dotnet-notes-certificate/","text":"https://stackoverflow.com/a/50788371 https://wiki.archlinux.org/title/Transport_Layer_Security I was looking for sources of how to trust a certificate for local development. I found this https://andrewlock.net/creating-and-trusting-a-self-signed-certificate-on-linux-for-use-in-kestrel-and-asp-net-core/ I have copied the original article with the intent of going over the content to learn some more especially for chromium based browsers as Blazor WASM is hard to debug without a trusted certificate. Using Open SSL to create a self-signed certificate On Windows, creating a self-signed development certificate for development is often not necessary - Visual Studio automatically creates a development certificate for use with IIS Express, so if you run your apps this way, then you shouldn't have to deal with certificates directly. On the other hand, if you want to host Kestrel directly over HTTPS, then you'll need to work with certificates directly one way or another. On Linux, you'll either need to create a cert for Kestrel to use, or for a reverse-proxy like Nginx or HAProxy. After much googling, I took the approach described in this post. Creating a basic certificate using openssl Creating a self-signed cert with the openssl library on Linux is theoretically pretty simple. My first attempt was to use a script something like the following: openssl req -new -x509 -newkey rsa:2048 -keyout localhost.key -out localhost.cer -days 365 -subj /CN=localhost openssl pkcs12 -export -out localhost.pfx -inkey localhost.key -in localhost.cer This creates 3 files: localhost.cer - The public key for the SSL certificate localhost.key - The private key for the SSL certificate localhost.pfx - An X509 certificate containing both the public and private key. This is the file that will be used by our ASP.NET Core app to serve over HTTPS. The script creates a certificate with a \"Common Name\" for the localhost domain (the -subj /CN=localhost part of the script). That means we can use it to secure connections to the localhost domain when developing locally. The problem with this certificate is that it only includes a common name so the latest Chrome versions will not trust it. Instead, we need to create a certificate with a Subject Alternative Name (SAN) for the DNS record (i.e. localhost). The easiest way I found to do this was to use a .conf file containing all our settings, and to pass it to openssl. Creating a certificate with DNS SAN The following file shows the .conf config file that specifies the particulars of the certificate that we're going to create. I've included all of the details that you must specify when creating a certificate, such as the company, email address, location etc. If you're creating your own self signed certificate, be sure to change these details, and to add any extra DNS records you need. ``` [ req ] prompt = no default_bits = 2048 default_keyfile = localhost.pem distinguished_name = subject req_extensions = req_ext x509_extensions = x509_ext string_mask = utf8only The Subject DN can be formed using X501 or RFC 4514 (see RFC 4519 for a description). Its sort of a mashup. For example, RFC 4514 does not provide emailAddress. [ subject ] countryName = GB stateOrProvinceName = London localityName = London organizationName = .NET Escapades Use a friendly name here because its presented to the user. The server's DNS names are placed in Subject Alternate Names. Plus, DNS names here is deprecated by both IETF and CA/Browser Forums. If you place a DNS name here, then you must include the DNS name in the SAN too (otherwise, Chrome and others that strictly follow the CA/Browser Baseline Requirements will fail). commonName = Localhost dev cert emailAddress = test@test.com Section x509_ext is used when generating a self-signed certificate. I.e., openssl req -x509 ... [ x509_ext ] subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer You only need digitalSignature below. If you don't allow RSA Key transport (i.e., you use ephemeral cipher suites), then omit keyEncipherment because that's key transport. basicConstraints = CA:FALSE keyUsage = digitalSignature, keyEncipherment subjectAltName = @alternate_names nsComment = \"OpenSSL Generated Certificate\" RFC 5280, Section 4.2.1.12 makes EKU optional CA/Browser Baseline Requirements, Appendix (B)(3)(G) makes me confused In either case, you probably only need serverAuth. extendedKeyUsage = serverAuth, clientAuth Section req_ext is used when generating a certificate signing request. I.e., openssl req ... [ req_ext ] subjectKeyIdentifier = hash basicConstraints = CA:FALSE keyUsage = digitalSignature, keyEncipherment subjectAltName = @alternate_names nsComment = \"OpenSSL Generated Certificate\" RFC 5280, Section 4.2.1.12 makes EKU optional CA/Browser Baseline Requirements, Appendix (B)(3)(G) makes me confused In either case, you probably only need serverAuth. extendedKeyUsage = serverAuth, clientAuth [ alternate_names ] DNS.1 = localhost Add these if you need them. But usually you don't want them or need them in production. You may need them for development. DNS.5 = localhost DNS.6 = localhost.localdomain DNS.7 = 127.0.0.1 IPv6 localhost DNS.8 = ::1 ``` We save this config to a file called localhost.conf, and use it to create the certificate using a similar script as before. Just run this script in the same folder as the localhost.conf file. openssl req -config localhost.conf -new -x509 -sha256 -newkey rsa:2048 -nodes \\ -keyout localhost.key -days 3650 -out localhost.crt openssl pkcs12 -export -out localhost.pfx -inkey localhost.key -in localhost.crt This will ask you for an export password for your pfx file. Be sure that you provide a password and keep it safe - ASP.NET Core requires that you don't leave the password blank. You should now have an X509 certificate called localhost.pfx that you can use to add HTTPS to your app. Trusting the certificate Before we use the certificate in our apps, we need to trust it on our local machine. Exactly how you go about this varies depending on which flavour of Linux you're using. On top of that, some apps seem to use their own certificate stores, so trusting the cert globally won't necessarily mean it's trusted in all of your apps. The following example worked for me on Ubuntu 16.04, and kept Chrome happy, but I had to explicitly add an exception to Firefox when I first used the cert. Install the cert utils sudo apt install libnss3-tools Trust the certificate for SSL pk12util -d sql:$HOME/.pki/nssdb -i localhost.pfx Trust a self-signed server certificate certutil -d sql:$HOME/.pki/nssdb -A -t \"P,,\" -n 'dev cert' -i localhost.crt As I said before, I'm not a Linux guy, so I'm not entirely sure if you need to run both of the trust commands, but I did just in case! If anyone knows a better approach I'm all ears :) We've now created a self-signed certificate with a DNS SAN name for localhost, and we trust it on the development machine. The last thing remaining is to use it in our app. Configuring Kestrel to use your self-signed certificate For simplicity, I'm just going to show how to load the localhost.pfx certificate in your app from the .pfx file, and how configure Kestrel to use it to serve requests over HTTPS. I've hard-coded the .pfx password in this example for simplicity, but you should load it from configuration instead. Warning You should never include the password directly like this in a production app. The following example is for ASP.NET Core 2.0 - Shawn Wildermuth has an example of how to add SSL in ASP.NET Core 1.X (as well as how to create a self-signed cert on Windows). ``` public class Program { public static void Main(string[] args) { BuildWebHost(args).Run(); } public static IWebHost BuildWebHost(string[] args) => return WebHost.CreateDefaultBuilder() .UseKestrel(options => { // Configure the Url and ports to bind to // This overrides calls to UseUrls and the ASPNETCORE_URLS environment variable, but will be // overridden if you call UseIisIntegration() and host behind IIS/IIS Express options.Listen(IPAddress.Loopback, 5001); options.Listen(IPAddress.Loopback, 5002, listenOptions => { listenOptions.UseHttps(\"localhost.pfx\", \"testpassword\"); }); }) .UseStartup<Startup>() .Build(); } ``` Although CreateDefaultBuilder() adds Kestrel to the app anyway, you can call UseKestrel() again and specify additional options. Here we are defining two URLs and ports to listen on (The IPAddress.Loopback address corresponds to localhost or 127.0.0.1): http://localhost:5001 - An unsecured end point https://localhost:5002 - Secured using our SSL cert We add HTTPS to the second Listen() call with the UseHttps() extension method. There are several overloads of the method, which allow you to provide an X509Certificate2 object directly, or as in this case, a filename and password to a certificate. If everything is configured correctly, you should be able to view the app in Chrome, and see a nice, green, Secure padlock:","title":"Creating a dotnet development certificate"},{"location":"dotnet/dotnet-notes-certificate/#using-open-ssl-to-create-a-self-signed-certificate","text":"On Windows, creating a self-signed development certificate for development is often not necessary - Visual Studio automatically creates a development certificate for use with IIS Express, so if you run your apps this way, then you shouldn't have to deal with certificates directly. On the other hand, if you want to host Kestrel directly over HTTPS, then you'll need to work with certificates directly one way or another. On Linux, you'll either need to create a cert for Kestrel to use, or for a reverse-proxy like Nginx or HAProxy. After much googling, I took the approach described in this post. Creating a basic certificate using openssl Creating a self-signed cert with the openssl library on Linux is theoretically pretty simple. My first attempt was to use a script something like the following: openssl req -new -x509 -newkey rsa:2048 -keyout localhost.key -out localhost.cer -days 365 -subj /CN=localhost openssl pkcs12 -export -out localhost.pfx -inkey localhost.key -in localhost.cer This creates 3 files: localhost.cer - The public key for the SSL certificate localhost.key - The private key for the SSL certificate localhost.pfx - An X509 certificate containing both the public and private key. This is the file that will be used by our ASP.NET Core app to serve over HTTPS. The script creates a certificate with a \"Common Name\" for the localhost domain (the -subj /CN=localhost part of the script). That means we can use it to secure connections to the localhost domain when developing locally. The problem with this certificate is that it only includes a common name so the latest Chrome versions will not trust it. Instead, we need to create a certificate with a Subject Alternative Name (SAN) for the DNS record (i.e. localhost). The easiest way I found to do this was to use a .conf file containing all our settings, and to pass it to openssl.","title":"Using Open SSL to create a self-signed certificate"},{"location":"dotnet/dotnet-notes-certificate/#creating-a-certificate-with-dns-san","text":"The following file shows the .conf config file that specifies the particulars of the certificate that we're going to create. I've included all of the details that you must specify when creating a certificate, such as the company, email address, location etc. If you're creating your own self signed certificate, be sure to change these details, and to add any extra DNS records you need. ``` [ req ] prompt = no default_bits = 2048 default_keyfile = localhost.pem distinguished_name = subject req_extensions = req_ext x509_extensions = x509_ext string_mask = utf8only","title":"Creating a certificate with DNS SAN"},{"location":"dotnet/dotnet-notes-certificate/#the-subject-dn-can-be-formed-using-x501-or-rfc-4514-see-rfc-4519-for-a-description","text":"","title":"The Subject DN can be formed using X501 or RFC 4514 (see RFC 4519 for a description)."},{"location":"dotnet/dotnet-notes-certificate/#its-sort-of-a-mashup-for-example-rfc-4514-does-not-provide-emailaddress","text":"[ subject ] countryName = GB stateOrProvinceName = London localityName = London organizationName = .NET Escapades","title":"Its sort of a mashup. For example, RFC 4514 does not provide emailAddress."},{"location":"dotnet/dotnet-notes-certificate/#use-a-friendly-name-here-because-its-presented-to-the-user-the-servers-dns","text":"","title":"Use a friendly name here because its presented to the user. The server's DNS"},{"location":"dotnet/dotnet-notes-certificate/#names-are-placed-in-subject-alternate-names-plus-dns-names-here-is-deprecated","text":"","title":"names are placed in Subject Alternate Names. Plus, DNS names here is deprecated"},{"location":"dotnet/dotnet-notes-certificate/#by-both-ietf-and-cabrowser-forums-if-you-place-a-dns-name-here-then-you","text":"","title":"by both IETF and CA/Browser Forums. If you place a DNS name here, then you"},{"location":"dotnet/dotnet-notes-certificate/#must-include-the-dns-name-in-the-san-too-otherwise-chrome-and-others-that","text":"","title":"must include the DNS name in the SAN too (otherwise, Chrome and others that"},{"location":"dotnet/dotnet-notes-certificate/#strictly-follow-the-cabrowser-baseline-requirements-will-fail","text":"commonName = Localhost dev cert emailAddress = test@test.com","title":"strictly follow the CA/Browser Baseline Requirements will fail)."},{"location":"dotnet/dotnet-notes-certificate/#section-x509_ext-is-used-when-generating-a-self-signed-certificate-ie-openssl-req-x509","text":"[ x509_ext ] subjectKeyIdentifier = hash authorityKeyIdentifier = keyid,issuer","title":"Section x509_ext is used when generating a self-signed certificate. I.e., openssl req -x509 ..."},{"location":"dotnet/dotnet-notes-certificate/#you-only-need-digitalsignature-below-if-you-dont-allow","text":"","title":"You only need digitalSignature below. If you don't allow"},{"location":"dotnet/dotnet-notes-certificate/#rsa-key-transport-ie-you-use-ephemeral-cipher-suites-then","text":"","title":"RSA Key transport (i.e., you use ephemeral cipher suites), then"},{"location":"dotnet/dotnet-notes-certificate/#omit-keyencipherment-because-thats-key-transport","text":"basicConstraints = CA:FALSE keyUsage = digitalSignature, keyEncipherment subjectAltName = @alternate_names nsComment = \"OpenSSL Generated Certificate\"","title":"omit keyEncipherment because that's key transport."},{"location":"dotnet/dotnet-notes-certificate/#rfc-5280-section-42112-makes-eku-optional","text":"","title":"RFC 5280, Section 4.2.1.12 makes EKU optional"},{"location":"dotnet/dotnet-notes-certificate/#cabrowser-baseline-requirements-appendix-b3g-makes-me-confused","text":"","title":"CA/Browser Baseline Requirements, Appendix (B)(3)(G) makes me confused"},{"location":"dotnet/dotnet-notes-certificate/#in-either-case-you-probably-only-need-serverauth","text":"","title":"In either case, you probably only need serverAuth."},{"location":"dotnet/dotnet-notes-certificate/#extendedkeyusage-serverauth-clientauth","text":"","title":"extendedKeyUsage = serverAuth, clientAuth"},{"location":"dotnet/dotnet-notes-certificate/#section-req_ext-is-used-when-generating-a-certificate-signing-request-ie-openssl-req","text":"[ req_ext ] subjectKeyIdentifier = hash basicConstraints = CA:FALSE keyUsage = digitalSignature, keyEncipherment subjectAltName = @alternate_names nsComment = \"OpenSSL Generated Certificate\"","title":"Section req_ext is used when generating a certificate signing request. I.e., openssl req ..."},{"location":"dotnet/dotnet-notes-certificate/#rfc-5280-section-42112-makes-eku-optional_1","text":"","title":"RFC 5280, Section 4.2.1.12 makes EKU optional"},{"location":"dotnet/dotnet-notes-certificate/#cabrowser-baseline-requirements-appendix-b3g-makes-me-confused_1","text":"","title":"CA/Browser Baseline Requirements, Appendix (B)(3)(G) makes me confused"},{"location":"dotnet/dotnet-notes-certificate/#in-either-case-you-probably-only-need-serverauth_1","text":"","title":"In either case, you probably only need serverAuth."},{"location":"dotnet/dotnet-notes-certificate/#extendedkeyusage-serverauth-clientauth_1","text":"[ alternate_names ] DNS.1 = localhost","title":"extendedKeyUsage = serverAuth, clientAuth"},{"location":"dotnet/dotnet-notes-certificate/#add-these-if-you-need-them-but-usually-you-dont-want-them-or","text":"","title":"Add these if you need them. But usually you don't want them or"},{"location":"dotnet/dotnet-notes-certificate/#need-them-in-production-you-may-need-them-for-development","text":"","title":"need them in production. You may need them for development."},{"location":"dotnet/dotnet-notes-certificate/#dns5-localhost","text":"","title":"DNS.5 = localhost"},{"location":"dotnet/dotnet-notes-certificate/#dns6-localhostlocaldomain","text":"","title":"DNS.6 = localhost.localdomain"},{"location":"dotnet/dotnet-notes-certificate/#dns7-127001","text":"","title":"DNS.7 = 127.0.0.1"},{"location":"dotnet/dotnet-notes-certificate/#ipv6-localhost","text":"","title":"IPv6 localhost"},{"location":"dotnet/dotnet-notes-certificate/#dns8-1","text":"``` We save this config to a file called localhost.conf, and use it to create the certificate using a similar script as before. Just run this script in the same folder as the localhost.conf file. openssl req -config localhost.conf -new -x509 -sha256 -newkey rsa:2048 -nodes \\ -keyout localhost.key -days 3650 -out localhost.crt openssl pkcs12 -export -out localhost.pfx -inkey localhost.key -in localhost.crt This will ask you for an export password for your pfx file. Be sure that you provide a password and keep it safe - ASP.NET Core requires that you don't leave the password blank. You should now have an X509 certificate called localhost.pfx that you can use to add HTTPS to your app.","title":"DNS.8 = ::1"},{"location":"dotnet/dotnet-notes-certificate/#trusting-the-certificate","text":"Before we use the certificate in our apps, we need to trust it on our local machine. Exactly how you go about this varies depending on which flavour of Linux you're using. On top of that, some apps seem to use their own certificate stores, so trusting the cert globally won't necessarily mean it's trusted in all of your apps. The following example worked for me on Ubuntu 16.04, and kept Chrome happy, but I had to explicitly add an exception to Firefox when I first used the cert.","title":"Trusting the certificate"},{"location":"dotnet/dotnet-notes-certificate/#install-the-cert-utils","text":"sudo apt install libnss3-tools","title":"Install the cert utils"},{"location":"dotnet/dotnet-notes-certificate/#trust-the-certificate-for-ssl","text":"pk12util -d sql:$HOME/.pki/nssdb -i localhost.pfx","title":"Trust the certificate for SSL"},{"location":"dotnet/dotnet-notes-certificate/#trust-a-self-signed-server-certificate","text":"certutil -d sql:$HOME/.pki/nssdb -A -t \"P,,\" -n 'dev cert' -i localhost.crt As I said before, I'm not a Linux guy, so I'm not entirely sure if you need to run both of the trust commands, but I did just in case! If anyone knows a better approach I'm all ears :) We've now created a self-signed certificate with a DNS SAN name for localhost, and we trust it on the development machine. The last thing remaining is to use it in our app. Configuring Kestrel to use your self-signed certificate For simplicity, I'm just going to show how to load the localhost.pfx certificate in your app from the .pfx file, and how configure Kestrel to use it to serve requests over HTTPS. I've hard-coded the .pfx password in this example for simplicity, but you should load it from configuration instead. Warning You should never include the password directly like this in a production app. The following example is for ASP.NET Core 2.0 - Shawn Wildermuth has an example of how to add SSL in ASP.NET Core 1.X (as well as how to create a self-signed cert on Windows). ``` public class Program { public static void Main(string[] args) { BuildWebHost(args).Run(); } public static IWebHost BuildWebHost(string[] args) => return WebHost.CreateDefaultBuilder() .UseKestrel(options => { // Configure the Url and ports to bind to // This overrides calls to UseUrls and the ASPNETCORE_URLS environment variable, but will be // overridden if you call UseIisIntegration() and host behind IIS/IIS Express options.Listen(IPAddress.Loopback, 5001); options.Listen(IPAddress.Loopback, 5002, listenOptions => { listenOptions.UseHttps(\"localhost.pfx\", \"testpassword\"); }); }) .UseStartup<Startup>() .Build(); } ``` Although CreateDefaultBuilder() adds Kestrel to the app anyway, you can call UseKestrel() again and specify additional options. Here we are defining two URLs and ports to listen on (The IPAddress.Loopback address corresponds to localhost or 127.0.0.1): http://localhost:5001 - An unsecured end point https://localhost:5002 - Secured using our SSL cert We add HTTPS to the second Listen() call with the UseHttps() extension method. There are several overloads of the method, which allow you to provide an X509Certificate2 object directly, or as in this case, a filename and password to a certificate. If everything is configured correctly, you should be able to view the app in Chrome, and see a nice, green, Secure padlock:","title":"Trust a self-signed server certificate"},{"location":"macos/macos-create-installer-image/","text":"To download a full installer For macOS Big Sur softwareupdate --fetch-full-installer --full-installer-version 11.3 Replacing the version will download the version - e.g. Catalina has version 10.15.3 Converting installer to iso hdiutil create -o /tmp/BigSur -size 12500m -volname BigSur -layout SPUD -fs HFS+J hdiutil attach /tmp/BigSur.dmg -noverify -mountpoint /Volumes/BigSur sudo /Applications/Install\\ macOS\\ Big\\ Sur/Contents/Resources/createinstallmedia --volume /Volumes/BigSur --nointeraction hdiutil detach /Volumes/BigSur/ hdiutil convert /tmp/BigSur.dmg -format UDTO -o ~/Desktop/BigSur.cdr mv ~/Desktop/BigSur.cdr.dmg ~/Desktop/BigSur.iso Create Virtualbox VM VBoxInternal/Devices/efi/0/Config/DmiSystemProduct\" \"MacBookPro11,3\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/efi/0/Config/DmiSystemVersion\" \"1.0\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/efi/0/Config/DmiBoardProduct\" \"Mac-2BD1B31983FE1663\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/smc/0/Config/DeviceKey\" \"ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC\" 1 VM screen size It seems macOS on VBox is limited to 1024x768, 1280x720, 1920x1080, 2560x1440 VBoxManage setextradata \"Big Sur\" \"VBoxInternal2/EfiGraphicsResolution 1280x720\"","title":"macOS installer"},{"location":"macos/macos-create-installer-image/#to-download-a-full-installer","text":"For macOS Big Sur softwareupdate --fetch-full-installer --full-installer-version 11.3 Replacing the version will download the version - e.g. Catalina has version 10.15.3","title":"To download a full installer"},{"location":"macos/macos-create-installer-image/#converting-installer-to-iso","text":"hdiutil create -o /tmp/BigSur -size 12500m -volname BigSur -layout SPUD -fs HFS+J hdiutil attach /tmp/BigSur.dmg -noverify -mountpoint /Volumes/BigSur sudo /Applications/Install\\ macOS\\ Big\\ Sur/Contents/Resources/createinstallmedia --volume /Volumes/BigSur --nointeraction hdiutil detach /Volumes/BigSur/ hdiutil convert /tmp/BigSur.dmg -format UDTO -o ~/Desktop/BigSur.cdr mv ~/Desktop/BigSur.cdr.dmg ~/Desktop/BigSur.iso","title":"Converting installer to iso"},{"location":"macos/macos-create-installer-image/#create-virtualbox-vm","text":"VBoxInternal/Devices/efi/0/Config/DmiSystemProduct\" \"MacBookPro11,3\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/efi/0/Config/DmiSystemVersion\" \"1.0\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/efi/0/Config/DmiBoardProduct\" \"Mac-2BD1B31983FE1663\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/smc/0/Config/DeviceKey\" \"ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\" VBoxManage setextradata \"Big Sur\" \"VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC\" 1","title":"Create Virtualbox VM"},{"location":"macos/macos-create-installer-image/#vm-screen-size","text":"It seems macOS on VBox is limited to 1024x768, 1280x720, 1920x1080, 2560x1440 VBoxManage setextradata \"Big Sur\" \"VBoxInternal2/EfiGraphicsResolution 1280x720\"","title":"VM screen size"},{"location":"manjaro/ai/manjaro-folding-at-home/","text":"System AI engine ollama llm gpt-oss:120b prompt How can I configure Manjaro Linux for use with Folding@Home using AMD W7500 OS os Manjaro Linux branch unstable kernel Linux 6.16 Hardware GPU Radeon 7900XTX CPU Ryzen 5945WX RAM 64G DISCLAIMER - AI GENERATED CONTENT Verify by crossreferencing the current Manjaro repo and Folding@home - archlinux wiki Below is a step\u2011by\u2011step, copy\u2011and\u2011paste ready guide for turning a fresh (or already\u2011running) Manjaro Linux installation into a Folding@home (FAH) GPU workstation that uses an AMD Radeon\u202fW7500 . It covers everything you need to know: 1\ufe0f\u20e3 Preparing the system \u2013 updates, kernel, user, firewall 2\ufe0f\u20e3 Installing the correct AMD OpenCL stack for the W7500 (open\u2011source + optional proprietary) 3\ufe0f\u20e3 Verifying OpenCL works ( clinfo ) 4\ufe0f\u20e3 Installing the FAH client (official package or from source) 5\ufe0f\u20e3 Configuring the FAH client for GPU\u2011only work, setting a custom team, passkey, power\u2011limit, etc. 6\ufe0f\u20e3 Managing the service (systemd) and monitoring progress (web UI, FAHControl , FAHLog ) 7\ufe0f\u20e3 Tweaking performance / power\u2011saving options specific to the W7500 8\ufe0f\u20e3 Common pitfalls & troubleshooting checklist 1\ufe0f\u20e3 System preparation Why? Manjaro ships with a rolling\u2011release kernel and a fairly recent Mesa stack, but we still want to make sure the kernel, firmware and user permissions are ready for AMD\u2019s OpenCL drivers. # 1. Refresh keyrings and update everything sudo pacman -Syyu --noconfirm # 2. Install the generic development tools (git, base-devel, etc.) sudo pacman -S --needed base-devel git # 3. Install a modern LTS kernel (optional, but recommended for better driver support) # If you already run the default kernel (e.g., 6.7.x) you can skip this. sudo mhwd-kernel -i linux61 # or linux62, linux63 \u2013 whichever is current LTS in Manjaro repos # 4. Reboot into the new kernel (or keep your current one if it works) reboot Create a dedicated \u201cfolding\u201d user (optional but clean) sudo useradd -m -G video,wheel -s /bin/bash folding # set a password (you\u2019ll need it later) sudo passwd folding Tip: Adding the user to the video group gives it permission to access the GPU device nodes ( /dev/dri/* ). If you run FAH under your regular user, just make sure that user is in video . Firewall (if you enable one) FAH uses port\u202f80/443 for control, port\u202f7396 for the web UI and port\u202f36330 for the optional \u201cslot\u201d server. The default ufw rules are enough: # If you have ufw enabled sudo ufw allow 7396/tcp sudo ufw allow 36330/tcp sudo ufw reload 2\ufe0f\u20e3 Install the AMD OpenCL stack for the Radeon\u202fW7500 The W7500 is a Polaris\u2011based GPU (GCN 4). It is fully supported by the open\u2011source amdgpu driver + Mesa OpenCL ( ROCm is not required). However, you can also install the AMDGPU\u2011PRO OpenCL runtime for a modest performance boost. 2\u2011a. Open\u2011source stack (recommended) # Core driver + firmware (Manjaro already ships this, but reinstall to be safe) sudo pacman -S --needed xf86-video-amdgpu mesa opencl-mesa libclc # Install the OpenCL ICD loader (already part of mesa-opencl, but keep it explicit) sudo pacman -S --needed ocl-icd # Verify the ICD file exists cat /etc/OpenCL/vendors/mesa.icd # \u2192 should output: libRusticlOpenCL.so.1 2\u2011b. (Optional) AMDGPU\u2011PRO OpenCL runtime UNVERIFIED CHECK upstream on amd.com for the update drivers If you want the proprietary amdgpu-pro OpenCL libraries (they can be ~5\u201110\u202f% faster on some kernels), do the following once . It will coexist with the open\u2011source stack \u2013 the ICD loader will pick the \u201cpro\u201d library if present. # Install the helper script that pulls the latest Pro package from AMD # (Works on Manjaro because we use the official .tar.xz release) mkdir -p ~/amdpro && cd ~/amdpro wget -O amdgpu-pro.tar.xz \\ https://drivers.amd.com/drivers/linux/amdgpu-pro-22.50-1290604-ubuntu-22.04.tar.xz tar -xf amdgpu-pro.tar.xz cd amdgpu-pro-22.50-1290604-ubuntu-22.04 # Install ONLY the OpenCL portion \u2013 we keep the open\u2011source driver sudo ./amdgpu-install -y --opencl=legacy,pal --headless # The installer puts an extra ICD entry: cat /etc/OpenCL/vendors/amdgpu-pro.icd # \u2192 should point to libamdocl64.so (or libamdocl64.so.1) Important: After installing the proprietary OpenCL, you must re\u2011boot so that the kernel module picks up the new firmware. 2\u2011c. Verify OpenCL works VERIFIED USING W7100 # Install a tiny helper to query OpenCL devices sudo pacman -S --needed clinfo # Run it \u2013 you should see at least one \u201cAMD Radeon W7500\u201d device clinfo | grep -i \"AMD\\|W7500\" Typical output (open\u2011source stack): $ clinfo | grep -i \"AMD\\|7100\" Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) Device Vendor AMD Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) ... If you see \u201cNumber of platforms = 0\u201d , double\u2011check that: the amdgpu kernel driver is loaded ( lsmod | grep amdgpu ) the user is in the video group /dev/dri/renderD* nodes exist and are readable/writable ( ls -l /dev/dri/ ) 3\ufe0f\u20e3 Install the Folding@home client Build the FAH client ( foldingathome ) from AUR. AUR packages may cease to function on system updates. If that happens you need to rebuild your FAH client. pamac build foldingathome Alternative \u2013 compile the very latest client (useful if you want a bleeding\u2011edge patch) cd ~ git clone https://github.com/FoldingAtHome/fah-client.git cd fah-client ./configure && make -j$(nproc) && sudo make install 4\ufe0f\u20e3 Configure the FAH client for GPU\u2011only work 4\u2011a. Generate a basic configuration file The first time the client runs, it will create ~/.config/FoldingAtHome/FAHClient.cfg . We will edit it manually to lock the client to the GPU slot. # If you installed as a dedicated user, become that user sudo -iu folding # Run the client once to generate a default config (it will pause and ask for team/passkey) fah-client & sleep 5 kill %1 # stop the temporary instance Now edit the config: sudo micro ~/.config/FoldingAtHome/FAHClient.cfg Paste the following (replace TEAM , PASSKEY , POWER as you wish): #------------------------------------------------- # Folding@home client configuration \u2013 GPU only #------------------------------------------------- # 1. Identity user = folding # any name you like team = 0 # 0 = default team; replace with your own team number (e.g., 12345) passkey = # optional \u2013 put your personal passkey here if you have one # 2. Slots \u2013 we only want a GPU slot slot.0.type = GPU slot.0.device = 0 # first GPU (0\u2011based). If you have multiple GPUs, you can add slot.1, slot.2, etc. slot.0.power = 75 # % of max power the client may draw (default 100). 75% is a good compromise. slot.0.enabled = true # 3. Turn off CPU slots (optional but saves CPU cycles) slot.1.type = CPU slot.1.enabled = false # 4. Network & security web-allow = 7396 # port for the built\u2011in web UI (http://localhost:7396) allow = 0/0/0 # allow all IPs (you can tighten this later) # 5. Misc gpu-allow = 0/0/0 # allow all GPUs \u2013 you can restrict by vendor if you ever add an NVIDIA card pause-on-battery = false # If you run a laptop \u2013 set true to avoid running on battery Save ( Ctrl+s ) and exit ( Ctrl+q ). 4\u2011b. Optional \u2013 set a custom \u201cpasskey\u201d (recommended for tracking) If you have a personal Folding@home account, generate a passkey on the website (https://foldingathome.org/passkey) and paste it into the passkey = line above. This links the work units to your account and gives you credit on the leaderboard. 4\u2011c. Set resource limits for the W7500 The Radeon\u202fW7500 can draw \u2248\u202f150\u202fW at full load. To keep the system cool and the power bill modest, you can: Throttle via the client ( slot.0.power = 70 \u2192 ~105\u202fW). Set a kernel power profile with amdgpu sysfs: # As root echo \"low\" > /sys/class/drm/card0/device/power_dpm_force_performance_level # or for a fine\u2011grained PWM limit: echo 80 > /sys/class/drm/card0/device/pp_dpm_sclk The client\u2019s slot.0.power is the easiest way because it is respected automatically for each work unit. 5\ufe0f\u20e3 Enable & start the service When you build the client, a systemd unit called fahclient.service was created. # Enable it for the dedicated folding user (or your own user) sudo systemctl enable fahclient.service sudo systemctl start fahclient.service # Check status sudo systemctl status fahclient.service You should see something like: \u25cf fahclient.service - Folding@home client Loaded: loaded (/usr/lib/systemd/system/fahclient.service; enabled; vendor preset: disabled) Active: active (running) since Fri 2025-09-20 \u2026 Main PID: 1234 (FAHClient) Tasks: 4 (limit: 4915) Memory: 150.0M CGroup: /system.slice/fahclient.service \u2514\u25001234 /usr/bin/FAHClient -v If you compiled the client yourself, you can create a simple service file: sudo nano /etc/systemd/system/fahclient.service [Unit] Description=Folding@home client After=network-online.target Wants=network-online.target [Service] Type=simple User=folding # or your own user ExecStart=/usr/local/bin/FAHClient -v Restart=on-failure RestartSec=10 [Install] WantedBy=multi-user.target sudo systemctl daemon-reload sudo systemctl enable --now fahclient.service Verify that the GPU slot is active # The client logs to ~/.config/FoldingAtHome/FAHClient.log tail -f ~/.config/FoldingAtHome/FAHClient.log You should see lines like: [INFO] slot 0 (GPU) is now working on core 2025-05-04 (Molecular Dynamics) on AMD Radeon W7500 [INFO] slot 0: using 75% power limit If you see slot 0: no OpenCL platform found , double\u2011check the OpenCL setup (section 2\u2011c). 6\ufe0f\u20e3 Monitoring & controlling your folding node Tool How to use What you see Web UI (built\u2011in) Open http://localhost:7396 in a browser (or http://<IP>:7396 from another machine) Real\u2011time work unit progress, GPU temperature, power usage, credit earned FAHControl (GUI) sudo pacman -S fahcontrol then launch FAHControl Same as web UI, but with a desktop app; can change slots on\u2011the\u2011fly FAHLog (CLI) FAHLog -t (tail) Live log output (same as tail -f on the log file) clinfo clinfo Confirms OpenCL platform/device details \u2013 handy for debugging driver issues systemd systemctl status fahclient / journalctl -u fahclient -f Service health, restarts, crash logs Tip: If you run the node headless (no monitor), you can tunnel the web UI over SSH: ssh -L 7396:localhost:7396 folding@your-node-ip # then point your local browser to http://localhost:7396 7\ufe0f\u20e3 Performance\u2011tuning specific to the Radeon\u202fW7500 Setting Command Effect Recommended value Client power limit slot.0.power = 70 (in config) Caps GPU power, reduces heat & fan noise 70\u202f% for 24/7 home use; 85\u202f% if you need more credit OpenCL work\u2011size slot.0.gpu-allow = 0/0/0 (default) \u2013 you can add slot.0.gpu-allow = 0/0/256 to limit work\u2011group size if you see instability Some kernels mis\u2011behave on older Polaris chips at large work\u2011groups Not needed for most users; leave default Kernel performance level echo high > /sys/class/drm/card0/device/power_dpm_force_performance_level (root) Forces the GPU to stay in \u201chigh\u201d performance state, slightly better throughput but more heat Use high if you notice the GPU dropping to low power frequently (check dmesg | grep amdgpu ) Fan control Install amdgpu-fan from AUR ( yay -S amdgpu-fan ) and set a custom curve (e.g., 60\u202f% at 50\u202f\u00b0C) Keeps temps under control without constant full\u2011speed fan 40\u201160\u202f% fan speed is usually fine for 70\u202f% power limit CPU affinity (if you keep a tiny CPU slot) taskset -c 0-3 FAHClient in a wrapper script Keeps the client from stealing cores you might need for other tasks Not required when CPU slot disabled Example: Adding a fan curve (optional) # Install the helper yay -S amdgpu-fan # Create a simple profile (e.g., 30% at 40\u00b0C, 60% at 55\u00b0C, 100% at 70\u00b0C) sudo tee /etc/amdgpu-fan.conf > /dev/null <<'EOF' [fan0] temp=40,30 temp=55,60 temp=70,100 EOF # Enable the daemon sudo systemctl enable --now amdgpu-fan.service 8\ufe0f\u20e3 Common pitfalls & quick\u2011fix checklist Symptom Likely cause Fix FAHClient exits with \u201cno OpenCL platform found\u201d - User not in video group - amdgpu driver not loaded - Wrong ICD file order (Pro overrides open\u2011source) sudo usermod -aG video $USER && newgrp video Verify lsmod | grep amdgpu Ensure /etc/OpenCL/vendors/mesa.icd exists and amdgpu-pro.icd (if installed) points to a real lib GPU shows 0\u202f% utilization in clinfo / FAH UI - Power limit set to 0 (or slot.0.power = 0 ) - GPU in \u201clow\u201d performance mode due to thermal throttling Set slot.0.power to a non\u2011zero value (\u2265\u202f50) Run cat /sys/class/drm/card0/device/pp_dpm_sclk to see if clocks are stuck; if so, echo high > /sys/.../power_dpm_force_performance_level FAH client crashes with \u201cSegmentation fault (core dumped)\u201d - Mismatch between Mesa OpenCL version and AMDGPU\u2011PRO libs - Out\u2011of\u2011date kernel (older kernels have bugs with Polaris) Remove the proprietary ICD ( sudo rm /etc/OpenCL/vendors/amdgpu-pro.icd ) and stick to the open\u2011source stack, OR update to the latest kernel ( mhwd-kernel -li \u2192 install newest) System hangs when folding starts - Insufficient power supply (W7500 draws ~150\u202fW) - Overheating (GPU fan stuck) Verify PSU rating (>\u202f400\u202fW) Check temps with sensors (install lm_sensors ) Clean dust, ensure fan spins FAH shows \u201cNo credit earned\u201d despite work - You forgot to add your passkey or team - You are using the default team 0 (which still gives credit, but you may be confused) Add your personal passkey in FAHClient.cfg Or join a team and set team = <your\u2011team\u2011id> Web UI unreachable from another machine - Firewall blocking 7396 - allow setting restricts IPs sudo ufw allow 7396/tcp Set allow = 0/0/0 in the config or specify allow = 192.168.1.0/24/0 \ud83d\udce6 Full \u201cone\u2011shot\u201d script (optional) If you want to automate everything (except your personal team/passkey), copy\u2011paste the following script as root (or use sudo -i first). It will: Update the system Install the open\u2011source AMDGPU + OpenCL stack Install FAH client Create a folding user (or use the current user) Write a ready\u2011to\u2011run config with a 70\u202f% power limit #!/usr/bin/env bash set -euo pipefail # ------------------------------------------------- # 1\ufe0f\u20e3 System update # ------------------------------------------------- pacman -Syyu --noconfirm # ------------------------------------------------- # 2\ufe0f\u20e3 Install required packages # ------------------------------------------------- pacman -S --needed base-devel git xf86-video-amdgpu mesa mesa-opencl libclc ocl-icd clinfo folding-at-home # ------------------------------------------------- # 3\ufe0f\u20e3 (Optional) create dedicated user # ------------------------------------------------- if ! id -u folding &>/dev/null; then useradd -m -G video,wheel -s /bin/bash folding echo \"Created user 'folding' (set a password when prompted)\" passwd folding fi # ------------------------------------------------- # 4\ufe0f\u20e3 Verify OpenCL # ------------------------------------------------- if ! clinfo | grep -iq \"AMD Radeon W7500\"; then echo \"\u26a0\ufe0f OpenCL detection failed. Please reboot and ensure the amdgpu driver loads.\" exit 1 fi # ------------------------------------------------- # 5\ufe0f\u20e3 Write config (for the chosen user) # ------------------------------------------------- TARGET_USER=${SUDO_USER:-$(whoami)} HOME_DIR=$(eval echo \"~$TARGET_USER\") CONFIG_DIR=\"$HOME_DIR/.config/FoldingAtHome\" mkdir -p \"$CONFIG_DIR\" cat > \"$CONFIG_DIR/FAHClient.cfg\" <<'EOF' # Folding@home client config \u2013 GPU only (W7500) user = folding team = 0 # replace with your team number if you have one passkey = # optional \u2013 paste your personal passkey here slot.0.type = GPU slot.0.device = 0 slot.0.power = 70 slot.0.enabled = true slot.1.type = CPU slot.1.enabled = false web-allow = 7396 allow = 0/0/0 gpu-allow = 0/0/0 pause-on-battery = false EOF chown -R \"$TARGET_USER\":\"$TARGET_USER\" \"$CONFIG_DIR\" # ------------------------------------------------- # 6\ufe0f\u20e3 Enable & start the service # ------------------------------------------------- systemctl enable --now fahclient.service echo \"\u2705 Setup complete! Check the log at $CONFIG_DIR/FAHClient.log\" echo \"\ud83c\udf10 Open http://$(hostname -I | awk '{print $1}'):7396 to watch your folding progress.\" Run it with: chmod +x setup_fah_w7500.sh sudo ./setup_fah_w7500.sh After the reboot (or after the script finishes), open the web UI and you should see the GPU slot actively folding. \ud83c\udf89 You\u2019re done! Your Manjaro box with a Radeon\u202fW7500 is now contributing to the world\u2011wide Folding@home project . Check the web UI regularly to see work\u2011unit progress and credit. Keep the system updated ( sudo pacman -Syu ) \u2013 newer kernels and Mesa releases often bring modest OpenCL speed gains. If you ever add another GPU (e.g., an NVIDIA RTX), just add another slot.N block in the same config and the client will automatically use both. Happy folding, and thank you for donating your GPU cycles to science! \ud83d\ude80\ud83e\uddec","title":"Manjaro Folding@Home"},{"location":"manjaro/ai/manjaro-folding-at-home/#system","text":"AI engine ollama llm gpt-oss:120b prompt How can I configure Manjaro Linux for use with Folding@Home using AMD W7500 OS os Manjaro Linux branch unstable kernel Linux 6.16 Hardware GPU Radeon 7900XTX CPU Ryzen 5945WX RAM 64G","title":"System"},{"location":"manjaro/ai/manjaro-folding-at-home/#disclaimer-ai-generated-content","text":"Verify by crossreferencing the current Manjaro repo and Folding@home - archlinux wiki Below is a step\u2011by\u2011step, copy\u2011and\u2011paste ready guide for turning a fresh (or already\u2011running) Manjaro Linux installation into a Folding@home (FAH) GPU workstation that uses an AMD Radeon\u202fW7500 . It covers everything you need to know: 1\ufe0f\u20e3 Preparing the system \u2013 updates, kernel, user, firewall 2\ufe0f\u20e3 Installing the correct AMD OpenCL stack for the W7500 (open\u2011source + optional proprietary) 3\ufe0f\u20e3 Verifying OpenCL works ( clinfo ) 4\ufe0f\u20e3 Installing the FAH client (official package or from source) 5\ufe0f\u20e3 Configuring the FAH client for GPU\u2011only work, setting a custom team, passkey, power\u2011limit, etc. 6\ufe0f\u20e3 Managing the service (systemd) and monitoring progress (web UI, FAHControl , FAHLog ) 7\ufe0f\u20e3 Tweaking performance / power\u2011saving options specific to the W7500 8\ufe0f\u20e3 Common pitfalls & troubleshooting checklist","title":"DISCLAIMER - AI GENERATED CONTENT"},{"location":"manjaro/ai/manjaro-folding-at-home/#1-system-preparation","text":"Why? Manjaro ships with a rolling\u2011release kernel and a fairly recent Mesa stack, but we still want to make sure the kernel, firmware and user permissions are ready for AMD\u2019s OpenCL drivers. # 1. Refresh keyrings and update everything sudo pacman -Syyu --noconfirm # 2. Install the generic development tools (git, base-devel, etc.) sudo pacman -S --needed base-devel git # 3. Install a modern LTS kernel (optional, but recommended for better driver support) # If you already run the default kernel (e.g., 6.7.x) you can skip this. sudo mhwd-kernel -i linux61 # or linux62, linux63 \u2013 whichever is current LTS in Manjaro repos # 4. Reboot into the new kernel (or keep your current one if it works) reboot","title":"1\ufe0f\u20e3 System preparation"},{"location":"manjaro/ai/manjaro-folding-at-home/#create-a-dedicated-folding-user-optional-but-clean","text":"sudo useradd -m -G video,wheel -s /bin/bash folding # set a password (you\u2019ll need it later) sudo passwd folding Tip: Adding the user to the video group gives it permission to access the GPU device nodes ( /dev/dri/* ). If you run FAH under your regular user, just make sure that user is in video .","title":"Create a dedicated \u201cfolding\u201d user (optional but clean)"},{"location":"manjaro/ai/manjaro-folding-at-home/#firewall-if-you-enable-one","text":"FAH uses port\u202f80/443 for control, port\u202f7396 for the web UI and port\u202f36330 for the optional \u201cslot\u201d server. The default ufw rules are enough: # If you have ufw enabled sudo ufw allow 7396/tcp sudo ufw allow 36330/tcp sudo ufw reload","title":"Firewall (if you enable one)"},{"location":"manjaro/ai/manjaro-folding-at-home/#2-install-the-amd-opencl-stack-for-the-radeon-w7500","text":"The W7500 is a Polaris\u2011based GPU (GCN 4). It is fully supported by the open\u2011source amdgpu driver + Mesa OpenCL ( ROCm is not required). However, you can also install the AMDGPU\u2011PRO OpenCL runtime for a modest performance boost.","title":"2\ufe0f\u20e3 Install the AMD OpenCL stack for the Radeon W7500"},{"location":"manjaro/ai/manjaro-folding-at-home/#2a-opensource-stack-recommended","text":"# Core driver + firmware (Manjaro already ships this, but reinstall to be safe) sudo pacman -S --needed xf86-video-amdgpu mesa opencl-mesa libclc # Install the OpenCL ICD loader (already part of mesa-opencl, but keep it explicit) sudo pacman -S --needed ocl-icd # Verify the ICD file exists cat /etc/OpenCL/vendors/mesa.icd # \u2192 should output: libRusticlOpenCL.so.1","title":"2\u2011a. Open\u2011source stack (recommended)"},{"location":"manjaro/ai/manjaro-folding-at-home/#2b-optional-amdgpupro-opencl-runtime","text":"UNVERIFIED CHECK upstream on amd.com for the update drivers If you want the proprietary amdgpu-pro OpenCL libraries (they can be ~5\u201110\u202f% faster on some kernels), do the following once . It will coexist with the open\u2011source stack \u2013 the ICD loader will pick the \u201cpro\u201d library if present. # Install the helper script that pulls the latest Pro package from AMD # (Works on Manjaro because we use the official .tar.xz release) mkdir -p ~/amdpro && cd ~/amdpro wget -O amdgpu-pro.tar.xz \\ https://drivers.amd.com/drivers/linux/amdgpu-pro-22.50-1290604-ubuntu-22.04.tar.xz tar -xf amdgpu-pro.tar.xz cd amdgpu-pro-22.50-1290604-ubuntu-22.04 # Install ONLY the OpenCL portion \u2013 we keep the open\u2011source driver sudo ./amdgpu-install -y --opencl=legacy,pal --headless # The installer puts an extra ICD entry: cat /etc/OpenCL/vendors/amdgpu-pro.icd # \u2192 should point to libamdocl64.so (or libamdocl64.so.1) Important: After installing the proprietary OpenCL, you must re\u2011boot so that the kernel module picks up the new firmware.","title":"2\u2011b. (Optional) AMDGPU\u2011PRO OpenCL runtime"},{"location":"manjaro/ai/manjaro-folding-at-home/#2c-verify-opencl-works","text":"VERIFIED USING W7100 # Install a tiny helper to query OpenCL devices sudo pacman -S --needed clinfo # Run it \u2013 you should see at least one \u201cAMD Radeon W7500\u201d device clinfo | grep -i \"AMD\\|W7500\" Typical output (open\u2011source stack): $ clinfo | grep -i \"AMD\\|7100\" Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) Device Vendor AMD Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) Device Name AMD Radeon Pro WX 7100 Graphics (radeonsi, polaris10, ACO, DRM 3.61, 6.12.44-3-MANJARO) ... If you see \u201cNumber of platforms = 0\u201d , double\u2011check that: the amdgpu kernel driver is loaded ( lsmod | grep amdgpu ) the user is in the video group /dev/dri/renderD* nodes exist and are readable/writable ( ls -l /dev/dri/ )","title":"2\u2011c. Verify OpenCL works"},{"location":"manjaro/ai/manjaro-folding-at-home/#3-install-the-foldinghome-client","text":"Build the FAH client ( foldingathome ) from AUR. AUR packages may cease to function on system updates. If that happens you need to rebuild your FAH client. pamac build foldingathome Alternative \u2013 compile the very latest client (useful if you want a bleeding\u2011edge patch) cd ~ git clone https://github.com/FoldingAtHome/fah-client.git cd fah-client ./configure && make -j$(nproc) && sudo make install","title":"3\ufe0f\u20e3 Install the Folding@home client"},{"location":"manjaro/ai/manjaro-folding-at-home/#4-configure-the-fah-client-for-gpuonly-work","text":"","title":"4\ufe0f\u20e3 Configure the FAH client for GPU\u2011only work"},{"location":"manjaro/ai/manjaro-folding-at-home/#4a-generate-a-basic-configuration-file","text":"The first time the client runs, it will create ~/.config/FoldingAtHome/FAHClient.cfg . We will edit it manually to lock the client to the GPU slot. # If you installed as a dedicated user, become that user sudo -iu folding # Run the client once to generate a default config (it will pause and ask for team/passkey) fah-client & sleep 5 kill %1 # stop the temporary instance Now edit the config: sudo micro ~/.config/FoldingAtHome/FAHClient.cfg Paste the following (replace TEAM , PASSKEY , POWER as you wish): #------------------------------------------------- # Folding@home client configuration \u2013 GPU only #------------------------------------------------- # 1. Identity user = folding # any name you like team = 0 # 0 = default team; replace with your own team number (e.g., 12345) passkey = # optional \u2013 put your personal passkey here if you have one # 2. Slots \u2013 we only want a GPU slot slot.0.type = GPU slot.0.device = 0 # first GPU (0\u2011based). If you have multiple GPUs, you can add slot.1, slot.2, etc. slot.0.power = 75 # % of max power the client may draw (default 100). 75% is a good compromise. slot.0.enabled = true # 3. Turn off CPU slots (optional but saves CPU cycles) slot.1.type = CPU slot.1.enabled = false # 4. Network & security web-allow = 7396 # port for the built\u2011in web UI (http://localhost:7396) allow = 0/0/0 # allow all IPs (you can tighten this later) # 5. Misc gpu-allow = 0/0/0 # allow all GPUs \u2013 you can restrict by vendor if you ever add an NVIDIA card pause-on-battery = false # If you run a laptop \u2013 set true to avoid running on battery Save ( Ctrl+s ) and exit ( Ctrl+q ).","title":"4\u2011a. Generate a basic configuration file"},{"location":"manjaro/ai/manjaro-folding-at-home/#4b-optional-set-a-custom-passkey-recommended-for-tracking","text":"If you have a personal Folding@home account, generate a passkey on the website (https://foldingathome.org/passkey) and paste it into the passkey = line above. This links the work units to your account and gives you credit on the leaderboard.","title":"4\u2011b. Optional \u2013 set a custom \u201cpasskey\u201d (recommended for tracking)"},{"location":"manjaro/ai/manjaro-folding-at-home/#4c-set-resource-limits-for-the-w7500","text":"The Radeon\u202fW7500 can draw \u2248\u202f150\u202fW at full load. To keep the system cool and the power bill modest, you can: Throttle via the client ( slot.0.power = 70 \u2192 ~105\u202fW). Set a kernel power profile with amdgpu sysfs: # As root echo \"low\" > /sys/class/drm/card0/device/power_dpm_force_performance_level # or for a fine\u2011grained PWM limit: echo 80 > /sys/class/drm/card0/device/pp_dpm_sclk The client\u2019s slot.0.power is the easiest way because it is respected automatically for each work unit.","title":"4\u2011c. Set resource limits for the W7500"},{"location":"manjaro/ai/manjaro-folding-at-home/#5-enable-start-the-service","text":"When you build the client, a systemd unit called fahclient.service was created. # Enable it for the dedicated folding user (or your own user) sudo systemctl enable fahclient.service sudo systemctl start fahclient.service # Check status sudo systemctl status fahclient.service You should see something like: \u25cf fahclient.service - Folding@home client Loaded: loaded (/usr/lib/systemd/system/fahclient.service; enabled; vendor preset: disabled) Active: active (running) since Fri 2025-09-20 \u2026 Main PID: 1234 (FAHClient) Tasks: 4 (limit: 4915) Memory: 150.0M CGroup: /system.slice/fahclient.service \u2514\u25001234 /usr/bin/FAHClient -v If you compiled the client yourself, you can create a simple service file: sudo nano /etc/systemd/system/fahclient.service [Unit] Description=Folding@home client After=network-online.target Wants=network-online.target [Service] Type=simple User=folding # or your own user ExecStart=/usr/local/bin/FAHClient -v Restart=on-failure RestartSec=10 [Install] WantedBy=multi-user.target sudo systemctl daemon-reload sudo systemctl enable --now fahclient.service","title":"5\ufe0f\u20e3 Enable &amp; start the service"},{"location":"manjaro/ai/manjaro-folding-at-home/#verify-that-the-gpu-slot-is-active","text":"# The client logs to ~/.config/FoldingAtHome/FAHClient.log tail -f ~/.config/FoldingAtHome/FAHClient.log You should see lines like: [INFO] slot 0 (GPU) is now working on core 2025-05-04 (Molecular Dynamics) on AMD Radeon W7500 [INFO] slot 0: using 75% power limit If you see slot 0: no OpenCL platform found , double\u2011check the OpenCL setup (section 2\u2011c).","title":"Verify that the GPU slot is active"},{"location":"manjaro/ai/manjaro-folding-at-home/#6-monitoring-controlling-your-folding-node","text":"Tool How to use What you see Web UI (built\u2011in) Open http://localhost:7396 in a browser (or http://<IP>:7396 from another machine) Real\u2011time work unit progress, GPU temperature, power usage, credit earned FAHControl (GUI) sudo pacman -S fahcontrol then launch FAHControl Same as web UI, but with a desktop app; can change slots on\u2011the\u2011fly FAHLog (CLI) FAHLog -t (tail) Live log output (same as tail -f on the log file) clinfo clinfo Confirms OpenCL platform/device details \u2013 handy for debugging driver issues systemd systemctl status fahclient / journalctl -u fahclient -f Service health, restarts, crash logs Tip: If you run the node headless (no monitor), you can tunnel the web UI over SSH: ssh -L 7396:localhost:7396 folding@your-node-ip # then point your local browser to http://localhost:7396","title":"6\ufe0f\u20e3 Monitoring &amp; controlling your folding node"},{"location":"manjaro/ai/manjaro-folding-at-home/#7-performancetuning-specific-to-the-radeon-w7500","text":"Setting Command Effect Recommended value Client power limit slot.0.power = 70 (in config) Caps GPU power, reduces heat & fan noise 70\u202f% for 24/7 home use; 85\u202f% if you need more credit OpenCL work\u2011size slot.0.gpu-allow = 0/0/0 (default) \u2013 you can add slot.0.gpu-allow = 0/0/256 to limit work\u2011group size if you see instability Some kernels mis\u2011behave on older Polaris chips at large work\u2011groups Not needed for most users; leave default Kernel performance level echo high > /sys/class/drm/card0/device/power_dpm_force_performance_level (root) Forces the GPU to stay in \u201chigh\u201d performance state, slightly better throughput but more heat Use high if you notice the GPU dropping to low power frequently (check dmesg | grep amdgpu ) Fan control Install amdgpu-fan from AUR ( yay -S amdgpu-fan ) and set a custom curve (e.g., 60\u202f% at 50\u202f\u00b0C) Keeps temps under control without constant full\u2011speed fan 40\u201160\u202f% fan speed is usually fine for 70\u202f% power limit CPU affinity (if you keep a tiny CPU slot) taskset -c 0-3 FAHClient in a wrapper script Keeps the client from stealing cores you might need for other tasks Not required when CPU slot disabled","title":"7\ufe0f\u20e3 Performance\u2011tuning specific to the Radeon W7500"},{"location":"manjaro/ai/manjaro-folding-at-home/#example-adding-a-fan-curve-optional","text":"# Install the helper yay -S amdgpu-fan # Create a simple profile (e.g., 30% at 40\u00b0C, 60% at 55\u00b0C, 100% at 70\u00b0C) sudo tee /etc/amdgpu-fan.conf > /dev/null <<'EOF' [fan0] temp=40,30 temp=55,60 temp=70,100 EOF # Enable the daemon sudo systemctl enable --now amdgpu-fan.service","title":"Example: Adding a fan curve (optional)"},{"location":"manjaro/ai/manjaro-folding-at-home/#8-common-pitfalls-quickfix-checklist","text":"Symptom Likely cause Fix FAHClient exits with \u201cno OpenCL platform found\u201d - User not in video group - amdgpu driver not loaded - Wrong ICD file order (Pro overrides open\u2011source) sudo usermod -aG video $USER && newgrp video Verify lsmod | grep amdgpu Ensure /etc/OpenCL/vendors/mesa.icd exists and amdgpu-pro.icd (if installed) points to a real lib GPU shows 0\u202f% utilization in clinfo / FAH UI - Power limit set to 0 (or slot.0.power = 0 ) - GPU in \u201clow\u201d performance mode due to thermal throttling Set slot.0.power to a non\u2011zero value (\u2265\u202f50) Run cat /sys/class/drm/card0/device/pp_dpm_sclk to see if clocks are stuck; if so, echo high > /sys/.../power_dpm_force_performance_level FAH client crashes with \u201cSegmentation fault (core dumped)\u201d - Mismatch between Mesa OpenCL version and AMDGPU\u2011PRO libs - Out\u2011of\u2011date kernel (older kernels have bugs with Polaris) Remove the proprietary ICD ( sudo rm /etc/OpenCL/vendors/amdgpu-pro.icd ) and stick to the open\u2011source stack, OR update to the latest kernel ( mhwd-kernel -li \u2192 install newest) System hangs when folding starts - Insufficient power supply (W7500 draws ~150\u202fW) - Overheating (GPU fan stuck) Verify PSU rating (>\u202f400\u202fW) Check temps with sensors (install lm_sensors ) Clean dust, ensure fan spins FAH shows \u201cNo credit earned\u201d despite work - You forgot to add your passkey or team - You are using the default team 0 (which still gives credit, but you may be confused) Add your personal passkey in FAHClient.cfg Or join a team and set team = <your\u2011team\u2011id> Web UI unreachable from another machine - Firewall blocking 7396 - allow setting restricts IPs sudo ufw allow 7396/tcp Set allow = 0/0/0 in the config or specify allow = 192.168.1.0/24/0","title":"8\ufe0f\u20e3 Common pitfalls &amp; quick\u2011fix checklist"},{"location":"manjaro/ai/manjaro-folding-at-home/#full-oneshot-script-optional","text":"If you want to automate everything (except your personal team/passkey), copy\u2011paste the following script as root (or use sudo -i first). It will: Update the system Install the open\u2011source AMDGPU + OpenCL stack Install FAH client Create a folding user (or use the current user) Write a ready\u2011to\u2011run config with a 70\u202f% power limit #!/usr/bin/env bash set -euo pipefail # ------------------------------------------------- # 1\ufe0f\u20e3 System update # ------------------------------------------------- pacman -Syyu --noconfirm # ------------------------------------------------- # 2\ufe0f\u20e3 Install required packages # ------------------------------------------------- pacman -S --needed base-devel git xf86-video-amdgpu mesa mesa-opencl libclc ocl-icd clinfo folding-at-home # ------------------------------------------------- # 3\ufe0f\u20e3 (Optional) create dedicated user # ------------------------------------------------- if ! id -u folding &>/dev/null; then useradd -m -G video,wheel -s /bin/bash folding echo \"Created user 'folding' (set a password when prompted)\" passwd folding fi # ------------------------------------------------- # 4\ufe0f\u20e3 Verify OpenCL # ------------------------------------------------- if ! clinfo | grep -iq \"AMD Radeon W7500\"; then echo \"\u26a0\ufe0f OpenCL detection failed. Please reboot and ensure the amdgpu driver loads.\" exit 1 fi # ------------------------------------------------- # 5\ufe0f\u20e3 Write config (for the chosen user) # ------------------------------------------------- TARGET_USER=${SUDO_USER:-$(whoami)} HOME_DIR=$(eval echo \"~$TARGET_USER\") CONFIG_DIR=\"$HOME_DIR/.config/FoldingAtHome\" mkdir -p \"$CONFIG_DIR\" cat > \"$CONFIG_DIR/FAHClient.cfg\" <<'EOF' # Folding@home client config \u2013 GPU only (W7500) user = folding team = 0 # replace with your team number if you have one passkey = # optional \u2013 paste your personal passkey here slot.0.type = GPU slot.0.device = 0 slot.0.power = 70 slot.0.enabled = true slot.1.type = CPU slot.1.enabled = false web-allow = 7396 allow = 0/0/0 gpu-allow = 0/0/0 pause-on-battery = false EOF chown -R \"$TARGET_USER\":\"$TARGET_USER\" \"$CONFIG_DIR\" # ------------------------------------------------- # 6\ufe0f\u20e3 Enable & start the service # ------------------------------------------------- systemctl enable --now fahclient.service echo \"\u2705 Setup complete! Check the log at $CONFIG_DIR/FAHClient.log\" echo \"\ud83c\udf10 Open http://$(hostname -I | awk '{print $1}'):7396 to watch your folding progress.\" Run it with: chmod +x setup_fah_w7500.sh sudo ./setup_fah_w7500.sh After the reboot (or after the script finishes), open the web UI and you should see the GPU slot actively folding.","title":"\ud83d\udce6 Full \u201cone\u2011shot\u201d script (optional)"},{"location":"manjaro/ai/manjaro-folding-at-home/#youre-done","text":"Your Manjaro box with a Radeon\u202fW7500 is now contributing to the world\u2011wide Folding@home project . Check the web UI regularly to see work\u2011unit progress and credit. Keep the system updated ( sudo pacman -Syu ) \u2013 newer kernels and Mesa releases often bring modest OpenCL speed gains. If you ever add another GPU (e.g., an NVIDIA RTX), just add another slot.N block in the same config and the client will automatically use both. Happy folding, and thank you for donating your GPU cycles to science! \ud83d\ude80\ud83e\uddec","title":"\ud83c\udf89 You\u2019re done!"},{"location":"manjaro/android/android-manjaro-droid-cam/","text":"Droidcam Droidcam web Download GNU/Linux client A tool for using your android device as a wireless/usb webcam Problems Judging from the a forum search for droidcam it appears Manjaro users are having a difficult time getting this into a working state. So I decided to check if it is such a pain to get working. Droidcam on AUR Despite some comments on the AUR page on non-versioned package source it seems the maintainer and the droidcam developers has decided it is a good idea to version the package source - probably taking into account when an AUR helper is caching the source archive. The comments track is filled with issues not only with relation to the build but also sound issues. The maintainer also states that Manjaro is not supported . We will take the sound issues later - first we take a look at getting your android device camera connected. Your Android device Before you even think of getting your computer to connect you must install the DroidCam application on your android device. My device is a rooted Huawei Nexus 6P using a crDroid Android 10 without any Google related stuff (and I mean nothing at all). There is several possible ways to get hold of the apk - I downloaded the apk, renamed it and installed it using adb debug adb install droidcam-6.7.10.apk It is necessary to setup the DroidCam and to start the App to be able to connect to it from your computer. Your Manjaro system My Manjaro system is on unstable branch and using kernel 5.7.4 using Openbox window manager. The maintainer of the PKGBUILD states that only makepkg is supported - so let's use it to build the package. Update your system and install the necessary build tools sudo pacman -Syu --needed git base-devel Next thing is to get hold of the PKGBUILD. Open a terminal and clone the repo \u279c ~ git clone https://aur.archlinux.org/droidcam Cloning into 'droidcam'... remote: Enumerating objects: 110, done. remote: Counting objects: 100% (110/110), done. remote: Compressing objects: 100% (98/98), done. remote: Total 110 (delta 11), reused 109 (delta 11), pack-reused 0 Receiving objects: 100% (110/110), 43.37 KiB | 2.55 MiB/s, done. Resolving deltas: 100% (11/11), done. Navigate into the folder and list the content \u279c ~ cd droidcam \u279c droidcam git:(master) ls droidcam.conf droidcam.desktop PKGBUILD What we are interested in is the PKGBUILD as it is a good habit to verify the content [details=\"droidcam/PKGBUILD\"] \u279c droidcam git:(master) cat PKGBUILD # Maintainer: AwesomeHaircut <jesusbalbastro at gmail com> # Maintainer: Mateusz Gozdek <mgozdekof@gmail.com> # Contributor: Rein Fernhout <public@reinfernhout.xyz> # Past Contributor: James An <james@jamesan.ca> pkgname=droidcam pkgver=1.3 pkgrel=1 epoch=1 pkgdesc='A tool for using your android device as a wireless/usb webcam' arch=('x86_64') url=\"https://github.com/aramg/${pkgname}\" license=('GPL') depends=('v4l2loopback-dc-dkms' 'alsa-lib' 'libjpeg-turbo' 'ffmpeg') makedepends=('gtk3') optdepends=('gtk3: use GUI version in addition to CLI interface' ) source=(\"${pkgname}.desktop\" \"${pkgname}-${pkgver}.zip::${url}/archive/v${pkgver}.zip\" \"${pkgname}.conf\" ) sha512sums=('72d21aa2d7eecc9bb070aaf7059a671246feb22f9c39b934a5463a4839f9347050de00754e5031dbc44f78eb2731f58f0cd2fcf781bc241f6fbd1abb4308b7ee' 'c783b62c530c521aa7f047073efe74b57f28fbadbd097dca595fb582820566aedd03c6e92d2f24d9ff84dceed8ab51955ad77e80481ebfb6e30423425f8f2953' 'ea457b46a2fc9f1a3ea8e99f2cd0771a587cff89f42335fdaf55988dda0376a1fea73b660174c9f1906a304bace68bffec30b70b20dafc05ebae8854d9aadb13') build() { cd ${pkgname}-${pkgver}/linux # All JPEG* parameters are needed to use shared version of libturbojpeg instead of # static one. make JPEG_DIR=\"\" JPEG_INCLUDE=\"\" JPEG_LIB=\"\" JPEG=$(pkg-config --libs --cflags libturbojpeg) } package() { pushd ${pkgname}-${pkgver}/linux # Install droidcam program files install -Dm755 \"${pkgname}\" \"${pkgdir}/usr/bin/${pkgname}\" install -Dm755 \"${pkgname}-cli\" \"${pkgdir}/usr/bin/${pkgname}-cli\" install -Dm644 icon2.png \"${pkgdir}/usr/share/pixmaps/${pkgname}.png\" install -Dm644 \"../../${pkgname}.desktop\" \"${pkgdir}/usr/share/applications/${pkgname}.desktop\" install -Dm644 \"../../${pkgname}.conf\" \"${pkgdir}/etc/modules-load.d/droidcam.conf\" install -Dm644 README.md \"${pkgdir}/usr/share/licenses/${pkgname}/LICENSE\" } [/details] We find the expected stuff - a list of dependencies - and note that we have a dkms dependecy - and from the package() function it is worth noting that we get a new configuration loading the v4l modules required to connect to a live camera. The dkms dependency is tricky because it usually requires kernel headers to be installed for your kernel. While Arch only has clearly distinctive kernels with only one version - Manjaro has several versions and every version has a complimentary header package. So to be able to build droidcam you need to ensure the headers are installed for all of your kernels - otherwise the droidcam app will not build and ultimately not work. List your installed kernels - example from my system \u279c droidcam git:(master) mhwd-kernel -li Currently running: 5.7.4-1-MANJARO (linux57) The following kernels are installed in your system: * linux56 * linux57 With this info - please use the output from your system - install the kernel headers sudo pacman -Syu linux56-headers linux57-headers Now we are ready to build and install the package and the dependencies. When the build is done - you will be asked to authorize the package installation. [details=\"makepkg -is\"] \u279c droidcam git:(master) makepkg -is ==> Making package: droidcam 1:1.3-1 (fre 19 jun 2020 12:36:46 CEST) ==> Checking runtime dependencies... ==> Checking buildtime dependencies... ==> Retrieving sources... -> Found droidcam.desktop -> Downloading droidcam-1.3.zip... % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 117 100 117 0 0 1218 0 --:--:-- --:--:-- --:--:-- 1218 100 91207 0 91207 0 0 126k 0 --:--:-- --:--:-- --:--:-- 126k -> Found droidcam.conf ==> Validating source files with sha512sums... droidcam.desktop ... Passed droidcam-1.3.zip ... Passed droidcam.conf ... Passed ==> Extracting sources... -> Extracting droidcam-1.3.zip with bsdtar ==> Starting build()... gcc -Wall -no-pie src/droidcam-cli.c src/connection.c src/settings.c src/decoder.c src/decoder_snd.c src/decoder_v4l2.c src/av.c src/adb.c -lturbojpeg `pkg-config --libs --cflags libswscale libavutil` -lspeex -lasound -lpthread -lm -o droidcam-cli gcc -Wall -no-pie src/droidcam.c src/resources.c src/connection.c src/settings.c src/decoder.c src/decoder_snd.c src/decoder_v4l2.c src/av.c src/adb.c `pkg-config --libs --cflags gtk+-3.0` `pkg-config --libs x11` -lturbojpeg `pkg-config --libs --cflags libswscale libavutil` -lspeex -lasound -lpthread -lm -o droidcam src/droidcam.c: In function \u2018the_callback\u2019: src/droidcam.c:189:4: warning: \u2018gtk_menu_popup\u2019 is deprecated: Use '(gtk_menu_popup_at_widget, gtk_menu_popup_at_pointer, gtk_menu_popup_at_rect)' instead [-Wdeprecated-declarations] 189 | gtk_menu_popup(GTK_MENU(menu), NULL, NULL, NULL, NULL, 0, 0); | ^~~~~~~~~~~~~~ In file included from /usr/include/gtk-3.0/gtk/gtklabel.h:34, from /usr/include/gtk-3.0/gtk/gtkaccellabel.h:35, from /usr/include/gtk-3.0/gtk/gtk.h:33, from src/droidcam.c:11: /usr/include/gtk-3.0/gtk/gtkmenu.h:138:9: note: declared here 138 | void gtk_menu_popup (GtkMenu *menu, | ^~~~~~~~~~~~~~ ==> Entering fakeroot environment... ==> Starting package()... ~/droidcam/src/droidcam-1.3/linux ~/droidcam/src ==> Tidying install... -> Removing libtool files... -> Purging unwanted files... -> Removing static library files... -> Stripping unneeded symbols from binaries and libraries... -> Compressing man and info pages... ==> Checking for packaging issues... ==> Creating package \"droidcam\"... -> Generating .PKGINFO file... -> Generating .BUILDINFO file... -> Generating .MTREE file... -> Compressing package... ==> Leaving fakeroot environment. ==> Finished making: droidcam 1:1.3-1 (fre 19 jun 2020 12:36:48 CEST) ==> Installing package droidcam with pacman -U... loading packages... resolving dependencies... looking for conflicting packages... Packages (1) droidcam-1:1.3-1 Total Installed Size: 0,12 MiB :: Proceed with installation? [Y/n] (1/1) checking keys in keyring [#######################] 100% (1/1) checking package integrity [#######################] 100% (1/1) loading package files [#######################] 100% (1/1) checking for file conflicts [#######################] 100% (1/1) checking available disk space [#######################] 100% :: Processing package changes... (1/1) installing droidcam [#######################] 100% Optional dependencies for droidcam gtk3: use GUI version in addition to CLI interface [installed] :: Running post-transaction hooks... (1/2) Arming ConditionNeedsUpdate... (2/2) Updating the desktop file MIME type cache... [/details] You should get a similar output and if you don't you have inconsistencies within your system. I can't say what it might be - but suffice to say - as the time of writing this guide - the droidcam package builds without hickups Starting the DroidCam app The app is depending on the correct v4l modules to be loaded by the kernel. If the kernel is updated but the system not restarted - there will be a mismatch between the kernel and modules which will make the application fail. Better safe than sorry - reboot your system - or manually load the required modules which are described in droidcam.conf. Manually loading the modules do not guarantee droidcam will work - your best shot is still a restart of your system. \u279c droidcam git:(master) cat droidcam.conf videodev v4l2loopback-dc \u279c droidcam git:(master) sudo modprobe videodev v4l2loopback-dc WiFi/LAN To connect using WiFi you must ensure your phone is on the same local network as your computer. When you start DroidCam on your device it will display the IP address to connect to. Depending on what you want to do Connect using a browser * http://<phoneip>:4747/ * http://<phoneip>:4747/video Using the DroidCam app [details=\"Screenshot\"] [/details] Sound Making it possible to use sound too - you are required set the properties in the pulseaudio mixer. I have not invested time in getting this to work. As of [date=2020-06-02 time=14:13:00 timezone=\"Europe/Copenhagen\"] sound support is an ongoing issue . Another comment in the thread mentions an install-sound script? Forum issues list https://archived.forum.manjaro.org/t/droidcam-doesnt-work/148707?u=linux-aarhus https://archived.forum.manjaro.org/t/package-v4l2loopback-dc-dkms-needed-for-droidcam-fails-to-compile-with-both-dkms-and-make/146132?u=linux-aarhus https://archived.forum.manjaro.org/t/manjaro-is-incompatible-with-an-arch-linux-pkgbuild/145499?u=linux-aarhus https://archived.forum.manjaro.org/t/droidcam-6-7-5-5-error-extra-modules-exist-while-building-with-yay/142345?u=linux-aarhus https://archived.forum.manjaro.org/t/anybody-using-droidcam-for-a-cellphone-webcam/131821?u=linux-aarhus https://archived.forum.manjaro.org/t/droidcam/119211?u=linux-aarhus https://archived.forum.manjaro.org/t/how-do-i-enable-phone-as-webcam-for-school/130143 https://archived.forum.manjaro.org/t/couldnt-install-droidcam-using-yay/80837?u=linux-aarhus","title":"Droid Cam on Manjaro"},{"location":"manjaro/android/android-manjaro-droid-cam/#droidcam","text":"Droidcam web Download GNU/Linux client A tool for using your android device as a wireless/usb webcam","title":"Droidcam"},{"location":"manjaro/android/android-manjaro-droid-cam/#problems","text":"Judging from the a forum search for droidcam it appears Manjaro users are having a difficult time getting this into a working state. So I decided to check if it is such a pain to get working.","title":"Problems"},{"location":"manjaro/android/android-manjaro-droid-cam/#droidcam-on-aur","text":"Despite some comments on the AUR page on non-versioned package source it seems the maintainer and the droidcam developers has decided it is a good idea to version the package source - probably taking into account when an AUR helper is caching the source archive. The comments track is filled with issues not only with relation to the build but also sound issues. The maintainer also states that Manjaro is not supported . We will take the sound issues later - first we take a look at getting your android device camera connected.","title":"Droidcam on AUR"},{"location":"manjaro/android/android-manjaro-droid-cam/#your-android-device","text":"Before you even think of getting your computer to connect you must install the DroidCam application on your android device. My device is a rooted Huawei Nexus 6P using a crDroid Android 10 without any Google related stuff (and I mean nothing at all). There is several possible ways to get hold of the apk - I downloaded the apk, renamed it and installed it using adb debug adb install droidcam-6.7.10.apk It is necessary to setup the DroidCam and to start the App to be able to connect to it from your computer.","title":"Your Android device"},{"location":"manjaro/android/android-manjaro-droid-cam/#your-manjaro-system","text":"My Manjaro system is on unstable branch and using kernel 5.7.4 using Openbox window manager. The maintainer of the PKGBUILD states that only makepkg is supported - so let's use it to build the package. Update your system and install the necessary build tools sudo pacman -Syu --needed git base-devel Next thing is to get hold of the PKGBUILD. Open a terminal and clone the repo \u279c ~ git clone https://aur.archlinux.org/droidcam Cloning into 'droidcam'... remote: Enumerating objects: 110, done. remote: Counting objects: 100% (110/110), done. remote: Compressing objects: 100% (98/98), done. remote: Total 110 (delta 11), reused 109 (delta 11), pack-reused 0 Receiving objects: 100% (110/110), 43.37 KiB | 2.55 MiB/s, done. Resolving deltas: 100% (11/11), done. Navigate into the folder and list the content \u279c ~ cd droidcam \u279c droidcam git:(master) ls droidcam.conf droidcam.desktop PKGBUILD What we are interested in is the PKGBUILD as it is a good habit to verify the content [details=\"droidcam/PKGBUILD\"] \u279c droidcam git:(master) cat PKGBUILD # Maintainer: AwesomeHaircut <jesusbalbastro at gmail com> # Maintainer: Mateusz Gozdek <mgozdekof@gmail.com> # Contributor: Rein Fernhout <public@reinfernhout.xyz> # Past Contributor: James An <james@jamesan.ca> pkgname=droidcam pkgver=1.3 pkgrel=1 epoch=1 pkgdesc='A tool for using your android device as a wireless/usb webcam' arch=('x86_64') url=\"https://github.com/aramg/${pkgname}\" license=('GPL') depends=('v4l2loopback-dc-dkms' 'alsa-lib' 'libjpeg-turbo' 'ffmpeg') makedepends=('gtk3') optdepends=('gtk3: use GUI version in addition to CLI interface' ) source=(\"${pkgname}.desktop\" \"${pkgname}-${pkgver}.zip::${url}/archive/v${pkgver}.zip\" \"${pkgname}.conf\" ) sha512sums=('72d21aa2d7eecc9bb070aaf7059a671246feb22f9c39b934a5463a4839f9347050de00754e5031dbc44f78eb2731f58f0cd2fcf781bc241f6fbd1abb4308b7ee' 'c783b62c530c521aa7f047073efe74b57f28fbadbd097dca595fb582820566aedd03c6e92d2f24d9ff84dceed8ab51955ad77e80481ebfb6e30423425f8f2953' 'ea457b46a2fc9f1a3ea8e99f2cd0771a587cff89f42335fdaf55988dda0376a1fea73b660174c9f1906a304bace68bffec30b70b20dafc05ebae8854d9aadb13') build() { cd ${pkgname}-${pkgver}/linux # All JPEG* parameters are needed to use shared version of libturbojpeg instead of # static one. make JPEG_DIR=\"\" JPEG_INCLUDE=\"\" JPEG_LIB=\"\" JPEG=$(pkg-config --libs --cflags libturbojpeg) } package() { pushd ${pkgname}-${pkgver}/linux # Install droidcam program files install -Dm755 \"${pkgname}\" \"${pkgdir}/usr/bin/${pkgname}\" install -Dm755 \"${pkgname}-cli\" \"${pkgdir}/usr/bin/${pkgname}-cli\" install -Dm644 icon2.png \"${pkgdir}/usr/share/pixmaps/${pkgname}.png\" install -Dm644 \"../../${pkgname}.desktop\" \"${pkgdir}/usr/share/applications/${pkgname}.desktop\" install -Dm644 \"../../${pkgname}.conf\" \"${pkgdir}/etc/modules-load.d/droidcam.conf\" install -Dm644 README.md \"${pkgdir}/usr/share/licenses/${pkgname}/LICENSE\" } [/details] We find the expected stuff - a list of dependencies - and note that we have a dkms dependecy - and from the package() function it is worth noting that we get a new configuration loading the v4l modules required to connect to a live camera. The dkms dependency is tricky because it usually requires kernel headers to be installed for your kernel. While Arch only has clearly distinctive kernels with only one version - Manjaro has several versions and every version has a complimentary header package. So to be able to build droidcam you need to ensure the headers are installed for all of your kernels - otherwise the droidcam app will not build and ultimately not work. List your installed kernels - example from my system \u279c droidcam git:(master) mhwd-kernel -li Currently running: 5.7.4-1-MANJARO (linux57) The following kernels are installed in your system: * linux56 * linux57 With this info - please use the output from your system - install the kernel headers sudo pacman -Syu linux56-headers linux57-headers Now we are ready to build and install the package and the dependencies. When the build is done - you will be asked to authorize the package installation. [details=\"makepkg -is\"] \u279c droidcam git:(master) makepkg -is ==> Making package: droidcam 1:1.3-1 (fre 19 jun 2020 12:36:46 CEST) ==> Checking runtime dependencies... ==> Checking buildtime dependencies... ==> Retrieving sources... -> Found droidcam.desktop -> Downloading droidcam-1.3.zip... % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 117 100 117 0 0 1218 0 --:--:-- --:--:-- --:--:-- 1218 100 91207 0 91207 0 0 126k 0 --:--:-- --:--:-- --:--:-- 126k -> Found droidcam.conf ==> Validating source files with sha512sums... droidcam.desktop ... Passed droidcam-1.3.zip ... Passed droidcam.conf ... Passed ==> Extracting sources... -> Extracting droidcam-1.3.zip with bsdtar ==> Starting build()... gcc -Wall -no-pie src/droidcam-cli.c src/connection.c src/settings.c src/decoder.c src/decoder_snd.c src/decoder_v4l2.c src/av.c src/adb.c -lturbojpeg `pkg-config --libs --cflags libswscale libavutil` -lspeex -lasound -lpthread -lm -o droidcam-cli gcc -Wall -no-pie src/droidcam.c src/resources.c src/connection.c src/settings.c src/decoder.c src/decoder_snd.c src/decoder_v4l2.c src/av.c src/adb.c `pkg-config --libs --cflags gtk+-3.0` `pkg-config --libs x11` -lturbojpeg `pkg-config --libs --cflags libswscale libavutil` -lspeex -lasound -lpthread -lm -o droidcam src/droidcam.c: In function \u2018the_callback\u2019: src/droidcam.c:189:4: warning: \u2018gtk_menu_popup\u2019 is deprecated: Use '(gtk_menu_popup_at_widget, gtk_menu_popup_at_pointer, gtk_menu_popup_at_rect)' instead [-Wdeprecated-declarations] 189 | gtk_menu_popup(GTK_MENU(menu), NULL, NULL, NULL, NULL, 0, 0); | ^~~~~~~~~~~~~~ In file included from /usr/include/gtk-3.0/gtk/gtklabel.h:34, from /usr/include/gtk-3.0/gtk/gtkaccellabel.h:35, from /usr/include/gtk-3.0/gtk/gtk.h:33, from src/droidcam.c:11: /usr/include/gtk-3.0/gtk/gtkmenu.h:138:9: note: declared here 138 | void gtk_menu_popup (GtkMenu *menu, | ^~~~~~~~~~~~~~ ==> Entering fakeroot environment... ==> Starting package()... ~/droidcam/src/droidcam-1.3/linux ~/droidcam/src ==> Tidying install... -> Removing libtool files... -> Purging unwanted files... -> Removing static library files... -> Stripping unneeded symbols from binaries and libraries... -> Compressing man and info pages... ==> Checking for packaging issues... ==> Creating package \"droidcam\"... -> Generating .PKGINFO file... -> Generating .BUILDINFO file... -> Generating .MTREE file... -> Compressing package... ==> Leaving fakeroot environment. ==> Finished making: droidcam 1:1.3-1 (fre 19 jun 2020 12:36:48 CEST) ==> Installing package droidcam with pacman -U... loading packages... resolving dependencies... looking for conflicting packages... Packages (1) droidcam-1:1.3-1 Total Installed Size: 0,12 MiB :: Proceed with installation? [Y/n] (1/1) checking keys in keyring [#######################] 100% (1/1) checking package integrity [#######################] 100% (1/1) loading package files [#######################] 100% (1/1) checking for file conflicts [#######################] 100% (1/1) checking available disk space [#######################] 100% :: Processing package changes... (1/1) installing droidcam [#######################] 100% Optional dependencies for droidcam gtk3: use GUI version in addition to CLI interface [installed] :: Running post-transaction hooks... (1/2) Arming ConditionNeedsUpdate... (2/2) Updating the desktop file MIME type cache... [/details] You should get a similar output and if you don't you have inconsistencies within your system. I can't say what it might be - but suffice to say - as the time of writing this guide - the droidcam package builds without hickups","title":"Your Manjaro system"},{"location":"manjaro/android/android-manjaro-droid-cam/#starting-the-droidcam-app","text":"The app is depending on the correct v4l modules to be loaded by the kernel. If the kernel is updated but the system not restarted - there will be a mismatch between the kernel and modules which will make the application fail. Better safe than sorry - reboot your system - or manually load the required modules which are described in droidcam.conf. Manually loading the modules do not guarantee droidcam will work - your best shot is still a restart of your system. \u279c droidcam git:(master) cat droidcam.conf videodev v4l2loopback-dc \u279c droidcam git:(master) sudo modprobe videodev v4l2loopback-dc","title":"Starting the DroidCam app"},{"location":"manjaro/android/android-manjaro-droid-cam/#wifilan","text":"To connect using WiFi you must ensure your phone is on the same local network as your computer. When you start DroidCam on your device it will display the IP address to connect to. Depending on what you want to do Connect using a browser * http://<phoneip>:4747/ * http://<phoneip>:4747/video Using the DroidCam app [details=\"Screenshot\"] [/details]","title":"WiFi/LAN"},{"location":"manjaro/android/android-manjaro-droid-cam/#sound","text":"Making it possible to use sound too - you are required set the properties in the pulseaudio mixer. I have not invested time in getting this to work. As of [date=2020-06-02 time=14:13:00 timezone=\"Europe/Copenhagen\"] sound support is an ongoing issue . Another comment in the thread mentions an install-sound script?","title":"Sound"},{"location":"manjaro/android/android-manjaro-droid-cam/#forum-issues-list","text":"https://archived.forum.manjaro.org/t/droidcam-doesnt-work/148707?u=linux-aarhus https://archived.forum.manjaro.org/t/package-v4l2loopback-dc-dkms-needed-for-droidcam-fails-to-compile-with-both-dkms-and-make/146132?u=linux-aarhus https://archived.forum.manjaro.org/t/manjaro-is-incompatible-with-an-arch-linux-pkgbuild/145499?u=linux-aarhus https://archived.forum.manjaro.org/t/droidcam-6-7-5-5-error-extra-modules-exist-while-building-with-yay/142345?u=linux-aarhus https://archived.forum.manjaro.org/t/anybody-using-droidcam-for-a-cellphone-webcam/131821?u=linux-aarhus https://archived.forum.manjaro.org/t/droidcam/119211?u=linux-aarhus https://archived.forum.manjaro.org/t/how-do-i-enable-phone-as-webcam-for-school/130143 https://archived.forum.manjaro.org/t/couldnt-install-droidcam-using-yay/80837?u=linux-aarhus","title":"Forum issues list"},{"location":"manjaro/android/android-manjaro-iriun-webcam/","text":"Iriun Web Cam Iriun web cam A tool for using your android device as a wireless/usb webcam and VR Your Android device Before you even think of getting your computer to connect you must install the Iriun 4K Webcam application on your android device. Your Manjaro system Manjaro and Arch are not identical systems and Manjaro kernel naming will require you to pre install the kernel headers for your installed kernels. If you fail to do so - the required v4l2loopback-dkms package will fail to build the required kernel modules and you will not be able to connect to phone. Prepare system to build packages Update your system and install the necessary build tools sudo pacman -Syu --needed git base-devel Clone the PKGBUILD sources Next thing is to get hold of the PKGBUILD. Open a terminal and clone the repo $ git clone https://aur.archlinux.org/iriunwebcam-bin.git Cloning into 'iriunwebcam-bin'... .... Resolving deltas: 100% (11/11), done. Inspect the sources Navigate into the folder and list the content $ cd iriunwebcam-bin $ ls -A .git PKGBUILD .SRCINFO We are interested in the content of the PKGBUILD (and possible companion files) because it is best practise to verify the content As of 2022-09-04 the content is as follows $ cat PKGBUILD # Maintainer: Barfin # Contributor: DanielH, agstrc pkgname=iriunwebcam-bin pkgver=2.7 pkgrel=1 pkgdesc=\"Use your phone's camera as a wireless webcam in your PC.\" arch=('any') url=\"http://iriun.gitlab.io\" license=(unknown) source=(\"iriunwebcam-${pkgver}.deb::http://iriun.gitlab.io/iriunwebcam-${pkgver}.deb\") options=('!strip') depends=('jack' 'qt5-base' 'v4l2loopback-dkms' 'android-tools') package() { tar -xf \"${srcdir}/data.tar.xz\" -C \"${pkgdir}\" # The permissions on the upstream file are wrong (eg: /etc is set to 775 instead of 755) # The command below sets directories to 755 but files to 644 chmod -R u+rwX,go+rX,go-w \"${pkgdir}\" chmod 755 \"${pkgdir}/usr/local/bin/iriunwebcam\" } md5sums=('0c96650189ad6f579e6104c62e3b50c4') We find the expected stuff - a list of dependencies jack (audio) qt5-base v4l2loopback-dkms android-tools :exclamation: Note the dkms dependency (v4l2loopback-dkms) :exclamation: Note the android-tools dependency More preparation according to PKGBUILD content Android tools The android-tools dependency creates a new group adbusers . To be able to connect using adb you must add your username to adbusers group sudo gpasswd -a $USER adbusers DKMS and kernel headers The dkms dependency is tricky because it usually requires kernel headers to be installed for your kernel. While Arch only has a clear distinctive kernel naming with only one version - Manjaro has several versions and every version has a complimentary header package. So to be able to build the package you need to ensure the headers are installed for all of your kernels - otherwise the app will not build and ultimately not work. List your installed kernels - your output may differ $ mhwd-kernel -li Currently running: 5.9.1-3-MANJARO (linux59) The following kernels are installed in your system: * linux515 With this info - replace $KERNEL with the values from your system - install the kernel headers for the kernel(s) mentioned above sudo pacman -Syu $KERNEL-headers Ensure correct checksums If the sources has changed and the maintainer has not yet updated the PKGBUILD you need to do it manually. You can do the using the updpkgsums command or you can add the -g argument to makepkg to this at build time $ updpkgsums Build the package Now we are ready to build the package and install the dependencies - optionally adding the argument to recreate the integrety checks $ makepkg -sf [-g] ... ==> Finished making: iriunwebcam-bin 2.7-1 (2022-09-04T11:18:38 CEST) You should get a similar result. The resulting package will likely be a different version. When the build is done - inspect the build folder once more. If you're paranoid, superuser or developer - you may inspect the package before installation(Midnight Commander is an excellent tool). When examining the pacage iriunwebcam-bin-$VERSION-any.pkg.tar.zst we find the package to contain configurations $ cat /etc/modprobe.d/iriunwebcam-options.conf # options v42loopback exclusive_caps=1 devices= 1 card_label=\"Iriun Webcam\" $ cat /etc/modules-load.d/iriunwebcam.conf # v4l2loopback A binary /usr/local/bin/iriunwebcam A .desktop launcher /usr/share/applications/iriunwebcam.desktop And a pixmap /usr/share/pixmaps/iriunwebcam.png Install the resulting packages To actually install the package use pacman - replace $VERSION with the version you have just built. sudo pacman -U iriunwebcam-bin-$VERSION-any.pkg.tar.zst Reboot your system to have the system use the new modules. Using your phones camera Follow the developer's instruction to connect your camera. Connect your phone to the same wifi network as your computer You can also connect using USB. if you use usb then activate developer mode then scroll down and activate usb-debugging usb debugging requires confirmation to trust the computer Start the app on your computer Start the app on your phone As noted above - I don't know why but it is verified - if your computer is wired to the network - you need to use USB to be able to use your phones camera - it is possible it is a limitation within the software as droid-cam will work no matter the computers connection is wired or wireless. Changelog 2022-09-04 - Updated with new dependency and paragraphing to clarify the elements of the guide.","title":"Iriun Web Cam on Manjaro"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#iriun-web-cam","text":"Iriun web cam A tool for using your android device as a wireless/usb webcam and VR","title":"Iriun Web Cam"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#your-android-device","text":"Before you even think of getting your computer to connect you must install the Iriun 4K Webcam application on your android device.","title":"Your Android device"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#your-manjaro-system","text":"Manjaro and Arch are not identical systems and Manjaro kernel naming will require you to pre install the kernel headers for your installed kernels. If you fail to do so - the required v4l2loopback-dkms package will fail to build the required kernel modules and you will not be able to connect to phone.","title":"Your Manjaro system"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#prepare-system-to-build-packages","text":"Update your system and install the necessary build tools sudo pacman -Syu --needed git base-devel","title":"Prepare system to build packages"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#clone-the-pkgbuild-sources","text":"Next thing is to get hold of the PKGBUILD. Open a terminal and clone the repo $ git clone https://aur.archlinux.org/iriunwebcam-bin.git Cloning into 'iriunwebcam-bin'... .... Resolving deltas: 100% (11/11), done.","title":"Clone the PKGBUILD sources"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#inspect-the-sources","text":"Navigate into the folder and list the content $ cd iriunwebcam-bin $ ls -A .git PKGBUILD .SRCINFO We are interested in the content of the PKGBUILD (and possible companion files) because it is best practise to verify the content As of 2022-09-04 the content is as follows $ cat PKGBUILD # Maintainer: Barfin # Contributor: DanielH, agstrc pkgname=iriunwebcam-bin pkgver=2.7 pkgrel=1 pkgdesc=\"Use your phone's camera as a wireless webcam in your PC.\" arch=('any') url=\"http://iriun.gitlab.io\" license=(unknown) source=(\"iriunwebcam-${pkgver}.deb::http://iriun.gitlab.io/iriunwebcam-${pkgver}.deb\") options=('!strip') depends=('jack' 'qt5-base' 'v4l2loopback-dkms' 'android-tools') package() { tar -xf \"${srcdir}/data.tar.xz\" -C \"${pkgdir}\" # The permissions on the upstream file are wrong (eg: /etc is set to 775 instead of 755) # The command below sets directories to 755 but files to 644 chmod -R u+rwX,go+rX,go-w \"${pkgdir}\" chmod 755 \"${pkgdir}/usr/local/bin/iriunwebcam\" } md5sums=('0c96650189ad6f579e6104c62e3b50c4') We find the expected stuff - a list of dependencies jack (audio) qt5-base v4l2loopback-dkms android-tools :exclamation: Note the dkms dependency (v4l2loopback-dkms) :exclamation: Note the android-tools dependency","title":"Inspect the sources"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#more-preparation-according-to-pkgbuild-content","text":"","title":"More preparation according to PKGBUILD content"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#android-tools","text":"The android-tools dependency creates a new group adbusers . To be able to connect using adb you must add your username to adbusers group sudo gpasswd -a $USER adbusers","title":"Android tools"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#dkms-and-kernel-headers","text":"The dkms dependency is tricky because it usually requires kernel headers to be installed for your kernel. While Arch only has a clear distinctive kernel naming with only one version - Manjaro has several versions and every version has a complimentary header package. So to be able to build the package you need to ensure the headers are installed for all of your kernels - otherwise the app will not build and ultimately not work. List your installed kernels - your output may differ $ mhwd-kernel -li Currently running: 5.9.1-3-MANJARO (linux59) The following kernels are installed in your system: * linux515 With this info - replace $KERNEL with the values from your system - install the kernel headers for the kernel(s) mentioned above sudo pacman -Syu $KERNEL-headers","title":"DKMS and kernel headers"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#ensure-correct-checksums","text":"If the sources has changed and the maintainer has not yet updated the PKGBUILD you need to do it manually. You can do the using the updpkgsums command or you can add the -g argument to makepkg to this at build time $ updpkgsums","title":"Ensure correct checksums"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#build-the-package","text":"Now we are ready to build the package and install the dependencies - optionally adding the argument to recreate the integrety checks $ makepkg -sf [-g] ... ==> Finished making: iriunwebcam-bin 2.7-1 (2022-09-04T11:18:38 CEST) You should get a similar result. The resulting package will likely be a different version. When the build is done - inspect the build folder once more. If you're paranoid, superuser or developer - you may inspect the package before installation(Midnight Commander is an excellent tool). When examining the pacage iriunwebcam-bin-$VERSION-any.pkg.tar.zst we find the package to contain configurations $ cat /etc/modprobe.d/iriunwebcam-options.conf # options v42loopback exclusive_caps=1 devices= 1 card_label=\"Iriun Webcam\" $ cat /etc/modules-load.d/iriunwebcam.conf # v4l2loopback A binary /usr/local/bin/iriunwebcam A .desktop launcher /usr/share/applications/iriunwebcam.desktop And a pixmap /usr/share/pixmaps/iriunwebcam.png","title":"Build the package"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#install-the-resulting-packages","text":"To actually install the package use pacman - replace $VERSION with the version you have just built. sudo pacman -U iriunwebcam-bin-$VERSION-any.pkg.tar.zst Reboot your system to have the system use the new modules.","title":"Install the resulting packages"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#using-your-phones-camera","text":"Follow the developer's instruction to connect your camera. Connect your phone to the same wifi network as your computer You can also connect using USB. if you use usb then activate developer mode then scroll down and activate usb-debugging usb debugging requires confirmation to trust the computer Start the app on your computer Start the app on your phone As noted above - I don't know why but it is verified - if your computer is wired to the network - you need to use USB to be able to use your phones camera - it is possible it is a limitation within the software as droid-cam will work no matter the computers connection is wired or wireless.","title":"Using your phones camera"},{"location":"manjaro/android/android-manjaro-iriun-webcam/#changelog","text":"2022-09-04 - Updated with new dependency and paragraphing to clarify the elements of the guide.","title":"Changelog"},{"location":"manjaro/cheats/cheatsheet-tmux/","text":"tmux Terminal multiplexer Session Control (from the command line) command description tmux Start a new session tmux new -s <session-name> Start a new session with the name chosen tmux ls List all sessions tmux attach -t <target-session> Re-attach a detached session tmux attach -d -t <target-session> Re-attach a detached session (and detach it from elsewhere) tmux kill-session -t <target-session> Delete session Pane Control command description Ctrl b, \" Split pane horizontally Ctrl b, % Split pane vertically Ctrl b, o Next pane Ctrl b, ; Previous pane Ctrl b, q Show pane numbers Ctrl b, z Toggle pane zoom Ctrl b, ! Convert pane into a window Ctrl b, x Kill current pane Ctrl b, Ctrl O Swap panes Ctrl b, t Display clock Ctrl b, q Transpose two letters (delete and paste) Ctrl b, { Move to the previous pane Ctrl b, } Move to the next pane Ctrl b, Space Toggle between pane layouts Ctrl b, \u2191 Resize pane (make taller) Ctrl b, \u2193 Resize pane (make smaller) Ctrl b, \u2190 Resize pane (make wider) Ctrl b, \u2192 Resize pane (make narrower) Window Control command description Ctrl b, c Create new window Ctrl b, d Detach from session Ctrl b, , Rename current window Ctrl b, & Close current window Ctrl b, w List windows Ctrl b, p Previous window Ctrl b, n Next window Copy-Mode (Emacs) command description Ctrl b, [ Enter copy mode Ctrl b, M-< Bottom of history Ctrl b, M-> Top of history Ctrl b, M-m Back to indentation Ctrl b, M-w Copy selection Ctrl b, M-y Paste selection Ctrl b, Ctrl g Clear selection Ctrl b, M-R Cursor to top line Ctrl b, M-r Cursor to middle line Ctrl b, \u2191 Cursor Up Ctrl b, \u2193 Cursor Down Ctrl b, \u2190 Cursor Left Ctrl b, \u2192 Cursor Right Copy-Mode (vi) command description Ctrl b, [ Enter copy mode Ctrl b, G Bottom of history Ctrl b, g Top of history Ctrl b, Enter Copy selection Ctrl b, p Paste selection Ctrl b, k Cursor Up Ctrl b, j Cursor Down Ctrl b, h Cursor Left Ctrl b, l Cursor Right tmux cheatsheet on DuckDuckGo","title":"tmux cheatsheet"},{"location":"manjaro/cheats/cheatsheet-tmux/#tmux","text":"Terminal multiplexer","title":"tmux"},{"location":"manjaro/cheats/cheatsheet-tmux/#session-control-from-the-command-line","text":"command description tmux Start a new session tmux new -s <session-name> Start a new session with the name chosen tmux ls List all sessions tmux attach -t <target-session> Re-attach a detached session tmux attach -d -t <target-session> Re-attach a detached session (and detach it from elsewhere) tmux kill-session -t <target-session> Delete session","title":"Session Control (from the command line)"},{"location":"manjaro/cheats/cheatsheet-tmux/#pane-control","text":"command description Ctrl b, \" Split pane horizontally Ctrl b, % Split pane vertically Ctrl b, o Next pane Ctrl b, ; Previous pane Ctrl b, q Show pane numbers Ctrl b, z Toggle pane zoom Ctrl b, ! Convert pane into a window Ctrl b, x Kill current pane Ctrl b, Ctrl O Swap panes Ctrl b, t Display clock Ctrl b, q Transpose two letters (delete and paste) Ctrl b, { Move to the previous pane Ctrl b, } Move to the next pane Ctrl b, Space Toggle between pane layouts Ctrl b, \u2191 Resize pane (make taller) Ctrl b, \u2193 Resize pane (make smaller) Ctrl b, \u2190 Resize pane (make wider) Ctrl b, \u2192 Resize pane (make narrower)","title":"Pane Control"},{"location":"manjaro/cheats/cheatsheet-tmux/#window-control","text":"command description Ctrl b, c Create new window Ctrl b, d Detach from session Ctrl b, , Rename current window Ctrl b, & Close current window Ctrl b, w List windows Ctrl b, p Previous window Ctrl b, n Next window","title":"Window Control"},{"location":"manjaro/cheats/cheatsheet-tmux/#copy-mode-emacs","text":"command description Ctrl b, [ Enter copy mode Ctrl b, M-< Bottom of history Ctrl b, M-> Top of history Ctrl b, M-m Back to indentation Ctrl b, M-w Copy selection Ctrl b, M-y Paste selection Ctrl b, Ctrl g Clear selection Ctrl b, M-R Cursor to top line Ctrl b, M-r Cursor to middle line Ctrl b, \u2191 Cursor Up Ctrl b, \u2193 Cursor Down Ctrl b, \u2190 Cursor Left Ctrl b, \u2192 Cursor Right","title":"Copy-Mode (Emacs)"},{"location":"manjaro/cheats/cheatsheet-tmux/#copy-mode-vi","text":"command description Ctrl b, [ Enter copy mode Ctrl b, G Bottom of history Ctrl b, g Top of history Ctrl b, Enter Copy selection Ctrl b, p Paste selection Ctrl b, k Cursor Up Ctrl b, j Cursor Down Ctrl b, h Cursor Left Ctrl b, l Cursor Right tmux cheatsheet on DuckDuckGo","title":"Copy-Mode (vi)"},{"location":"manjaro/configuration/configuration-alacritty-terminal-emulator/","text":"Alacritty terminal dimensions document: name: ~/.config/alacritty/alacritty.yml type: configuration window: dimensions columns: 120 lines: 40","title":"Alacritty Terminal Emulator"},{"location":"manjaro/configuration/configuration-alacritty-terminal-emulator/#alacritty-terminal-dimensions","text":"document: name: ~/.config/alacritty/alacritty.yml type: configuration window: dimensions columns: 120 lines: 40","title":"Alacritty terminal dimensions"},{"location":"manjaro/configuration/configuration-change-username/","text":"Change username Username should be chosen with care for while it is possible to change it - it may have implications beyond recognition. Implications to consider Configuration file may no longer work as expected. Scripts and service units relying on the old username. Symlinks may point to invalid destinations. If you still think you are up for the change - please read on. The GNU way By reading the man pages you find the GNU system has thought of it. man usermod man groupmod Either Reboot and don't login. Open a TTY pressing Ctrl Alt F4 Or Reboot and edit the grub entry. Press e on the selected grub entry and add the number 3 to the kernel command line and press F10 to continue boot. Login as root ! You cannot login as the user you want to change - you must use root. Manjaro usually creates a user group matching the username and assigns the user to the specific group. This makes it necessary on Manjaro to rename both the login and group. When you are logged in as root first rename the user and rename the user's home # usermod --login $NEWLOGIN --move-home --home /home/$NEWLOGIN $OLDLOGIN Then rename the user's group # groupmod --new-name $NEWGROUP $OLDGROUP NOTE: This can also be done from a live ISO using chroot. Remedy implications Contributed by @freggel.doe at Manjaro Forum Some symlinks in that new home-directory might be broken after, because their target contain the full path with the old username. Wine and it's default $HOME/.wine -prefix comes to mind. To find dead symlinks: find /home/$NEWLOGIN -xtype l Some config-files contain full paths as well (desktop background image for example). To find files with \"old\" username: grep -rn \"/home/$OLDLOGIN/\"","title":"Change username"},{"location":"manjaro/configuration/configuration-change-username/#change-username","text":"Username should be chosen with care for while it is possible to change it - it may have implications beyond recognition.","title":"Change username"},{"location":"manjaro/configuration/configuration-change-username/#implications-to-consider","text":"Configuration file may no longer work as expected. Scripts and service units relying on the old username. Symlinks may point to invalid destinations. If you still think you are up for the change - please read on.","title":"Implications to consider"},{"location":"manjaro/configuration/configuration-change-username/#the-gnu-way","text":"By reading the man pages you find the GNU system has thought of it. man usermod man groupmod","title":"The GNU way"},{"location":"manjaro/configuration/configuration-change-username/#either","text":"Reboot and don't login. Open a TTY pressing Ctrl Alt F4","title":"Either"},{"location":"manjaro/configuration/configuration-change-username/#or","text":"Reboot and edit the grub entry. Press e on the selected grub entry and add the number 3 to the kernel command line and press F10 to continue boot.","title":"Or"},{"location":"manjaro/configuration/configuration-change-username/#login-as-root","text":"You cannot login as the user you want to change - you must use root. Manjaro usually creates a user group matching the username and assigns the user to the specific group. This makes it necessary on Manjaro to rename both the login and group. When you are logged in as root first rename the user and rename the user's home # usermod --login $NEWLOGIN --move-home --home /home/$NEWLOGIN $OLDLOGIN Then rename the user's group # groupmod --new-name $NEWGROUP $OLDGROUP NOTE: This can also be done from a live ISO using chroot.","title":"Login as root!"},{"location":"manjaro/configuration/configuration-change-username/#remedy-implications","text":"Contributed by @freggel.doe at Manjaro Forum Some symlinks in that new home-directory might be broken after, because their target contain the full path with the old username. Wine and it's default $HOME/.wine -prefix comes to mind. To find dead symlinks: find /home/$NEWLOGIN -xtype l Some config-files contain full paths as well (desktop background image for example). To find files with \"old\" username: grep -rn \"/home/$OLDLOGIN/\"","title":"Remedy implications"},{"location":"manjaro/configuration/configuration-import-pfx-certificate/","text":"Transport Layer Security - ArchWiki See also file:///usr/share/ca-certificates/trust-source/README To extract the certificate stored in a .pfx file to a PEM file (if the it fails - append the -legacy option) openssl pkcs12 -in cert.pfx -clcerts -out cert.pem [-legacy] To extract also the private key (again - if this fails - append -legacy option) openssl pkcs12 -in cert.pfx -nodes -out cert.pem [-legacy] A pfx file is usually password protected, so input the password when challenged. Copy the extracted file to sudo cp cert.pem /usr/share/ca-certificates/trust-source/anchors/ And update the trust sudo update-ca-trust","title":"Import pfx certificats on Manjaro"},{"location":"manjaro/configuration/configuration-manjaro-tools-build-mirror/","text":"To make the tools config follow primary mirror in mirrorlist Edit your ~/.config/manjaro-tools/manjaro-tools.conf build_mirror=$(grep /etc/pacman.d/mirrorlist -e 'http' | head -n 1 | cut -d' ' -f3- | rev | cut -d'/' -f4- | rev)","title":"Manjaro Tools build_mirror"},{"location":"manjaro/configuration/configuration-x11-over-ssh/","text":"Configure SSH to forward X Editing server config Server configuration is found in /etc/ssh/sshd_config X11 forward for specified user Match User manjaro X11Forwarding yes Configure display on host Default :10 X11DisplayOffset 10 If you want to use all display change X11UseLocalhost no Client Client configuration is stored in ~/.ssh/config Connect ssh -X manjaro@host.name Alternative connection method ssh -o ForwardX11=yes manjaro@host.name Make X11 forwarding a permanent option. Edit the local config and set X11Forwarding yes Running an X11 app over ssh e.g. xclock (fork to background) ssh -X -f user@host xclock For more info read the man page man ssh Troubleshooting check xauth $ which xauth /usr/bin/xauth It is usually present on Manjaro - if not sync the package sudo pacman -S xorg-xauth","title":"X11 over SSH"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#configure-ssh-to-forward-x","text":"","title":"Configure SSH to forward X"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#editing-server-config","text":"Server configuration is found in /etc/ssh/sshd_config","title":"Editing server config"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#x11-forward-for-specified-user","text":"Match User manjaro X11Forwarding yes","title":"X11 forward for specified user"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#configure-display-on-host","text":"Default :10 X11DisplayOffset 10","title":"Configure display on host"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#if-you-want-to-use-all-display-change","text":"X11UseLocalhost no","title":"If you want to use all display change"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#client","text":"Client configuration is stored in ~/.ssh/config","title":"Client"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#connect","text":"ssh -X manjaro@host.name","title":"Connect"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#alternative-connection-method","text":"ssh -o ForwardX11=yes manjaro@host.name","title":"Alternative connection method"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#make-x11-forwarding-a-permanent-option","text":"Edit the local config and set X11Forwarding yes","title":"Make X11 forwarding a permanent option."},{"location":"manjaro/configuration/configuration-x11-over-ssh/#running-an-x11-app-over-ssh","text":"e.g. xclock (fork to background) ssh -X -f user@host xclock For more info read the man page man ssh","title":"Running an X11 app over ssh"},{"location":"manjaro/configuration/configuration-x11-over-ssh/#troubleshooting","text":"check xauth $ which xauth /usr/bin/xauth It is usually present on Manjaro - if not sync the package sudo pacman -S xorg-xauth","title":"Troubleshooting"},{"location":"manjaro/grub/grub-boot-iso-directly/","text":"menuentry \"Manjaro grub_iso\" { set isofile=\"/miso/manjaro-gnome-20.1-stable-x86_64.iso\" set dri=\"free\" set lang=\"en_US\" set keytable=\"fi\" set timezone=\"Europe/Helsinki\" search --no-floppy -f --set=root $isofile probe -u $root --set=abc set pqr=\"/dev/disk/by-uuid/$abc\" loopback loop $isofile linux (loop)/boot/vmlinuz-x86_64 img_dev=$pqr img_loop=$isofile driver=$dri tz=$timezone lang=$lang keytable=$keytable copytoram initrd (loop)/boot/intel_ucode.img (loop)/boot/initramfs-x86_64.img } Source: Manjaro Forum","title":"Boot ISO from GRUB"},{"location":"manjaro/grub/grub-support-for-luks2-container/","text":"grub only supports container using PBKDF2 container type. See this commit comment dated 1010-01-10 where Argon2i and Argon2id was postponed. For Arch and distributions based on Arch there the option of building a custom grub loader using the recipe located in AUR as grub-improved-luks2-git . An article on the details was found at https://mdleom.com/blog/2022/11/27/grub-luks2-argon2/","title":"Grub load system from luks2 container"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/","text":"Minimal CLI system using VirtualBox Use any Manjaro ISO but at the boot menu edit the free drivers item by pressing e and append 3 to the linux line. When booted to the terminal - login using root : manjaro 1. Keyboard If tyou need a differenct keyboard than us then use loadkeys followed by a country code e.g. for Denmark # loadkeys dk 2. System time Ensure system time is correct - necessary for SSL certificates # systemctl enable --now systemd-timesyncd 3. Mirror and branch We use pacman-mirrors to set a mirror and the desired branch. # pacman-mirrors --api --set-branch unstable --url https://manjaro.moson.eu You can replace the branch with stable or testing and you can remove the --url argument and use e.g. --continent for closer mirrors. 4. Database and keyrings Ensure pacman is up-to-date, download the databases and install keyrings # pacman -Syy pacman archlinux-keyring manjaro-keyring 5. Trust database Create trust database, populate and refresh keys # pacman-key --init # pacman-key --populate archlinux manjaro # pacman-key --refresh-keys If for some reason the above fails on the last command you need to specify a keyserver - and to mention a few keyserver.pgp.com keyserver.ubuntu.com pgp.mit.edu 3. Partitioning disk root@ubuntu:~# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7:0 0 31M 1 loop /snap/snapd/9607 loop1 7:1 0 55.3M 1 loop /snap/core18/1885 loop2 7:2 0 70.6M 1 loop /snap/lxd/16922 vda 252:0 0 25G 0 disk \u251c\u2500vda1 252:1 0 24.9G 0 part / \u251c\u2500vda14 252:14 0 4M 0 part \u2514\u2500vda15 252:15 0 106M 0 part /boot/efi # cfdisk --zero /dev/sda Using MBR Select dos partition type Create one partition primary Format bash # mkfs.ext4 -L MJROROOT /dev/sda1 Mount bash # mount /dev/sda1 /mnt Using GPT Select gpt Create a small (8MB) unformatted partition - partition type BIOS boot (0xEF02) Create the root partition Format bash # mkfs.ext4 -L MJROROOT /dev/sda2 Mount # mount /dev/sda2 /mnt 6. Base installation Use basestrap command to install a base set of packages into the newly mounted root # basestrap /mnt base linux54 dhcpcd grub mkinitcpio vi nano sudo links openssh firewalld 7. Base configuration # manjaro-chroot /mnt /bin/bash Console keyboard Set console keyboard in /etc/vconsole.conf KEYMAP=us Locale To generate the messages edit /etc/locale.gen and remove the comment for locale(s) to be generated (UTF-8 is the recommend choice). Select locale Example for a system in Denmark using english messages ... en_US.UTF-8 UTF-8 ... Generate the messages # locale-gen locale.conf Edit your locale configuration in /etc/locale.conf to match above choice - example for Denmark LANG=en_DK.UTF8 Timezone Set the time zone for location (the available zones is listed in /usr/share/zoneinfo/ using the Continent/Capitol format). Symlink the time zone as /etc/localtime - example for Denmark # ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime Clock Linux clock runs using the timezone info and UTC time. # hwclock --systohc --utc Hostname Set hostname # echo manjaro > /etc/hostname Hosts configuration ``` nano /etc/hosts ``` bash 127.0.0.1 localhost ::1 localhost 127.0.1.1 manjaro.localdomain manjaro Note: If the system has a static IP replace 127.0.1.1 with the IP. System administration Allow members of the wheel group to perform administrative tasks. Run visudo # visudo Locate the line reading # %wheel ALL=(ALL) ALL and remove the # in the beginning of the line %wheel ALL=(ALL) ALL Enable dhcp network # systemctl enable dhcpcd Enable ssh service # systemctl enable sshd Time syncronization Enable timesync daemon # systemctl enable systemd-timesyncd Root password Set a password the root user # passwd cloud-init # pacman -S cloud-init Edit /etc/cloud/cloud.cfg add the line datasource_list: [ ConfigDrive, OpenNebula, DigitalOcean, Azure, AltCloud, OVF, MAAS, GCE, OpenStack, CloudSigma, SmartOS, None, NoCloud ] In the section cloud_init_modules remember to remove the line specifying growpart unless you have build and installed the growpart package from AUR. Edit the section system_info - edit the section as preferred. Enable the following services # systemctl enable cloud-init.service cloud-final.service 8. Bootloader Build the initramfs and install and setup grub Initramfs Build the initramfs according to your chosen kernel e.g. linux54 # mkinitcpio -p linux54 Bootloader # grub-install --target=i386-pc /dev/sda Edit the default grub configuration /etc/default/grub and adjust to match your setup e.g. you can use the label or you can use device path for your root partition GRUB_CMDLINE_LINUX_DEFAULT=\".. root=/dev/sdaX ...\" or GRUB_CMDLINE_LINUX_DEFAULT=\".. root=LABEL=MJROROOT ...\" and uncomment the following line #GRUB_DISABLE_LINUX_UUID=true Generate grub configuration # grub-mkconfig -o /boot/grub/grub.cfg Close chroot # exit Unmount the partitions # umount -R /mnt Testing the image is booting After you have booted your image - check the folder /run/cloud-init for non-trivial messages. Remember to eject the ISO you used for installation Clean your image and the cloud-init before shutting down # pacman -Scc # cloud-init clean # systemctl poweroff Then compress the VDI image - best result # bzip2 --best -k your-vm-disk.vdi","title":"Manjaro cloud instance using cloud-init"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#minimal-cli-system-using-virtualbox","text":"Use any Manjaro ISO but at the boot menu edit the free drivers item by pressing e and append 3 to the linux line. When booted to the terminal - login using root : manjaro 1. Keyboard If tyou need a differenct keyboard than us then use loadkeys followed by a country code e.g. for Denmark # loadkeys dk 2. System time Ensure system time is correct - necessary for SSL certificates # systemctl enable --now systemd-timesyncd 3. Mirror and branch We use pacman-mirrors to set a mirror and the desired branch. # pacman-mirrors --api --set-branch unstable --url https://manjaro.moson.eu You can replace the branch with stable or testing and you can remove the --url argument and use e.g. --continent for closer mirrors. 4. Database and keyrings Ensure pacman is up-to-date, download the databases and install keyrings # pacman -Syy pacman archlinux-keyring manjaro-keyring 5. Trust database Create trust database, populate and refresh keys # pacman-key --init # pacman-key --populate archlinux manjaro # pacman-key --refresh-keys If for some reason the above fails on the last command you need to specify a keyserver - and to mention a few keyserver.pgp.com keyserver.ubuntu.com pgp.mit.edu","title":"Minimal CLI system using VirtualBox"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#3-partitioning-disk","text":"root@ubuntu:~# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7:0 0 31M 1 loop /snap/snapd/9607 loop1 7:1 0 55.3M 1 loop /snap/core18/1885 loop2 7:2 0 70.6M 1 loop /snap/lxd/16922 vda 252:0 0 25G 0 disk \u251c\u2500vda1 252:1 0 24.9G 0 part / \u251c\u2500vda14 252:14 0 4M 0 part \u2514\u2500vda15 252:15 0 106M 0 part /boot/efi # cfdisk --zero /dev/sda","title":"3. Partitioning disk"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#using-mbr","text":"Select dos partition type Create one partition primary Format bash # mkfs.ext4 -L MJROROOT /dev/sda1 Mount bash # mount /dev/sda1 /mnt","title":"Using MBR"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#using-gpt","text":"Select gpt Create a small (8MB) unformatted partition - partition type BIOS boot (0xEF02) Create the root partition Format bash # mkfs.ext4 -L MJROROOT /dev/sda2 Mount # mount /dev/sda2 /mnt","title":"Using GPT"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#6-base-installation","text":"Use basestrap command to install a base set of packages into the newly mounted root # basestrap /mnt base linux54 dhcpcd grub mkinitcpio vi nano sudo links openssh firewalld","title":"6. Base installation"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#7-base-configuration","text":"# manjaro-chroot /mnt /bin/bash","title":"7. Base configuration"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#console-keyboard","text":"Set console keyboard in /etc/vconsole.conf KEYMAP=us","title":"Console keyboard"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#locale","text":"To generate the messages edit /etc/locale.gen and remove the comment for locale(s) to be generated (UTF-8 is the recommend choice). Select locale Example for a system in Denmark using english messages ... en_US.UTF-8 UTF-8 ... Generate the messages # locale-gen locale.conf Edit your locale configuration in /etc/locale.conf to match above choice - example for Denmark LANG=en_DK.UTF8","title":"Locale"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#timezone","text":"Set the time zone for location (the available zones is listed in /usr/share/zoneinfo/ using the Continent/Capitol format). Symlink the time zone as /etc/localtime - example for Denmark # ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime","title":"Timezone"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#clock","text":"Linux clock runs using the timezone info and UTC time. # hwclock --systohc --utc","title":"Clock"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#hostname","text":"Set hostname # echo manjaro > /etc/hostname","title":"Hostname"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#hosts-configuration","text":"```","title":"Hosts configuration"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#nano-etchosts","text":"","title":"nano /etc/hosts"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#_1","text":"bash 127.0.0.1 localhost ::1 localhost 127.0.1.1 manjaro.localdomain manjaro Note: If the system has a static IP replace 127.0.1.1 with the IP.","title":"```"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#system-administration","text":"Allow members of the wheel group to perform administrative tasks. Run visudo # visudo Locate the line reading # %wheel ALL=(ALL) ALL and remove the # in the beginning of the line %wheel ALL=(ALL) ALL Enable dhcp network # systemctl enable dhcpcd Enable ssh service # systemctl enable sshd","title":"System administration"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#time-syncronization","text":"Enable timesync daemon # systemctl enable systemd-timesyncd","title":"Time syncronization"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#root-password","text":"Set a password the root user # passwd","title":"Root password"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#cloud-init","text":"# pacman -S cloud-init Edit /etc/cloud/cloud.cfg add the line datasource_list: [ ConfigDrive, OpenNebula, DigitalOcean, Azure, AltCloud, OVF, MAAS, GCE, OpenStack, CloudSigma, SmartOS, None, NoCloud ] In the section cloud_init_modules remember to remove the line specifying growpart unless you have build and installed the growpart package from AUR. Edit the section system_info - edit the section as preferred. Enable the following services # systemctl enable cloud-init.service cloud-final.service","title":"cloud-init"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#8-bootloader","text":"Build the initramfs and install and setup grub","title":"8. Bootloader"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#initramfs","text":"Build the initramfs according to your chosen kernel e.g. linux54 # mkinitcpio -p linux54","title":"Initramfs"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#bootloader","text":"# grub-install --target=i386-pc /dev/sda Edit the default grub configuration /etc/default/grub and adjust to match your setup e.g. you can use the label or you can use device path for your root partition GRUB_CMDLINE_LINUX_DEFAULT=\".. root=/dev/sdaX ...\" or GRUB_CMDLINE_LINUX_DEFAULT=\".. root=LABEL=MJROROOT ...\" and uncomment the following line #GRUB_DISABLE_LINUX_UUID=true Generate grub configuration # grub-mkconfig -o /boot/grub/grub.cfg","title":"Bootloader"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#close-chroot","text":"# exit","title":"Close chroot"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#unmount-the-partitions","text":"# umount -R /mnt","title":"Unmount the partitions"},{"location":"manjaro/installation/manjaro-cli-cloud-instance-using-cloud-init/#testing-the-image-is-booting","text":"After you have booted your image - check the folder /run/cloud-init for non-trivial messages. Remember to eject the ISO you used for installation Clean your image and the cloud-init before shutting down # pacman -Scc # cloud-init clean # systemctl poweroff Then compress the VDI image - best result # bzip2 --best -k your-vm-disk.vdi","title":"Testing the image is booting"},{"location":"manjaro/installation/manjaro-cli-installation-kde-plasma/","text":"Extend your Manjaro CLI This guide covers the extension of a basic CLI to a graphical environment using a minimal set of packages. If you want to read up on the CLI it is available on the link below. Boot your device and login into the system using the root account. Install packages We will now extend our basic CLI to a graphical environment using the least amount of packages and we will add in a web browser application. For this excercise I have chosen LXDE because it is lightweight and offers a familiar Windows like interface. I have chosen Midori because of the small footprint but it could as well be Firefox or Chromium. When you get the hang of it you can modify to your liking but for now install the below packages using pacman . You may need to research if you need WiFi driver packages not mentioned below. [details=\"Xorg packages\"] * xorg-server * xorg-server-common * xorg-xinit * xorg-drivers [/details] [details=\"Wireless packages\"] * ipw2100-fw * ipw2200-fw [/details] [details=\"Lxde vanilla\"] * accountsservice * gnome-keyring * gnome-icon-theme * gnome-themes-standard * lxappearance * lxde-common * lxde-icon-theme * lxhotkey * lxinput * lxlauncher * lxmed * lxmenu-data * lxpanel * lxsession * lxtask * lxterminal * obconf * pcmanfm * perl-file-mimeinfo * xdg-user-dirs * xdg-user-dirs-gtk * xdg-utils [/details] [details=\"Network\"] * midori * network-manager-applet [/details] [details=\"Manjaro theming\"] * lxde-wallpapers * manjaro-lxde-config * manjaro-lxde-desktop-settings * manjaro-lxde-logout-banner * matcha-gtk-theme * manjaro-openbox-matcha * papirus-icon-theme * papirus-maia-icon-theme * ttf-dejavu * ttf-roboto * xcursor-breeze [/details] # pacman -Syu xorg-server xorg-server-common xorg-xinit xorg-drivers ipw2100-fw ipw2200-fw iw iwd accountsservice gnome-keyring gnome-icon-theme gnome-themes-standard leafpad lxappearance lxde-common lxde-icon-theme lxhotkey lxinput lxlauncher lxmed lxmenu-data lxpanel lxsession lxtask lxterminal manjaro-icons obconf pcmanfm perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils midori network-manager-applet lxde-wallpapers manjaro-lxde-config manjaro-lxde-desktop-settings manjaro-lxde-logout-banner matcha-gtk-theme manjaro-openbox-matcha papirus-icon-theme papirus-maia-icon-theme ttf-dejavu ttf-roboto xcursor-breeze After you have installed the Xorg and Lxde packages - create a new adminstrative user. The explanation for waiting with user creation is the default settings which, on user creation, are copied from /etc/skel to the new users home. # useradd -mUG lp,network,power,sys,wheel newuser Set a password for the new user # passwd newuser Logout # exit Start X Login with the new username and launch X $ startx Variations https://archived.forum.manjaro.org/t/howto-install-manjaro-using-cli-only/108203?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-run-manjaro-on-a-stick/109520?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-install-encrypted-manjaro-using-cli/110553?u=linux-aarhus","title":"CLI to LXDE"},{"location":"manjaro/installation/manjaro-cli-installation-kde-plasma/#extend-your-manjaro-cli","text":"This guide covers the extension of a basic CLI to a graphical environment using a minimal set of packages. If you want to read up on the CLI it is available on the link below. Boot your device and login into the system using the root account.","title":"Extend your Manjaro CLI"},{"location":"manjaro/installation/manjaro-cli-installation-kde-plasma/#install-packages","text":"We will now extend our basic CLI to a graphical environment using the least amount of packages and we will add in a web browser application. For this excercise I have chosen LXDE because it is lightweight and offers a familiar Windows like interface. I have chosen Midori because of the small footprint but it could as well be Firefox or Chromium. When you get the hang of it you can modify to your liking but for now install the below packages using pacman . You may need to research if you need WiFi driver packages not mentioned below. [details=\"Xorg packages\"] * xorg-server * xorg-server-common * xorg-xinit * xorg-drivers [/details] [details=\"Wireless packages\"] * ipw2100-fw * ipw2200-fw [/details] [details=\"Lxde vanilla\"] * accountsservice * gnome-keyring * gnome-icon-theme * gnome-themes-standard * lxappearance * lxde-common * lxde-icon-theme * lxhotkey * lxinput * lxlauncher * lxmed * lxmenu-data * lxpanel * lxsession * lxtask * lxterminal * obconf * pcmanfm * perl-file-mimeinfo * xdg-user-dirs * xdg-user-dirs-gtk * xdg-utils [/details] [details=\"Network\"] * midori * network-manager-applet [/details] [details=\"Manjaro theming\"] * lxde-wallpapers * manjaro-lxde-config * manjaro-lxde-desktop-settings * manjaro-lxde-logout-banner * matcha-gtk-theme * manjaro-openbox-matcha * papirus-icon-theme * papirus-maia-icon-theme * ttf-dejavu * ttf-roboto * xcursor-breeze [/details] # pacman -Syu xorg-server xorg-server-common xorg-xinit xorg-drivers ipw2100-fw ipw2200-fw iw iwd accountsservice gnome-keyring gnome-icon-theme gnome-themes-standard leafpad lxappearance lxde-common lxde-icon-theme lxhotkey lxinput lxlauncher lxmed lxmenu-data lxpanel lxsession lxtask lxterminal manjaro-icons obconf pcmanfm perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils midori network-manager-applet lxde-wallpapers manjaro-lxde-config manjaro-lxde-desktop-settings manjaro-lxde-logout-banner matcha-gtk-theme manjaro-openbox-matcha papirus-icon-theme papirus-maia-icon-theme ttf-dejavu ttf-roboto xcursor-breeze After you have installed the Xorg and Lxde packages - create a new adminstrative user. The explanation for waiting with user creation is the default settings which, on user creation, are copied from /etc/skel to the new users home. # useradd -mUG lp,network,power,sys,wheel newuser Set a password for the new user # passwd newuser Logout # exit","title":"Install packages"},{"location":"manjaro/installation/manjaro-cli-installation-kde-plasma/#start-x","text":"Login with the new username and launch X $ startx","title":"Start X"},{"location":"manjaro/installation/manjaro-cli-installation-kde-plasma/#variations","text":"https://archived.forum.manjaro.org/t/howto-install-manjaro-using-cli-only/108203?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-run-manjaro-on-a-stick/109520?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-install-encrypted-manjaro-using-cli/110553?u=linux-aarhus","title":"Variations"},{"location":"manjaro/installation/manjaro-cli-installation-mate-systemd-boot-and-luks/","text":"Toolbox script Installing a Manjaro Mate using systemd boot and LUKS encryption # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # Copyright (c) 2021 @linux-aarhus # # This script is based on # https://forum.manjaro.org/t/root-tip-diy-installer-script-base-sdboot-luks/88502 # # MODIFIED TO FIT A SPECIFIC FORUM TOPIC # https://forum.manjaro.org/t/how-do-i-install-manjaro-mate-with-lvm-on-luks-and-dual-boot-with-windows/87358 # # ! IMPORTANT ! # ! GREAT CARE SHOULD BE EXCERCISED ! # ! A lot of assumptions are made - please review carefully ! # # The script assumes the system is booted using a recent Manjaro Mate ISO # The disk is pre-installed using Windows in EFI mode # The Manjaro ISO is booted in EFI mode (firmware Legacy boot disabled) # The existing Windows EFI partition ($esp) is located at /dev/sda1 # An empty partition has been created to hold a Linux filesystem (0x8300) as /dev/sda5 # systemd-boot is installed as bootloader # The root filesystem is using f2fs inside a LUKS container # # ! PLEASE REVIEW THE VARIABLES SECTION ! # ! AMEND THE VARIABLES AS NECESSARY ! # if [ \"$(id -u)\" != \"0\" ]; then echo \"Please change to root context using su or sudo\" echo \"\" exit fi ############################################################# #### VARIABLES SECTION TARGET=\"/dev/sda\" EFI_PART=\"/dev/sda1\" # existing Windows $esp LUKS_PART=\"/dev/sda2\" # root partition to hold LUKS container TUSER=manjaro # first user == wheel group TDISPLAYMANAGER=lightdm # display manager KERNEL=\"5.10\" # linux kernel number KERNELPKG=$(echo linux$KERNEL | sed 's/\\.//')# kernel package name MIRROR='https://mirrors.manjaro.org/repo/' # build mirror BRANCH='unstable' # target branch TKEYMAP='dk' # target keyboard layout TLOCALE_CONF='en_DK.UTF-8' # target locale.conf TLOCALE_PRIMARY='en_DK.UTF-8 UTF-8' # target primary locale TLOCALE_FALLBACK='en_US.UTF-8 UTF-8' # target fallback locale TTIMEZONE='Europe/Copenhagen' # target timezone THOSTNAME='manjaro' # target hostname ITER_TIME=\"10000\" # luks iteration time RETRIES=\"3\" # luks decryption retries BASE_PKGS=\"base $KERNELPKG mkinitcpio networkmanager bash-completion\" TGROUPS='lp,network,power,wheel' TSERVICES='cronie ModemManager NetworkManager cups tlp tlp-sleep avahi-daemon add-autologin-group haveged apparmor snapd.apparmor snapd' #### VARIABLES END ############################################################# # == BARE METAL TEST SETUP ============================ #echo \"==> Unmounting $TARGET\" #umount -f \"$TARGET\" #echo \"==> Preparing disk $TARGET\" #sgdisk --zap-all \"$TARGET\" #sgdisk --mbrtogpt \"$TARGET\" #### efi #echo \"==> Creating EFI partition\" #sgdisk --new 1::+512M --typecode 1:ef00 --change-name 1:\"EFI System\" \"$TARGET\" #echo \"==> wiping EFI partition\" #wipefs -af \"$TARGET\"1 #echo \"==> formatting EFI partition\" #mkfs.vfat -F32 \"$TARGET\"1 #### root #echo \"==> Creating root partition\" #sgdisk --new 2::: --typecode 2:8304 --change-name 2:\"Linux x86-64 root\" \"$TARGET\" #echo \"==> wiping root partition\" #wipefs -af \"$TARGET\"2 # == END BARE METAL TEST SETUP ======================== # ===== EXISTING WINDOWS DEVICE ======================= echo \"==> Unmounting $EFI_PART\" umount -f \"$EFI_PART\" echo \"==> Unmounting $LUKS_PART\" umount -f \"$LUKS_PART\" echo \"==> wiping root partition\" wipefs -af \"$LUKS_PART\" # ==================================================== echo \"==> ------------------------------------------\" echo \"==> Setting up root LUKS container\" echo \" -> WATCHOUT FOR THE UPPERCASE CONFIRMATION\" echo \" -> If using CapsLock remember to toggle back\" cryptsetup --type luks2 --use-urandom luksFormat \"$LUKS_PART\" echo \"==> ------------------------------------------\" echo \"==> Open LUKS container\" cryptsetup open \"$LUKS_PART\" cryptroot echo \"==> Formatting LUKS using ext4\" mkfs.ext4 /dev/mapper/cryptroot echo \"==> Mounting root partition\" mount /dev/mapper/cryptroot /mnt echo \"==> Creating /boot\" mkdir /mnt/boot echo \"==> Mounting EFI partition\" mount \"$EFI_PART\" /mnt/boot echo \"==> Setting branch and mirror\" pacman-mirrors --api --set-branch $BRANCH --url $MIRROR echo \"==> Syncronizing pacman databases\" pacman -Syy echo \"==> installing base system\" basestrap /mnt $BASE_PKGS echo \"==> Configure base ...\" echo \" -> Creating file: vconsole.conf\" echo KEYMAP=$TKEYMAP > /mnt/etc/vconsole.conf echo \" -> Creating file: locale.conf\" echo LANG=$TLOCALE_CONF > /mnt/etc/locale.conf echo \" -> Creating file: hostname\" echo manjaro > /mnt/etc/hostname echo \" -> Creating file: hosts\" cat > /mnt/etc/hosts <<EOF 127.0.0.1 localhost 127.0.1.1 $THOSTNAME.localdomain $THOSTNAME EOF echo \" -> Creating symlink: localtime\" ln -sf /usr/share/zoneinfo/$TTIMEZONE /mnt/etc/localtime echo \" -> Setting hardware clock\" manjaro-chroot /mnt hwclock --systohc echo \" -> Enabling services\" manjaro-chroot /mnt systemctl enable NetworkManager systemd-timesyncd echo \" -> Modifying file: locale.gen\" echo $TLOCALE_PRIMARY >> /mnt/etc/locale.gen echo $TLOCALE_FALLBACK >> /mnt/etc/locale.gen echo \" -> Generating locale\" manjaro-chroot /mnt locale-gen echo \" -> Setting up mkinitcpio.conf\" sed -i '/HOOKS=/c\\HOOKS=(systemd keyboard keymap sd-vconsole block sd-encrypt autodetect modconf filesystems fsck)' /mnt/etc/mkinitcpio.conf echo \" -> Generating initrd\" manjaro-chroot /mnt mkinitcpio -P echo \" -> Installing bootloader\" bootctl --path=/mnt/boot install echo \" -> Updating entries with device UUID\" devuuid=$(lsblk -no uuid \"$LUKS_PART\" | head -n1) echo \" -> Creating loader entry: manjaro.conf\" cat > /mnt/boot/loader/entries/manjaro.conf <<EOF title Manjaro linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Creating fallback entry: manjaro-fallback.conf\" cat > /mnt/boot/loader/entries/manjaro-fallback.conf <<EOF title Manjaro (fallback) linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-fallback-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Setting default loader\" sed -i '/default/c\\/default manjaro\\*/' /mnt/boot/loader/loader.conf echo \"==> Setting target branch and mirror\" pacman-mirrors --api --prefix /mnt --set-branch $BRANCH --url $MIRROR echo \"==> Set root password\" manjaro-chroot /mnt passwd root ############################################################# #### ISO SPECIFIC SETUP echo \"==> Installing display manager\" manjaro-chroot /mnt pacman -S $TDISPLAYMANAGER --noconfirm echo \"==> Installing ISO package lists\" manjaro-chroot /mnt pacman -S $(comm -12 <(awk '{print $1}' /rootfs-pkgs.txt | sort) <(awk '{print $1}' /desktopfs-pkgs.txt | sort) | sed '/^grub/d' | sed '/^os-prober/d' | sed '/^kernel-modules-hook/d' | sed '/^kernel-alive/d' | sed '/^linux[0-9][0-9]/d') --needed --noconfirm echo \" --> Done installing ISO packages.\" echo \"==> Copying ISO specific settings...\" cp /etc/lightdm/lightdm-gtk-greeter.conf /mnt/etc/lightdm cp /etc/lightdm/slick-greeter.conf /mnt/etc/lightdm cp /etc/environment /mnt/etc cp /usr/share/icons/default /mnt/usr/share/icons echo \"==> Setting up wheel group\" cat > /mnt/etc/sudoers.d/100-wheel <<EOF %wheel ALL=(ALL) ALL EOF echo \"==> Create new admin user $TUSER\" manjaro-chroot /mnt useradd -mUG $TGROUPS $TUSER echo \"==> Set admin user password\" manjaro-chroot /mnt passwd $TUSER echo \"==> Enable display manager\" manjaro-chroot /mnt systemctl enable $TDISPLAYMANAGER echo \"==> Enable ISO services\" manjaro-chroot /mnt systemctl enable $TSERVICES #### ISO SETUP END ############################################################# echo \"==> Cleaning up\" echo \" -> Unmounting partitions\" umount -R /mnt echo \" -> Closing LUKS container\" cryptsetup close /dev/mapper/cryptroot sync echo \"==> Done! You have succesfully mimicked a Manjaro Mate Edition\" echo \"==> TODO: Configure swapfile ...\" echo \" -> Swap configuration <https://wiki.manjaro.org/index.php/Swap>\" echo \"\"","title":"Mimick Manjaro Mate using sdboot and luks"},{"location":"manjaro/installation/manjaro-cli-installation-mate-systemd-boot-and-luks/#toolbox-script","text":"Installing a Manjaro Mate using systemd boot and LUKS encryption # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # Copyright (c) 2021 @linux-aarhus # # This script is based on # https://forum.manjaro.org/t/root-tip-diy-installer-script-base-sdboot-luks/88502 # # MODIFIED TO FIT A SPECIFIC FORUM TOPIC # https://forum.manjaro.org/t/how-do-i-install-manjaro-mate-with-lvm-on-luks-and-dual-boot-with-windows/87358 # # ! IMPORTANT ! # ! GREAT CARE SHOULD BE EXCERCISED ! # ! A lot of assumptions are made - please review carefully ! # # The script assumes the system is booted using a recent Manjaro Mate ISO # The disk is pre-installed using Windows in EFI mode # The Manjaro ISO is booted in EFI mode (firmware Legacy boot disabled) # The existing Windows EFI partition ($esp) is located at /dev/sda1 # An empty partition has been created to hold a Linux filesystem (0x8300) as /dev/sda5 # systemd-boot is installed as bootloader # The root filesystem is using f2fs inside a LUKS container # # ! PLEASE REVIEW THE VARIABLES SECTION ! # ! AMEND THE VARIABLES AS NECESSARY ! # if [ \"$(id -u)\" != \"0\" ]; then echo \"Please change to root context using su or sudo\" echo \"\" exit fi ############################################################# #### VARIABLES SECTION TARGET=\"/dev/sda\" EFI_PART=\"/dev/sda1\" # existing Windows $esp LUKS_PART=\"/dev/sda2\" # root partition to hold LUKS container TUSER=manjaro # first user == wheel group TDISPLAYMANAGER=lightdm # display manager KERNEL=\"5.10\" # linux kernel number KERNELPKG=$(echo linux$KERNEL | sed 's/\\.//')# kernel package name MIRROR='https://mirrors.manjaro.org/repo/' # build mirror BRANCH='unstable' # target branch TKEYMAP='dk' # target keyboard layout TLOCALE_CONF='en_DK.UTF-8' # target locale.conf TLOCALE_PRIMARY='en_DK.UTF-8 UTF-8' # target primary locale TLOCALE_FALLBACK='en_US.UTF-8 UTF-8' # target fallback locale TTIMEZONE='Europe/Copenhagen' # target timezone THOSTNAME='manjaro' # target hostname ITER_TIME=\"10000\" # luks iteration time RETRIES=\"3\" # luks decryption retries BASE_PKGS=\"base $KERNELPKG mkinitcpio networkmanager bash-completion\" TGROUPS='lp,network,power,wheel' TSERVICES='cronie ModemManager NetworkManager cups tlp tlp-sleep avahi-daemon add-autologin-group haveged apparmor snapd.apparmor snapd' #### VARIABLES END ############################################################# # == BARE METAL TEST SETUP ============================ #echo \"==> Unmounting $TARGET\" #umount -f \"$TARGET\" #echo \"==> Preparing disk $TARGET\" #sgdisk --zap-all \"$TARGET\" #sgdisk --mbrtogpt \"$TARGET\" #### efi #echo \"==> Creating EFI partition\" #sgdisk --new 1::+512M --typecode 1:ef00 --change-name 1:\"EFI System\" \"$TARGET\" #echo \"==> wiping EFI partition\" #wipefs -af \"$TARGET\"1 #echo \"==> formatting EFI partition\" #mkfs.vfat -F32 \"$TARGET\"1 #### root #echo \"==> Creating root partition\" #sgdisk --new 2::: --typecode 2:8304 --change-name 2:\"Linux x86-64 root\" \"$TARGET\" #echo \"==> wiping root partition\" #wipefs -af \"$TARGET\"2 # == END BARE METAL TEST SETUP ======================== # ===== EXISTING WINDOWS DEVICE ======================= echo \"==> Unmounting $EFI_PART\" umount -f \"$EFI_PART\" echo \"==> Unmounting $LUKS_PART\" umount -f \"$LUKS_PART\" echo \"==> wiping root partition\" wipefs -af \"$LUKS_PART\" # ==================================================== echo \"==> ------------------------------------------\" echo \"==> Setting up root LUKS container\" echo \" -> WATCHOUT FOR THE UPPERCASE CONFIRMATION\" echo \" -> If using CapsLock remember to toggle back\" cryptsetup --type luks2 --use-urandom luksFormat \"$LUKS_PART\" echo \"==> ------------------------------------------\" echo \"==> Open LUKS container\" cryptsetup open \"$LUKS_PART\" cryptroot echo \"==> Formatting LUKS using ext4\" mkfs.ext4 /dev/mapper/cryptroot echo \"==> Mounting root partition\" mount /dev/mapper/cryptroot /mnt echo \"==> Creating /boot\" mkdir /mnt/boot echo \"==> Mounting EFI partition\" mount \"$EFI_PART\" /mnt/boot echo \"==> Setting branch and mirror\" pacman-mirrors --api --set-branch $BRANCH --url $MIRROR echo \"==> Syncronizing pacman databases\" pacman -Syy echo \"==> installing base system\" basestrap /mnt $BASE_PKGS echo \"==> Configure base ...\" echo \" -> Creating file: vconsole.conf\" echo KEYMAP=$TKEYMAP > /mnt/etc/vconsole.conf echo \" -> Creating file: locale.conf\" echo LANG=$TLOCALE_CONF > /mnt/etc/locale.conf echo \" -> Creating file: hostname\" echo manjaro > /mnt/etc/hostname echo \" -> Creating file: hosts\" cat > /mnt/etc/hosts <<EOF 127.0.0.1 localhost 127.0.1.1 $THOSTNAME.localdomain $THOSTNAME EOF echo \" -> Creating symlink: localtime\" ln -sf /usr/share/zoneinfo/$TTIMEZONE /mnt/etc/localtime echo \" -> Setting hardware clock\" manjaro-chroot /mnt hwclock --systohc echo \" -> Enabling services\" manjaro-chroot /mnt systemctl enable NetworkManager systemd-timesyncd echo \" -> Modifying file: locale.gen\" echo $TLOCALE_PRIMARY >> /mnt/etc/locale.gen echo $TLOCALE_FALLBACK >> /mnt/etc/locale.gen echo \" -> Generating locale\" manjaro-chroot /mnt locale-gen echo \" -> Setting up mkinitcpio.conf\" sed -i '/HOOKS=/c\\HOOKS=(systemd keyboard keymap sd-vconsole block sd-encrypt autodetect modconf filesystems fsck)' /mnt/etc/mkinitcpio.conf echo \" -> Generating initrd\" manjaro-chroot /mnt mkinitcpio -P echo \" -> Installing bootloader\" bootctl --path=/mnt/boot install echo \" -> Updating entries with device UUID\" devuuid=$(lsblk -no uuid \"$LUKS_PART\" | head -n1) echo \" -> Creating loader entry: manjaro.conf\" cat > /mnt/boot/loader/entries/manjaro.conf <<EOF title Manjaro linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Creating fallback entry: manjaro-fallback.conf\" cat > /mnt/boot/loader/entries/manjaro-fallback.conf <<EOF title Manjaro (fallback) linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-fallback-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Setting default loader\" sed -i '/default/c\\/default manjaro\\*/' /mnt/boot/loader/loader.conf echo \"==> Setting target branch and mirror\" pacman-mirrors --api --prefix /mnt --set-branch $BRANCH --url $MIRROR echo \"==> Set root password\" manjaro-chroot /mnt passwd root ############################################################# #### ISO SPECIFIC SETUP echo \"==> Installing display manager\" manjaro-chroot /mnt pacman -S $TDISPLAYMANAGER --noconfirm echo \"==> Installing ISO package lists\" manjaro-chroot /mnt pacman -S $(comm -12 <(awk '{print $1}' /rootfs-pkgs.txt | sort) <(awk '{print $1}' /desktopfs-pkgs.txt | sort) | sed '/^grub/d' | sed '/^os-prober/d' | sed '/^kernel-modules-hook/d' | sed '/^kernel-alive/d' | sed '/^linux[0-9][0-9]/d') --needed --noconfirm echo \" --> Done installing ISO packages.\" echo \"==> Copying ISO specific settings...\" cp /etc/lightdm/lightdm-gtk-greeter.conf /mnt/etc/lightdm cp /etc/lightdm/slick-greeter.conf /mnt/etc/lightdm cp /etc/environment /mnt/etc cp /usr/share/icons/default /mnt/usr/share/icons echo \"==> Setting up wheel group\" cat > /mnt/etc/sudoers.d/100-wheel <<EOF %wheel ALL=(ALL) ALL EOF echo \"==> Create new admin user $TUSER\" manjaro-chroot /mnt useradd -mUG $TGROUPS $TUSER echo \"==> Set admin user password\" manjaro-chroot /mnt passwd $TUSER echo \"==> Enable display manager\" manjaro-chroot /mnt systemctl enable $TDISPLAYMANAGER echo \"==> Enable ISO services\" manjaro-chroot /mnt systemctl enable $TSERVICES #### ISO SETUP END ############################################################# echo \"==> Cleaning up\" echo \" -> Unmounting partitions\" umount -R /mnt echo \" -> Closing LUKS container\" cryptsetup close /dev/mapper/cryptroot sync echo \"==> Done! You have succesfully mimicked a Manjaro Mate Edition\" echo \"==> TODO: Configure swapfile ...\" echo \" -> Swap configuration <https://wiki.manjaro.org/index.php/Swap>\" echo \"\"","title":"Toolbox script"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/","text":"Run Manjaro on a stick This is my learning experience - documented for those readers who like the adventure :slight_smile: This guide and the resulting USB is intended to run on generic hardware - any EFI based computer you may be close to and capable of booting an USB by using the firmware's boot override. You can of course extend this crash guide in any way you want - please - that is why I created it - to be the base for experiments - for learning - for the street credit you gain. Please have fun! Headlines Goals First steps Locate device Preparation Partitioning Formatting Mounting Base installation Configure for USB Moment of truth Install LXDE Add ISO image to Grub Package list Sources 1. Goals Minimal Manjaro on USB stick - verify boot ( EFI ) Data sharing with other systems using exfat Extend Manjaro with Lxde using CLI login and startx Extend Grub to boot ISO files (Manjaro - Tails) [HowTo] Install Manjaro using CLI I have used a Kingston USB3 device 32G and my test system is an Yepo with Intel J3455, 8GB RAM and USB2 and USB3 . Due to how USB sticks are designed - it may be more feasible to load an ISO and use Manjaro in its unaltered live environment - but let's find out. 2. First steps CAUTION You will be doing the following as root so in case of device names - do double check your devices. DISCLAIMER : I take no responsibility if you wreck something because you are to quick on the Enter key. Change user Open a terminal and login as root. $ su -l root Password: I am using a device path /dev/sdl through the rest of the guide - replace with your actual device. You can verify which device you are using by removing all USB flash devices. Insert the device you want to use and list your devices. You can recognize the removable device by the number 1 in the RM column. 3. Locate the device It is very important you verify your device path. You will be so sorry if accidentally zap the wrong device. Sample device list # lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT ... sdc 8:32 0 447,1G 0 disk \u251c\u2500sdc1 8:33 0 300M 0 part /boot/efi \u251c\u2500sdc2 8:34 0 412,4G 0 part / \u2514\u2500sdc3 8:35 0 34,4G 0 part [SWAP] ... sdl 8:176 1 28,8G 0 disk \u251c\u2500sdl1 8:177 1 8G 0 part \u251c\u2500sdl2 8:178 1 20G 0 part \u2514\u2500sdl3 8:179 1 837,5M 0 part ... 4. Preparation Wipe the device (double check device path) (for encrypted system use urandom instead of zero's) # dd if=/dev/zero of=/dev/sdl bs=4M status=progress 5. Partitioning IMPORTANT : * The partition types must be set. * Partitions must be created in the following order. (Microsoft expects only one partition on USB - the first) Run cfdisk and select gpt when prompted. # cfdisk --zero /dev/sdl First (1) partition - 8G Partition type: Microsoft basic data Filesystem exfat Second (2) partition - 20G Partition type: Linux root (x86-64) Filesystem f2fs Third (3) partition - remaining space Partition type: EFI System Filesystem fat32 6. Formatting Partition 1 # mkfs.exfat /dev/sdl1 Partition 2 # mkfs.f2fs /dev/sdl2 Partition 3 # mkfs.fat -F32 /dev/sdl3 7. Mounting Mount root # mount /dev/sdl2 /mnt Create the /boot/efi folder # mkdir -p /mnt/boot/efi And mount the EFI partition # mount /dev/sdl3 /mnt/boot/efi 8. Base installation Use section 6 & 7 in the CLI guide to install the base system and return here without exiting the chroot. IMPORTANT : Install f2fs-tools in your root. (The complete list of package can be found at the end of the guide.) 9. Configure for USB Edit mkinitcpio.conf ```bash nano /etc/mkinitcpio.conf bash MODULES=(f2fs) ... HOOKS=\"base udev block keyboard autodetect modconf keymap filesystems fsck\" ``` -- Source: Arch Wiki Mkinitcpio Common hooks Build initramfs # mkinitcpio -p linux53 Install grub 64-bit EFI # grub-install --target=x86_64-efi --removable --recheck --boot-directory=/boot --efi-directory=/boot/efi 32-bit EFI # grub-install --target=i386-efi --removable --recheck --boot-directory=/boot --efi-directory=/boot/efi -- Source: Arch Wiki GRUB Installation part 2 Create grub config Because we are using f2fs we need to modify the grub defaults. Later on we also want to show the grub menu for selecting an ISO to load and we do not want that grub menu to disappear too fast. ```bash nano /etc/default/grub bash GRUB_DEFAULT=0 GRUB_TIMEOUT=-1 GRUB_TIMEOUT_STYLE=menu ... GRUB_CMDLINE_LINUX_DEFAULT=\"\" ... GRUB_SAVEDEFAULT=true ``` Save the file and create grub config # grub-mkconfig -o /boot/grub/grub.cfg 10. Moment of truth Close the chroot # exit Moment of truth Verify the stick is bootable on another system at hand. Login as root. If you are using a cable verify you have a network connection. nmcli device show | grep IP4 If you need to create a wireless connection launch the Network Manager console $ nmtui If you followed section 6 in the CLI guide to the letter you have a text browser. Use it to test your internet connection $ links manjaro.org If you cannot make a network connection - wireless Broadcom comes to mind - you need to mount the stick in a chroot and install the necessary drivers and then test it again. When you have verified the stick works you are ready to continue. 11. Extend with LXDE Next thing is to extend our system from a basic CLI to a basic GUI using only a basic set of packages and a GUI web browser. I have chosen Lxde because it is lightweight, easy to use and Midori because of the small footprint. [HowTo] Install a basic LXDE When all packages has been installed * in chroot * exit chroot, unmount the partitions and boot a testing device * Never just unplug your device - you will damage the filesystem. * Wait until umount has finished and for eventualities execute the sync command. Reboot Restart your system and boot to the stick. Login with the new username and launch X $ startx You are now running Manjaro-on-a-stick and we can have some more fun. 12. Extend grub to boot ISO images I am assuming the following You have booted the USB stick - it is working. You have a running X. You have a working internet connection. You know how to override your boot sequence. You know how to access the grub menu using the Shift key. Most of following be done from the booted USB or using chroot. You may prefer to use a mounted environment to do the editing and copying the ISO to the USB as doing it using the USB's environment maybe to slow for you. I have used a root shell and a temporary mount - but you can do as you see fit. If you choose to work directly on the booted USB you will need additional packages installed and adapt the paths used below. Get Tails Grub can boot ISO image - right off the stick. Let's see if can get Tails to boot. Open Midori and download the latest Tails ISO from the official website . You find link for the ISO image near the bottom of the page. The image is the same for DVD and virtual machines. TIP : Midori shows no sign of beginning the download. Don't click download but check in the upper right corner of the browser - the download symbol - it should show the progressing download. IMPORTANT : NEVER download Tails from other sources than the official. The ISO folder When you have downloaded the ISO move the file to a new folder you are about to create in the /boot folder. Execute the following command in the LX terminal emulator. sudo mkdir /mnt/boot/isos Move the file to the new location - we use a wildcard because this guide cannot assume a specific version. sudo mv ~/Downloads/tails*.iso /mnt/boot/isos Verify you actually moved it. ls /mnt/boot/isos You can copy any number of ISO files to your USB - your limit is only the amount of space allocated to your root environment. The grub configuration This part makes use of a set of scripts called multibootusb . They are available from github user @aguslr (see reference #2) and was brought to my attention some time ago by @AgentS (see reference #3). Clone the the multiboot usb repo using git git clone https://github.com/aguslr/multibootusb Copy the configuration files from the multibootusb repo to your USB mount. sudo cp -r mbusb.{cfg,d} /mnt/boot/grub TIP : The mbusb.cfg can take some time to load. Only use scripts for ISOs you plan to use. In this case I only copied the folders manjaro.d and tails.d - you are free to copy others if you like. I have not tested all possibilities - so I don't know if it all works. Please direct multibootiso script issues to the author. Create a file on the USB named custom.cfg ``` nano /mnt/boot/grub/custom.cfg ========= Multiboot ISO ========== https://github.com/aguslr/multibootusb if [ -e \"$prefix/mbusb.cfg\" ]; then source \"$prefix/mbusb.cfg\" fi ``` Save the file and close it. Then unmount your partition Eject the stick Boot your test system Booting Manjaro ISO The boot options for Manjaro works Booting Tails ISO The boot options for Tails does not work on my test system - it seems those change from time to time or more likely I am doing something wrong. I have figure out how to make this work. 13. Package list [details=\"Complete package list\"] base linux53 dhcpcd networkmanager grub efibootmgr f2fs-tools mkinitcpio vi nano sudo links xorg-server xorg-server-common xorg-xinit xorg-drivers ipw2100-fw ipw2200-fw iw iwd accountsservice engrampa epdfview galculator gnome-keyring gnome-icon-theme gnome-themes-standard gpicview-gtk3 leafpad lxappearance-gtk3 lxde-common lxde-icon-theme lxhotkey-gtk3 lxinput-gtk3 lxlauncher-gtk3 lxmed lxmenu-data lxpanel-gtk3 lxsession-gtk3 lxtask-gtk3 lxterminal manjaro-icons obconf pcmanfm-gtk3 perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils firewalld midori network-manager-applet lxde-wallpapers manjaro-lxde-config manjaro-lxde-desktop-settings manjaro-lxde-logout-banner matcha-gtk-theme manjaro-openbox-matcha papirus-icon-theme papirus-maia-icon-theme ttf-dejavu ttf-roboto xcursor-breeze [/details] Sources Install Manjaro using CLI Install Manjaro using LUKS encryption Install a basic LXDE Manjaro Lxde iso-profile Grub multiboot script Makeshift restore partition Tails official web Arch Wiki - GRUB Arch Wiki - mkinitcpio Install a basic Gnome","title":"Manjaro on a stick"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#run-manjaro-on-a-stick","text":"This is my learning experience - documented for those readers who like the adventure :slight_smile: This guide and the resulting USB is intended to run on generic hardware - any EFI based computer you may be close to and capable of booting an USB by using the firmware's boot override. You can of course extend this crash guide in any way you want - please - that is why I created it - to be the base for experiments - for learning - for the street credit you gain. Please have fun!","title":"Run Manjaro on a stick"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#headlines","text":"Goals First steps Locate device Preparation Partitioning Formatting Mounting Base installation Configure for USB Moment of truth Install LXDE Add ISO image to Grub Package list Sources","title":"Headlines"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#1-goals","text":"Minimal Manjaro on USB stick - verify boot ( EFI ) Data sharing with other systems using exfat Extend Manjaro with Lxde using CLI login and startx Extend Grub to boot ISO files (Manjaro - Tails) [HowTo] Install Manjaro using CLI I have used a Kingston USB3 device 32G and my test system is an Yepo with Intel J3455, 8GB RAM and USB2 and USB3 . Due to how USB sticks are designed - it may be more feasible to load an ISO and use Manjaro in its unaltered live environment - but let's find out.","title":"1. Goals"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#2-first-steps","text":"","title":"2. First steps"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#caution","text":"You will be doing the following as root so in case of device names - do double check your devices. DISCLAIMER : I take no responsibility if you wreck something because you are to quick on the Enter key.","title":"CAUTION"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#change-user","text":"Open a terminal and login as root. $ su -l root Password: I am using a device path /dev/sdl through the rest of the guide - replace with your actual device. You can verify which device you are using by removing all USB flash devices. Insert the device you want to use and list your devices. You can recognize the removable device by the number 1 in the RM column.","title":"Change user"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#3-locate-the-device","text":"It is very important you verify your device path. You will be so sorry if accidentally zap the wrong device.","title":"3. Locate the device"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#sample-device-list","text":"# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT ... sdc 8:32 0 447,1G 0 disk \u251c\u2500sdc1 8:33 0 300M 0 part /boot/efi \u251c\u2500sdc2 8:34 0 412,4G 0 part / \u2514\u2500sdc3 8:35 0 34,4G 0 part [SWAP] ... sdl 8:176 1 28,8G 0 disk \u251c\u2500sdl1 8:177 1 8G 0 part \u251c\u2500sdl2 8:178 1 20G 0 part \u2514\u2500sdl3 8:179 1 837,5M 0 part ...","title":"Sample device list"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#4-preparation","text":"Wipe the device (double check device path) (for encrypted system use urandom instead of zero's) # dd if=/dev/zero of=/dev/sdl bs=4M status=progress","title":"4. Preparation"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#5-partitioning","text":"IMPORTANT : * The partition types must be set. * Partitions must be created in the following order. (Microsoft expects only one partition on USB - the first) Run cfdisk and select gpt when prompted. # cfdisk --zero /dev/sdl First (1) partition - 8G Partition type: Microsoft basic data Filesystem exfat Second (2) partition - 20G Partition type: Linux root (x86-64) Filesystem f2fs Third (3) partition - remaining space Partition type: EFI System Filesystem fat32","title":"5. Partitioning"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#6-formatting","text":"","title":"6. Formatting"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#partition-1","text":"# mkfs.exfat /dev/sdl1","title":"Partition 1"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#partition-2","text":"# mkfs.f2fs /dev/sdl2","title":"Partition 2"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#partition-3","text":"# mkfs.fat -F32 /dev/sdl3","title":"Partition 3"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#7-mounting","text":"Mount root # mount /dev/sdl2 /mnt Create the /boot/efi folder # mkdir -p /mnt/boot/efi And mount the EFI partition # mount /dev/sdl3 /mnt/boot/efi","title":"7. Mounting"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#8-base-installation","text":"Use section 6 & 7 in the CLI guide to install the base system and return here without exiting the chroot. IMPORTANT : Install f2fs-tools in your root. (The complete list of package can be found at the end of the guide.)","title":"8. Base installation"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#9-configure-for-usb","text":"","title":"9. Configure for USB"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#edit-mkinitcpioconf","text":"```bash","title":"Edit mkinitcpio.conf"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#nano-etcmkinitcpioconf","text":"bash MODULES=(f2fs) ... HOOKS=\"base udev block keyboard autodetect modconf keymap filesystems fsck\" ``` -- Source: Arch Wiki Mkinitcpio Common hooks","title":"nano /etc/mkinitcpio.conf"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#build-initramfs","text":"# mkinitcpio -p linux53","title":"Build initramfs"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#install-grub","text":"64-bit EFI # grub-install --target=x86_64-efi --removable --recheck --boot-directory=/boot --efi-directory=/boot/efi 32-bit EFI # grub-install --target=i386-efi --removable --recheck --boot-directory=/boot --efi-directory=/boot/efi -- Source: Arch Wiki GRUB Installation part 2","title":"Install grub"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#create-grub-config","text":"Because we are using f2fs we need to modify the grub defaults. Later on we also want to show the grub menu for selecting an ISO to load and we do not want that grub menu to disappear too fast. ```bash","title":"Create grub config"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#nano-etcdefaultgrub","text":"bash GRUB_DEFAULT=0 GRUB_TIMEOUT=-1 GRUB_TIMEOUT_STYLE=menu ... GRUB_CMDLINE_LINUX_DEFAULT=\"\" ...","title":"nano /etc/default/grub"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#grub_savedefaulttrue","text":"``` Save the file and create grub config # grub-mkconfig -o /boot/grub/grub.cfg","title":"GRUB_SAVEDEFAULT=true"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#10-moment-of-truth","text":"Close the chroot # exit","title":"10. Moment of truth"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#moment-of-truth","text":"Verify the stick is bootable on another system at hand. Login as root. If you are using a cable verify you have a network connection. nmcli device show | grep IP4 If you need to create a wireless connection launch the Network Manager console $ nmtui If you followed section 6 in the CLI guide to the letter you have a text browser. Use it to test your internet connection $ links manjaro.org If you cannot make a network connection - wireless Broadcom comes to mind - you need to mount the stick in a chroot and install the necessary drivers and then test it again. When you have verified the stick works you are ready to continue.","title":"Moment of truth"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#11-extend-with-lxde","text":"Next thing is to extend our system from a basic CLI to a basic GUI using only a basic set of packages and a GUI web browser. I have chosen Lxde because it is lightweight, easy to use and Midori because of the small footprint. [HowTo] Install a basic LXDE When all packages has been installed * in chroot * exit chroot, unmount the partitions and boot a testing device * Never just unplug your device - you will damage the filesystem. * Wait until umount has finished and for eventualities execute the sync command.","title":"11. Extend with LXDE"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#reboot","text":"Restart your system and boot to the stick. Login with the new username and launch X $ startx You are now running Manjaro-on-a-stick and we can have some more fun.","title":"Reboot"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#12-extend-grub-to-boot-iso-images","text":"I am assuming the following You have booted the USB stick - it is working. You have a running X. You have a working internet connection. You know how to override your boot sequence. You know how to access the grub menu using the Shift key. Most of following be done from the booted USB or using chroot. You may prefer to use a mounted environment to do the editing and copying the ISO to the USB as doing it using the USB's environment maybe to slow for you. I have used a root shell and a temporary mount - but you can do as you see fit. If you choose to work directly on the booted USB you will need additional packages installed and adapt the paths used below.","title":"12. Extend grub to boot ISO images"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#get-tails","text":"Grub can boot ISO image - right off the stick. Let's see if can get Tails to boot. Open Midori and download the latest Tails ISO from the official website . You find link for the ISO image near the bottom of the page. The image is the same for DVD and virtual machines. TIP : Midori shows no sign of beginning the download. Don't click download but check in the upper right corner of the browser - the download symbol - it should show the progressing download. IMPORTANT : NEVER download Tails from other sources than the official.","title":"Get Tails"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#the-iso-folder","text":"When you have downloaded the ISO move the file to a new folder you are about to create in the /boot folder. Execute the following command in the LX terminal emulator. sudo mkdir /mnt/boot/isos Move the file to the new location - we use a wildcard because this guide cannot assume a specific version. sudo mv ~/Downloads/tails*.iso /mnt/boot/isos Verify you actually moved it. ls /mnt/boot/isos You can copy any number of ISO files to your USB - your limit is only the amount of space allocated to your root environment.","title":"The ISO folder"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#the-grub-configuration","text":"This part makes use of a set of scripts called multibootusb . They are available from github user @aguslr (see reference #2) and was brought to my attention some time ago by @AgentS (see reference #3). Clone the the multiboot usb repo using git git clone https://github.com/aguslr/multibootusb Copy the configuration files from the multibootusb repo to your USB mount. sudo cp -r mbusb.{cfg,d} /mnt/boot/grub TIP : The mbusb.cfg can take some time to load. Only use scripts for ISOs you plan to use. In this case I only copied the folders manjaro.d and tails.d - you are free to copy others if you like. I have not tested all possibilities - so I don't know if it all works. Please direct multibootiso script issues to the author. Create a file on the USB named custom.cfg ```","title":"The grub configuration"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#nano-mntbootgrubcustomcfg","text":"","title":"nano /mnt/boot/grub/custom.cfg"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#multiboot-iso","text":"","title":"========= Multiboot ISO =========="},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#httpsgithubcomaguslrmultibootusb","text":"if [ -e \"$prefix/mbusb.cfg\" ]; then source \"$prefix/mbusb.cfg\" fi ``` Save the file and close it. Then unmount your partition Eject the stick Boot your test system","title":"https://github.com/aguslr/multibootusb"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#booting-manjaro-iso","text":"The boot options for Manjaro works","title":"Booting Manjaro ISO"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#booting-tails-iso","text":"The boot options for Tails does not work on my test system - it seems those change from time to time or more likely I am doing something wrong. I have figure out how to make this work.","title":"Booting Tails ISO"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#13-package-list","text":"[details=\"Complete package list\"] base linux53 dhcpcd networkmanager grub efibootmgr f2fs-tools mkinitcpio vi nano sudo links xorg-server xorg-server-common xorg-xinit xorg-drivers ipw2100-fw ipw2200-fw iw iwd accountsservice engrampa epdfview galculator gnome-keyring gnome-icon-theme gnome-themes-standard gpicview-gtk3 leafpad lxappearance-gtk3 lxde-common lxde-icon-theme lxhotkey-gtk3 lxinput-gtk3 lxlauncher-gtk3 lxmed lxmenu-data lxpanel-gtk3 lxsession-gtk3 lxtask-gtk3 lxterminal manjaro-icons obconf pcmanfm-gtk3 perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils firewalld midori network-manager-applet lxde-wallpapers manjaro-lxde-config manjaro-lxde-desktop-settings manjaro-lxde-logout-banner matcha-gtk-theme manjaro-openbox-matcha papirus-icon-theme papirus-maia-icon-theme ttf-dejavu ttf-roboto xcursor-breeze [/details]","title":"13. Package list"},{"location":"manjaro/installation/manjaro-cli-installation-on-a-stick/#sources","text":"Install Manjaro using CLI Install Manjaro using LUKS encryption Install a basic LXDE Manjaro Lxde iso-profile Grub multiboot script Makeshift restore partition Tails official web Arch Wiki - GRUB Arch Wiki - mkinitcpio Install a basic Gnome","title":"Sources"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-and-luks/","text":"Toolbox script Installing a base Manjaro using systemd boot and LUKS encryption # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # Copyright (c) 2021 @linux-aarhus # # ! IMPORTANT ! # ! GREAT CARE SHOULD BE EXCERCISED ! # ! A lot of assumptions are made - please review carefully ! # # The root filesystem is using f2fs inside a LUKS container # # ! PLEASE REVIEW THE VARIABLES SECTION ! # ! AMEND THE VARIABLES AS NECESSARY ! # if [ \"$(id -u)\" != \"0\" ]; then echo \"Please change to root context using su or sudo\" echo \"Usage: bash sdboot-luks-setup.sh /dev/sdX\" echo \"\" exit fi if [[ -z \"$1\" ]]; then echo \"No device specified ...\" echo \"Usage: bash sdboot-luks-setup.sh /dev/sdX\" echo \"\" exit fi TARGET=\"$1\" # target device from first argument KERNEL=\"5.10\" # linux kernel number KERNELPKG=$(echo linux$2 | sed 's/\\.//') # kernel package name MIRROR='https://repos.nix.dk/manjaro/' # build mirror BRANCH='unstable' # target branch TKEYMAP='dk' # target keyboard layout TLOCALE_CONF='en_DK.UTF-8' # target locale.conf TLOCALE_PRIMARY='en_DK.UTF-8 UTF-8' # target primary locale TLOCALE_FALLBACK='en_US.UTF-8 UTF-8' # target fallback locale TTIMEZONE='Europe/Copenhagen' # target timezone THOSTNAME='manjaro' # target hostname ITER_TIME=\"10000\" # luks iteration time RETRIES=\"3\" # luks decryption retries BASE_PKGS=\"base $KERNELPKG mkinitcpio networkmanager f2fs-tools bash-completion\" echo \"==> Unmounting $TARGET\" umount -f \"$TARGET\" echo \"==> Preparing disk $TARGET\" sgdisk --zap-all \"$TARGET\" sgdisk --mbrtogpt \"$TARGET\" echo \"==> Creating EFI partition\" sgdisk --new 1::+512M \\ --typecode 1:ef00 \\ --change-name 1:\"EFI System\" \\ \"$TARGET\" echo \"==> Creating root partition\" sgdisk --new 2::: \\ --typecode 2:8304 \\ --change-name 2:\"Linux x86-64 root\" \\ \"$TARGET\" echo \"==> wiping EFI partition\" wipefs -af \"$TARGET\"1 echo \"==> wiping root partition\" wipefs -af \"$TARGET\"2 echo \"==> formatting EFI partition\" mkfs.vfat -F32 \"$TARGET\"1 echo \"==> ------------------------------------------\" echo \"==> Setting up root LUKS container\" echo \" -> WATCHOUT FOR THE UPPERCASE CONFIRMATION\" echo \" -> If using CapsLock remember to toggle back\" cryptsetup --type luks2 \\ --hash sha512 \\ --iter-time $ITER_TIME \\ --tries $RETRIES \\ --use-urandom luksFormat \\ \"$TARGET\"2 echo \"==> ------------------------------------------\" echo \"==> Open LUKS container\" cryptsetup open \"$TARGET\"2 cryptroot echo \"==> Formatting LUKS using f2fs\" mkfs.f2fs -f /dev/mapper/cryptroot echo \"==> Mounting root partition\" mount /dev/mapper/cryptroot /mnt echo \"==> Creating /boot\" mkdir /mnt/boot echo \"==> Mounting EFI partition\" mount \"$TARGET\"1 /mnt/boot echo \"==> Setting branch and mirror\" pacman-mirrors --api --set-branch $BRANCH --url $MIRROR echo \"==> Syncronizing pacman databases\" pacman -Syy echo \"==> installing base system with Linux kernel $2\" basestrap /mnt $BASE_PKGS echo \"==> Configure base ...\" echo \" -> Creating file: vconsole.conf\" echo KEYMAP=$TKEYMAP > /mnt/etc/vconsole.conf echo \" -> Creating file: locale.conf\" echo LANG=$TLOCALE_CONF > /mnt/etc/locale.conf echo \" -> Creating file: hostname\" echo manjaro > /mnt/etc/hostname echo \" -> Creating file: hosts\" cat > /mnt/etc/hosts <<EOF 127.0.0.1 localhost 127.0.1.1 $THOSTNAME.localdomain $THOSTNAME EOF echo \" -> Creating symlink: localtime\" ln -sf /usr/share/zoneinfo/$TTIMEZONE /mnt/etc/localtime echo \" -> Setting hardware clock\" manjaro-chroot /mnt hwclock --systohc echo \" -> Enabling services\" manjaro-chroot /mnt systemctl enable NetworkManager systemd-timesyncd echo \" -> Modifying file: locale.gen\" echo \"$TLOCALE_PRIMARY\" >> /mnt/etc/locale.gen echo \"$TLOCALE_FALLBACK\" >> /mnt/etc/locale.gen echo \" -> Generating locale\" manjaro-chroot /mnt locale-gen echo \" -> Setting up mkinitcpio.conf\" sed -i '/MODULES=/c\\MODULES=(f2fs)' \\ /mnt/etc/mkinitcpio.conf sed -i '/HOOKS=/c\\HOOKS=(systemd keyboard keymap sd-vconsole block sd-encrypt autodetect modconf filesystems fsck)' \\ /mnt/etc/mkinitcpio.conf echo \" -> Generating initrd\" manjaro-chroot /mnt mkinitcpio -P echo \" -> Installing bootloader\" bootctl --path=/mnt/boot install echo \" -> Updating entries with device UUID\" devuuid=$(lsblk -no uuid \"$TARGET\"2 | tail -1) echo \" -> Creating loader entry: manjaro.conf\" cat > /mnt/boot/loader/entries/manjaro.conf <<EOF title Manjaro linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Creating fallback entry: manjaro-fallback.conf\" cat > /mnt/boot/loader/entries/manjaro-fallback.conf <<EOF title Manjaro (fallback) linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-fallback-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Setting default loader\" sed -i '/default/c\\/default manjaro\\*/' /mnt/boot/loader/loader.conf echo \"==> Setting target branch and mirror\" pacman-mirrors --api --prefix /mnt --set-branch $BRANCH --url $MIRROR echo \" -> Setup your root password\" manjaro-chroot /mnt passwd echo \"==> Cleaning up\" echo \" -> Unmounting partitions\" umount -R /mnt echo \" -> Closing LUKS container\" cryptsetup close /dev/mapper/cryptroot sync echo \"==> Done! Minimal base is now installed and configured\" echo \"==> TODO: Install GUI and configure swap\" echo \" -> Manjaro iso profiles <https://gitlab.manjaro.org/profiles-and-settings/iso-profiles> echo \" -> Swap configuration <https://wiki.manjaro.org/index.php/Swap>\" echo \"\"","title":"Manjaro base using sdboot and luks"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-and-luks/#toolbox-script","text":"Installing a base Manjaro using systemd boot and LUKS encryption # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # Copyright (c) 2021 @linux-aarhus # # ! IMPORTANT ! # ! GREAT CARE SHOULD BE EXCERCISED ! # ! A lot of assumptions are made - please review carefully ! # # The root filesystem is using f2fs inside a LUKS container # # ! PLEASE REVIEW THE VARIABLES SECTION ! # ! AMEND THE VARIABLES AS NECESSARY ! # if [ \"$(id -u)\" != \"0\" ]; then echo \"Please change to root context using su or sudo\" echo \"Usage: bash sdboot-luks-setup.sh /dev/sdX\" echo \"\" exit fi if [[ -z \"$1\" ]]; then echo \"No device specified ...\" echo \"Usage: bash sdboot-luks-setup.sh /dev/sdX\" echo \"\" exit fi TARGET=\"$1\" # target device from first argument KERNEL=\"5.10\" # linux kernel number KERNELPKG=$(echo linux$2 | sed 's/\\.//') # kernel package name MIRROR='https://repos.nix.dk/manjaro/' # build mirror BRANCH='unstable' # target branch TKEYMAP='dk' # target keyboard layout TLOCALE_CONF='en_DK.UTF-8' # target locale.conf TLOCALE_PRIMARY='en_DK.UTF-8 UTF-8' # target primary locale TLOCALE_FALLBACK='en_US.UTF-8 UTF-8' # target fallback locale TTIMEZONE='Europe/Copenhagen' # target timezone THOSTNAME='manjaro' # target hostname ITER_TIME=\"10000\" # luks iteration time RETRIES=\"3\" # luks decryption retries BASE_PKGS=\"base $KERNELPKG mkinitcpio networkmanager f2fs-tools bash-completion\" echo \"==> Unmounting $TARGET\" umount -f \"$TARGET\" echo \"==> Preparing disk $TARGET\" sgdisk --zap-all \"$TARGET\" sgdisk --mbrtogpt \"$TARGET\" echo \"==> Creating EFI partition\" sgdisk --new 1::+512M \\ --typecode 1:ef00 \\ --change-name 1:\"EFI System\" \\ \"$TARGET\" echo \"==> Creating root partition\" sgdisk --new 2::: \\ --typecode 2:8304 \\ --change-name 2:\"Linux x86-64 root\" \\ \"$TARGET\" echo \"==> wiping EFI partition\" wipefs -af \"$TARGET\"1 echo \"==> wiping root partition\" wipefs -af \"$TARGET\"2 echo \"==> formatting EFI partition\" mkfs.vfat -F32 \"$TARGET\"1 echo \"==> ------------------------------------------\" echo \"==> Setting up root LUKS container\" echo \" -> WATCHOUT FOR THE UPPERCASE CONFIRMATION\" echo \" -> If using CapsLock remember to toggle back\" cryptsetup --type luks2 \\ --hash sha512 \\ --iter-time $ITER_TIME \\ --tries $RETRIES \\ --use-urandom luksFormat \\ \"$TARGET\"2 echo \"==> ------------------------------------------\" echo \"==> Open LUKS container\" cryptsetup open \"$TARGET\"2 cryptroot echo \"==> Formatting LUKS using f2fs\" mkfs.f2fs -f /dev/mapper/cryptroot echo \"==> Mounting root partition\" mount /dev/mapper/cryptroot /mnt echo \"==> Creating /boot\" mkdir /mnt/boot echo \"==> Mounting EFI partition\" mount \"$TARGET\"1 /mnt/boot echo \"==> Setting branch and mirror\" pacman-mirrors --api --set-branch $BRANCH --url $MIRROR echo \"==> Syncronizing pacman databases\" pacman -Syy echo \"==> installing base system with Linux kernel $2\" basestrap /mnt $BASE_PKGS echo \"==> Configure base ...\" echo \" -> Creating file: vconsole.conf\" echo KEYMAP=$TKEYMAP > /mnt/etc/vconsole.conf echo \" -> Creating file: locale.conf\" echo LANG=$TLOCALE_CONF > /mnt/etc/locale.conf echo \" -> Creating file: hostname\" echo manjaro > /mnt/etc/hostname echo \" -> Creating file: hosts\" cat > /mnt/etc/hosts <<EOF 127.0.0.1 localhost 127.0.1.1 $THOSTNAME.localdomain $THOSTNAME EOF echo \" -> Creating symlink: localtime\" ln -sf /usr/share/zoneinfo/$TTIMEZONE /mnt/etc/localtime echo \" -> Setting hardware clock\" manjaro-chroot /mnt hwclock --systohc echo \" -> Enabling services\" manjaro-chroot /mnt systemctl enable NetworkManager systemd-timesyncd echo \" -> Modifying file: locale.gen\" echo \"$TLOCALE_PRIMARY\" >> /mnt/etc/locale.gen echo \"$TLOCALE_FALLBACK\" >> /mnt/etc/locale.gen echo \" -> Generating locale\" manjaro-chroot /mnt locale-gen echo \" -> Setting up mkinitcpio.conf\" sed -i '/MODULES=/c\\MODULES=(f2fs)' \\ /mnt/etc/mkinitcpio.conf sed -i '/HOOKS=/c\\HOOKS=(systemd keyboard keymap sd-vconsole block sd-encrypt autodetect modconf filesystems fsck)' \\ /mnt/etc/mkinitcpio.conf echo \" -> Generating initrd\" manjaro-chroot /mnt mkinitcpio -P echo \" -> Installing bootloader\" bootctl --path=/mnt/boot install echo \" -> Updating entries with device UUID\" devuuid=$(lsblk -no uuid \"$TARGET\"2 | tail -1) echo \" -> Creating loader entry: manjaro.conf\" cat > /mnt/boot/loader/entries/manjaro.conf <<EOF title Manjaro linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Creating fallback entry: manjaro-fallback.conf\" cat > /mnt/boot/loader/entries/manjaro-fallback.conf <<EOF title Manjaro (fallback) linux /vmlinuz-$KERNEL-x86_64 initrd /initramfs-$KERNEL-fallback-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=$devuuid=cryptroot EOF echo \" -> Setting default loader\" sed -i '/default/c\\/default manjaro\\*/' /mnt/boot/loader/loader.conf echo \"==> Setting target branch and mirror\" pacman-mirrors --api --prefix /mnt --set-branch $BRANCH --url $MIRROR echo \" -> Setup your root password\" manjaro-chroot /mnt passwd echo \"==> Cleaning up\" echo \" -> Unmounting partitions\" umount -R /mnt echo \" -> Closing LUKS container\" cryptsetup close /dev/mapper/cryptroot sync echo \"==> Done! Minimal base is now installed and configured\" echo \"==> TODO: Install GUI and configure swap\" echo \" -> Manjaro iso profiles <https://gitlab.manjaro.org/profiles-and-settings/iso-profiles> echo \" -> Swap configuration <https://wiki.manjaro.org/index.php/Swap>\" echo \"\"","title":"Toolbox script"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/","text":"Yet another CLI guide But what if you requirements are simple? And you want the installation to be as simple as possible? Plain and simple no fuzz - boot Manjaro - that's it. systemd-boot is a bootloader which do not get much attention on Manjaro - since most Manjaro installations is created using Calamares installer which in turn installs grub. I recall a setting for an iso-profile setting the efi_bootloader=\"grub\" - but it didn't work very well so I decided to learn how to implement systemd-boot the most simple way - later create a merge request to the tools. Before you begin First - I am assuming you know your device path - for the safety of less experienced readers - I am using a device path /dev/sdy you most likely do not find on your system. Second - I am assuming you are using a root TTY as no commands is prefixed with sudo . TIP : Don't use a graphical environment - switch to TTY - because the live system may lock screen and other unpleasant thing while you are using the terminal - thus breaking what ever you were doing. Third - I will be using command line partitioning - no menu interfaces - pure command line. Fourth - This guide will work for any device - it be internal, removable USB or otherwise attached to your system. To ease the pain of writing the same device over and over I made use of an environment variable - I assume you set the same too. TIP If your circumstances allows for it - you can use [ssh] to install remotely using another device on your network. Let's begin If you have not done so already open a root TTY and set the device variable - remember it only exist in the current shell # INS=\"/dev/sdy\" Ensure your device is not mounted anywhere # umount -f \"$INS\" Now to the serious stuff The stuff that needs disclaimers - you are on your own kind of stuff. Clean the disk's partition tables # sgdisk --zap-all \"$INS\" Create a new GPT partition table # sgdisk --mbrtogpt \"$INS\" Create the $esp partition # sgdisk --new 1::+512M --typecode 1:ef00 --change-name 1:\"EFI System\" \"$INS\" Create the root partition # sgdisk --new 2::: --typecode 2:8304 --change-name 2:\"Linux x86-64 root\" \"$INS\" Wipe everything from the partitions # wipefs -af \"$INS\"1 # wipefs -af \"$INS\"2 Format the partitions Format $esp partition using FAT32 # mkfs.vfat -vF32 \"$INS\"1 Format the the root partition using your preferred filesystem- If your device is flash based you can use f2fs which is created for flash or you can use ext4 which is a defacto standard for Linux. # mkfs.f2fs \"$INS\"2 Mounting Mount your root partition on the systems temporary mountpoint # mount \"$INS\"2 /mnt Then create the folder for booting systemd ($esp) # mkdir /mnt/boot And mount the $esp partition # mount \"$INS\"1 /mnt/boot Installing a base Manjaro system This article is only scratching the surface of the new system. We only install a basic bootable system using the base meta package, filesystem tools for f2fs along with kernel and some required tools - and don't forget network connectivity # basestrap /mnt base f2fs-tools linux55 nano mkinitcpio bash-completion networkmanager systemd-boot-manager Configuring the base system Configuring the system is the tedious - extremely boring - but crucial part, usually abstracted by tools like Manjaro Architect. [details=\"The boring configurational steps\"] Chroot into the mountpoint # manjaro-chroot /mnt /bin/bash Configurations The vconsole.conf file contains information about the type of keymap you are using - in this case a danish keymap - but it could us for a default US english keymap. # echo KEYMAP=dk > /etc/vconsole.conf The hostname file contains the name of your computer on a network - this must be unique - you can of course select another name # echo manjaro > /etc/hostname The hosts file contains information local to your system. The is almost empty - edit the file and append below IP addresses and the hostname from your hostname file # nano /etc/hosts 127.0.0.1 localhost 127.0.1.1 manjaro.localdomain manjaro The ever important system time - the example is for Denmark but it could be Europe/Paris if you live in that area. # ln -sf /usr/share/zoneinfo/Europe/Copenhagen Unix systems expects the hardware clock to run in UTC and the system then corrects the clock using the timezone information - this is a point where Windows and Linux disagree causing trouble for dual-booters - which we are not. # hwclock --systohc Enable the network and timesync (don't use --now in chroot, it will fail) # systemctl enable NetworkManager systemd-timesyncd Now we create a locale configuration - this configuration defines system messages and how time, date and other units are displayed. # nano /etc/locale.gen Uncomment the locales you want to use - e.g. using English for messages and German for date and time uncomment both. In this example - again for Denmark. en_DK.UTF-8 UTF-8 To actually use preferences the necessary files needs generated - this is done using the locale-gen command # locale-gen The locale.conf file contains a reference to the locale files just created. Please see the Arch Wiki page on locales for additional entries you can add. # echo LANG=en_DK.UTF-8 > /etc/locale.conf And finally set the root password # passwd [/details] Booting systemd-boot on Arch Wiki This is the interesting part you have worked yourself down to. initramfs Use the mkinicpio command to generate the initramfs - it will copy the files to the boot ($esp) partition. # mkinitcpio -P bootloader Now install the systemd bootloader to the boot ($esp) partition # bootctl --path=/boot install The rest of the configuration can be done outside chroot - necessary to write a boot entry to your EFI firmware # exit For the bootloader to actually load we need create a configuration file to specify the kernel, initrd. To avoid typos - use ls to list the content of boot folder and pipe the output to the boot configuration # ls /mnt/boot/init* /mnt/boot/vmlinuz* > /mnt/boot/loader/entries/manjaro.conf Now open the file using nano # nano /mnt/boot/loader/entries/manjaro.conf Amend the file to look like this (the order of the lines are not important) title Manjaro linux /vmlinuz-5.5-x86_64 initrd /initramfs-5.5-x86_64.img This new configuration file is then added to the file loader.conf # nano /mnt/boot/loader/loader.conf default manjaro Maintenance This article does not take into account the amd/intel microcode and maintenance due to kernel upgrades or booting different kernels. To learn more - read up on systemd-boot on the Arch Wiki. Just a few things worth noting. With systemd-boot, we also need to handle microcode loading by hand in the entries It is probably worth pointing out that these entries will need to be added/updated as new kernels are installed and removed Lastly, systemd-boot-manager will handle both those things for you in an automated fashion. It can automate the installation of systemd-boot, the creation and removal of entries, the addition of microcode updates and has options setting defaults automatically. It has full support for luks/lvm/btrfs/zfs/etc. -- @dalto Finally Unmount your devices # umount -R /mnt If you are installing to an USB device - sync device before removing it # sync And reboot # reboot Conclusion You have only scratched the surface and there is work to be done - installing xorg, applications, themes - what ever you fancy - it's really up to you how this adventure ends. Have fun - I did.","title":"systemd-boot - BASIC - installation"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#yet-another-cli-guide","text":"But what if you requirements are simple? And you want the installation to be as simple as possible? Plain and simple no fuzz - boot Manjaro - that's it. systemd-boot is a bootloader which do not get much attention on Manjaro - since most Manjaro installations is created using Calamares installer which in turn installs grub. I recall a setting for an iso-profile setting the efi_bootloader=\"grub\" - but it didn't work very well so I decided to learn how to implement systemd-boot the most simple way - later create a merge request to the tools.","title":"Yet another CLI guide"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#before-you-begin","text":"First - I am assuming you know your device path - for the safety of less experienced readers - I am using a device path /dev/sdy you most likely do not find on your system. Second - I am assuming you are using a root TTY as no commands is prefixed with sudo . TIP : Don't use a graphical environment - switch to TTY - because the live system may lock screen and other unpleasant thing while you are using the terminal - thus breaking what ever you were doing. Third - I will be using command line partitioning - no menu interfaces - pure command line. Fourth - This guide will work for any device - it be internal, removable USB or otherwise attached to your system. To ease the pain of writing the same device over and over I made use of an environment variable - I assume you set the same too. TIP If your circumstances allows for it - you can use [ssh] to install remotely using another device on your network.","title":"Before you begin"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#lets-begin","text":"If you have not done so already open a root TTY and set the device variable - remember it only exist in the current shell # INS=\"/dev/sdy\" Ensure your device is not mounted anywhere # umount -f \"$INS\"","title":"Let's begin"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#now-to-the-serious-stuff","text":"The stuff that needs disclaimers - you are on your own kind of stuff.","title":"Now to the serious stuff"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#clean-the-disks-partition-tables","text":"# sgdisk --zap-all \"$INS\"","title":"Clean the disk's partition tables"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#create-a-new-gpt-partition-table","text":"# sgdisk --mbrtogpt \"$INS\"","title":"Create a new GPT partition table"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#create-the-esp-partition","text":"# sgdisk --new 1::+512M --typecode 1:ef00 --change-name 1:\"EFI System\" \"$INS\"","title":"Create the $esp partition"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#create-the-root-partition","text":"# sgdisk --new 2::: --typecode 2:8304 --change-name 2:\"Linux x86-64 root\" \"$INS\"","title":"Create the root partition"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#wipe-everything-from-the-partitions","text":"# wipefs -af \"$INS\"1 # wipefs -af \"$INS\"2","title":"Wipe everything from the partitions"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#format-the-partitions","text":"Format $esp partition using FAT32 # mkfs.vfat -vF32 \"$INS\"1 Format the the root partition using your preferred filesystem- If your device is flash based you can use f2fs which is created for flash or you can use ext4 which is a defacto standard for Linux. # mkfs.f2fs \"$INS\"2","title":"Format the partitions"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#mounting","text":"Mount your root partition on the systems temporary mountpoint # mount \"$INS\"2 /mnt Then create the folder for booting systemd ($esp) # mkdir /mnt/boot And mount the $esp partition # mount \"$INS\"1 /mnt/boot","title":"Mounting"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#installing-a-base-manjaro-system","text":"This article is only scratching the surface of the new system. We only install a basic bootable system using the base meta package, filesystem tools for f2fs along with kernel and some required tools - and don't forget network connectivity # basestrap /mnt base f2fs-tools linux55 nano mkinitcpio bash-completion networkmanager systemd-boot-manager","title":"Installing a base Manjaro system"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#configuring-the-base-system","text":"Configuring the system is the tedious - extremely boring - but crucial part, usually abstracted by tools like Manjaro Architect. [details=\"The boring configurational steps\"]","title":"Configuring the base system"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#chroot-into-the-mountpoint","text":"# manjaro-chroot /mnt /bin/bash","title":"Chroot into the mountpoint"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#configurations","text":"The vconsole.conf file contains information about the type of keymap you are using - in this case a danish keymap - but it could us for a default US english keymap. # echo KEYMAP=dk > /etc/vconsole.conf The hostname file contains the name of your computer on a network - this must be unique - you can of course select another name # echo manjaro > /etc/hostname The hosts file contains information local to your system. The is almost empty - edit the file and append below IP addresses and the hostname from your hostname file # nano /etc/hosts 127.0.0.1 localhost 127.0.1.1 manjaro.localdomain manjaro The ever important system time - the example is for Denmark but it could be Europe/Paris if you live in that area. # ln -sf /usr/share/zoneinfo/Europe/Copenhagen Unix systems expects the hardware clock to run in UTC and the system then corrects the clock using the timezone information - this is a point where Windows and Linux disagree causing trouble for dual-booters - which we are not. # hwclock --systohc Enable the network and timesync (don't use --now in chroot, it will fail) # systemctl enable NetworkManager systemd-timesyncd Now we create a locale configuration - this configuration defines system messages and how time, date and other units are displayed. # nano /etc/locale.gen Uncomment the locales you want to use - e.g. using English for messages and German for date and time uncomment both. In this example - again for Denmark. en_DK.UTF-8 UTF-8 To actually use preferences the necessary files needs generated - this is done using the locale-gen command # locale-gen The locale.conf file contains a reference to the locale files just created. Please see the Arch Wiki page on locales for additional entries you can add. # echo LANG=en_DK.UTF-8 > /etc/locale.conf And finally set the root password # passwd [/details]","title":"Configurations"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#booting","text":"","title":"Booting"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#systemd-boot-on-arch-wiki","text":"This is the interesting part you have worked yourself down to.","title":"systemd-boot on Arch Wiki"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#initramfs","text":"Use the mkinicpio command to generate the initramfs - it will copy the files to the boot ($esp) partition. # mkinitcpio -P","title":"initramfs"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#bootloader","text":"Now install the systemd bootloader to the boot ($esp) partition # bootctl --path=/boot install The rest of the configuration can be done outside chroot - necessary to write a boot entry to your EFI firmware # exit For the bootloader to actually load we need create a configuration file to specify the kernel, initrd. To avoid typos - use ls to list the content of boot folder and pipe the output to the boot configuration # ls /mnt/boot/init* /mnt/boot/vmlinuz* > /mnt/boot/loader/entries/manjaro.conf Now open the file using nano # nano /mnt/boot/loader/entries/manjaro.conf Amend the file to look like this (the order of the lines are not important) title Manjaro linux /vmlinuz-5.5-x86_64 initrd /initramfs-5.5-x86_64.img This new configuration file is then added to the file loader.conf # nano /mnt/boot/loader/loader.conf default manjaro","title":"bootloader"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#maintenance","text":"This article does not take into account the amd/intel microcode and maintenance due to kernel upgrades or booting different kernels. To learn more - read up on systemd-boot on the Arch Wiki. Just a few things worth noting. With systemd-boot, we also need to handle microcode loading by hand in the entries It is probably worth pointing out that these entries will need to be added/updated as new kernels are installed and removed Lastly, systemd-boot-manager will handle both those things for you in an automated fashion. It can automate the installation of systemd-boot, the creation and removal of entries, the addition of microcode updates and has options setting defaults automatically. It has full support for luks/lvm/btrfs/zfs/etc. -- @dalto","title":"Maintenance"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#finally","text":"Unmount your devices # umount -R /mnt If you are installing to an USB device - sync device before removing it # sync And reboot # reboot","title":"Finally"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-basic/#conclusion","text":"You have only scratched the surface and there is work to be done - installing xorg, applications, themes - what ever you fancy - it's really up to you how this adventure ends. Have fun - I did.","title":"Conclusion"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/","text":"Manjaro UEFI using systemd-boot, LUKS and btrfs The following is my notes while reading and the changes I made to the subsequent installation to fit into a Manjaro system installation. NOTE : Before you dive into btrfs - be sure to read the entire article - including the documentation linked at the end of this document. Overview UEFI using systemd-boot LUKS encrypted root btrfs with subvolumes Sources is listed at the end of this document You can boot from any Manjaro ISO - open a terminal - and follow this guide. For a similar guide without LUKS read here https://forum.manjaro.org/t/manjaro-uefi-systemd-boot-and-btrfs/116466?u=linux-aarhus Assuming you know how to identify your disk devices and can replace the example device name /dev/sdy with the device for your system. All commands written is assuming your are logged in as root. On Manjaro ISOs the root login is root : manjaro General Connect to your network and ensure your system clock is correct # systemctl start systemd-timesyncd Set a preferred mirror and branch then download databases # pacman-mirrors -aU https://manjaro.moson.eu -Sunstable # pacman -Syy Partitioning and File System Creation Partition Clear the disk of any existing file systems using random pattern - as the partition will be encrypted this will disguise the partitions and data held on it. It will take some time to complete - hours if you are having a big storage device. # dd if=/dev/urandom of=/dev/sdy status=progress bs=10M Use cdisk to create the boot partition and the main partition which will be encrypted # cfdisk /dev/sdy boot 512M EFI system partition type root remaining space default type Linux file system Set up the encryption container # cryptsetup luksFormat /dev/sdy2 Are you sure? YES Enter passphrase (twice) # cryptsetup open /dev/sdy2 luks Format Format to FAT32 for the boot and btrfs for the root # mkfs.vfat -F32 /dev/sdy1 # mkfs.btrfs /dev/mapper/luks The author of the original guide has some reasonable suggestions which also matches the defaults used by Manjaro Architect. * / subvolume * /home subvolume in case a root snapshot needs to be restored * /var changes often so also a separate subvolume. * noatime and nodiratime are used to prevent a write every time a file or directory is accessed (not great for a COW filesystem like btrfs). * zstd is used for compression because it's fast and provides compression similar to xz. * Don't use discard . Issue manual trim commands with fstrim or enable the fstrim.timer. Subvolumes # mount /dev/mapper/luks /mnt # btrfs subvolume create /mnt/@ # btrfs subvolume create /mnt/@home # btrfs subvolume create /mnt/@var # umount /mnt # mount -o subvol=@,ssd,compress=zstd,noatime,nodiratime /dev/mapper/luks /mnt # mkdir /mnt/{boot,home,var} # mount -o subvol=@home,ssd,compress=zstd,noatime,nodiratime /dev/mapper/luks /mnt/home # mount -o subvol=@var,ssd,compress=zstd,noatime,nodiratime /dev/mapper/luks /mnt/var # mount /dev/sdy1 /mnt/boot Installation Install base Manjaro # basestrap /mnt base btrfs-progs sudo manjaro-zsh-config intel-ucode networkmanager linux54 nano vim systemd-boot-manager mkinitcpio Generate fstab Generate fstab and verify the content # fstabgen -U /mnt >> /mnt/etc/fstab # cat /mnt/etc/fstab Configure system Chroot # manjaro-chroot /mnt /bin/zsh Hostname # echo manjaro > /etc/hostname Edit /etc/hosts # nano /etc/hosts 127.0.0.1 localhost ::1 localhost 127.0.1.1 manjaro.localdomain manjaro Shell # chsh -s /bin/zsh Timezone Example for Denmark # ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime # hwclock --systohc Network Manager Enable network connection # systemctl enable NetworkManager Enable ntp client # systemctl enable systemd-timesyncd Locale Locale example for Danish locale * uncomment en_DK.UTF-8 and en_US.UTF-8 Save file and generate the messages # nano /etc/locale.gen # locale-gen /etc/locale.conf Locale.conf example for Denmark # echo LANG=en_DK.UTF-8 > /etc/locale.conf Root password # passwd /etc/mkinitcpio.conf Add btrfs and encrypt and save # nano /etc/mkinitcpio.conf HOOKS=\"base udev btrfs encrypt autodetect modconf block filesystems keyboard fsck\" # mkinitcpio -p linux54 systemd-boot Install the boot loader # bootctl --path=/boot install Create Manjaro loaders # sdboot-manage gen Navigate to /boot/loader/entries and check the configurations sdboot-manage has created (there will be two). :information_source: If you create the entries by hand please note * root=UUID= is the UUID of your LUKS container * cryptdevice=UUID= is the UUID of physical partition hosting your container Default title Manjaro Linux 5.4 linux /vmlinuz-5.4-x86_64 initrd /intel-ucode.img initrd /initramfs-5.4-x86_64.img options root=UUID=289ae676-7cbc-43a7-b4b7-e9cf325227c9 rw rootflags=subvol=/@ cryptdevice=UUID=9d336c58-0e8f-434d-b12a-b75663c4ad59 Fallback title Manjaro Linux 5.4 linux /vmlinuz-5.4-x86_64 initrd /intel-ucode.img initrd /initramfs-5.4-x86_64-fallback.img options root=UUID=289ae676-7cbc-43a7-b4b7-e9cf325227c9 rw rootflags=subvol=/@ cryptdevice=UUID=9d336c58-0e8f-434d-b12a-b75663c4ad59:luks Base config done # exit # umount -R /mnt # reboot Customizing You should have a fully functioning Manjaro system. What comes next is your personal preferences. The example is a very basic vanilla Gnome desktop. Gnome desktop # pacman -Syu xorg-server xorg-server-common xorg-xinit xorg-drivers accountsservice gnome-keyring gnome-session gnome-shell gnome-desktop gnome-terminal gdm Add a user and set password # useradd -mUG lp,network,power,sys,wheel -s /bin/zsh newuser # passwd newuser Admin user Add user to wheel group # visudo Uncomment and save %wheel ALL=(ALL) ALL Enable displaymanager # systemctl enable gdm Reboot # reboot Trouble shooting If something went wrong and you need to get back in from the live image: # cryptsetup open /dev/sdy2 luks # mount -o subvol=@,ssd /dev/mapper/luks /mnt # mount -o subvol=@home,ssd /dev/mapper/luks /mnt/home # mount -o subvol=@var,ssd /dev/mapper/luks /mnt/var # mount /dev/sdy1 /mnt/boot # manjaro-chroot /mnt /bin/zsh drive preparation resource https://wiki.archlinux.org/index.php/Dm-crypt/Drive_preparation btrfs resources https://btrfs.wiki.kernel.org/index.php/Status https://btrfs.wiki.kernel.org/index.php/FAQ#Is_btrfs_stable.3F https://btrfs.wiki.kernel.org/index.php/Getting_started https://wiki.archlinux.org/index.php/Btrfs https://forum.manjaro.org/t/btrfs-tips-and-tricks/71186?u=linux-aarhus Credits https://austinmorlan.com/posts/arch_linux_install/ Credits in original source - https://fogelholk.io/installing-arch-with-lvm-on-luks-and-btrfs/ - https://flypenguin.de/2018/01/20/arch-full-disk-encryption-btrfs-on-efi-systems/ - https://wiki.archlinux.org/","title":"systemd-boot - LUKS - btrfs"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#manjaro-uefi-using-systemd-boot-luks-and-btrfs","text":"The following is my notes while reading and the changes I made to the subsequent installation to fit into a Manjaro system installation. NOTE : Before you dive into btrfs - be sure to read the entire article - including the documentation linked at the end of this document.","title":"Manjaro UEFI using systemd-boot, LUKS and btrfs"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#overview","text":"UEFI using systemd-boot LUKS encrypted root btrfs with subvolumes Sources is listed at the end of this document You can boot from any Manjaro ISO - open a terminal - and follow this guide. For a similar guide without LUKS read here https://forum.manjaro.org/t/manjaro-uefi-systemd-boot-and-btrfs/116466?u=linux-aarhus Assuming you know how to identify your disk devices and can replace the example device name /dev/sdy with the device for your system. All commands written is assuming your are logged in as root. On Manjaro ISOs the root login is root : manjaro","title":"Overview"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#general","text":"Connect to your network and ensure your system clock is correct # systemctl start systemd-timesyncd Set a preferred mirror and branch then download databases # pacman-mirrors -aU https://manjaro.moson.eu -Sunstable # pacman -Syy","title":"General"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#partitioning-and-file-system-creation","text":"","title":"Partitioning and File System Creation"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#partition","text":"Clear the disk of any existing file systems using random pattern - as the partition will be encrypted this will disguise the partitions and data held on it. It will take some time to complete - hours if you are having a big storage device. # dd if=/dev/urandom of=/dev/sdy status=progress bs=10M Use cdisk to create the boot partition and the main partition which will be encrypted # cfdisk /dev/sdy boot 512M EFI system partition type root remaining space default type Linux file system Set up the encryption container # cryptsetup luksFormat /dev/sdy2 Are you sure? YES Enter passphrase (twice) # cryptsetup open /dev/sdy2 luks","title":"Partition"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#format","text":"Format to FAT32 for the boot and btrfs for the root # mkfs.vfat -F32 /dev/sdy1 # mkfs.btrfs /dev/mapper/luks The author of the original guide has some reasonable suggestions which also matches the defaults used by Manjaro Architect. * / subvolume * /home subvolume in case a root snapshot needs to be restored * /var changes often so also a separate subvolume. * noatime and nodiratime are used to prevent a write every time a file or directory is accessed (not great for a COW filesystem like btrfs). * zstd is used for compression because it's fast and provides compression similar to xz. * Don't use discard . Issue manual trim commands with fstrim or enable the fstrim.timer.","title":"Format"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#subvolumes","text":"# mount /dev/mapper/luks /mnt # btrfs subvolume create /mnt/@ # btrfs subvolume create /mnt/@home # btrfs subvolume create /mnt/@var # umount /mnt # mount -o subvol=@,ssd,compress=zstd,noatime,nodiratime /dev/mapper/luks /mnt # mkdir /mnt/{boot,home,var} # mount -o subvol=@home,ssd,compress=zstd,noatime,nodiratime /dev/mapper/luks /mnt/home # mount -o subvol=@var,ssd,compress=zstd,noatime,nodiratime /dev/mapper/luks /mnt/var # mount /dev/sdy1 /mnt/boot","title":"Subvolumes"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#installation","text":"","title":"Installation"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#install-base-manjaro","text":"# basestrap /mnt base btrfs-progs sudo manjaro-zsh-config intel-ucode networkmanager linux54 nano vim systemd-boot-manager mkinitcpio","title":"Install base Manjaro"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#generate-fstab","text":"Generate fstab and verify the content # fstabgen -U /mnt >> /mnt/etc/fstab # cat /mnt/etc/fstab","title":"Generate fstab"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#configure-system","text":"","title":"Configure system"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#chroot","text":"# manjaro-chroot /mnt /bin/zsh","title":"Chroot"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#hostname","text":"# echo manjaro > /etc/hostname","title":"Hostname"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#edit-etchosts","text":"# nano /etc/hosts 127.0.0.1 localhost ::1 localhost 127.0.1.1 manjaro.localdomain manjaro","title":"Edit /etc/hosts"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#shell","text":"# chsh -s /bin/zsh","title":"Shell"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#timezone","text":"Example for Denmark # ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime # hwclock --systohc","title":"Timezone"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#network-manager","text":"Enable network connection # systemctl enable NetworkManager","title":"Network Manager"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#enable-ntp-client","text":"# systemctl enable systemd-timesyncd","title":"Enable ntp client"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#locale","text":"Locale example for Danish locale * uncomment en_DK.UTF-8 and en_US.UTF-8 Save file and generate the messages # nano /etc/locale.gen # locale-gen","title":"Locale"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#etclocaleconf","text":"Locale.conf example for Denmark # echo LANG=en_DK.UTF-8 > /etc/locale.conf","title":"/etc/locale.conf"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#root-password","text":"# passwd","title":"Root password"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#etcmkinitcpioconf","text":"Add btrfs and encrypt and save # nano /etc/mkinitcpio.conf HOOKS=\"base udev btrfs encrypt autodetect modconf block filesystems keyboard fsck\" # mkinitcpio -p linux54","title":"/etc/mkinitcpio.conf"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#systemd-boot","text":"Install the boot loader # bootctl --path=/boot install","title":"systemd-boot"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#create-manjaro-loaders","text":"# sdboot-manage gen Navigate to /boot/loader/entries and check the configurations sdboot-manage has created (there will be two). :information_source: If you create the entries by hand please note * root=UUID= is the UUID of your LUKS container * cryptdevice=UUID= is the UUID of physical partition hosting your container","title":"Create Manjaro loaders"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#default","text":"title Manjaro Linux 5.4 linux /vmlinuz-5.4-x86_64 initrd /intel-ucode.img initrd /initramfs-5.4-x86_64.img options root=UUID=289ae676-7cbc-43a7-b4b7-e9cf325227c9 rw rootflags=subvol=/@ cryptdevice=UUID=9d336c58-0e8f-434d-b12a-b75663c4ad59","title":"Default"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#fallback","text":"title Manjaro Linux 5.4 linux /vmlinuz-5.4-x86_64 initrd /intel-ucode.img initrd /initramfs-5.4-x86_64-fallback.img options root=UUID=289ae676-7cbc-43a7-b4b7-e9cf325227c9 rw rootflags=subvol=/@ cryptdevice=UUID=9d336c58-0e8f-434d-b12a-b75663c4ad59:luks","title":"Fallback"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#base-config-done","text":"# exit # umount -R /mnt # reboot","title":"Base config done"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#customizing","text":"You should have a fully functioning Manjaro system. What comes next is your personal preferences. The example is a very basic vanilla Gnome desktop.","title":"Customizing"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#gnome-desktop","text":"# pacman -Syu xorg-server xorg-server-common xorg-xinit xorg-drivers accountsservice gnome-keyring gnome-session gnome-shell gnome-desktop gnome-terminal gdm","title":"Gnome desktop"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#add-a-user-and-set-password","text":"# useradd -mUG lp,network,power,sys,wheel -s /bin/zsh newuser # passwd newuser","title":"Add a user and set password"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#admin-user","text":"Add user to wheel group # visudo","title":"Admin user"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#uncomment-and-save","text":"%wheel ALL=(ALL) ALL","title":"Uncomment and save"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#enable-displaymanager","text":"# systemctl enable gdm","title":"Enable displaymanager"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#reboot","text":"# reboot","title":"Reboot"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#trouble-shooting","text":"If something went wrong and you need to get back in from the live image: # cryptsetup open /dev/sdy2 luks # mount -o subvol=@,ssd /dev/mapper/luks /mnt # mount -o subvol=@home,ssd /dev/mapper/luks /mnt/home # mount -o subvol=@var,ssd /dev/mapper/luks /mnt/var # mount /dev/sdy1 /mnt/boot # manjaro-chroot /mnt /bin/zsh","title":"Trouble shooting"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#drive-preparation-resource","text":"https://wiki.archlinux.org/index.php/Dm-crypt/Drive_preparation","title":"drive preparation resource"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#btrfs-resources","text":"https://btrfs.wiki.kernel.org/index.php/Status https://btrfs.wiki.kernel.org/index.php/FAQ#Is_btrfs_stable.3F https://btrfs.wiki.kernel.org/index.php/Getting_started https://wiki.archlinux.org/index.php/Btrfs https://forum.manjaro.org/t/btrfs-tips-and-tricks/71186?u=linux-aarhus","title":"btrfs resources"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-btrfs/#credits","text":"https://austinmorlan.com/posts/arch_linux_install/ Credits in original source - https://fogelholk.io/installing-arch-with-lvm-on-luks-and-btrfs/ - https://flypenguin.de/2018/01/20/arch-full-disk-encryption-btrfs-on-efi-systems/ - https://wiki.archlinux.org/","title":"Credits"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/","text":"Why another guide on encryption? Using grub to boot an encrypted system often leads to long waits while grub decrypts the luks container just to get to the kernels. This load time is a weakness of the current grub implementation - and while it will probably be solved in due time - we need to find ways around it. For example you can use a separate partition for boot, $esp and root and leave boot unencrypted. This works and grub will happily boot. If you want to dual boot several variations of Linux and throw in a Windows and a couple of ISO - this is the way to go. But what if you requirements are simple? You just want an encrypted Manjaro? And you want the installation to be as simple as possible? systemd-boot is a bootloader which do not get much attention on Manjaro - since most Manjaro installations is created using Calamares installer which in turn installs grub. I recall a setting for an iso-profile setting the efi_bootloader=\"grub\" - but it didn't work very well so I decided to learn how to implement systemd-boot the most simple way - later create a merge request to the tools. Before you begin First - I am assuming you know your device path - for the safety of less experienced readers - I am using a device path /dev/sdy you most likely do not find on your system. Second - I am assuming you are using a root TTY as no commands is prefixed with sudo . TIP : Don't use a graphical environment - switch to TTY - because the live system may lock screen and other unpleasant thing while you are using the terminal - thus breaking what ever you were doing. Third - I will be using command line partitioning - no menu interfaces - pure command line. Fourth - This guide will work for any device - it be internal, removable USB or otherwise attached to your system. To ease the pain of writing the same device over and over I made use of an environment variable - I assume you set the same too. TIP If your circumstances allows for it - you can use ssh to install remotely using another device on your network. Let's begin If you have not done so already open a root TTY and set the device variable - remember it only exist in the current shell INS=\"/dev/sdy\" Ensure your device is not mounted anywhere umount -f \"$INS\" Now to the serious stuff The stuff that needs disclaimers - you are on your own kind of stuff. Clean the disk's partition tables sgdisk --zap-all \"$INS\" Create a new GPT partition table sgdisk --mbrtogpt \"$INS\" Randomize the dev dd if=/dev/urandom of=$INS status=progress Create the $esp partition sgdisk --new 1::+512M --typecode 1:ef00 --change-name 1:\"EFI System\" \"$INS\" Create the root partition sgdisk --new 2::: --typecode 2:8304 --change-name 2:\"Linux x86-64 root\" \"$INS\" Wipe everything from the partitions wipefs -af \"$INS\"1 wipefs -af \"$INS\"2 Format the partitions Format $esp partition using FAT32 mkfs.vfat -vF32 \"$INS\"1 Root LUKS container Create the LUKS container - the --iter-time argument can be changed (default>10000) - the more iterations the better. --tries can be changed defaults to three (3) times. cryptsetup -v --iter-time 5000 --type luks2 --iter-time 50000 --hash sha512 --tries 5 --use-urandom luksFormat \"$INS\"2 Open the LUKS container cryptsetup open \"$INS\"2 cryptroot Format the container using your preferred file system - If your device is flash based you can use f2fs which is created for flash or you can use ext4 which is a defacto standard for Linux. mkfs.ext4 /dev/mapper/cryptroot Mounting Mount your LUKS container on the systems temporary mountpoint mount /dev/mapper/cryptroot /mnt Then create the folder for booting systemd ($esp) mkdir /mnt/boot And mount the $esp partition mount \"$INS\"1 /mnt/boot Installing a base Manjaro system This article is only scratching the surface of the new system. We only install a basic bootable system using the base meta package, (if you use f2fs add the package f2fs-tools ) along with kernel and some required tools - and don't forget network connectivity basestrap /mnt base linux510 nano mkinitcpio bash-completion networkmanager f2fs-tools Configuring the base system Configuring the system is the tedious - extremely boring - but crucial part, usually abstracted by tools like Manjaro Architect. Chroot into the mountpoint manjaro-chroot /mnt /bin/bash Configurations The vconsole.conf file contains information about the type of keymap you are using - in this case a danish keymap - but it could us for a default US english keymap. echo KEYMAP=dk > /etc/vconsole.conf The hostname file contains the name of your computer on a network - this must be unique - you can of course select another name echo manjaro > /etc/hostname The hosts file contains information local to your system. The is almost empty - edit the file and append below IP addresses and the hostname from your hostname file nano /etc/hosts 127.0.0.1 localhost 127.0.1.1 manjaro.localdomain manjaro The ever important system time - the example is for Denmark but it could be Europe/Paris if you live in that area. ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime Unix systems expects the hardware clock to run in UTC and the system then corrects the clock using the timezone information - this is a point where Windows and Linux disagree causing trouble for dual-booters - which we are not. hwclock --systohc Enable the network and timesync (don't use --now in chroot, it will fail) systemctl enable NetworkManager systemd-timesyncd Now we create a locale configuration - this configuration defines system messages and how time, date and other units are displayed. nano /etc/locale.gen Uncomment the locales you want to use - e.g. using English for messages and German for date and time uncomment both. In this example - again for Denmark. en_DK.UTF-8 UTF-8 To actually use preferences the necessary files needs generated - this is done using the locale-gen command locale-gen The locale.conf file contains a reference to the locale files just created. Please see the Arch Wiki page on locales for additional entries you can add. echo LANG=en_DK.UTF-8 > /etc/locale.conf And finally set the root password - do not skip as you will not be able to login into the rebooted system. passwd systemd-boot systemd-boot on Arch Wiki This is the interesting part you have worked yourself down to. Because we are using LUKS encrypted root partition we need to make some system parts available at boot time. We need to make the initramfs aware of the encryption we use and it need to accept input from the user on encryption phrase used to decrypt the system. initramfs Those settings is defined in the file mkinitcpio.conf - we need to edit that file so suit our purpose nano /etc/mkinitcpio.conf Edit the HOOKS line to include keyboard , keymap , sd-vconsole and sd-encrypt . This is required to get past the decryption phase. And the order of appearance is important - they must appear before autodetect. HOOKS=\"systemd keyboard keymap sd-vconsole block sd-encrypt autodetect modconf filesystems fsck\" Use the mkinicpio command to generate the initramfs - it will copy the files to the boot ($esp) partition. mkinitcpio -P -d /boot bootloader Now install the systemd bootloader to the boot ($esp) partition bootctl --path=/boot install To get the UUID for the device we need to exit chroot and the rest of the configuration can be done outside. exit For the bootloader to actually load we need create a configuration file to specify the kernel, initrd and kernel options. The configuration must match your system's kernel and initrd also DEVICE-UUID must the UUID of the physical device hosting the LUKS container. We can use lsblk to output the UUID and write it directly to the entry configuration. lsblk -no PATH,UUID \"$INS\"2 > /mnt/boot/loader/entries/manjaro.conf We also need the filenames of the kernel and to avoid typos - we use ls and pipe the output to the same file - just appending instead ls /mnt/boot/init* /mnt/boot/vmlinuz* >> /mnt/boot/loader/entries/manjaro.conf Now open the file using nano nano /mnt/boot/loader/entries/manjaro.conf Amend the file to look like this (the order of the lines are not important) title Manjaro linux /vmlinuz-5.10-x86_64 initrd /initramfs-5.10-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=DEVICE-UUID=cryptroot This new configuration file is then added to the file loader.conf nano /mnt/boot/loader/loader.conf default manjaro Maintenance This article does not take into account the amd/intel microcode and maintenance due to kernel upgrades or booting different kernels. To learn more - read up on systemd-boot on the Arch Wiki. To facilitate tedious maintenance tasks you can install the systemd-boot-manager package from official repo. Just a few things worth noting. With systemd-boot, we also need to handle microcode loading by hand in the entries It is probably worth pointing out that these entries will need to be added/updated as new kernels are installed and removed Lastly, systemd-boot-manager will handle both those things for you in an automated fashion. It can automate the installation of systemd-boot, the creation and removal of entries, the addition of microcode updates and has options setting defaults automatically. It has full support for luks/lvm/btrfs/zfs/etc. -- @dalto Test your install Unmount your devices # umount -R /mnt Close the LUKS container # cryptsetup close /dev/mapper/cryptroot If you are installing to an USB device - sync device before removing it # sync And reboot # reboot Install Manjaro Edition You now have a the minimal for a system to boot and make a network connection - where you go from here is really up to you. Option 1 Pick from the big-big box of Linux Lego and customize your own favorite system. Option 2 On your favorite system you can use two files from your root /rootfs-pkgs.txt /desktopfs-pkgs.txt Sanitize the lists combining them into one list - then feed them to pacman to install them into your new root file system. Start with root filesystem and pipe it into a new file cat /rootfs-pkgs.txt | awk '{print $1;}' > ~/iso-pkglist.txt Continue with the desktop filesystem and append it to the file cat /desktopfs-pkgs.txt | awk '{print $1;}' >> ~/iso-pkglist.txt Then feed the entire list to pacman and direct the installation to your mounted root using the convenient options of not confirming and only install if not already installed. pacman -Syy --no-confirm --needed --root /mnt - < ~/iso-pkglist.txt You will now require a few extra steps - which requires chroot. Administrative user It is important to hold back on user creation until you have installed the packages making up the Manjaro look and feel otherwise your user will have only desktop defaults. All theming etc. is stored in /etc/skel and upon user creation these files as used as a skeleton. The first created should be an administrative user - replace $USERNAME with an actual username useradd --create-home --user-group -G network,scanner,lp,wheel $USERNAME Then set a password for the user passwd $USERNAME Display manager To enable a graphical login you must enable the display manager. Which one depends on the environment KDE systemctl enable sddm Xfce systemctl enable lightdm Gnome systemctl enable gdm Conclusion You have only scratched the surface and there is work to be done - installing Xorg, applications, themes - what ever you fancy - it's really up to you how this adventure ends. Have fun - I did.","title":"systemd-boot - LUKS - ext4"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#why-another-guide-on-encryption","text":"Using grub to boot an encrypted system often leads to long waits while grub decrypts the luks container just to get to the kernels. This load time is a weakness of the current grub implementation - and while it will probably be solved in due time - we need to find ways around it. For example you can use a separate partition for boot, $esp and root and leave boot unencrypted. This works and grub will happily boot. If you want to dual boot several variations of Linux and throw in a Windows and a couple of ISO - this is the way to go. But what if you requirements are simple? You just want an encrypted Manjaro? And you want the installation to be as simple as possible? systemd-boot is a bootloader which do not get much attention on Manjaro - since most Manjaro installations is created using Calamares installer which in turn installs grub. I recall a setting for an iso-profile setting the efi_bootloader=\"grub\" - but it didn't work very well so I decided to learn how to implement systemd-boot the most simple way - later create a merge request to the tools.","title":"Why another guide on encryption?"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#before-you-begin","text":"First - I am assuming you know your device path - for the safety of less experienced readers - I am using a device path /dev/sdy you most likely do not find on your system. Second - I am assuming you are using a root TTY as no commands is prefixed with sudo . TIP : Don't use a graphical environment - switch to TTY - because the live system may lock screen and other unpleasant thing while you are using the terminal - thus breaking what ever you were doing. Third - I will be using command line partitioning - no menu interfaces - pure command line. Fourth - This guide will work for any device - it be internal, removable USB or otherwise attached to your system. To ease the pain of writing the same device over and over I made use of an environment variable - I assume you set the same too. TIP If your circumstances allows for it - you can use ssh to install remotely using another device on your network.","title":"Before you begin"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#lets-begin","text":"If you have not done so already open a root TTY and set the device variable - remember it only exist in the current shell INS=\"/dev/sdy\" Ensure your device is not mounted anywhere umount -f \"$INS\"","title":"Let's begin"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#now-to-the-serious-stuff","text":"The stuff that needs disclaimers - you are on your own kind of stuff.","title":"Now to the serious stuff"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#clean-the-disks-partition-tables","text":"sgdisk --zap-all \"$INS\"","title":"Clean the disk's partition tables"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#create-a-new-gpt-partition-table","text":"sgdisk --mbrtogpt \"$INS\"","title":"Create a new GPT partition table"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#randomize-the-dev","text":"dd if=/dev/urandom of=$INS status=progress","title":"Randomize the dev"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#create-the-esp-partition","text":"sgdisk --new 1::+512M --typecode 1:ef00 --change-name 1:\"EFI System\" \"$INS\"","title":"Create the $esp partition"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#create-the-root-partition","text":"sgdisk --new 2::: --typecode 2:8304 --change-name 2:\"Linux x86-64 root\" \"$INS\"","title":"Create the root partition"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#wipe-everything-from-the-partitions","text":"wipefs -af \"$INS\"1 wipefs -af \"$INS\"2","title":"Wipe everything from the partitions"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#format-the-partitions","text":"Format $esp partition using FAT32 mkfs.vfat -vF32 \"$INS\"1","title":"Format the partitions"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#root-luks-container","text":"Create the LUKS container - the --iter-time argument can be changed (default>10000) - the more iterations the better. --tries can be changed defaults to three (3) times. cryptsetup -v --iter-time 5000 --type luks2 --iter-time 50000 --hash sha512 --tries 5 --use-urandom luksFormat \"$INS\"2 Open the LUKS container cryptsetup open \"$INS\"2 cryptroot Format the container using your preferred file system - If your device is flash based you can use f2fs which is created for flash or you can use ext4 which is a defacto standard for Linux. mkfs.ext4 /dev/mapper/cryptroot","title":"Root LUKS container"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#mounting","text":"Mount your LUKS container on the systems temporary mountpoint mount /dev/mapper/cryptroot /mnt Then create the folder for booting systemd ($esp) mkdir /mnt/boot And mount the $esp partition mount \"$INS\"1 /mnt/boot","title":"Mounting"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#installing-a-base-manjaro-system","text":"This article is only scratching the surface of the new system. We only install a basic bootable system using the base meta package, (if you use f2fs add the package f2fs-tools ) along with kernel and some required tools - and don't forget network connectivity basestrap /mnt base linux510 nano mkinitcpio bash-completion networkmanager f2fs-tools","title":"Installing a base Manjaro system"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#configuring-the-base-system","text":"Configuring the system is the tedious - extremely boring - but crucial part, usually abstracted by tools like Manjaro Architect.","title":"Configuring the base system"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#chroot-into-the-mountpoint","text":"manjaro-chroot /mnt /bin/bash","title":"Chroot into the mountpoint"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#configurations","text":"The vconsole.conf file contains information about the type of keymap you are using - in this case a danish keymap - but it could us for a default US english keymap. echo KEYMAP=dk > /etc/vconsole.conf The hostname file contains the name of your computer on a network - this must be unique - you can of course select another name echo manjaro > /etc/hostname The hosts file contains information local to your system. The is almost empty - edit the file and append below IP addresses and the hostname from your hostname file nano /etc/hosts 127.0.0.1 localhost 127.0.1.1 manjaro.localdomain manjaro The ever important system time - the example is for Denmark but it could be Europe/Paris if you live in that area. ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime Unix systems expects the hardware clock to run in UTC and the system then corrects the clock using the timezone information - this is a point where Windows and Linux disagree causing trouble for dual-booters - which we are not. hwclock --systohc Enable the network and timesync (don't use --now in chroot, it will fail) systemctl enable NetworkManager systemd-timesyncd Now we create a locale configuration - this configuration defines system messages and how time, date and other units are displayed. nano /etc/locale.gen Uncomment the locales you want to use - e.g. using English for messages and German for date and time uncomment both. In this example - again for Denmark. en_DK.UTF-8 UTF-8 To actually use preferences the necessary files needs generated - this is done using the locale-gen command locale-gen The locale.conf file contains a reference to the locale files just created. Please see the Arch Wiki page on locales for additional entries you can add. echo LANG=en_DK.UTF-8 > /etc/locale.conf And finally set the root password - do not skip as you will not be able to login into the rebooted system. passwd","title":"Configurations"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#systemd-boot","text":"systemd-boot on Arch Wiki This is the interesting part you have worked yourself down to. Because we are using LUKS encrypted root partition we need to make some system parts available at boot time. We need to make the initramfs aware of the encryption we use and it need to accept input from the user on encryption phrase used to decrypt the system.","title":"systemd-boot"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#initramfs","text":"Those settings is defined in the file mkinitcpio.conf - we need to edit that file so suit our purpose nano /etc/mkinitcpio.conf Edit the HOOKS line to include keyboard , keymap , sd-vconsole and sd-encrypt . This is required to get past the decryption phase. And the order of appearance is important - they must appear before autodetect. HOOKS=\"systemd keyboard keymap sd-vconsole block sd-encrypt autodetect modconf filesystems fsck\" Use the mkinicpio command to generate the initramfs - it will copy the files to the boot ($esp) partition. mkinitcpio -P -d /boot","title":"initramfs"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#bootloader","text":"Now install the systemd bootloader to the boot ($esp) partition bootctl --path=/boot install To get the UUID for the device we need to exit chroot and the rest of the configuration can be done outside. exit For the bootloader to actually load we need create a configuration file to specify the kernel, initrd and kernel options. The configuration must match your system's kernel and initrd also DEVICE-UUID must the UUID of the physical device hosting the LUKS container. We can use lsblk to output the UUID and write it directly to the entry configuration. lsblk -no PATH,UUID \"$INS\"2 > /mnt/boot/loader/entries/manjaro.conf We also need the filenames of the kernel and to avoid typos - we use ls and pipe the output to the same file - just appending instead ls /mnt/boot/init* /mnt/boot/vmlinuz* >> /mnt/boot/loader/entries/manjaro.conf Now open the file using nano nano /mnt/boot/loader/entries/manjaro.conf Amend the file to look like this (the order of the lines are not important) title Manjaro linux /vmlinuz-5.10-x86_64 initrd /initramfs-5.10-x86_64.img options root=/dev/mapper/cryptroot rd.luks.name=DEVICE-UUID=cryptroot This new configuration file is then added to the file loader.conf nano /mnt/boot/loader/loader.conf default manjaro","title":"bootloader"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#maintenance","text":"This article does not take into account the amd/intel microcode and maintenance due to kernel upgrades or booting different kernels. To learn more - read up on systemd-boot on the Arch Wiki. To facilitate tedious maintenance tasks you can install the systemd-boot-manager package from official repo. Just a few things worth noting. With systemd-boot, we also need to handle microcode loading by hand in the entries It is probably worth pointing out that these entries will need to be added/updated as new kernels are installed and removed Lastly, systemd-boot-manager will handle both those things for you in an automated fashion. It can automate the installation of systemd-boot, the creation and removal of entries, the addition of microcode updates and has options setting defaults automatically. It has full support for luks/lvm/btrfs/zfs/etc. -- @dalto","title":"Maintenance"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#test-your-install","text":"Unmount your devices # umount -R /mnt Close the LUKS container # cryptsetup close /dev/mapper/cryptroot If you are installing to an USB device - sync device before removing it # sync And reboot # reboot","title":"Test your install"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#install-manjaro-edition","text":"You now have a the minimal for a system to boot and make a network connection - where you go from here is really up to you.","title":"Install Manjaro Edition"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#option-1","text":"Pick from the big-big box of Linux Lego and customize your own favorite system.","title":"Option 1"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#option-2","text":"On your favorite system you can use two files from your root /rootfs-pkgs.txt /desktopfs-pkgs.txt Sanitize the lists combining them into one list - then feed them to pacman to install them into your new root file system. Start with root filesystem and pipe it into a new file cat /rootfs-pkgs.txt | awk '{print $1;}' > ~/iso-pkglist.txt Continue with the desktop filesystem and append it to the file cat /desktopfs-pkgs.txt | awk '{print $1;}' >> ~/iso-pkglist.txt Then feed the entire list to pacman and direct the installation to your mounted root using the convenient options of not confirming and only install if not already installed. pacman -Syy --no-confirm --needed --root /mnt - < ~/iso-pkglist.txt You will now require a few extra steps - which requires chroot.","title":"Option 2"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#administrative-user","text":"It is important to hold back on user creation until you have installed the packages making up the Manjaro look and feel otherwise your user will have only desktop defaults. All theming etc. is stored in /etc/skel and upon user creation these files as used as a skeleton. The first created should be an administrative user - replace $USERNAME with an actual username useradd --create-home --user-group -G network,scanner,lp,wheel $USERNAME Then set a password for the user passwd $USERNAME Display manager To enable a graphical login you must enable the display manager. Which one depends on the environment","title":"Administrative user"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#kde","text":"systemctl enable sddm","title":"KDE"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#xfce","text":"systemctl enable lightdm","title":"Xfce"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#gnome","text":"systemctl enable gdm","title":"Gnome"},{"location":"manjaro/installation/manjaro-cli-installation-systemd-boot-luks-ext4/#conclusion","text":"You have only scratched the surface and there is work to be done - installing Xorg, applications, themes - what ever you fancy - it's really up to you how this adventure ends. Have fun - I did.","title":"Conclusion"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/","text":"Encrypt a new Manjaro installation using CLI This guide is an addition to the CLI guide on creating a Manjaro installation. The guide will assume a few points You are installing on bare-metal. Your disk device is /dev/sda If you device is not the above - you must replace sda with your actual device. Target is an EFI based system. You are familiar with the CLI guide. DISCLAIMER : I assume no responsiblity for your device and the consequenses of your actions on your device. Previous to this guide I had no experience in creating encrypted partition - let alone encryption at all. If you think there may be an error in the guide please help me improve by adding a comment. I have had no need for encryption but learning is good and my learning starts with a search using DuckDuckGo . This guide will only cover the steps to create an encrypted system. When you have created the required encrypted partitions the installation follows the same pattern as the previous guide. You find the link at then end of this document. Overview Preparation Partitioning Formatting Mounting Base install Bootloader Conclusion Preparation This step is going to take some time - depending your level of motivation, your actual need or if it is just for the learning experience. When a disk is used the data written to the disk can be read with forensic utilities such as the testdisk utility. https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#2-setup When you re-purpose a disk using a partitioning tool, you are removing references to files but not the files themselves. Even in the case of creating encrypted partitions the previous raw data is still present. If you want to create encrypted partitions - the whole purpose is to hide whatever data you want hide but in case of re-using a disk you also want to remove every shred of data previously present. Possible ways to shred data on a disk Several possible ways exist for shredding data and the chosen method is a matter of choice. The choice depends on multiple factor like purpose, security needs, time available or if it just a learning experience. If you are using an SSD it could be a good idea to use a tool to reset the memory cells. https://wiki.archlinux.org/index.php/Solid_state_drive/Memory_cell_clearing Shred for giveaway using dd Shredding of existing data is most easily done overwriting the disk with zero's (0) a number of times. Executing this command as root a number of times will do it. # dd if=/dev/zero of=/dev/sda bs=1M status=progress That is good if you are giving the disk away, but it is not good enough if you re-purpose the disk for your own use as an encrypted device. If you only overwrite your disk with zero's any data written to the encrypted partition will be obvious to a forensic tool because the data is everything but zero's. This is why re-using a disk for encrypting needs a little more sophistication. Shred for encryption using dd Overwrite the disk a number of times using random sequence is the preparation - even for a brand new disk. # dd if=/dev/urandom of=/dev/sda bs=1M status=progress This preparation is not required but if you are concerned of the risks of anyone using forensic tools on your disk - you will do it. Shred for encryption using shred The shred utility is working slightly different, even as it operates on the device path, it uses the file allocation table to identify files, then overwrite the file a number of times (defaults to three (3)). Arch wiki The wiki describes a procedure to wipe a device https://wiki.archlinux.org/index.php/Dm-crypt/Drive_preparation Partitioning We will use cfdisk to partition the disk. Select gpt when prompted. # cfdisk --zero /dev/sda We need a minimum of three (3) partitions. If you plan to use multiple kernels the boot partition should be big enough to hold all of them. My initial 100M would be too small as pointed to by @eugen-b so I changed to 300M. $esp size: 100M partition type: EFI system boot size: 300M partition type: Linux root size: what you have left When you have created the partitions - write the changes and exit cfdisk. Encrypted device Now we create our encrypted device # cryptsetup --verbose --hash sha512 --iter-time 5000 --use-random luksFormat /dev/sda3 Confirm the creation and supply a passphrase - the longer the better - use a combination of upper/lowercase letters, numbers and symbols. WARNING! ======== This will overwrite data on /dev/sda3 irrevocably. Are you sure? (Type uppercase yes): YES Enter passphrase for /dev/sda3: IMPORTANT : If you are using Dvorak or other non-standard read the forum topic linked below on custom keymap. Usually you can use a passphrase that can be reproduced using a standard qwerty US keyboard layout. Verify passphrase: Key slot 0 created. Command successful. Unlock the partition Now create a device mapper by unlocking your partition - in this case we use the name cryptroot but it can really be anything - just stick to it because you will need it later. # cryptsetup open --type luks /dev/sda3 cryptroot Enter passphrase for /dev/sda3: Formatting The $esp partition uses FAT32 # mkfs.fat -F32 /dev/sda1 The boot partition uses ext - ext2 will be just fine # mkfs.ext2 /dev/sda2 The encrypted partition # mkfs.ext4 /dev/mapper/cryptroot Mounting Mount the devices so we can begin installing Mount root # mount /dev/mapper/cryptroot /mnt Create boot folder and mount # mkdir /mnt/boot # mount /dev/sda2 /mnt/boot Create efi folder and mount # mkdir /mnt/boot/efi # mount /dev/sda1 /mnt/boot/efi Create etc folder # mkdir /mnt/etc Generate filesystem table # fstabgen -U /mnt > /mnt/etc/fstab Base installation Enter a chroot environment and use section 6 and 7 of the CLI guide to perform a basic Manjaro installation. # manjaro-chroot /mnt /bin/bash https://forum.manjaro.org/t/howto-install-manjaro-using-cli-only/108203?u=linux-aarhusaarhus Return to this guide when done and don't leave the chroot. Bootloader To enable grub to use the encrypted root we need to make some changes to some default configs. Edit mkinitcpio.conf Why? To my understanding of initramfs on Arch it is generated partly using predefined modules and partly on modules detected at boot time. If you need a particular keyboard or keymap available as early as possible - inputting passphrase comes to mind - you need make them explicit available. That means changing the HOOKS line to make the modules available before autodetect. This makes your initramfs image larger - presumably - I have no means of testing - it also makes your system aware of your preferences (e.g. a dvorak keyboard or maybe even country specific layout) This is a point I could use some feedback. ``` nano /etc/mkinitcpio.conf HOOKS=\"base udev block keyboard keymap autodetect modconf encrypt filesystems fsck\" ``` Build initramfs Building initramfs requires knowing which kernel to use e.g. Linux 54. # mkinicpio -p linux54 Edit grub default We could use the device naming but in systemd world this naming may not always be the same - not guaranteed to be identical on every boot - so it is highly recommended to use UUID. To the UUID of the sda3 partition holding the cryptroot we use lsblk and define the output to be NAME,UUID. lsblk -o NAME,UUID /dev/sda3 You will get two UUIDs - the first being the physical partion - the second the cryptroot partition - and it is the UUID of the physical partition we need for grub. ``` nano /etc/default/grub GRUB_CMDLINE_LINUX=\"cryptdevice=UUID=xxxx-yyy-zzzz:cryptroot\" ``` Install bootloader # grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=Manjaro Generate grub config grub-mkconfig -o /boot/grub/grub.cfg Conclusion Exit the chroot, umount device, close your encryption container # exit # umount -R /mnt # cryptsetup close cryptroot # reboot Type in your passphrase for your encrypted container and login using root and the necessary password. Sources https://wiki.archlinux.org/index.php/Dm-crypt https://wiki.archlinux.org/index.php/Dm-crypt/Drive_preparation https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption https://www.howtoforge.com/tutorial/how-to-install-arch-linux-with-full-disk-encryption/","title":"Encrypted CLI installation"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#encrypt-a-new-manjaro-installation-using-cli","text":"This guide is an addition to the CLI guide on creating a Manjaro installation. The guide will assume a few points You are installing on bare-metal. Your disk device is /dev/sda If you device is not the above - you must replace sda with your actual device. Target is an EFI based system. You are familiar with the CLI guide. DISCLAIMER : I assume no responsiblity for your device and the consequenses of your actions on your device. Previous to this guide I had no experience in creating encrypted partition - let alone encryption at all. If you think there may be an error in the guide please help me improve by adding a comment. I have had no need for encryption but learning is good and my learning starts with a search using DuckDuckGo . This guide will only cover the steps to create an encrypted system. When you have created the required encrypted partitions the installation follows the same pattern as the previous guide. You find the link at then end of this document.","title":"Encrypt a new Manjaro installation using CLI"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#overview","text":"Preparation Partitioning Formatting Mounting Base install Bootloader Conclusion","title":"Overview"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#preparation","text":"This step is going to take some time - depending your level of motivation, your actual need or if it is just for the learning experience. When a disk is used the data written to the disk can be read with forensic utilities such as the testdisk utility. https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#2-setup When you re-purpose a disk using a partitioning tool, you are removing references to files but not the files themselves. Even in the case of creating encrypted partitions the previous raw data is still present. If you want to create encrypted partitions - the whole purpose is to hide whatever data you want hide but in case of re-using a disk you also want to remove every shred of data previously present.","title":"Preparation"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#possible-ways-to-shred-data-on-a-disk","text":"Several possible ways exist for shredding data and the chosen method is a matter of choice. The choice depends on multiple factor like purpose, security needs, time available or if it just a learning experience. If you are using an SSD it could be a good idea to use a tool to reset the memory cells. https://wiki.archlinux.org/index.php/Solid_state_drive/Memory_cell_clearing","title":"Possible ways to shred data on a disk"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#shred-for-giveaway-using-dd","text":"Shredding of existing data is most easily done overwriting the disk with zero's (0) a number of times. Executing this command as root a number of times will do it. # dd if=/dev/zero of=/dev/sda bs=1M status=progress That is good if you are giving the disk away, but it is not good enough if you re-purpose the disk for your own use as an encrypted device. If you only overwrite your disk with zero's any data written to the encrypted partition will be obvious to a forensic tool because the data is everything but zero's. This is why re-using a disk for encrypting needs a little more sophistication.","title":"Shred for giveaway using dd"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#shred-for-encryption-using-dd","text":"Overwrite the disk a number of times using random sequence is the preparation - even for a brand new disk. # dd if=/dev/urandom of=/dev/sda bs=1M status=progress This preparation is not required but if you are concerned of the risks of anyone using forensic tools on your disk - you will do it.","title":"Shred for encryption using dd"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#shred-for-encryption-using-shred","text":"The shred utility is working slightly different, even as it operates on the device path, it uses the file allocation table to identify files, then overwrite the file a number of times (defaults to three (3)).","title":"Shred for encryption using shred"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#arch-wiki","text":"The wiki describes a procedure to wipe a device https://wiki.archlinux.org/index.php/Dm-crypt/Drive_preparation","title":"Arch wiki"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#partitioning","text":"We will use cfdisk to partition the disk. Select gpt when prompted. # cfdisk --zero /dev/sda We need a minimum of three (3) partitions. If you plan to use multiple kernels the boot partition should be big enough to hold all of them. My initial 100M would be too small as pointed to by @eugen-b so I changed to 300M. $esp size: 100M partition type: EFI system boot size: 300M partition type: Linux root size: what you have left When you have created the partitions - write the changes and exit cfdisk.","title":"Partitioning"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#encrypted-device","text":"Now we create our encrypted device # cryptsetup --verbose --hash sha512 --iter-time 5000 --use-random luksFormat /dev/sda3 Confirm the creation and supply a passphrase - the longer the better - use a combination of upper/lowercase letters, numbers and symbols. WARNING! ======== This will overwrite data on /dev/sda3 irrevocably. Are you sure? (Type uppercase yes): YES Enter passphrase for /dev/sda3: IMPORTANT : If you are using Dvorak or other non-standard read the forum topic linked below on custom keymap. Usually you can use a passphrase that can be reproduced using a standard qwerty US keyboard layout. Verify passphrase: Key slot 0 created. Command successful.","title":"Encrypted device"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#unlock-the-partition","text":"Now create a device mapper by unlocking your partition - in this case we use the name cryptroot but it can really be anything - just stick to it because you will need it later. # cryptsetup open --type luks /dev/sda3 cryptroot Enter passphrase for /dev/sda3:","title":"Unlock the partition"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#formatting","text":"The $esp partition uses FAT32 # mkfs.fat -F32 /dev/sda1 The boot partition uses ext - ext2 will be just fine # mkfs.ext2 /dev/sda2 The encrypted partition # mkfs.ext4 /dev/mapper/cryptroot","title":"Formatting"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#mounting","text":"Mount the devices so we can begin installing","title":"Mounting"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#mount-root","text":"# mount /dev/mapper/cryptroot /mnt","title":"Mount root"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#create-boot-folder-and-mount","text":"# mkdir /mnt/boot # mount /dev/sda2 /mnt/boot","title":"Create boot folder and mount"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#create-efi-folder-and-mount","text":"# mkdir /mnt/boot/efi # mount /dev/sda1 /mnt/boot/efi","title":"Create efi folder and mount"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#create-etc-folder","text":"# mkdir /mnt/etc","title":"Create etc folder"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#generate-filesystem-table","text":"# fstabgen -U /mnt > /mnt/etc/fstab","title":"Generate filesystem table"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#base-installation","text":"Enter a chroot environment and use section 6 and 7 of the CLI guide to perform a basic Manjaro installation. # manjaro-chroot /mnt /bin/bash https://forum.manjaro.org/t/howto-install-manjaro-using-cli-only/108203?u=linux-aarhusaarhus Return to this guide when done and don't leave the chroot.","title":"Base installation"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#bootloader","text":"To enable grub to use the encrypted root we need to make some changes to some default configs.","title":"Bootloader"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#edit-mkinitcpioconf","text":"Why? To my understanding of initramfs on Arch it is generated partly using predefined modules and partly on modules detected at boot time. If you need a particular keyboard or keymap available as early as possible - inputting passphrase comes to mind - you need make them explicit available. That means changing the HOOKS line to make the modules available before autodetect. This makes your initramfs image larger - presumably - I have no means of testing - it also makes your system aware of your preferences (e.g. a dvorak keyboard or maybe even country specific layout) This is a point I could use some feedback. ```","title":"Edit mkinitcpio.conf"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#nano-etcmkinitcpioconf","text":"HOOKS=\"base udev block keyboard keymap autodetect modconf encrypt filesystems fsck\" ```","title":"nano /etc/mkinitcpio.conf"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#build-initramfs","text":"Building initramfs requires knowing which kernel to use e.g. Linux 54. # mkinicpio -p linux54","title":"Build initramfs"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#edit-grub-default","text":"We could use the device naming but in systemd world this naming may not always be the same - not guaranteed to be identical on every boot - so it is highly recommended to use UUID. To the UUID of the sda3 partition holding the cryptroot we use lsblk and define the output to be NAME,UUID. lsblk -o NAME,UUID /dev/sda3 You will get two UUIDs - the first being the physical partion - the second the cryptroot partition - and it is the UUID of the physical partition we need for grub. ```","title":"Edit grub default"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#nano-etcdefaultgrub","text":"GRUB_CMDLINE_LINUX=\"cryptdevice=UUID=xxxx-yyy-zzzz:cryptroot\" ```","title":"nano /etc/default/grub"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#install-bootloader","text":"# grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=Manjaro","title":"Install bootloader"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#generate-grub-config","text":"grub-mkconfig -o /boot/grub/grub.cfg","title":"Generate grub config"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#conclusion","text":"Exit the chroot, umount device, close your encryption container # exit # umount -R /mnt # cryptsetup close cryptroot # reboot Type in your passphrase for your encrypted container and login using root and the necessary password.","title":"Conclusion"},{"location":"manjaro/installation/manjaro-cli-installation-using-luks/#sources","text":"https://wiki.archlinux.org/index.php/Dm-crypt https://wiki.archlinux.org/index.php/Dm-crypt/Drive_preparation https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption https://www.howtoforge.com/tutorial/how-to-install-arch-linux-with-full-disk-encryption/","title":"Sources"},{"location":"manjaro/installation/manjaro-cli-installation-vanilla-gnome/","text":"Extend your Manjaro CLI This guide covers the extension of a basic CLI to a graphical environment using a minimal set of packages. If you want to read up on the CLI it is available on the link below. Boot your device and login into the system using the root account. Install packages We will now extend our basic CLI to a graphical environment using the least amount of packages and we will add in a web browser application. When you get the hang of it you can modify to your liking but for now install the below packages using pacman . You may need to research if you need WiFi driver packages not mentioned below. # pacman -Syu xorg-server xorg-server-common xorg-xinit xorg-drivers accountsservice gnome-keyring gnome-icon-theme gnome-themes-standard gnome-session gnome-shell gnome-desktop gnome-terminal gdm After you have installed the packages - create a new administrative user. # useradd -mUG lp,network,power,sys,wheel newuser Set a password for the new user # passwd newuser Enable gdm display manager # systemctl enable gdm Reboot # reboot Variations https://archived.forum.manjaro.org/t/howto-install-manjaro-using-cli-only/108203?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-run-manjaro-on-a-stick/109520?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-install-encrypted-manjaro-using-cli/110553?u=linux-aarhus","title":"CLI to vanilla Gnome"},{"location":"manjaro/installation/manjaro-cli-installation-vanilla-gnome/#extend-your-manjaro-cli","text":"This guide covers the extension of a basic CLI to a graphical environment using a minimal set of packages. If you want to read up on the CLI it is available on the link below. Boot your device and login into the system using the root account.","title":"Extend your Manjaro CLI"},{"location":"manjaro/installation/manjaro-cli-installation-vanilla-gnome/#install-packages","text":"We will now extend our basic CLI to a graphical environment using the least amount of packages and we will add in a web browser application. When you get the hang of it you can modify to your liking but for now install the below packages using pacman . You may need to research if you need WiFi driver packages not mentioned below. # pacman -Syu xorg-server xorg-server-common xorg-xinit xorg-drivers accountsservice gnome-keyring gnome-icon-theme gnome-themes-standard gnome-session gnome-shell gnome-desktop gnome-terminal gdm After you have installed the packages - create a new administrative user. # useradd -mUG lp,network,power,sys,wheel newuser Set a password for the new user # passwd newuser Enable gdm display manager # systemctl enable gdm Reboot # reboot","title":"Install packages"},{"location":"manjaro/installation/manjaro-cli-installation-vanilla-gnome/#variations","text":"https://archived.forum.manjaro.org/t/howto-install-manjaro-using-cli-only/108203?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-run-manjaro-on-a-stick/109520?u=linux-aarhus https://archived.forum.manjaro.org/t/howto-install-encrypted-manjaro-using-cli/110553?u=linux-aarhus","title":"Variations"},{"location":"manjaro/installation/manjaro-persistent-usb-installation/","text":"Based on the ALMA project https://forum.manjaro.org/t/manjaro-xfce-20-0-3-persistent-usb-released/151622 Presets https://github.com/philmmanjaro/alma/tree/master/presets","title":"Manjaro Persistent USB"},{"location":"manjaro/installation/manjaro-persistent-usb-installation/#based-on-the-alma-project","text":"https://forum.manjaro.org/t/manjaro-xfce-20-0-3-persistent-usb-released/151622","title":"Based on the ALMA project"},{"location":"manjaro/installation/manjaro-persistent-usb-installation/#presets","text":"https://github.com/philmmanjaro/alma/tree/master/presets","title":"Presets"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/","text":"Manjaro-To-Go LXDE with persistence This guide is different than the usual guides I write - the purpose of this is to give any of you a serious tool in case of displacement due to war, evacuation due to natural disasters, riots, ban on religious practice etc. You can also use the stick at home for your occasional secure computing - you can have a normal computer in home - and when necessary you can boot the stick - do what you need to do, e.g. keeping it up-to-date - shut it down and hide it for what ever prying eyes - governments, gangs, rebels, thieves - may force their way into your home. With escalating instability of the world around us - the escalating impact human actions has on our environment - the ever increasing possibilities of having to evacuate - many of us have emergency kits - sleeping bags, food supplies and water - ready to go - we sometimes forget our most vital belongings - the documents that defines us, our origin, our marriage, our children, photos of our relatives, photos of our passports, electronic copies of birth- and marriage certificates, our real-estate documents, proof of ownership for various items we carry - these invaluable documents we don't want others to get their hands on. Many of us values the Bible over everything and would want to have a copy - even an electronic copy - with us. We can't rely on having a computer with us if we need to evacuate but we can rely on - should the need rise - that we can get access to a computer. But we cannot trust others with the stick - they could just copy the documents off the stick - we cannot trust a computer we have not booted to be clean - no keylogger, malware - we cannot trust it to be able to decrypt our data. The Xorg set of display drivers works with recent hardware - but due to the fast development of graphics hardware and though I expect it to work - obviously I cannot make any guarantee. So this is - in my opinion - the ultimate guide to have a Linux in your pocket - an encrypted Linux - for storage of your personal documents. What is this about I will demonstrate how to create a portable encrypted system using an USB device and the most minimal graphical environment possible using Manjaro. CAUTION You will be doing the following as root so in case of device names - do double check your devices. IMPORTANT : Never just unplug your device - you will damage the filesystem. If plugged into another operating system use the system file manager's eject method or ensure device data has been sync'd using the sync command. Then use umount to safely remove the device. DISCLAIMER : I take no responsibility if you wreck something because you are to quick on the Enter key. Let us begin Change user Open a terminal and login as root. $ su -l root Password: Locating your device Through the rest of this article - I will be using a device path of /dev/sdy - replace with your actual device. You can verify which device you are using by removing all USB flash devices. Insert the device you want to use and list your devices. You can recognize the removable device by the number 1 in the RM column. Prepare the device We will be using an unencrypted boot partition, so we cannot hide the presence of a Linux system on the device and where it is. Before we do anything we will fill the device using a random pattern. The benefit is that encrypted data cannot be distinguished from the rest of the device. Start by unmounting your device - using force if necessary. umount -f /dev/sdy Wipe the device (double check device path) using a random pattern. dd if=/dev/urandom of=/dev/sdy bs=4M status=progress Partitions You can use stick of your choice - you have to adjust the partition sizes accordingly. For this article I am using a 64G SanDisk Extreme. To be able to exchange unencrypted data without having to boot the USB we will create a partition of 16G. To maximize compatibility we use exFAT which will be readable by most systems. The intention is to create a hybrid USB capable of booting from a BIOS system as well as an EFI system so we need a special BIOS partition as well. Create GUID partition table sgdisk --mbrtogpt /dev/sdy Create the bios boot partition sgdisk --new 1::+1M --typecode 1:ef02 --change-name 1:\"BIOS boot partition\" /dev/sdy Create the EFI system partition sgdisk --new 2::+50M --typecode 2:ef00 --change-name 2:\"EFI System\" /dev/sdy Create the data partition sgdisk --new 3::+16G --typecode 3:0700 --change-name 3:\"Microsoft basic data\" /dev/sdy Create grub boot partition sgdisk --new 4::+1G --typecode 4:8300 --change-name 4:\"Linux filesystem\" /dev/sdy Create root partition sgdisk --new 5::: --typecode 5:8300 --change-name 5:\"Linux filesystem\" /dev/sdy Create hybrid MBR Arch Linux documentation sgdisk --hybrid 1:2:3 /dev/sdy Boot flag for data partition sgdisk --attributes 3:set:2 /dev/sdy Clean BIOS partition wipefs -af /dev/sdy1 Clean and format EFI partition wipefs -af /dev/sdy2 FAT32 mkfs.vfat -vF32 /dev/sdy2 Clean and format data partition wipefs -af /dev/sdy3 exFAT mkfs.exfat /dev/sdy3 Clean and format grub boot partition wipefs -af /dev/sdy4 ext2 mkfs.ext2 /dev/sdy4 Create LUKS container The larger --iter-time argument used will create a stronger resistance against brute-force but takes longer to decrypt. Example 1 bash cryptsetup --verbose --hash sha256 --iter-time 2000 --use-random luksFormat /dev/sdy5 Example 2 bash cryptsetup --verbose --hash sha512 --iter-time 5000 --use-random luksFormat /dev/sdy5 Confirm and enter passphrase twice and unlock the container (longer password - better encryption) cryptsetup open --type luks /dev/sdy5 cryptroot Create an ext4 file system in the container mkfs.ext4 /dev/mapper/cryptroot Mounting Mount root mount /dev/mapper/cryptroot /mnt Create the /boot folder mkdir /mnt/boot Mount the grub boot partition mount /dev/sdy4 /mnt/boot Create the /boot/efi folder mkdir /mnt/boot/efi And mount the EFI partition mount /dev/sdy2 /mnt/boot/efi Finally create a folder for the data partition mkdir /mnt/data And mount the data partition mount /dev/sdy3 /mnt/data Base installation Replace $LINUX with the kernel of your choice. e.g. linux58 - linux-latest or linux-lts basestrap /mnt base sudo networkmanager $LINUX links nano vim grub mkinitcpio bash-completion broadcom-wl ipw2100-fw Configure system Create fstab fstabgen -U /mnt >> /mnt/etc/fstab Verify the generated fstab has the expected content - remove references to devices which is not your USB /dev/sdy (e.g. the host systems swap - is often added). Chroot manjaro-chroot /mnt /bin/bash Console keyboard Example for Denmark echo LANG=dk > /etc/vconsole.conf Hostname echo manjaro > /etc/hostname Edit /etc/hosts nano /etc/hosts 127.0.0.1 localhost ::1 localhost 127.0.1.1 manjaro.localdomain manjaro Timezone Example for Denmark ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime hwclock --systohc Network Manager Enable network connection systemctl enable NetworkManager Enable ntp client systemctl enable systemd-timesyncd Locale Locale example for Danish locale uncomment en_DK.UTF-8 and en_US.UTF-8 Save file and generate the message table nano /etc/locale.gen locale-gen /etc/locale.conf Locale.conf example for Denmark echo LANG=en_DK.UTF-8 > /etc/locale.conf Root password This is important - if you don't set it you will not be able to login as root - so the other option is to create a user with admin before rebooting. Pick a good password and do not reuse your luks key passwd /etc/mkinitcpio.conf Add encrypt and block - the order is important - then save the changes ```bash nano /etc/mkinitcpio.conf text HOOKS=\"base udev encrypt block keyboard autodetect modconf filesystems fsck\" ``` -- https://wiki.archlinux.org/index.php/Mkinitcpio#Common_hooks Build initramfs mkinitcpio -P Install grub EFI grub-install --target=x86_64-efi --boot-directory=/boot --efi-directory=/boot/efi --removable --recheck BIOS grub-install --force --target=i386-pc --recheck --boot-directory=/boot /dev/sdy Fallback grub-install --force --target=i386-pc --boot-directory=/boot --recheck /dev/sdy3 Edit grub default We could use the device naming but in systemd world this naming may not always be the same - not guaranteed to be identical on every boot - so it is highly recommended to use UUID. To the UUID of the sdy5 partition holding the cryptroot we use lsblk and define the output to be NAME,UUID. lsblk -o NAME,UUID /dev/sdy5 You will get two UUIDs - the first being the physical partion - the second the cryptroot partition - and it is the UUID of the physical partition we need for grub. ``` nano /etc/default/grub GRUB_CMDLINE_LINUX=\"cryptdevice=UUID=xxxx-yyy-zzzz:cryptroot\" ``` Save the file and create grub config grub-mkconfig -o /boot/grub/grub.cfg USB specific considerations Because we are using USB we know repeating writes is not healthy in the long run. Switch journal configuration to use RAM and ensure the journal is not filling up the RAM. nano /etc/systemd/journald.conf Modify to include this and save the file Storage=volatile SystemMaxUse=16M Edit your fstab and edit the options to include the noatime option. This will prevent writing to the filesystem every time a file changes which can be a lot. nano /etc/fstab Append to the options list like this - and save the file # <file system> <mount point> <type> <options> <dump> <pass> UUID=sample-uuid / ext4 defaults,noatime 0 1 Exit your chroot and eject the stick sync exit umount -R /mnt cryptsetup close /dev/mapper/cryptroot sync Moment of truth Verify the stick is bootable on another system at hand. Login as root. If you are using a cable verify you have a network connection. nmcli device show | grep IP4 If you need to create a wireless connection launch the Network Manager console nmtui Test your internet connection links manjaro.org If you cannot make a network connection - various Broadcom and RALink based devices comes to mind - you need to mount the stick in a chroot and install the necessary drivers and then test it again. Installing minimal GUI The best GUI for this use case is LXDE. It is based on Openbox window manager and is well known for it's stability. Xorg and drivers sudo pacman -Syu xorg-server xorg-server-common xorg-xinit xf86-video-amdgpu xf86-video-ati xf86-video-intel xf86-video-nouveau xf86-video-vesa xf86-input-libinput xf86-input-evdev LXDE LXDE can be installed using the a meta package so for this writeup it is the lxde package also adding some packages to make our life easier. sudo pacman -Syu lxde epdfview accountsservice gnome-keyring gnome-icon-theme gnome-icons-standard perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils Spicing LXDE sudo pacman -Syu lxde-wallpapers manjaro-lxde-config manjaro-lxde-desktop-settings manjor-lxde-logout-banner matcha-gtk-theme manjaro-openbox-matcha papirus-icon-theme papirus-maia-icon-theme ttf-dejavu ttf-roboto xcursor-breeze Network utilities sudo pacman -Syu netctl ifplugd iw wpa_supplicant dialog network-manager-applet networkmanager-openvpn User The reasoning creating the user lastly is the theming packages. Those packages are installed to /etc/skel and used as skeleton when creating new users. Choose a username and replace $USERNAME below with the chosen username useradd -mUG lp,network,power,sys,wheel $USERNAME Allow members of wheel group to perform administrative tasks Run visudo visudo Locate the line reading # %wheel ALL=(ALL) ALL and remove the # in the beginning of the line %wheel ALL=(ALL) ALL And press Esc Shift z z Logout from the root session exit Start X Login with the new username and launch X startx Remember to shut the system down - don't remove the stick while it is running :slight_smile:","title":"USB LXDE with persistence"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#manjaro-to-go-lxde-with-persistence","text":"This guide is different than the usual guides I write - the purpose of this is to give any of you a serious tool in case of displacement due to war, evacuation due to natural disasters, riots, ban on religious practice etc. You can also use the stick at home for your occasional secure computing - you can have a normal computer in home - and when necessary you can boot the stick - do what you need to do, e.g. keeping it up-to-date - shut it down and hide it for what ever prying eyes - governments, gangs, rebels, thieves - may force their way into your home. With escalating instability of the world around us - the escalating impact human actions has on our environment - the ever increasing possibilities of having to evacuate - many of us have emergency kits - sleeping bags, food supplies and water - ready to go - we sometimes forget our most vital belongings - the documents that defines us, our origin, our marriage, our children, photos of our relatives, photos of our passports, electronic copies of birth- and marriage certificates, our real-estate documents, proof of ownership for various items we carry - these invaluable documents we don't want others to get their hands on. Many of us values the Bible over everything and would want to have a copy - even an electronic copy - with us. We can't rely on having a computer with us if we need to evacuate but we can rely on - should the need rise - that we can get access to a computer. But we cannot trust others with the stick - they could just copy the documents off the stick - we cannot trust a computer we have not booted to be clean - no keylogger, malware - we cannot trust it to be able to decrypt our data. The Xorg set of display drivers works with recent hardware - but due to the fast development of graphics hardware and though I expect it to work - obviously I cannot make any guarantee. So this is - in my opinion - the ultimate guide to have a Linux in your pocket - an encrypted Linux - for storage of your personal documents.","title":"Manjaro-To-Go LXDE with persistence"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#what-is-this-about","text":"I will demonstrate how to create a portable encrypted system using an USB device and the most minimal graphical environment possible using Manjaro.","title":"What is this about"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#caution","text":"You will be doing the following as root so in case of device names - do double check your devices. IMPORTANT : Never just unplug your device - you will damage the filesystem. If plugged into another operating system use the system file manager's eject method or ensure device data has been sync'd using the sync command. Then use umount to safely remove the device. DISCLAIMER : I take no responsibility if you wreck something because you are to quick on the Enter key.","title":"CAUTION"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#let-us-begin","text":"","title":"Let us begin"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#change-user","text":"Open a terminal and login as root. $ su -l root Password:","title":"Change user"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#locating-your-device","text":"Through the rest of this article - I will be using a device path of /dev/sdy - replace with your actual device. You can verify which device you are using by removing all USB flash devices. Insert the device you want to use and list your devices. You can recognize the removable device by the number 1 in the RM column.","title":"Locating your device"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#prepare-the-device","text":"We will be using an unencrypted boot partition, so we cannot hide the presence of a Linux system on the device and where it is. Before we do anything we will fill the device using a random pattern. The benefit is that encrypted data cannot be distinguished from the rest of the device. Start by unmounting your device - using force if necessary. umount -f /dev/sdy Wipe the device (double check device path) using a random pattern. dd if=/dev/urandom of=/dev/sdy bs=4M status=progress","title":"Prepare the device"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#partitions","text":"You can use stick of your choice - you have to adjust the partition sizes accordingly. For this article I am using a 64G SanDisk Extreme. To be able to exchange unencrypted data without having to boot the USB we will create a partition of 16G. To maximize compatibility we use exFAT which will be readable by most systems. The intention is to create a hybrid USB capable of booting from a BIOS system as well as an EFI system so we need a special BIOS partition as well.","title":"Partitions"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-guid-partition-table","text":"sgdisk --mbrtogpt /dev/sdy","title":"Create GUID partition table"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-the-bios-boot-partition","text":"sgdisk --new 1::+1M --typecode 1:ef02 --change-name 1:\"BIOS boot partition\" /dev/sdy","title":"Create the bios boot partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-the-efi-system-partition","text":"sgdisk --new 2::+50M --typecode 2:ef00 --change-name 2:\"EFI System\" /dev/sdy","title":"Create the EFI system partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-the-data-partition","text":"sgdisk --new 3::+16G --typecode 3:0700 --change-name 3:\"Microsoft basic data\" /dev/sdy","title":"Create the data partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-grub-boot-partition","text":"sgdisk --new 4::+1G --typecode 4:8300 --change-name 4:\"Linux filesystem\" /dev/sdy","title":"Create grub boot partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-root-partition","text":"sgdisk --new 5::: --typecode 5:8300 --change-name 5:\"Linux filesystem\" /dev/sdy","title":"Create root partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-hybrid-mbr","text":"Arch Linux documentation sgdisk --hybrid 1:2:3 /dev/sdy","title":"Create hybrid MBR"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#boot-flag-for-data-partition","text":"sgdisk --attributes 3:set:2 /dev/sdy","title":"Boot flag for data partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#clean-bios-partition","text":"wipefs -af /dev/sdy1","title":"Clean BIOS partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#clean-and-format-efi-partition","text":"wipefs -af /dev/sdy2 FAT32 mkfs.vfat -vF32 /dev/sdy2","title":"Clean and format EFI partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#clean-and-format-data-partition","text":"wipefs -af /dev/sdy3 exFAT mkfs.exfat /dev/sdy3","title":"Clean and format data partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#clean-and-format-grub-boot-partition","text":"wipefs -af /dev/sdy4 ext2 mkfs.ext2 /dev/sdy4","title":"Clean and format grub boot partition"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-luks-container","text":"The larger --iter-time argument used will create a stronger resistance against brute-force but takes longer to decrypt. Example 1 bash cryptsetup --verbose --hash sha256 --iter-time 2000 --use-random luksFormat /dev/sdy5 Example 2 bash cryptsetup --verbose --hash sha512 --iter-time 5000 --use-random luksFormat /dev/sdy5 Confirm and enter passphrase twice and unlock the container (longer password - better encryption) cryptsetup open --type luks /dev/sdy5 cryptroot Create an ext4 file system in the container mkfs.ext4 /dev/mapper/cryptroot","title":"Create LUKS container"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#mounting","text":"Mount root mount /dev/mapper/cryptroot /mnt Create the /boot folder mkdir /mnt/boot Mount the grub boot partition mount /dev/sdy4 /mnt/boot Create the /boot/efi folder mkdir /mnt/boot/efi And mount the EFI partition mount /dev/sdy2 /mnt/boot/efi Finally create a folder for the data partition mkdir /mnt/data And mount the data partition mount /dev/sdy3 /mnt/data","title":"Mounting"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#base-installation","text":"Replace $LINUX with the kernel of your choice. e.g. linux58 - linux-latest or linux-lts basestrap /mnt base sudo networkmanager $LINUX links nano vim grub mkinitcpio bash-completion broadcom-wl ipw2100-fw","title":"Base installation"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#configure-system","text":"","title":"Configure system"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#create-fstab","text":"fstabgen -U /mnt >> /mnt/etc/fstab Verify the generated fstab has the expected content - remove references to devices which is not your USB /dev/sdy (e.g. the host systems swap - is often added).","title":"Create fstab"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#chroot","text":"manjaro-chroot /mnt /bin/bash","title":"Chroot"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#console-keyboard","text":"Example for Denmark echo LANG=dk > /etc/vconsole.conf","title":"Console keyboard"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#hostname","text":"echo manjaro > /etc/hostname","title":"Hostname"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#edit-etchosts","text":"nano /etc/hosts 127.0.0.1 localhost ::1 localhost 127.0.1.1 manjaro.localdomain manjaro","title":"Edit /etc/hosts"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#timezone","text":"Example for Denmark ln -sf /usr/share/zoneinfo/Europe/Copenhagen /etc/localtime hwclock --systohc","title":"Timezone"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#network-manager","text":"Enable network connection systemctl enable NetworkManager","title":"Network Manager"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#enable-ntp-client","text":"systemctl enable systemd-timesyncd","title":"Enable ntp client"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#locale","text":"Locale example for Danish locale uncomment en_DK.UTF-8 and en_US.UTF-8 Save file and generate the message table nano /etc/locale.gen locale-gen","title":"Locale"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#etclocaleconf","text":"Locale.conf example for Denmark echo LANG=en_DK.UTF-8 > /etc/locale.conf","title":"/etc/locale.conf"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#root-password","text":"This is important - if you don't set it you will not be able to login as root - so the other option is to create a user with admin before rebooting. Pick a good password and do not reuse your luks key passwd","title":"Root password"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#etcmkinitcpioconf","text":"Add encrypt and block - the order is important - then save the changes ```bash","title":"/etc/mkinitcpio.conf"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#nano-etcmkinitcpioconf","text":"text HOOKS=\"base udev encrypt block keyboard autodetect modconf filesystems fsck\" ``` -- https://wiki.archlinux.org/index.php/Mkinitcpio#Common_hooks","title":"nano /etc/mkinitcpio.conf"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#build-initramfs","text":"mkinitcpio -P","title":"Build initramfs"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#install-grub","text":"EFI grub-install --target=x86_64-efi --boot-directory=/boot --efi-directory=/boot/efi --removable --recheck BIOS grub-install --force --target=i386-pc --recheck --boot-directory=/boot /dev/sdy Fallback grub-install --force --target=i386-pc --boot-directory=/boot --recheck /dev/sdy3","title":"Install grub"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#edit-grub-default","text":"We could use the device naming but in systemd world this naming may not always be the same - not guaranteed to be identical on every boot - so it is highly recommended to use UUID. To the UUID of the sdy5 partition holding the cryptroot we use lsblk and define the output to be NAME,UUID. lsblk -o NAME,UUID /dev/sdy5 You will get two UUIDs - the first being the physical partion - the second the cryptroot partition - and it is the UUID of the physical partition we need for grub. ```","title":"Edit grub default"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#nano-etcdefaultgrub","text":"GRUB_CMDLINE_LINUX=\"cryptdevice=UUID=xxxx-yyy-zzzz:cryptroot\" ``` Save the file and create grub config grub-mkconfig -o /boot/grub/grub.cfg","title":"nano /etc/default/grub"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#usb-specific-considerations","text":"Because we are using USB we know repeating writes is not healthy in the long run. Switch journal configuration to use RAM and ensure the journal is not filling up the RAM. nano /etc/systemd/journald.conf Modify to include this and save the file Storage=volatile SystemMaxUse=16M Edit your fstab and edit the options to include the noatime option. This will prevent writing to the filesystem every time a file changes which can be a lot. nano /etc/fstab Append to the options list like this - and save the file # <file system> <mount point> <type> <options> <dump> <pass> UUID=sample-uuid / ext4 defaults,noatime 0 1","title":"USB specific considerations"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#exit-your-chroot-and-eject-the-stick","text":"sync exit umount -R /mnt cryptsetup close /dev/mapper/cryptroot sync","title":"Exit your chroot and eject the stick"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#moment-of-truth","text":"Verify the stick is bootable on another system at hand. Login as root. If you are using a cable verify you have a network connection. nmcli device show | grep IP4 If you need to create a wireless connection launch the Network Manager console nmtui Test your internet connection links manjaro.org If you cannot make a network connection - various Broadcom and RALink based devices comes to mind - you need to mount the stick in a chroot and install the necessary drivers and then test it again.","title":"Moment of truth"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#installing-minimal-gui","text":"The best GUI for this use case is LXDE. It is based on Openbox window manager and is well known for it's stability.","title":"Installing minimal GUI"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#xorg-and-drivers","text":"sudo pacman -Syu xorg-server xorg-server-common xorg-xinit xf86-video-amdgpu xf86-video-ati xf86-video-intel xf86-video-nouveau xf86-video-vesa xf86-input-libinput xf86-input-evdev","title":"Xorg and drivers"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#lxde","text":"LXDE can be installed using the a meta package so for this writeup it is the lxde package also adding some packages to make our life easier. sudo pacman -Syu lxde epdfview accountsservice gnome-keyring gnome-icon-theme gnome-icons-standard perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils","title":"LXDE"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#spicing-lxde","text":"sudo pacman -Syu lxde-wallpapers manjaro-lxde-config manjaro-lxde-desktop-settings manjor-lxde-logout-banner matcha-gtk-theme manjaro-openbox-matcha papirus-icon-theme papirus-maia-icon-theme ttf-dejavu ttf-roboto xcursor-breeze","title":"Spicing LXDE"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#network-utilities","text":"sudo pacman -Syu netctl ifplugd iw wpa_supplicant dialog network-manager-applet networkmanager-openvpn","title":"Network utilities"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#user","text":"The reasoning creating the user lastly is the theming packages. Those packages are installed to /etc/skel and used as skeleton when creating new users. Choose a username and replace $USERNAME below with the chosen username useradd -mUG lp,network,power,sys,wheel $USERNAME Allow members of wheel group to perform administrative tasks Run visudo visudo Locate the line reading # %wheel ALL=(ALL) ALL and remove the # in the beginning of the line %wheel ALL=(ALL) ALL And press Esc Shift z z Logout from the root session exit","title":"User"},{"location":"manjaro/installation/manjaro-usb-to-go-with-persistience/#start-x","text":"Login with the new username and launch X startx Remember to shut the system down - don't remove the stick while it is running :slight_smile:","title":"Start X"},{"location":"manjaro/luks/luks-change-phrase/","text":"Locate key slot Assuming the partition holding the luks volume is /dev/sda2 As you may have more than one slot active - locate the one for the passphrase cryptsetup open --type=luks --test-passphrase -vv /dev/sda No usable token is available. Enter passphrase for /dev/sda2: Key slot 1 unlocked. Command successful. Add new key slot In this case the slot is number 1 so add a new key cryptsetup luksAddKey /dev/sda2 Wipe previous key slot Then wipe the slot for the previous phrase (slot returned from the check) - enter the new passphrase when challenged cryptsetup luksKillSlot /dev/sda2 1","title":"Changing LUKS passphrase"},{"location":"manjaro/luks/luks-change-phrase/#locate-key-slot","text":"Assuming the partition holding the luks volume is /dev/sda2 As you may have more than one slot active - locate the one for the passphrase cryptsetup open --type=luks --test-passphrase -vv /dev/sda No usable token is available. Enter passphrase for /dev/sda2: Key slot 1 unlocked. Command successful.","title":"Locate key slot"},{"location":"manjaro/luks/luks-change-phrase/#add-new-key-slot","text":"In this case the slot is number 1 so add a new key cryptsetup luksAddKey /dev/sda2","title":"Add new key slot"},{"location":"manjaro/luks/luks-change-phrase/#wipe-previous-key-slot","text":"Then wipe the slot for the previous phrase (slot returned from the check) - enter the new passphrase when challenged cryptsetup luksKillSlot /dev/sda2 1","title":"Wipe previous key slot"},{"location":"manjaro/luks/luks-dm-crypt-notes/","text":"Error message WARNING: keyslots area (998400 bytes) is very small, available LUKS2 keyslot count is very limited. Check your partion - remove partition and increase the size. Error message Cannot wipe header on device /dev/disk/by-partlabel/cryptsystem. The device may be readonly. Execute as root blockdev --getro <device> Return 1 if read-only - 0 when read-write","title":"dm-crypt notes"},{"location":"manjaro/luks/luks-dm-crypt-notes/#error-message","text":"WARNING: keyslots area (998400 bytes) is very small, available LUKS2 keyslot count is very limited. Check your partion - remove partition and increase the size.","title":"Error message"},{"location":"manjaro/luks/luks-dm-crypt-notes/#error-message_1","text":"Cannot wipe header on device /dev/disk/by-partlabel/cryptsystem. The device may be readonly. Execute as root blockdev --getro <device> Return 1 if read-only - 0 when read-write","title":"Error message"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/","text":"linux-aarhus | 2022-07-24 14:11:34 UTC | Source: About Manjaro and AUR Manjaro and AUR This is a superficial review of elements of Linux history spiced with some personal memories and my experience with Arch Linux and Manjaro. A followup on previous topics https://forum.manjaro.org/t/aur-please-restrain-yourself/103318 https://forum.manjaro.org/t/responsible-use-of-aur/86392 TL:DR custom packages - unsupported - you are on your own! History part I The GNU/Linux history lesson is far more than this lesson. This document cannot possibly contain all aspects so only the points I think were necessary to describe the relationship between Manjaro and AUR. To understand this relationship one need to understand the historical aspects on Linux, source code and distributing binary code. Applications cannot interact with CPU, RAM and GPU on it own. They all depend on a layer and that layer is the kernel - in the context of this document the kernel initially created by Linus Torvalds - commonly known as Linux. The kernel is a collection of services provided in a manner which makes it possible for an application to interaction with the hardware. If you look at Linux From Scratch and Gentoo you will see they are not distributions of binaries but a collection of books describing how to create your operating system from source code. On the get-started page of the Gentoo web it is expressed as The Gentoo Handbook provides detailed documentation that guides you through the installation process. There is no installation program\u2014you're the installer. That way, you can apply all the customizations you desire. So - in the beginning there was only source code. You would need to have access to another computer system on which to build the kernel. Before you could do that you would have to, either acquire the source in some form or type it in manually, compile the source to binaries, transfer the binaries to a target system and run it. If you had a bright idea - e.g. the curl utility - you would share source with the community. They would then acquire the code, compile it to binary form and run it on their system. A very rough description of the process is something like this curl -O <url/source.tar.gz> tar -xcf source.tar.gz cd sourcedir ./configure make sudo make install To compile your Linux from source is a tedious, time consuming task - just try it - and this is where distributions are born. History part II Then what about distributions? Distributions are groups of individuals or companies which have the power to build a large amount source code into binary form and distribute this as turnkey solutions. There was Slackware and Red Hat - I specifically remember Red Hat because my younger brother was seriously into Linux before me. SUSE Linux, Slackware and Red Hat were among the first to distribute binary code with SUSE being one of the first commercial distributors of GNU/Linux binary packages. I have very fond memories of SUSE as this is the distribution where I entered the Linux world around 1998. Four years later (not me) 2002 Arch Linux, then 2011 Manjaro. Arch got an undeserved reputation of being inaccessible. I dare say - it is not inaccessible. Imagine a Raspberry PI. It is open source - the schematics are available - you can buy all the components from some well assorted electronics supplier. If you are up to the challenge you buy all the components for the PI and begin putting it together. At the same electronics supplier you can get a ready-to-run PI or one of the multiple variations. Using an unjust comparison - Arch Linux the components making up the PI - you just have to put them together - but doing so requires knowledge and hard work. This is where you choose Orange Pi, Banana Pi or something else. Where am I going you think - well - a single board computer is a single board computer - right? Yes - and no - even originated in the same idea, being single boarded and working identically, sharing components - they are different. What is it with AUR? To put it short - AUR is Recipes for adding CUSTOM packages The name speaks for itself. A.U.R is Arch User Repository - the point being the emphasis on Arch. Using AUR also implies Arch stable branch - which is only achievable by using Manjaro unstable or testing branch. As Manjaro is based on Arch Linux one would think - they are the same - and that is where one would go wrong. Manjaro and Arch do not share kernels, a subtle but very important difference. Both Manjaro and Arch uses a branch structure (slightly different naming) and builds from the same source at kernel.org and this is where the similarity ends. Manjaro maintains a larger number of kernels which uses a slightly different patch-set. You can enlighten yourself on the details on Manjaro gitlab . Because of this difference certain proprietary drivers which must match the released kernels are different than with Arch. Some Manjaro applications have been back-ported and is available in AUR - most notably the Pamac Package manager - just search in AUR for pamac. The AUR maintainer of pamac - is not the developer but a third party - so when the developer pushes new changes - bug fixes, new functionality - anything - the AUR maintainer has to work out if those changes will work on Arch or other Arch based systems. The same happens the other way around. When one look at the set of build instructions on AUR one need to consider the build instructions are for Arch the resulting package is for Arch what files are the script downloading is it source files or binary files is the binary files safe does the instructions work for Manjaro does the build make assumptions only satisfied on Arch (e.g. glibc version) Being able to find an answer one needs knowledge. Not only on the build process but also knowledge of bash scripting, environment variables, compiling source to binary but knowledge on what actually happens during execution of the build script - which files are replaced, placed where and why. Because a CUSTOM package build using a script found on AUR has the potential to completely wreck a healthy and well running system AUR has always carried the warning DISCLAIMER: AUR packages are user produced content. Any use of the provided files is at your own risk. Why the need of responsibility? Because CUSTOM packages has the potential to wreck your system - they are unsupported. It is not that some scripts are supported and others not. They are unsupported because they add/alter/replace system files and as such they can generate issues which otherwise would not have occurred on a pristine Manjaro installation. When you sync your system any CUSTOM package may cease to function without warning OR your system may cease to function due to a CUSTOM package - therefore one must remove all CUSTOM packages before an issue can be validated as related to Manjaro. If apply system wide changes to your Manjaro system using an unsupported source build script and subsequently the system breaks after an update - you must assume that your changes caused it - you cannot imply it is an upstream problem. Always bring your own house in order - then you seek help. I have AUR packages in my system, but i don't recall having installed them. Once in a while, package maintainers, both at Arch and Manjaro, clean up the repositories from packages considered \"deprecated\", \"unused\", \"outdated\", etc. Such packages, when removed from Arch repositories -- and then consequentially from Manjaro repositories -- are usually moved to AUR. Meanwhile, such packages previously available in Manjaro repositories but not in Arch's, are usually available in AUR to begin with. If you find such packages in your system, you can check if they are either still used (directly), needed (as dependencies), or required (as dependencies of a used package). Depending on the output, you may or may not want to remove them. pactree <package> Applying CUSTOM packages Like Orange PI is not Raspberry PI - Manjaro is not Arch. You should therefore carefully consider the impact on your system now and future. Is this necessary for my workflow Remove unused packages How is it affecting mys system The native method to create packages is by means of PKGBUILD script. This also goes for apps or services not available in the repositories. You write your own PKGBUILD script and learning to so is the best way to understand what AUR is. To avoid duplicating each others work PKGBUILDs are stored in a central location - the AUR. This storage also make a PKGBUILD easier to keep updated when it is use by many people - therefore the vote system - which to the Arch Community serves as a pointer to a potential inclusion in the official community repository. Any passing stranger can register an account and create a PKGBUILD which conforms to the guidelines which is why the following is the initial method to make use of such unverified script from a complete stranger. Ensure the system is up-to-date and the necessary tools are available $ sudo pacman -Syu $ sudo pacman -S git base-devel --needed $ git clone <aur/pkg.git> $ cd pkg Inspect the source files to verify dependencies, sources, build dependencies. When you are confident this is OK you can proceed to build the package. $ makepkg Resolve build error or missing dependencies if any and install the package $ sudo pacman -U pkg-ver.pkg.tar.xz For a deeper look into possible build issues - read https://forum.manjaro.org/t/howto-fix-a-failing-aur-package-build/104668. AUR helpers Many CUSTOM scripts exist for various reasons e.g. the content they provide are proprietary the content is not widely use drivers for devices commonly used by Windows systems deprecated tools e.g. older versions of python Some has a setup where they find themselves depending on several binary packages not readily available or because a build script has dependencies which is not readily available. This creates a repetitive task of iterating over the packages - and if there is something a hardcore computer user hates - it is repetitive tasks. They must be scripted. So a new kind of scripting or application was born - the AUR helpers. AUR helpers is the kind of tool I would never expect to find in the Arch Linux repositories because an AUR helper automates CUSTOM packages . A.U.R no longer reference Arch User Repository but Automated User Response Consisting of a script/application Which executes a another set of scripts downloaded from a public source The downloaded material is defined by one or more complete strangers The helper abstracts verification The helper executes the script The script fetches sources from third party locations The script executes a series of actions on your personal computer system Which may alter critical system components like kernel or device drivers Result Worst case scenario A completely random example: On the next update various system components are updated such as xorg or wayland and because one of the your CUSTOM packages is now incompatible with the system - the system refuses to start - no display manager starts. You have read about the error LightDM display manager failed to start or SDDM display manager failed to start . Who are you blaming? You are blaming the update - where in reality - you should blame your own lack of knowledge or perhaps you just forgot that CUSTOM package which is now dysfunctional and breaks your system. What should be learned? Exercise due diligence Know your system Know possible weaknesses Remember your CUSTOM packages Manjaro provides and excellent package helper which is capable of handling various methods of distributing an application - and it can build from CUSTOM scripts . Although this is indeed a Manjaro feature CUSTOM packages and the Manjaro package manager Pamac makes it possible build from CUSTOM scripts - it is still your system - thus CUSTOM packages your responsibility . License Manjaro is a GNU/Linux which is based on GNU Public License or GPL Disclaimer of Warranty. THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM \u201cAS IS\u201d WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION. Limitation of Liability. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. Interpretation of Sections 15 and 16. If the disclaimer of warranty and limitation of liability provided above cannot be given local legal effect according to their terms, reviewing courts shall apply local law that most closely approximates an absolute waiver of all civil liability in connection with the Program, unless a warranty or assumption of liability accompanies a copy of the Program in return for a fee. -- Free Software Foundation - GNU Public License (GPL) Disclaimer Disclaimer No warranties, either express or implied, are hereby given for anything provided by Manjaro Linux (\u201cSoftware\u201d). All Software is supplied without any accompanying guarantee, whether expressly mentioned, implied or tacitly assumed. This information does not include any guarantees regarding quality, does not describe any fair marketable quality, and does not make any claims as to quality guarantees or guarantees regarding the suitability for a special purpose. The user assumes all responsibility for damages resulting from the use of the software. -- Manjaro Web - Terms of Use","title":"About Manjaro and AUR"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#manjaro-and-aur","text":"This is a superficial review of elements of Linux history spiced with some personal memories and my experience with Arch Linux and Manjaro. A followup on previous topics https://forum.manjaro.org/t/aur-please-restrain-yourself/103318 https://forum.manjaro.org/t/responsible-use-of-aur/86392 TL:DR custom packages - unsupported - you are on your own!","title":"Manjaro and AUR"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#history-part-i","text":"The GNU/Linux history lesson is far more than this lesson. This document cannot possibly contain all aspects so only the points I think were necessary to describe the relationship between Manjaro and AUR. To understand this relationship one need to understand the historical aspects on Linux, source code and distributing binary code. Applications cannot interact with CPU, RAM and GPU on it own. They all depend on a layer and that layer is the kernel - in the context of this document the kernel initially created by Linus Torvalds - commonly known as Linux. The kernel is a collection of services provided in a manner which makes it possible for an application to interaction with the hardware. If you look at Linux From Scratch and Gentoo you will see they are not distributions of binaries but a collection of books describing how to create your operating system from source code. On the get-started page of the Gentoo web it is expressed as The Gentoo Handbook provides detailed documentation that guides you through the installation process. There is no installation program\u2014you're the installer. That way, you can apply all the customizations you desire. So - in the beginning there was only source code. You would need to have access to another computer system on which to build the kernel. Before you could do that you would have to, either acquire the source in some form or type it in manually, compile the source to binaries, transfer the binaries to a target system and run it. If you had a bright idea - e.g. the curl utility - you would share source with the community. They would then acquire the code, compile it to binary form and run it on their system. A very rough description of the process is something like this curl -O <url/source.tar.gz> tar -xcf source.tar.gz cd sourcedir ./configure make sudo make install To compile your Linux from source is a tedious, time consuming task - just try it - and this is where distributions are born.","title":"History part I"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#history-part-ii","text":"","title":"History part II"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#then-what-about-distributions","text":"Distributions are groups of individuals or companies which have the power to build a large amount source code into binary form and distribute this as turnkey solutions. There was Slackware and Red Hat - I specifically remember Red Hat because my younger brother was seriously into Linux before me. SUSE Linux, Slackware and Red Hat were among the first to distribute binary code with SUSE being one of the first commercial distributors of GNU/Linux binary packages. I have very fond memories of SUSE as this is the distribution where I entered the Linux world around 1998. Four years later (not me) 2002 Arch Linux, then 2011 Manjaro. Arch got an undeserved reputation of being inaccessible. I dare say - it is not inaccessible. Imagine a Raspberry PI. It is open source - the schematics are available - you can buy all the components from some well assorted electronics supplier. If you are up to the challenge you buy all the components for the PI and begin putting it together. At the same electronics supplier you can get a ready-to-run PI or one of the multiple variations. Using an unjust comparison - Arch Linux the components making up the PI - you just have to put them together - but doing so requires knowledge and hard work. This is where you choose Orange Pi, Banana Pi or something else. Where am I going you think - well - a single board computer is a single board computer - right? Yes - and no - even originated in the same idea, being single boarded and working identically, sharing components - they are different.","title":"Then what about distributions?"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#what-is-it-with-aur","text":"To put it short - AUR is Recipes for adding CUSTOM packages The name speaks for itself. A.U.R is Arch User Repository - the point being the emphasis on Arch. Using AUR also implies Arch stable branch - which is only achievable by using Manjaro unstable or testing branch. As Manjaro is based on Arch Linux one would think - they are the same - and that is where one would go wrong. Manjaro and Arch do not share kernels, a subtle but very important difference. Both Manjaro and Arch uses a branch structure (slightly different naming) and builds from the same source at kernel.org and this is where the similarity ends. Manjaro maintains a larger number of kernels which uses a slightly different patch-set. You can enlighten yourself on the details on Manjaro gitlab . Because of this difference certain proprietary drivers which must match the released kernels are different than with Arch. Some Manjaro applications have been back-ported and is available in AUR - most notably the Pamac Package manager - just search in AUR for pamac. The AUR maintainer of pamac - is not the developer but a third party - so when the developer pushes new changes - bug fixes, new functionality - anything - the AUR maintainer has to work out if those changes will work on Arch or other Arch based systems. The same happens the other way around. When one look at the set of build instructions on AUR one need to consider the build instructions are for Arch the resulting package is for Arch what files are the script downloading is it source files or binary files is the binary files safe does the instructions work for Manjaro does the build make assumptions only satisfied on Arch (e.g. glibc version) Being able to find an answer one needs knowledge. Not only on the build process but also knowledge of bash scripting, environment variables, compiling source to binary but knowledge on what actually happens during execution of the build script - which files are replaced, placed where and why. Because a CUSTOM package build using a script found on AUR has the potential to completely wreck a healthy and well running system AUR has always carried the warning DISCLAIMER: AUR packages are user produced content. Any use of the provided files is at your own risk.","title":"What is it with AUR?"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#why-the-need-of-responsibility","text":"Because CUSTOM packages has the potential to wreck your system - they are unsupported. It is not that some scripts are supported and others not. They are unsupported because they add/alter/replace system files and as such they can generate issues which otherwise would not have occurred on a pristine Manjaro installation. When you sync your system any CUSTOM package may cease to function without warning OR your system may cease to function due to a CUSTOM package - therefore one must remove all CUSTOM packages before an issue can be validated as related to Manjaro. If apply system wide changes to your Manjaro system using an unsupported source build script and subsequently the system breaks after an update - you must assume that your changes caused it - you cannot imply it is an upstream problem. Always bring your own house in order - then you seek help.","title":"Why the need of responsibility?"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#i-have-aur-packages-in-my-system-but-i-dont-recall-having-installed-them","text":"Once in a while, package maintainers, both at Arch and Manjaro, clean up the repositories from packages considered \"deprecated\", \"unused\", \"outdated\", etc. Such packages, when removed from Arch repositories -- and then consequentially from Manjaro repositories -- are usually moved to AUR. Meanwhile, such packages previously available in Manjaro repositories but not in Arch's, are usually available in AUR to begin with. If you find such packages in your system, you can check if they are either still used (directly), needed (as dependencies), or required (as dependencies of a used package). Depending on the output, you may or may not want to remove them. pactree <package>","title":"I have AUR packages in my system, but i don't recall having installed them."},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#applying-custom-packages","text":"Like Orange PI is not Raspberry PI - Manjaro is not Arch. You should therefore carefully consider the impact on your system now and future. Is this necessary for my workflow Remove unused packages How is it affecting mys system The native method to create packages is by means of PKGBUILD script. This also goes for apps or services not available in the repositories. You write your own PKGBUILD script and learning to so is the best way to understand what AUR is. To avoid duplicating each others work PKGBUILDs are stored in a central location - the AUR. This storage also make a PKGBUILD easier to keep updated when it is use by many people - therefore the vote system - which to the Arch Community serves as a pointer to a potential inclusion in the official community repository. Any passing stranger can register an account and create a PKGBUILD which conforms to the guidelines which is why the following is the initial method to make use of such unverified script from a complete stranger. Ensure the system is up-to-date and the necessary tools are available $ sudo pacman -Syu $ sudo pacman -S git base-devel --needed $ git clone <aur/pkg.git> $ cd pkg Inspect the source files to verify dependencies, sources, build dependencies. When you are confident this is OK you can proceed to build the package. $ makepkg Resolve build error or missing dependencies if any and install the package $ sudo pacman -U pkg-ver.pkg.tar.xz For a deeper look into possible build issues - read https://forum.manjaro.org/t/howto-fix-a-failing-aur-package-build/104668.","title":"Applying CUSTOM packages"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#aur-helpers","text":"Many CUSTOM scripts exist for various reasons e.g. the content they provide are proprietary the content is not widely use drivers for devices commonly used by Windows systems deprecated tools e.g. older versions of python Some has a setup where they find themselves depending on several binary packages not readily available or because a build script has dependencies which is not readily available. This creates a repetitive task of iterating over the packages - and if there is something a hardcore computer user hates - it is repetitive tasks. They must be scripted. So a new kind of scripting or application was born - the AUR helpers. AUR helpers is the kind of tool I would never expect to find in the Arch Linux repositories because an AUR helper automates CUSTOM packages . A.U.R no longer reference Arch User Repository but Automated User Response Consisting of a script/application Which executes a another set of scripts downloaded from a public source The downloaded material is defined by one or more complete strangers The helper abstracts verification The helper executes the script The script fetches sources from third party locations The script executes a series of actions on your personal computer system Which may alter critical system components like kernel or device drivers","title":"AUR helpers"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#result","text":"","title":"Result"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#worst-case-scenario","text":"A completely random example: On the next update various system components are updated such as xorg or wayland and because one of the your CUSTOM packages is now incompatible with the system - the system refuses to start - no display manager starts. You have read about the error LightDM display manager failed to start or SDDM display manager failed to start .","title":"Worst case scenario"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#who-are-you-blaming","text":"You are blaming the update - where in reality - you should blame your own lack of knowledge or perhaps you just forgot that CUSTOM package which is now dysfunctional and breaks your system.","title":"Who are you blaming?"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#what-should-be-learned","text":"Exercise due diligence Know your system Know possible weaknesses Remember your CUSTOM packages Manjaro provides and excellent package helper which is capable of handling various methods of distributing an application - and it can build from CUSTOM scripts . Although this is indeed a Manjaro feature CUSTOM packages and the Manjaro package manager Pamac makes it possible build from CUSTOM scripts - it is still your system - thus CUSTOM packages your responsibility .","title":"What should be learned?"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#license","text":"Manjaro is a GNU/Linux which is based on GNU Public License or GPL Disclaimer of Warranty. THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM \u201cAS IS\u201d WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION. Limitation of Liability. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. Interpretation of Sections 15 and 16. If the disclaimer of warranty and limitation of liability provided above cannot be given local legal effect according to their terms, reviewing courts shall apply local law that most closely approximates an absolute waiver of all civil liability in connection with the Program, unless a warranty or assumption of liability accompanies a copy of the Program in return for a fee. -- Free Software Foundation - GNU Public License (GPL)","title":"License"},{"location":"manjaro/maintenance/manjaro-maintenance-00-about-manjaro-and-aur/#disclaimer","text":"Disclaimer No warranties, either express or implied, are hereby given for anything provided by Manjaro Linux (\u201cSoftware\u201d). All Software is supplied without any accompanying guarantee, whether expressly mentioned, implied or tacitly assumed. This information does not include any guarantees regarding quality, does not describe any fair marketable quality, and does not make any claims as to quality guarantees or guarantees regarding the suitability for a special purpose. The user assumes all responsibility for damages resulting from the use of the software. -- Manjaro Web - Terms of Use","title":"Disclaimer"},{"location":"manjaro/maintenance/manjaro-maintenance-01-i-am-not-to-blame/","text":"linux-aarhus | 2020-10-09 15:24:53 UTC | Source: What is wrong - I am not to blame When you're updating your system and you have an issue with any installed package installed - your immediate thought is - the update is at Manjaro fault. No - it is not - you are While Manjaro provides the updates the result is yours. You may think - I am safe using the updates provided. No - you are not - whatever packages installed using AUR may need to be reinstalled - other packages may not be compatible with your installation. Yes you can install a lot of packages which in various ways will interfere with your update but that is not to be blamed on Manjaro. Comment on comment Why is this an announcement? This seems condescending at best and flamebait at worst. -- lectrode There is no ill intentions what so ever - but seeming I have touched a nerve - but the intention - putting this in the announcement section is to draw attention to and to emphasize the point and The point being: There is so many combinations possible - hardware and software - and you really need to understand - while Manjaro provides the system and as such also updates it is impossible to cover every single system combo there is no guarantee every possible combo will work With the increasing popularity of Manjaro - there is an increasing tendency to expect that any changes made to the system will not be become affected by updates and this expectation is fundamentally wrong. Every possible system will deviate on almost every aspect when compared to the systems used by the Manjaro team thus making it next to impossible to create the perfect system and every Manjaro user must have a basic understanding of Linux - especially how the Arch based Linux works. Comment on comment That being said, you all desperately need to hire someone to handle your public relations. Some of your posts come off so \u201cuser hostile\u201d. I\u2019m not sure why you chose to take this tone with the community that is supporting your work. You could have easily said all of this in a much more palatable manner. -- Jojo_phet You may be right - my apology - I am not very good at PR - what I am good at is system maintenance and coding. The initial target is not the member's of the community - it is targeted those - with an attitude - those demanding solutions and casting blame - those are the target - not you - not the member on a learning path. The intention with this is to raise awareness - to make new members self-aware - aware of the possibility that some system combinations which used to work - may cease to work and when this happens - it is not the fault of Manjaro - but could as well be the combination of factors. Manjaro is a spare time project - a very successful project - but that doesn't change the fact that it is still only backed by a few people in their spare time and users new to the Linux ecosystem tend to forget that if something is easy - it is because some other user has put a tremendous amount of time into making it easy . What I refer to as basics is basic Linux knowledge. Linux is not Windows - and you cannot apply the logic from Windows onto your Linux. We had a short article in the FAQ section on the archived forum https://archived.forum.manjaro.org/t/linux-windows-why-should-linux-want-me/126641 The following statement is true Manjaro is suitable for both newcomers and experienced computer users. - https://manjaro.org/ There has been comparison with vehicles and this is a good comparison - because you choose vehicle - according to the use case - maybe even the terrain you are in. While you can expect your Tesla or your Rolls Royce to be flawless - it is simply because you have paid a lot of money for it. When you buy a new vehicle you don't start by customizing the look - rearranging the intererior - moving the seats around - removing doors or moving them around because you want the hinges on the other side or you want that rear door to open the other way - just because you heard it was possible. You start using the vehicle for the purpose it is intended. You don't try to change it into something it is not - you have realistic expectations to what it is capable of - because you research before you made the investment. Unlike proprietary operating systems, you have full control over your hardware, without restrictions. This makes it ideal for people who want to learn how Linux works and how it is different to other operating systems. From this perspective, it is also suitable for beginners similar to the way an Arduino is an excellent entry-point to embedded hardware development. - https://manjaro.org/ Putting this perspective onto Linux - you have not paid a dime. But most immediately begin to rearrange the interior. Experimenting with different kinds of software - all with out having any basic knowledge. When you buy a system with Manjaro pre-installed you are entitled to higher expectation as the Manjaro system may have been tuned and adjusted for this specific hardware. But if you alter the parameters - and you will - it is inevitable - situations will come where you need to backtrace what may cause this issue to rise as Manjaro cannot take into account all those small changes which one on its own is nothing but a 100 is not. Manjaro - any Linux system - with Nvidia Optimus graphics is in the mercy of the vendor. Linux world is doing a good job in adjusting and trying to keep up but you can never point at Manjaro and say - you are at fault here - simply because for the 100 hardware identical laptops - there will be a 100 configurations as every user is different. Even though the laptops are identical - the hardware components are not. They may be from different batches - some basic electronic components may even be from different vendors depending on the current price. In combination with the any given user preference - this makes it impossible to guarantee that any given combination of user/software/hardware will ever work flawless.","title":"What is wrong - I am not to blame"},{"location":"manjaro/maintenance/manjaro-maintenance-02-responsible-use-of-aur/","text":"linux-aarhus | 2021-10-16 11:26:19 UTC | Source: Responsible use of AUR Be responsible in using the AUR :warning: Remember, the AUR is neither officially supported by Arch nor by Manjaro. Using it is at your own risk and your own responsibility. The AUR ( Arch User Repository ) is like a public library run by volunteers. The books are contributed by the readers and as such we respect both the volunteers and our fellow readers contributing their books for us to read. We all need to be responsible in our use of this repository. We are guests allowed to use the library - so let's behave like polite guests. With the growing popularity of Arch based distributions - the AUR has become more popular that any Arch user could have ever imagined. It is difficult to educate on responsible use of a free service - just picture that you were the provider and not aurweb Development Team. While the AUR technically is just an organized collection of text files containing instructions on how to install certain software whether this is from source code or from binary packages - it contains functionality to search for keywords within package names and their description. I cannot say what the original intention were - I was not there - but as a developer and former system administrator and small time hosting provider - I can appreciate how the Archlinux users have contributed to the overall ecosystem of Manjaro. I want to appeal to you - my fellow Manjaro community members - and the anonymous Manjaro user reading this ... The in-house package manager shipped with Manjaro - Pamac - contains functionality which - when used without thinking - easily contributes to the overload of AUR - which just happened again - today [date=2021-10-14 timezone=\"Europe/Copenhagen\"]. do not enable AUR unless you strictly need it do not enable checking for updates to AUR packages do not enable checking for updates to DEV packages How useful this may be - it also constitutes a lot of useless traffic targeted the AUR search API. Some time ago the Archlinux Team has considered it necessary to throttle requests to the search api because of user scripts used in conky flooded the search api. Recently a topic was opened in Manjaro gitlab for Pamac requesting modifications to how Pamac used the search API to minimize the impact on the AUR service. The incident of today - makes it clear that the AUR web search API is overloaded and I ask of you to consider how you are contributing to the impact on the AUR web. We all benefit from the availability - so let's not abuse it.","title":"Responsible use of AUR"},{"location":"manjaro/maintenance/manjaro-maintenance-02-responsible-use-of-aur/#be-responsible-in-using-the-aur","text":":warning: Remember, the AUR is neither officially supported by Arch nor by Manjaro. Using it is at your own risk and your own responsibility. The AUR ( Arch User Repository ) is like a public library run by volunteers. The books are contributed by the readers and as such we respect both the volunteers and our fellow readers contributing their books for us to read. We all need to be responsible in our use of this repository. We are guests allowed to use the library - so let's behave like polite guests. With the growing popularity of Arch based distributions - the AUR has become more popular that any Arch user could have ever imagined. It is difficult to educate on responsible use of a free service - just picture that you were the provider and not aurweb Development Team. While the AUR technically is just an organized collection of text files containing instructions on how to install certain software whether this is from source code or from binary packages - it contains functionality to search for keywords within package names and their description. I cannot say what the original intention were - I was not there - but as a developer and former system administrator and small time hosting provider - I can appreciate how the Archlinux users have contributed to the overall ecosystem of Manjaro. I want to appeal to you - my fellow Manjaro community members - and the anonymous Manjaro user reading this ... The in-house package manager shipped with Manjaro - Pamac - contains functionality which - when used without thinking - easily contributes to the overload of AUR - which just happened again - today [date=2021-10-14 timezone=\"Europe/Copenhagen\"]. do not enable AUR unless you strictly need it do not enable checking for updates to AUR packages do not enable checking for updates to DEV packages How useful this may be - it also constitutes a lot of useless traffic targeted the AUR search API. Some time ago the Archlinux Team has considered it necessary to throttle requests to the search api because of user scripts used in conky flooded the search api. Recently a topic was opened in Manjaro gitlab for Pamac requesting modifications to how Pamac used the search API to minimize the impact on the AUR service. The incident of today - makes it clear that the AUR web search API is overloaded and I ask of you to consider how you are contributing to the impact on the AUR web. We all benefit from the availability - so let's not abuse it.","title":"Be responsible in using the AUR"},{"location":"manjaro/maintenance/manjaro-maintenance-03-aur-restrain-yourself/","text":"linux-aarhus | 2022-02-20 12:17:20 UTC | Source: AUR - please restrain yourself Responsible use of AUR With reference to an earlier thread - drifting out of hand https://forum.manjaro.org/t/responsible-use-of-aur/86392 It appears that Manjaro users are still seeing AUR as something to be used without reflection. The users of Manjaro has become a joke when it comes to AUR https://forum.endeavouros.com/t/is-aur-down-again/24287/3 Topics like below emphasizes that members of this forum does not realize that AUR scripts are unsupported. https://forum.manjaro.org/t/pamac-showing-aur-updates-but-wont-update/78775 https://forum.manjaro.org/t/aur-updates-does-not-show-up-in-pamac/44363 https://forum.manjaro.org/t/does-updating-system-with-pacman-updates-aur-packages-as-well/95282 https://forum.manjaro.org/t/pamac-doesnt-recognise-updates/102763/ https://forum.manjaro.org/t/pamac-crashes-when-checking-dependencies/102957 https://forum.manjaro.org/t/some-packages-that-i-cant-update/102867/ While AUR is a nice collection of scripts you shouldn't depend on using unsupported software . DISCLAIMER: AUR packages are user produced content. Any use of the provided files is at your own risk. - https://aur.archlinux.org/ Use the AUR at your own risk! No support will be provided by the Manjaro team for any issues that may arise relating to software installations from the AUR. When Manjaro is updated, AUR packages might stop working. This is not a Manjaro issue - https://wiki.manjaro.org/index.php/Arch_User_Repository Below quote is a topic on Arch forum which dates back 2012-10-27 From time to time the AUR, like any website, goes down. When that happens, there is a simple, three point checklist you can follow: Check that it is not just a local issue with downforeveryoneorjustme . If it is just you, then troubleshoot your machine/network/typing skills. If it appears to be global, proceed to point two. Do not , under any circumstances, open a thread here. If AUR (or any Arch site is down), rest assured someone is working hard to bring it up. If you have reason to believe that you may have discovered this outage, check on IRC or the ML to see if it has been mentioned. At this point, remain calm and do not panic; proceed in an orderly fashion to point three. If you must have access to unsupported software, you can always take the time to learn how to write a PKGBUILD to free yourself from the tyranny of reliance on the AUR. Then, when it does come back up, you can contribute your own which, rest assured, will in due course be unavailable to some pooor soul next time the AUR is down. This is the wheel of life... - https://bbs.archlinux.org/viewtopic.php?id=151536","title":"AUR - please restrain yourself"},{"location":"manjaro/maintenance/manjaro-maintenance-03-aur-restrain-yourself/#responsible-use-of-aur","text":"With reference to an earlier thread - drifting out of hand https://forum.manjaro.org/t/responsible-use-of-aur/86392 It appears that Manjaro users are still seeing AUR as something to be used without reflection. The users of Manjaro has become a joke when it comes to AUR https://forum.endeavouros.com/t/is-aur-down-again/24287/3 Topics like below emphasizes that members of this forum does not realize that AUR scripts are unsupported. https://forum.manjaro.org/t/pamac-showing-aur-updates-but-wont-update/78775 https://forum.manjaro.org/t/aur-updates-does-not-show-up-in-pamac/44363 https://forum.manjaro.org/t/does-updating-system-with-pacman-updates-aur-packages-as-well/95282 https://forum.manjaro.org/t/pamac-doesnt-recognise-updates/102763/ https://forum.manjaro.org/t/pamac-crashes-when-checking-dependencies/102957 https://forum.manjaro.org/t/some-packages-that-i-cant-update/102867/ While AUR is a nice collection of scripts you shouldn't depend on using unsupported software . DISCLAIMER: AUR packages are user produced content. Any use of the provided files is at your own risk. - https://aur.archlinux.org/ Use the AUR at your own risk! No support will be provided by the Manjaro team for any issues that may arise relating to software installations from the AUR. When Manjaro is updated, AUR packages might stop working. This is not a Manjaro issue - https://wiki.manjaro.org/index.php/Arch_User_Repository Below quote is a topic on Arch forum which dates back 2012-10-27 From time to time the AUR, like any website, goes down. When that happens, there is a simple, three point checklist you can follow: Check that it is not just a local issue with downforeveryoneorjustme . If it is just you, then troubleshoot your machine/network/typing skills. If it appears to be global, proceed to point two. Do not , under any circumstances, open a thread here. If AUR (or any Arch site is down), rest assured someone is working hard to bring it up. If you have reason to believe that you may have discovered this outage, check on IRC or the ML to see if it has been mentioned. At this point, remain calm and do not panic; proceed in an orderly fashion to point three. If you must have access to unsupported software, you can always take the time to learn how to write a PKGBUILD to free yourself from the tyranny of reliance on the AUR. Then, when it does come back up, you can contribute your own which, rest assured, will in due course be unavailable to some pooor soul next time the AUR is down. This is the wheel of life... - https://bbs.archlinux.org/viewtopic.php?id=151536","title":"Responsible use of AUR"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/","text":"linux-aarhus | 2022-10-07 09:16:16 UTC | Source: Update Manjaro the smart way Manjaro updates Either when you use your system or shortly after login - a message appears - telling you there is updates available. When you click the message Pamac opens with the updates pane listing 100's of packages ready to download/install on your system. Almost per instinct you click the update now - provide your password and the flow begin. Suddenly your screen goes blank - you wait - nothing happens. You press Ctrl Alt F4 to access TTY - nothing happens - you wait - nothing happens. Without giving much thought to it - you hold the power button until the system powers off and press it again to power on your system - and now you are having a black screen maybe a message .... unless your system is not booting at all ! What now? Could the situation have been avoided? While - of course - there is no guarantee - the following headlines may help you understand what goes on behind the scenes. Know your system What happens when you update What happens and why when an update stalls Updating the smart way Conclusion Know your system There is a few packages - which when updated most likely will require a restart. A short list of important system packages which probably requires restart ucode cryptsetup linux nvidia mesa systemd wayland xf86-video xorg Another part of knowing your system is which foreign packages you have installed. Foreign packages is defined as everything not in the official repository so keeping a list of packages installed by an AUR helper or using makepkg -i will be of help when you update your system. Before you update - you can query pacman for the list - pipe it to a text file for later referral $ pacman -Qm > ~/aur-pkglist.txt && xdg-open aur-pkglist.txt package download The way pacman works - using the alpm library - is to download the packages and verify by signatures - and when a package validation fail - the transaction will be not committed. This ensures no updates are written to the system if the internet connects is severed as the update will be cancelled unless all packages required is available in the local package cache. pacman hooks A part of knowing your system is to understand how the alpm library applies the updates. Many packages - especially system packages - makes use of hooks to process changes during an update. If a package update is not fully completed - eg. your system loses power during update - the post-update hooks are not executed - and bad things can happen - what actually happens depends on the package and the hooks implemented. What happens on update? Most of us has been using Windows and we know from Windows that system files may be locked so the system must be restarted so the file can be replaced with the updated versions. Due to the modularity of Linux only needed parts of an application is loaded into memory and the rest is loaded on as-needed-basis - and this includes kernel, kernel modules and drivers. Custom packages When you build a custom package using an AUR helper, the package is built using the - at build time - available system libraries. When you update your system - you may be replacing those dependencies with new libraries - and such replacement may cause instability or outright failure of your custom package - especially when your custom packages depends on a specific kernel release. When you reboot your system after an update the system will use new modules and any application or device relying on a custom kernel module will fail because the module has not been rebuilt. Only after a successful update and a successful restart you can begin to update your custom modules. custom themes Themes is not only a bunch of color definitions and icons. Gnome (GTK+) and Plasma (QT+) themes is high level code integrating with the tool kit using tool kit specific definitions, code abstraction even javascript. This makes applications prone to errors when themes are not maintained to match the next release of the tool kit. Such maintenance may appear tedious but nonetheless - a non maintained theme may break the system - most notably the display manager most notably gdm for Gnome and sddm for Plasma but also toolbars, extensions and plasmoids may exhibit erratic behavior. What happens when an update stalls? The following is a simplified description - of what may happen. When you run huge updates within the graphical environment - whether you use a terminal or a gui package manager - the system may end in a state where it needs to load a specific library at a specific memory address pointing at a specific routine in the library - but due to updates - the library is no longer existing - it has been updated to a never version - and your update stalls. Updating the smart way Before major updates, it is wise to - temporarily Gnome disable extensions revert to default shell theme revert to default theme Plasma revert to the default global theme (Breeze/Breath) (include desktop layout) revert display manager (sddm) to the default theme (Breeze/Breath). Updating the smart way includes knowing which packages may pose a problem if the update is run with the GUI. I showed you a list of packages which by a lot of users experience often requires special attention. When Pamac shows you a huge list of update - it can be hard to get a clear view and you could miss one. You can use a small utility script simplifying the task of evaluating a huge list of updates. When you have evaluated the list and found this update to have the potential to stall - the smart way is to update using the console. Logout of your GUI and switch to TTY. Don't ever interrupt the process Don't ever interrupt the process - intentionally or unintentionally. Ensure you are not doing your update when your area are known to power spike, or during stormy weather which can cause interruptions to the power grid - if your system loses power you will probably have a problem getting it back up and runnning. Ensure mirror is up-to-date Before syncronizing your system optionally ensure your primary mirror is up-to-date $ pacman-mirrors Pacman-mirrors version 4.16.4 Local mirror status for unstable branch Mirror #1 OK 00:31 Denmark https://www.uex.dk/public/manjaro/ Ensure enough diskspace If you don't regularly clean up you system - now is a good time Remove old entries from the journal (reduce the size to 50M) $ sudo journalctl --vacuum-size=50M Cleanup your pacman cache (this will remove uninstalled packages and reduce pkg versions to the installed version) $ sudo paccache -ruk0 Updating Logout of your GUI and switch to TTY- Ctrl Alt F4 and run the update. Depending on the result you may proceed to update the system If you are using dkms based drivers - ensure they are rebuild without errors. $ sudo pacman -Syu If you need to rebuild your mirror list - you will need to use below variation of the update command - forcing your system package database to equal your primary mirror's databases and as pointed to by @cscs Pamac has a timer - rebuilding your mirror list on a regular base - in which case this command should be favored. $ sudo pacman -Syyu When you reboot after a successful update - first thing to do is rebuilding your foreign packages and drivers. This can be done from a terminal in the GUI session - but if you want to ensure you get no problems - TTY is recommended Ctrl Alt F4 . Depending on your environment, you switch back to GUI using Ctrl Alt F7 or if your displaymanager is SDDM Ctrl Alt F1 Rebuilding all your AUR packages using a single command e.g. $ pamac upgrade -a After succesful sync Reapply your custom theming and give yourself a :clap: - you deserve it. Conclusion Following a few basic rules will help you keep your system healthy and hopefully you will avoid problems from a stalled update.","title":"Update Manjaro the smart way"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#manjaro-updates","text":"Either when you use your system or shortly after login - a message appears - telling you there is updates available. When you click the message Pamac opens with the updates pane listing 100's of packages ready to download/install on your system. Almost per instinct you click the update now - provide your password and the flow begin. Suddenly your screen goes blank - you wait - nothing happens. You press Ctrl Alt F4 to access TTY - nothing happens - you wait - nothing happens. Without giving much thought to it - you hold the power button until the system powers off and press it again to power on your system - and now you are having a black screen maybe a message .... unless your system is not booting at all ! What now? Could the situation have been avoided? While - of course - there is no guarantee - the following headlines may help you understand what goes on behind the scenes. Know your system What happens when you update What happens and why when an update stalls Updating the smart way Conclusion","title":"Manjaro updates"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#know-your-system","text":"There is a few packages - which when updated most likely will require a restart. A short list of important system packages which probably requires restart ucode cryptsetup linux nvidia mesa systemd wayland xf86-video xorg Another part of knowing your system is which foreign packages you have installed. Foreign packages is defined as everything not in the official repository so keeping a list of packages installed by an AUR helper or using makepkg -i will be of help when you update your system. Before you update - you can query pacman for the list - pipe it to a text file for later referral $ pacman -Qm > ~/aur-pkglist.txt && xdg-open aur-pkglist.txt","title":"Know your system"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#package-download","text":"The way pacman works - using the alpm library - is to download the packages and verify by signatures - and when a package validation fail - the transaction will be not committed. This ensures no updates are written to the system if the internet connects is severed as the update will be cancelled unless all packages required is available in the local package cache.","title":"package download"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#pacman-hooks","text":"A part of knowing your system is to understand how the alpm library applies the updates. Many packages - especially system packages - makes use of hooks to process changes during an update. If a package update is not fully completed - eg. your system loses power during update - the post-update hooks are not executed - and bad things can happen - what actually happens depends on the package and the hooks implemented.","title":"pacman hooks"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#what-happens-on-update","text":"Most of us has been using Windows and we know from Windows that system files may be locked so the system must be restarted so the file can be replaced with the updated versions. Due to the modularity of Linux only needed parts of an application is loaded into memory and the rest is loaded on as-needed-basis - and this includes kernel, kernel modules and drivers.","title":"What happens on update?"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#custom-packages","text":"When you build a custom package using an AUR helper, the package is built using the - at build time - available system libraries. When you update your system - you may be replacing those dependencies with new libraries - and such replacement may cause instability or outright failure of your custom package - especially when your custom packages depends on a specific kernel release. When you reboot your system after an update the system will use new modules and any application or device relying on a custom kernel module will fail because the module has not been rebuilt. Only after a successful update and a successful restart you can begin to update your custom modules.","title":"Custom packages"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#custom-themes","text":"Themes is not only a bunch of color definitions and icons. Gnome (GTK+) and Plasma (QT+) themes is high level code integrating with the tool kit using tool kit specific definitions, code abstraction even javascript. This makes applications prone to errors when themes are not maintained to match the next release of the tool kit. Such maintenance may appear tedious but nonetheless - a non maintained theme may break the system - most notably the display manager most notably gdm for Gnome and sddm for Plasma but also toolbars, extensions and plasmoids may exhibit erratic behavior.","title":"custom themes"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#what-happens-when-an-update-stalls","text":"The following is a simplified description - of what may happen. When you run huge updates within the graphical environment - whether you use a terminal or a gui package manager - the system may end in a state where it needs to load a specific library at a specific memory address pointing at a specific routine in the library - but due to updates - the library is no longer existing - it has been updated to a never version - and your update stalls.","title":"What happens when an update stalls?"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#updating-the-smart-way","text":"Before major updates, it is wise to - temporarily Gnome disable extensions revert to default shell theme revert to default theme Plasma revert to the default global theme (Breeze/Breath) (include desktop layout) revert display manager (sddm) to the default theme (Breeze/Breath). Updating the smart way includes knowing which packages may pose a problem if the update is run with the GUI. I showed you a list of packages which by a lot of users experience often requires special attention. When Pamac shows you a huge list of update - it can be hard to get a clear view and you could miss one. You can use a small utility script simplifying the task of evaluating a huge list of updates. When you have evaluated the list and found this update to have the potential to stall - the smart way is to update using the console. Logout of your GUI and switch to TTY.","title":"Updating the smart way"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#dont-ever-interrupt-the-process","text":"Don't ever interrupt the process - intentionally or unintentionally. Ensure you are not doing your update when your area are known to power spike, or during stormy weather which can cause interruptions to the power grid - if your system loses power you will probably have a problem getting it back up and runnning.","title":"Don't ever interrupt the process"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#ensure-mirror-is-up-to-date","text":"Before syncronizing your system optionally ensure your primary mirror is up-to-date $ pacman-mirrors Pacman-mirrors version 4.16.4 Local mirror status for unstable branch Mirror #1 OK 00:31 Denmark https://www.uex.dk/public/manjaro/","title":"Ensure mirror is up-to-date"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#ensure-enough-diskspace","text":"If you don't regularly clean up you system - now is a good time Remove old entries from the journal (reduce the size to 50M) $ sudo journalctl --vacuum-size=50M Cleanup your pacman cache (this will remove uninstalled packages and reduce pkg versions to the installed version) $ sudo paccache -ruk0","title":"Ensure enough diskspace"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#updating","text":"Logout of your GUI and switch to TTY- Ctrl Alt F4 and run the update. Depending on the result you may proceed to update the system If you are using dkms based drivers - ensure they are rebuild without errors. $ sudo pacman -Syu If you need to rebuild your mirror list - you will need to use below variation of the update command - forcing your system package database to equal your primary mirror's databases and as pointed to by @cscs Pamac has a timer - rebuilding your mirror list on a regular base - in which case this command should be favored. $ sudo pacman -Syyu When you reboot after a successful update - first thing to do is rebuilding your foreign packages and drivers. This can be done from a terminal in the GUI session - but if you want to ensure you get no problems - TTY is recommended Ctrl Alt F4 . Depending on your environment, you switch back to GUI using Ctrl Alt F7 or if your displaymanager is SDDM Ctrl Alt F1 Rebuilding all your AUR packages using a single command e.g. $ pamac upgrade -a","title":"Updating"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#after-succesful-sync","text":"Reapply your custom theming and give yourself a :clap: - you deserve it.","title":"After succesful sync"},{"location":"manjaro/maintenance/manjaro-maintenance-04-update-the-smart-way/#conclusion","text":"Following a few basic rules will help you keep your system healthy and hopefully you will avoid problems from a stalled update.","title":"Conclusion"},{"location":"manjaro/maintenance/manjaro-update-practise/","text":"Manjaro updates Either when you use your system or shortly after login - a message appears - telling you there is updates available. When you click the message Pamac opens with the updates pane listing 100's of packages ready to download/install on your system. Almost per instinct you click the update now - provide your password and the flow begin. Suddenly your screen goes blank - you wait - nothing happens. You press Ctrl Alt F4 - nothing happens - you wait - nothing happens. You hold the power button until the system powers off and press it again to power on your system - and now you are having a black screen maybe a message .... What now? Could the situation have been avoided? While - of course - there is no guarantee - the following headlines may help you understand what goes on behind the scenes. Know your system What happens when you update What happens and why when an update stalls Updating the smart way Conclusion Know your system There is a few packages - which when updated most likely will require a restart. A short list of important system packages which probably requires restart ucode cryptsetup linux nvidia mesa systemd wayland xf86-video xorg Another part of knowing your system is which foreign packages you have installed. Foreign packages is defined as everything not in the official repository so keeping a list of packages installed by an AUR helper or using makepkg -i will be of help when you update your system. Before you update - you can query pacman for the list - pipe it to a text file for later referral pacman -Qm > ~/aur-pkglist.txt && xdg-open aur-pkglist.txt What happens on update? Most of us has been using Windows and we know from Windows that system files may be locked an the system must be restarted to the file can be replaced with the updated versions. Due to the modularity of Linux only needed portions of an application is loaded into memory and the rest is loaded on as-needed-basis - and this includes kernel, kernel modules and drivers. When you build a package using an AUR helper the package is build using the - at build time - available system libraries. When you update your system - you are potentially replacing those dependencies with new libraries - which in turn may influence your system stability - especially when it comes to a kernel module build for a specific kernel. When you reboot your system after an update the system will usually use the updated kernel upon reboot - and the device relying on a custom kernel module will fail because the module has not been rebuild. Only after a successful update and a successful restart you can begin to update your custom modules. What happens when an update stalls? The following is a simplified description - of what may happen. When you run huge updates within the graphical environment - whether you use a terminal or a gui package manager - the system may end in a state where it needs to load a specific library at a specific memory address pointing at a specific routine in the library - but due to updates - the library is no longer existing - it has been updated to a never version - and your update stalls. Updating the smart way Updating the smart way includes knowing which packages may pose a problem if the update is run with the GUI. I showed you a list of packages which by a lot of users experience often requires special attention. When Pamac shows you a huge list of update - it can be hard to get a clear view and you could miss one. You can use a small utility script simplifying the task of evaluating a huge list of updates. When you have evaluated the list and found this update to have the potential to stall - the smart way is to update using the console. Logout of your GUI and switch to TTY. Ensure mirror is up-to-date Before switching to console and executing the update command - ensure your primary mirror is up-to-date $ pacman-mirrors Pacman-mirrors version 4.16.4 Local mirror status for unstable branch Mirror #1 OK 00:31 Denmark https://www.uex.dk/public/manjaro/ Updating Logout of your GUI and switch to TTY- Ctrl Alt F4 and run the update. Depending on the result you may proceed to update the system $ sudo pacman -Syu If you need to rebuild your mirror list - you will need to use below variation of the update command - forcing your system package database to equal your primary mirror's databases and as pointed to by @cscs Pamac has a timer - rebuilding your mirror list on a regular base - in which case the this command should be favored. $ sudo pacman -Syyu When you reboot after a successful update - first thing to do is rebuilding your foreign packages, drivers and kernel modules. This can be done from a terminal in the GUI session - but if you want to ensure you get no problems - TTY is recommended Ctrl Alt F4 . Depending on your DE you switch back to GUI using Ctrl Alt F7 or Ctrl Alt F1 Rebuilding all your AUR packages using a single command e.g. $ pamac upgrade -a Conclusion Following a few basic rules will help you keep your system healthy and hopefully you will avoid problems from a stalled update.","title":"Smart Manjaro system update"},{"location":"manjaro/maintenance/manjaro-update-practise/#manjaro-updates","text":"Either when you use your system or shortly after login - a message appears - telling you there is updates available. When you click the message Pamac opens with the updates pane listing 100's of packages ready to download/install on your system. Almost per instinct you click the update now - provide your password and the flow begin. Suddenly your screen goes blank - you wait - nothing happens. You press Ctrl Alt F4 - nothing happens - you wait - nothing happens. You hold the power button until the system powers off and press it again to power on your system - and now you are having a black screen maybe a message .... What now? Could the situation have been avoided? While - of course - there is no guarantee - the following headlines may help you understand what goes on behind the scenes. Know your system What happens when you update What happens and why when an update stalls Updating the smart way Conclusion","title":"Manjaro updates"},{"location":"manjaro/maintenance/manjaro-update-practise/#know-your-system","text":"There is a few packages - which when updated most likely will require a restart. A short list of important system packages which probably requires restart ucode cryptsetup linux nvidia mesa systemd wayland xf86-video xorg Another part of knowing your system is which foreign packages you have installed. Foreign packages is defined as everything not in the official repository so keeping a list of packages installed by an AUR helper or using makepkg -i will be of help when you update your system. Before you update - you can query pacman for the list - pipe it to a text file for later referral pacman -Qm > ~/aur-pkglist.txt && xdg-open aur-pkglist.txt","title":"Know your system"},{"location":"manjaro/maintenance/manjaro-update-practise/#what-happens-on-update","text":"Most of us has been using Windows and we know from Windows that system files may be locked an the system must be restarted to the file can be replaced with the updated versions. Due to the modularity of Linux only needed portions of an application is loaded into memory and the rest is loaded on as-needed-basis - and this includes kernel, kernel modules and drivers. When you build a package using an AUR helper the package is build using the - at build time - available system libraries. When you update your system - you are potentially replacing those dependencies with new libraries - which in turn may influence your system stability - especially when it comes to a kernel module build for a specific kernel. When you reboot your system after an update the system will usually use the updated kernel upon reboot - and the device relying on a custom kernel module will fail because the module has not been rebuild. Only after a successful update and a successful restart you can begin to update your custom modules.","title":"What happens on update?"},{"location":"manjaro/maintenance/manjaro-update-practise/#what-happens-when-an-update-stalls","text":"The following is a simplified description - of what may happen. When you run huge updates within the graphical environment - whether you use a terminal or a gui package manager - the system may end in a state where it needs to load a specific library at a specific memory address pointing at a specific routine in the library - but due to updates - the library is no longer existing - it has been updated to a never version - and your update stalls.","title":"What happens when an update stalls?"},{"location":"manjaro/maintenance/manjaro-update-practise/#updating-the-smart-way","text":"Updating the smart way includes knowing which packages may pose a problem if the update is run with the GUI. I showed you a list of packages which by a lot of users experience often requires special attention. When Pamac shows you a huge list of update - it can be hard to get a clear view and you could miss one. You can use a small utility script simplifying the task of evaluating a huge list of updates. When you have evaluated the list and found this update to have the potential to stall - the smart way is to update using the console. Logout of your GUI and switch to TTY.","title":"Updating the smart way"},{"location":"manjaro/maintenance/manjaro-update-practise/#ensure-mirror-is-up-to-date","text":"Before switching to console and executing the update command - ensure your primary mirror is up-to-date $ pacman-mirrors Pacman-mirrors version 4.16.4 Local mirror status for unstable branch Mirror #1 OK 00:31 Denmark https://www.uex.dk/public/manjaro/","title":"Ensure mirror is up-to-date"},{"location":"manjaro/maintenance/manjaro-update-practise/#updating","text":"Logout of your GUI and switch to TTY- Ctrl Alt F4 and run the update. Depending on the result you may proceed to update the system $ sudo pacman -Syu If you need to rebuild your mirror list - you will need to use below variation of the update command - forcing your system package database to equal your primary mirror's databases and as pointed to by @cscs Pamac has a timer - rebuilding your mirror list on a regular base - in which case the this command should be favored. $ sudo pacman -Syyu When you reboot after a successful update - first thing to do is rebuilding your foreign packages, drivers and kernel modules. This can be done from a terminal in the GUI session - but if you want to ensure you get no problems - TTY is recommended Ctrl Alt F4 . Depending on your DE you switch back to GUI using Ctrl Alt F7 or Ctrl Alt F1 Rebuilding all your AUR packages using a single command e.g. $ pamac upgrade -a","title":"Updating"},{"location":"manjaro/maintenance/manjaro-update-practise/#conclusion","text":"Following a few basic rules will help you keep your system healthy and hopefully you will avoid problems from a stalled update.","title":"Conclusion"},{"location":"manjaro/mirror/manjaro-offline-package-installation/","text":"To download a package with dependencies e.g. libreoffice-fresh sudo pacman -S libreoffice-fresh --cachedir ~/tmp --downloadonly $(pacman -Si libreoffice-fresh | awk -F'[:]' '/^Depends/ {print $2}') To update an offline installation - we need a lot more - first a disk of no less then 80G free space and a rsync script to fetch the entire Manjaro stable branch. #!/bin/sh ####################################################### ### ### Variables to amend ### Ensure your target has enough free space ### Expect around 70-80GiB ### TARGET=\"~/ManjaroRepo\" TMP=\"~/.cache/manjaro\" LOCK=\"~/.cache/rsync-manjaro.lock\" ### arguments to exclude folders not needed for an offline stable repo ### exclude from sync EXCLUDE='--exclude=\"arm\" --exclude=\"pool\" --exclude=\"testing\" --exclude=\"unstable\" --exclude=\"*/kde-unstable\"' ### mirror rsync address SOURCE=\"rsync://mirror.easyname.at/manjaro/\" ###################################################### ### ### create folders if the don't exist ### ###################################################### [ ! -d \"${TARGET}\" ] && mkdir -p \"${TARGET}\" [ ! -d \"${TMP}\" ] && mkdir -p \"${TMP}\" # setup lock exec 9>\"${LOCK}\" flock -n 9 || exit # if run by a systemd timer if ! stty &>/dev/null; then QUIET=\"--quiet\" fi ################################################## ### ### This rsync command creates a copy of stable repo ### where symlinks are converted to regular files ### Expect the size to be around 70GB to 80GB ### ### rsync is an io-intensive task ### therefore some mirrors do no honor --checksum ################################################## CHECKSUM=\"--checksum\" rsync --recursive --times --copy-links --verbose --safe-links \\ --delete-after --progress --perms ${CHECKSUM} \\ --timeout=600 --contimeout=300 \\ --human-readable --delay-updates --no-motd \\ ${QUIET} --temp-dir=\"${TMP}\" \\ ${EXCLUDE} \\ ${SOURCE} \\ \"${TARGET}\" rm -f ${LOCK} ~~~ !/usr/bin/env bash sample script for updating a remote system with no network using a labeled filesystem on a portable medium mount using label e.g. ManjaroRepo sudo mount /dev/disk-by-label/ManjaroRepo /mnt start the python http server python -m http.server -d /mnt 8080 & use pacman-mirrors to point pacman to the local mirror sudo pacman-mirrors -aU http://localhost:8080 update the system sudo pacman -Syyu optionally reboot the system reboot","title":"Manjaro - offline package installation"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#usrbinenv-bash","text":"","title":"!/usr/bin/env bash"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#sample-script-for-updating-a-remote-system-with-no-network","text":"","title":"sample script for updating a remote system with no network"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#using-a-labeled-filesystem-on-a-portable-medium","text":"","title":"using a labeled filesystem on a portable medium"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#mount-using-label-eg-manjarorepo","text":"sudo mount /dev/disk-by-label/ManjaroRepo /mnt","title":"mount using label e.g. ManjaroRepo"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#start-the-python-http-server","text":"python -m http.server -d /mnt 8080 &","title":"start the python http server"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#use-pacman-mirrors-to-point-pacman-to-the-local-mirror","text":"sudo pacman-mirrors -aU http://localhost:8080","title":"use pacman-mirrors to point pacman to the local mirror"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#update-the-system","text":"sudo pacman -Syyu","title":"update the system"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#optionally-reboot-the-system","text":"","title":"optionally reboot the system"},{"location":"manjaro/mirror/manjaro-offline-package-installation/#reboot","text":"","title":"reboot"},{"location":"manjaro/mirror/manjaro-portable-mirror/","text":"Why a portable mirror There could be any number of reasons to use a portable mirror - some common use cases You have work to do and you don't want to destablize your perfect system but you need a specific package Your internet connection for syncing (installing) is slow or metered The Nvidia drivers work just the way they should To be able to travel and you ind you desperately need an arbitrary package The desktop is mostly bugfree -> Gnome or Plasma :eyes: Description This topic is intended to provide a hands-on - proof of concept - on how to honor any of the above expectations Using a portable mirror is no different than using an online mirror - except the fact that you become your own mirror proovider. Technically - with out too much hazzle - you can expand the availability to your local network - but for now let us stay with the portable mirror abstraction. Requirements Initial requirement of a reasonable fast and reliable internet connection. Could be your campus, a public service or a friend's unlimited internet connection. Initial data transfer of ~100GB data - the initial mirror sync. A storage device capable of holding this initial transfer plus the overhead of temporary files making a device with at least 128GB free space. A lot of patience (see the Patience section in the sidebar) :warning: Do not cheap out on the device - use a branded device with good reputation of reliability and resilience to accidents like drops or moisture. A normal Manjaro stable branch sees fewer sync than testing and unstable, so scheduling a monthly sync of your portable mirror could be sufficient. But as your own mirror provider - you may choose any other schedule that fits into your workflow. Preparation Create a Linux partition with (as miniminum) 128GB space and format it with ext4 and the label PortableMirror - do not use btrfs even if you prefer - it is not suited for this purpose. To avoid accidental change of your PortableMirror device you should only change the device using root context. This means you run the rsync script using sudo as this will ensure some integrity against accidental changes. This also means we create the initial script using root context. Mount the partition using the label PortableMirror on the designated temporary mountpoint /mnt . sudo mount /dev/disk/by-label/PortableMirror /mnt Create a new file on the new partition - call it rsync-manjaro.sh . I am using micro as my terminal editor - replace micro with your preferred editor capable of obtaining root permissions for saving the file. micro /mnt/rsync-manjaro.sh Paste the following and save the file #!/usr/bin/env bash # This must be a relative path starting with the scripts location # To accomodate for various ways of executing the script I have used # this snippet to ensure we always know the exact path of the script # https://www.baeldung.com/linux/bash-get-location-within-script SCRIPT_PATH=\"${BASH_SOURCE}\" while [ -L \"${SCRIPT_PATH}\" ]; do SCRIPT_DIR=\"$(cd -P \"$(dirname \"${SCRIPT_PATH}\")\" >/dev/null 2>&1 && pwd)\" SCRIPT_PATH=\"$(readlink \"${SCRIPT_PATH}\")\" [[ ${SCRIPT_PATH} != /* ]] && SCRIPT_PATH=\"${SCRIPT_DIR}/${SCRIPT_PATH}\" done SCRIPT_PATH=\"$(readlink -f \"${SCRIPT_PATH}\")\" SCRIPT_DIR=\"$(cd -P \"$(dirname -- \"${SCRIPT_PATH}\")\" >/dev/null 2>&1 && pwd)\" # this will be the folder holding the portable mirror TARGET=\"${SCRIPT_DIR}/PortableMirror\" # working variables TMP=\"${SCRIPT_DIR}/tmp\" # lockfile will prevent multiple instances of the script process # if the script is terminated mid execution # you may need to manually remove the lockfile LOCK=\"${TMP}/rsync-manjaro.lock\" # this is the mirror to sync from # you \u00e6may need to evaluate various mirrors to # find one that supports checksum SOURCE=\"rsync://ftp.halifax.rwth-aachen.de/manjaro/\" # assume checksum CHECKSUM=\"-c\" # verify if checksum can be used check=$(rsync --checksum --dry-run ${SOURCE}) [[ ${check} =~ \"disabled\" ]] && unset CHECKSUM # create the targets [ ! -d \"${TARGET}\" ] && mkdir -p \"${TARGET}\" [ ! -d \"${TMP}\" ] && mkdir -p \"${TMP}\" # exit if lockfile exist exec 9>\"${LOCK}\" flock -n 9 || exit # if running from a timer or a cron job silence the output if ! stty &>/dev/null; then QUIET=\"-q\" fi if [[ -z $QUIET ]]; then echo \"--== SYNC PORTABLE MIRROR ==--\" echo \"${SOURCE}\" echo \"please wait ... \" fi ################################################## ### ### This rsync command creates a copy of stable repo ### where symlinks are converted to regular files ### Expect the size to be around 100GB ### It is possible to reduce the size further ### by excluding signatures ### this requires to execute the update as ### SigLevel=TrustAll sudo pacman -Syu ### ################################################## rsync -rtLv --safe-links \\ --delete-after --progress -h \\ --timeout=600 --contimeout=300 -p \\ --delay-updates --no-motd \\ --exclude=\"arm*\" \\ --exclude=\"pool\" \\ --exclude=\"testing\" \\ --exclude=\"unstable\" \\ --exclude=\"stable/kde-unstable\" \\ ${QUIET} ${CHECKSUM} \\ ${SOURCE} \\ \"${TARGET}\" rm -f ${LOCK} if [[ -z $QUIET ]]; then echo \"${SOURCE}\" echo \"Sync complete\" fi If you have the internet connection and the time - run the script sudo bash rsync-manjaro.sh Whenever you have the option - once or twice a month - attach the device - mount it - open a terminal at the mount path - and execute above command to sync the portable mirror. Patience For documentation purpose I timed the initial sync using an ordinary folder on my system's NVMe. The number is for system connected to a Cat6 LAN, connected to the internet with 1Gbit fiber optic connection in Denmark.. You need to adjust your expectation according to your bandwidth. Besides the download time you need to factor in how fast data can be written to you selected storage device - which is why you should not not cheap out on the device. $ time ./rsync-manjaro.sh [...] sent 568,87K bytes received 92,38G bytes 14,12M bytes/sec total size is 92,35G speedup is 1,00 real 109m4,842s user 0m20,322s sys 2m8,504s Using the portable mirror Your portable mirror goes into the custom mirrors catagory and according to the manpage you can use a custom mirror as a file based miror or server based mirror. If you want to make it available in an air-gapped network (understood as no internet connection) then use a http based mirror. If you want to use on a single air-gapped system (with no network at all) the file based mirror is also an option. In either case you need to mount the partition - and because we labelled the disk you do not need to know the device path - just remember the label. You could even attach a sticker to the device with the label name - easy recognizable on the desk. Mirror configuration The core application pacman-mirrors allows you to specify a given mirror using command line. First mount the device sudo mount /dev/disk/by-label/PortableMirror /mnt For a file based mirror sudo pacman-mirrors --api --url file:///mnt/PortableMirror The process for a http mirror is slightly different as you must first start a http service. The system Python contains a simple http service you can utilize for this purpose. python -m http.server -d /mnt/PortableMirror 8080 & sudo pacman-mirrors --api --url http://localhost:8080 Static configuration If are going all-in on being your own mirror provider - you may choose to make your mirror configuration static. Edit pacman-mirrors.conf as root and uncomment the # Static = line and add your mirrors url and save the file. When ready sudo pacman -Syu Conclusion While setting up the portable mirror initially requires some work and patience to sync the stable branch repo, you are now able to install any application offline. Remember this: pamac provides a timer which will remove your portable mirror pamac provides a notification when new packages can be synced If you are going to rely on your portable mirror - it is advised to disable the timer and notification. Instead of syncing your computer - sync your portable mirror - then sync your system using the portable mirror. Posted at: Create and use a portable Manjaro mirror","title":"Portable Manjaro Mirror"},{"location":"manjaro/mirror/manjaro-portable-mirror/#why-a-portable-mirror","text":"There could be any number of reasons to use a portable mirror - some common use cases You have work to do and you don't want to destablize your perfect system but you need a specific package Your internet connection for syncing (installing) is slow or metered The Nvidia drivers work just the way they should To be able to travel and you ind you desperately need an arbitrary package The desktop is mostly bugfree -> Gnome or Plasma :eyes:","title":"Why a portable mirror"},{"location":"manjaro/mirror/manjaro-portable-mirror/#description","text":"This topic is intended to provide a hands-on - proof of concept - on how to honor any of the above expectations Using a portable mirror is no different than using an online mirror - except the fact that you become your own mirror proovider. Technically - with out too much hazzle - you can expand the availability to your local network - but for now let us stay with the portable mirror abstraction.","title":"Description"},{"location":"manjaro/mirror/manjaro-portable-mirror/#requirements","text":"Initial requirement of a reasonable fast and reliable internet connection. Could be your campus, a public service or a friend's unlimited internet connection. Initial data transfer of ~100GB data - the initial mirror sync. A storage device capable of holding this initial transfer plus the overhead of temporary files making a device with at least 128GB free space. A lot of patience (see the Patience section in the sidebar) :warning: Do not cheap out on the device - use a branded device with good reputation of reliability and resilience to accidents like drops or moisture. A normal Manjaro stable branch sees fewer sync than testing and unstable, so scheduling a monthly sync of your portable mirror could be sufficient. But as your own mirror provider - you may choose any other schedule that fits into your workflow.","title":"Requirements"},{"location":"manjaro/mirror/manjaro-portable-mirror/#preparation","text":"Create a Linux partition with (as miniminum) 128GB space and format it with ext4 and the label PortableMirror - do not use btrfs even if you prefer - it is not suited for this purpose. To avoid accidental change of your PortableMirror device you should only change the device using root context. This means you run the rsync script using sudo as this will ensure some integrity against accidental changes. This also means we create the initial script using root context. Mount the partition using the label PortableMirror on the designated temporary mountpoint /mnt . sudo mount /dev/disk/by-label/PortableMirror /mnt Create a new file on the new partition - call it rsync-manjaro.sh . I am using micro as my terminal editor - replace micro with your preferred editor capable of obtaining root permissions for saving the file. micro /mnt/rsync-manjaro.sh Paste the following and save the file #!/usr/bin/env bash # This must be a relative path starting with the scripts location # To accomodate for various ways of executing the script I have used # this snippet to ensure we always know the exact path of the script # https://www.baeldung.com/linux/bash-get-location-within-script SCRIPT_PATH=\"${BASH_SOURCE}\" while [ -L \"${SCRIPT_PATH}\" ]; do SCRIPT_DIR=\"$(cd -P \"$(dirname \"${SCRIPT_PATH}\")\" >/dev/null 2>&1 && pwd)\" SCRIPT_PATH=\"$(readlink \"${SCRIPT_PATH}\")\" [[ ${SCRIPT_PATH} != /* ]] && SCRIPT_PATH=\"${SCRIPT_DIR}/${SCRIPT_PATH}\" done SCRIPT_PATH=\"$(readlink -f \"${SCRIPT_PATH}\")\" SCRIPT_DIR=\"$(cd -P \"$(dirname -- \"${SCRIPT_PATH}\")\" >/dev/null 2>&1 && pwd)\" # this will be the folder holding the portable mirror TARGET=\"${SCRIPT_DIR}/PortableMirror\" # working variables TMP=\"${SCRIPT_DIR}/tmp\" # lockfile will prevent multiple instances of the script process # if the script is terminated mid execution # you may need to manually remove the lockfile LOCK=\"${TMP}/rsync-manjaro.lock\" # this is the mirror to sync from # you \u00e6may need to evaluate various mirrors to # find one that supports checksum SOURCE=\"rsync://ftp.halifax.rwth-aachen.de/manjaro/\" # assume checksum CHECKSUM=\"-c\" # verify if checksum can be used check=$(rsync --checksum --dry-run ${SOURCE}) [[ ${check} =~ \"disabled\" ]] && unset CHECKSUM # create the targets [ ! -d \"${TARGET}\" ] && mkdir -p \"${TARGET}\" [ ! -d \"${TMP}\" ] && mkdir -p \"${TMP}\" # exit if lockfile exist exec 9>\"${LOCK}\" flock -n 9 || exit # if running from a timer or a cron job silence the output if ! stty &>/dev/null; then QUIET=\"-q\" fi if [[ -z $QUIET ]]; then echo \"--== SYNC PORTABLE MIRROR ==--\" echo \"${SOURCE}\" echo \"please wait ... \" fi ################################################## ### ### This rsync command creates a copy of stable repo ### where symlinks are converted to regular files ### Expect the size to be around 100GB ### It is possible to reduce the size further ### by excluding signatures ### this requires to execute the update as ### SigLevel=TrustAll sudo pacman -Syu ### ################################################## rsync -rtLv --safe-links \\ --delete-after --progress -h \\ --timeout=600 --contimeout=300 -p \\ --delay-updates --no-motd \\ --exclude=\"arm*\" \\ --exclude=\"pool\" \\ --exclude=\"testing\" \\ --exclude=\"unstable\" \\ --exclude=\"stable/kde-unstable\" \\ ${QUIET} ${CHECKSUM} \\ ${SOURCE} \\ \"${TARGET}\" rm -f ${LOCK} if [[ -z $QUIET ]]; then echo \"${SOURCE}\" echo \"Sync complete\" fi If you have the internet connection and the time - run the script sudo bash rsync-manjaro.sh Whenever you have the option - once or twice a month - attach the device - mount it - open a terminal at the mount path - and execute above command to sync the portable mirror.","title":"Preparation"},{"location":"manjaro/mirror/manjaro-portable-mirror/#patience","text":"For documentation purpose I timed the initial sync using an ordinary folder on my system's NVMe. The number is for system connected to a Cat6 LAN, connected to the internet with 1Gbit fiber optic connection in Denmark.. You need to adjust your expectation according to your bandwidth. Besides the download time you need to factor in how fast data can be written to you selected storage device - which is why you should not not cheap out on the device. $ time ./rsync-manjaro.sh [...] sent 568,87K bytes received 92,38G bytes 14,12M bytes/sec total size is 92,35G speedup is 1,00 real 109m4,842s user 0m20,322s sys 2m8,504s","title":"Patience"},{"location":"manjaro/mirror/manjaro-portable-mirror/#using-the-portable-mirror","text":"Your portable mirror goes into the custom mirrors catagory and according to the manpage you can use a custom mirror as a file based miror or server based mirror. If you want to make it available in an air-gapped network (understood as no internet connection) then use a http based mirror. If you want to use on a single air-gapped system (with no network at all) the file based mirror is also an option. In either case you need to mount the partition - and because we labelled the disk you do not need to know the device path - just remember the label. You could even attach a sticker to the device with the label name - easy recognizable on the desk.","title":"Using the portable mirror"},{"location":"manjaro/mirror/manjaro-portable-mirror/#mirror-configuration","text":"The core application pacman-mirrors allows you to specify a given mirror using command line. First mount the device sudo mount /dev/disk/by-label/PortableMirror /mnt For a file based mirror sudo pacman-mirrors --api --url file:///mnt/PortableMirror The process for a http mirror is slightly different as you must first start a http service. The system Python contains a simple http service you can utilize for this purpose. python -m http.server -d /mnt/PortableMirror 8080 & sudo pacman-mirrors --api --url http://localhost:8080","title":"Mirror configuration"},{"location":"manjaro/mirror/manjaro-portable-mirror/#static-configuration","text":"If are going all-in on being your own mirror provider - you may choose to make your mirror configuration static. Edit pacman-mirrors.conf as root and uncomment the # Static = line and add your mirrors url and save the file.","title":"Static configuration"},{"location":"manjaro/mirror/manjaro-portable-mirror/#when-ready","text":"sudo pacman -Syu","title":"When ready"},{"location":"manjaro/mirror/manjaro-portable-mirror/#conclusion","text":"While setting up the portable mirror initially requires some work and patience to sync the stable branch repo, you are now able to install any application offline. Remember this: pamac provides a timer which will remove your portable mirror pamac provides a notification when new packages can be synced If you are going to rely on your portable mirror - it is advised to disable the timer and notification. Instead of syncing your computer - sync your portable mirror - then sync your system using the portable mirror. Posted at: Create and use a portable Manjaro mirror","title":"Conclusion"},{"location":"manjaro/network/network-basic-iptables-rules/","text":"Basic iptables rules Prefix # - run command as root or by use of sudo command $ - run command in regular user-context !!!! The order of iptables rules matters. Traffic is filtered by first applicable rule. !!!! If a rule accept SSH traffic, followed by a rule to deny SSH traffic, iptables will always allow the traffic because allow comes before deny rule in the chain. !!!! You can change the rule order by specifying a rule number in your command. Reject all outgoing network traffic Ruleset only allowing current outgoing and established traffic. Needed when you are logged in to a server via ssh. # iptables -F OUTPUT # iptables -A OUTPUT -m state --state ESTABLISHED -j ACCEPT # iptables -A OUTPUT -j REJECT Reject all incoming network traffic Ruleset rejecting all incoming traffic # iptables -F INPUT # iptables -A INPUT -m state --state ESTABLISHED -j ACCEPT # iptables -A INPUT -j REJECT Reject all network traffic Ruleset to drop and block all network traffic whether incoming or outgoing. ! This will also include current ongoing established traffic and it will break your traffic if remote. # iptables -F # iptables -A INPUT -j REJECT # iptables -A OUTPUT -j REJECT # iptables -A FORWARD -j REJECT Drop incoming ping requests Drop all incoming ping requests. It is possible to use REJECT instead of DROP. The difference between DROP vs REJECT is that DROP silently discards the incoming package, whereas REJECT will result in ICMP error being returned. # iptables -A INPUT -p icmp --icmp-type echo-request -j DROP Reject outgoing on port Reject all outgoing traffic coming from a local port 22 (ssh). # iptables -A OUTPUT -p tcp --dport ssh -j REJECT Reject incoming on port Reject all incoming traffic to a local port 22 (ssh). # iptables -A INPUT -p tcp --dport ssh -j REJECT Reject all incoming traffic except Ruleset rejecting all incoming traffic to system except port 22 (SSH). It will also accept traffic on the loopback interface. # iptables -A INPUT -i lo -j ACCEPT # iptables -A INPUT -p tcp --dport ssh -j ACCEPT # iptables -A INPUT -j REJECT Accept incoming port from IP address Ruleset blocking all incoming traffic to port 22 (ssh) except host address 1.3.5.7 . Only allow host IP 1.3.5.7 to access ssh. # iptables -A INPUT -p tcp -s 1.3.5.7 --dport ssh -j ACCEPT # iptables -A INPUT -p tcp --dport ssh -j REJECT Block incoming port except from MAC address Ruleset blocking all incoming port (ssh) except host with MAC address 11:22:33:aa:bb:cc . Only allow host with MAC address 11:22:33:aa:bb:cc to access ssh. # iptables -A INPUT -m mac --mac-source 11:22:33:aa:bb:cc -p tcp --dport ssh -j ACCEPT # iptables -A INPUT -p tcp --dport ssh -j REJECT Reject incoming traffic on a specific TCP port Drop all incoming traffic on TCP port 6000 . # iptables -A INPUT -p tcp --dport 6000 -j REJECT Drop all incoming traffic on interface Drop incoming traffic on a interface coming from subnet 172.16.1.0/16 . Useful in attempt to drop illegal IP addresses on wan interface. If enp3s1 is an external network interface, no incoming traffic originating from internal network should hit enp3s1 network interface. # iptables -A INPUT -i enp3s1 -s 172.16.1.0/16 -j DROP Create a simple IP Masquerading Create a simple IP Masquerading gateway to allow all host on the same subnet to access the Internet. The enp3s1 is the external interface connected to the Internet. # echo \"1\" > /proc/sys/net/ipv4/ip\\_forward # iptables -t nat -A POSTROUTING -o enp3s1 -j MASQUERADE Reject all incoming port except specified IP address Reject all incoming ssh ( port 22 ) traffic except traffic request from IP 7.5.3.1 # iptables -A INPUT -t filter ! -s 7.5.3.1 -p tcp --dport 22 -j REJECT Reject all incoming port except IP address range Reject all incoming ssh ( port 22 ) traffic except traffic request from IP address range 172.16.1.65 - 172.16.1.128. Removing negator \"!\" from the below rule reject all ssh traffic originating from IP address range 172.16.1.65 - 172.16.1.128. # iptables -A INPUT -t filter -m iprange ! --src-range 172.16.1.65 - 172.16.1.128 -p tcp --dport 22 -j REJECT reject all outgoing traffic to a specific remote host Reject all outgoing traffic to a remote host with an IP address 7.5.3.1 # iptables -A OUTPUT -d 7.5.3.1 -j REJECT block access to a specific website Block all incoming traffic from facebook.com where source port is www ( port 80 ). # iptables -A INPUT -s facebook.com -p tcp --sport www -j DROP More reading Simple statefull firewall on wiki.archlinux.org","title":"Basic firewall (iptables) rules"},{"location":"manjaro/network/network-basic-iptables-rules/#basic-iptables-rules","text":"Prefix # - run command as root or by use of sudo command $ - run command in regular user-context !!!! The order of iptables rules matters. Traffic is filtered by first applicable rule. !!!! If a rule accept SSH traffic, followed by a rule to deny SSH traffic, iptables will always allow the traffic because allow comes before deny rule in the chain. !!!! You can change the rule order by specifying a rule number in your command.","title":"Basic iptables rules"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-all-outgoing-network-traffic","text":"Ruleset only allowing current outgoing and established traffic. Needed when you are logged in to a server via ssh. # iptables -F OUTPUT # iptables -A OUTPUT -m state --state ESTABLISHED -j ACCEPT # iptables -A OUTPUT -j REJECT","title":"Reject all outgoing network traffic"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-all-incoming-network-traffic","text":"Ruleset rejecting all incoming traffic # iptables -F INPUT # iptables -A INPUT -m state --state ESTABLISHED -j ACCEPT # iptables -A INPUT -j REJECT","title":"Reject all incoming network traffic"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-all-network-traffic","text":"Ruleset to drop and block all network traffic whether incoming or outgoing. ! This will also include current ongoing established traffic and it will break your traffic if remote. # iptables -F # iptables -A INPUT -j REJECT # iptables -A OUTPUT -j REJECT # iptables -A FORWARD -j REJECT","title":"Reject all network traffic"},{"location":"manjaro/network/network-basic-iptables-rules/#drop-incoming-ping-requests","text":"Drop all incoming ping requests. It is possible to use REJECT instead of DROP. The difference between DROP vs REJECT is that DROP silently discards the incoming package, whereas REJECT will result in ICMP error being returned. # iptables -A INPUT -p icmp --icmp-type echo-request -j DROP","title":"Drop incoming ping requests"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-outgoing-on-port","text":"Reject all outgoing traffic coming from a local port 22 (ssh). # iptables -A OUTPUT -p tcp --dport ssh -j REJECT","title":"Reject outgoing on port"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-incoming-on-port","text":"Reject all incoming traffic to a local port 22 (ssh). # iptables -A INPUT -p tcp --dport ssh -j REJECT","title":"Reject incoming on port"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-all-incoming-traffic-except","text":"Ruleset rejecting all incoming traffic to system except port 22 (SSH). It will also accept traffic on the loopback interface. # iptables -A INPUT -i lo -j ACCEPT # iptables -A INPUT -p tcp --dport ssh -j ACCEPT # iptables -A INPUT -j REJECT","title":"Reject all incoming traffic except"},{"location":"manjaro/network/network-basic-iptables-rules/#accept-incoming-port-from-ip-address","text":"Ruleset blocking all incoming traffic to port 22 (ssh) except host address 1.3.5.7 . Only allow host IP 1.3.5.7 to access ssh. # iptables -A INPUT -p tcp -s 1.3.5.7 --dport ssh -j ACCEPT # iptables -A INPUT -p tcp --dport ssh -j REJECT","title":"Accept incoming port from IP address"},{"location":"manjaro/network/network-basic-iptables-rules/#block-incoming-port-except-from-mac-address","text":"Ruleset blocking all incoming port (ssh) except host with MAC address 11:22:33:aa:bb:cc . Only allow host with MAC address 11:22:33:aa:bb:cc to access ssh. # iptables -A INPUT -m mac --mac-source 11:22:33:aa:bb:cc -p tcp --dport ssh -j ACCEPT # iptables -A INPUT -p tcp --dport ssh -j REJECT","title":"Block incoming port except from MAC address"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-incoming-traffic-on-a-specific-tcp-port","text":"Drop all incoming traffic on TCP port 6000 . # iptables -A INPUT -p tcp --dport 6000 -j REJECT","title":"Reject incoming traffic on a specific TCP port"},{"location":"manjaro/network/network-basic-iptables-rules/#drop-all-incoming-traffic-on-interface","text":"Drop incoming traffic on a interface coming from subnet 172.16.1.0/16 . Useful in attempt to drop illegal IP addresses on wan interface. If enp3s1 is an external network interface, no incoming traffic originating from internal network should hit enp3s1 network interface. # iptables -A INPUT -i enp3s1 -s 172.16.1.0/16 -j DROP","title":"Drop all incoming traffic on interface"},{"location":"manjaro/network/network-basic-iptables-rules/#create-a-simple-ip-masquerading","text":"Create a simple IP Masquerading gateway to allow all host on the same subnet to access the Internet. The enp3s1 is the external interface connected to the Internet. # echo \"1\" > /proc/sys/net/ipv4/ip\\_forward # iptables -t nat -A POSTROUTING -o enp3s1 -j MASQUERADE","title":"Create a simple IP Masquerading"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-all-incoming-port-except-specified-ip-address","text":"Reject all incoming ssh ( port 22 ) traffic except traffic request from IP 7.5.3.1 # iptables -A INPUT -t filter ! -s 7.5.3.1 -p tcp --dport 22 -j REJECT","title":"Reject all incoming port except specified IP address"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-all-incoming-port-except-ip-address-range","text":"Reject all incoming ssh ( port 22 ) traffic except traffic request from IP address range 172.16.1.65 - 172.16.1.128. Removing negator \"!\" from the below rule reject all ssh traffic originating from IP address range 172.16.1.65 - 172.16.1.128. # iptables -A INPUT -t filter -m iprange ! --src-range 172.16.1.65 - 172.16.1.128 -p tcp --dport 22 -j REJECT","title":"Reject all incoming port except IP address range"},{"location":"manjaro/network/network-basic-iptables-rules/#reject-all-outgoing-traffic-to-a-specific-remote-host","text":"Reject all outgoing traffic to a remote host with an IP address 7.5.3.1 # iptables -A OUTPUT -d 7.5.3.1 -j REJECT","title":"reject all outgoing traffic to a specific remote host"},{"location":"manjaro/network/network-basic-iptables-rules/#block-access-to-a-specific-website","text":"Block all incoming traffic from facebook.com where source port is www ( port 80 ). # iptables -A INPUT -s facebook.com -p tcp --sport www -j DROP","title":"block access to a specific website"},{"location":"manjaro/network/network-basic-iptables-rules/#more-reading","text":"Simple statefull firewall on wiki.archlinux.org","title":"More reading"},{"location":"manjaro/network/network-basic-troubleshooting/","text":"Difficulty: \u2606\u2606\u2606\u2606\u2606 Network connections This is not a guide on troubleshooting hardware and drivers but the network connection itself. The guide is assuming your hardware and driver(s) are in a working state. The guide is intended as a reference for working your self through situations like I can't connect to the internet I ping an IP but not a domain name How can I find my printer's IP Every user will be in a situation when network troubleshooting is necessary - it is almost inevitable. NOTE: This is a work in progress ... please add a comment if there is a network topic you would like covered - maybe in a separate guide. IPv6 is a topic on it's own - completely different and I know nothing - so please don't ask. Troubleshooting Network troubleshooting is like an onion. You peel one layer at a time until you reach the core. Always start with the system having issues. Having additional packages installed before problems arise is useful but not necessary. $ sudo pacman -Syu bind whois arp-scan net-tools traceroute Network info Getting some basic info can be done numerous ways using a variety of utilites. In the context of providing basic info NetworkManager's CLI tool provides a good overview and is Manjaro default network manager. Example output $ nmcli device show | grep IP4 IP4.ADDRESS[1]: 10.10.10.20/24 IP4.GATEWAY: 10.10.10.1 IP4.ROUTE[1]: dst = 0.0.0.0/0, nh = 10.10.10.1, mt = 100 IP4.ROUTE[2]: dst = 10.10.10.0/24, nh = 0.0.0.0, mt = 100 IP4.DNS[1]: 10.10.10.4 IP4.DOMAIN[1]: lan.nix.dk IP4.ADDRESS[1]: 127.0.0.1/8 IP4.GATEWAY: -- Using the output from your system - look for answers to the following questions Do I have an address : \u2192 IP4.ADDRESS ? Is the IP in the expected sub net : \u2192 IP4.ROUTE dst = ? Is the gateway correct: \u2192 IP4.GATEWAY ? Is the DNS correct: \u2192 IP4.DNS ? Is the route correct:\u2192 IP4.ROUTE ? If everything checks - continue to testing your connection - use the data from your system. connectivity check From man ping When using ping for fault isolation, it should first be run on the local host, to verify that the local network interface is up and running. Then, hosts and gateways further and further away should be \u201cpinged\u201d. Round-trip times and packet loss statistics are computed. If duplicate packets are received, they are not included in the packet loss calculation, although the round trip time of these packets is used in calculating the minimum/average/maximum/mdev round-trip time numbers. The ping app will continue sending packages until you terminate with Ctrl c . This can be useful if you want to know when your router becomes available after restart. But you can also limit the number of packages when you invoke the command Gateway connection ping -c 3 IP4.GATEWAY Name server connection ping -c 3 IP4.DNS routing check :information_source: Requires traceroute To check how the package travels in the network we use traceroute . This app sends back all the hops it makes until it reaches it destination. These hops are useful to determine if the issue at hand is internal or external. You can verify the internal hops by comparing the output of the traceroute command with the output of the above nmcli command. To check external routing use a known external IP address e.g. one of Google's nameservers traceroute 8.8.8.8 dns check Verify if the name lookup works as expected using drill . Using a couple of different domain names will ensure it is not a cached result. Try a domain you have never looked up before e.g. nix.dk (one of mine) \u279c ~ drill nix.dk ;; ->>HEADER<<- opcode: QUERY, rcode: NOERROR, id: 44615 ;; flags: qr rd ra ; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0 ;; QUESTION SECTION: ;; nix.dk. IN A ;; ANSWER SECTION: nix.dk. 3600 IN A 5.103.137.72 ;; AUTHORITY SECTION: ;; ADDITIONAL SECTION: ;; Query time: 18 msec ;; SERVER: 127.0.0.53 ;; WHEN: Tue Dec 21 13:29:08 2021 ;; MSG SIZE rcvd: 40 domain traceroute check :information_source: Requires traceroute Being able to resolve the domain name does not imply you can reach the domain - so knowing where the connection breaks is often informative. ISP support if often more responsive the more you know. traceroute nix.dk Locating devices on your network :information_source: Requires arp-scan Every network'd device has several unique identifiers. MAC address IP address hostname Locating the devices on your network can be done using arp-scan. You will need to be root, or arp-scan must be SUID root, in order to run arp-scan, because the functions that it uses to read and write packets require root privilege. # arp-scan --localnet Interface: eno1, type: EN10MB, MAC: 00:d8:61:xx:yy:zz, IPv4: 10.10.10.20 Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan) 10.10.10.1 fc:ec:da:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.2 14:91:82:xx:yy:zz Belkin International Inc. 10.10.10.3 8e:3b:ad:xx:yy:zz (Unknown: locally administered) 10.10.10.4 b8:27:eb:xx:yy:zz Raspberry Pi Foundation 10.10.10.5 fc:ec:da:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.10 00:11:32:xx:yy:zz Synology Incorporated 10.10.10.19 94:57:a5:xx:yy:zz Hewlett Packard 10.10.10.30 18:e8:29:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.31 fc:ec:da:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.32 b4:fb:e4:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.201 3c:d9:2b:xx:yy:zz Hewlett Packard 10.10.10.204 b4:fb:e4:xx:yy:zz Ubiquiti Networks Inc. 12 packets received by filter, 0 packets dropped by kernel Ending arp-scan 1.9.7: 256 hosts scanned in 2.039 seconds (125.55 hosts/sec). 12 responded","title":"Network know-how"},{"location":"manjaro/network/network-basic-troubleshooting/#network-connections","text":"This is not a guide on troubleshooting hardware and drivers but the network connection itself. The guide is assuming your hardware and driver(s) are in a working state. The guide is intended as a reference for working your self through situations like I can't connect to the internet I ping an IP but not a domain name How can I find my printer's IP Every user will be in a situation when network troubleshooting is necessary - it is almost inevitable. NOTE: This is a work in progress ... please add a comment if there is a network topic you would like covered - maybe in a separate guide. IPv6 is a topic on it's own - completely different and I know nothing - so please don't ask.","title":"Network connections"},{"location":"manjaro/network/network-basic-troubleshooting/#troubleshooting","text":"Network troubleshooting is like an onion. You peel one layer at a time until you reach the core. Always start with the system having issues. Having additional packages installed before problems arise is useful but not necessary. $ sudo pacman -Syu bind whois arp-scan net-tools traceroute","title":"Troubleshooting"},{"location":"manjaro/network/network-basic-troubleshooting/#network-info","text":"Getting some basic info can be done numerous ways using a variety of utilites. In the context of providing basic info NetworkManager's CLI tool provides a good overview and is Manjaro default network manager. Example output $ nmcli device show | grep IP4 IP4.ADDRESS[1]: 10.10.10.20/24 IP4.GATEWAY: 10.10.10.1 IP4.ROUTE[1]: dst = 0.0.0.0/0, nh = 10.10.10.1, mt = 100 IP4.ROUTE[2]: dst = 10.10.10.0/24, nh = 0.0.0.0, mt = 100 IP4.DNS[1]: 10.10.10.4 IP4.DOMAIN[1]: lan.nix.dk IP4.ADDRESS[1]: 127.0.0.1/8 IP4.GATEWAY: -- Using the output from your system - look for answers to the following questions Do I have an address : \u2192 IP4.ADDRESS ? Is the IP in the expected sub net : \u2192 IP4.ROUTE dst = ? Is the gateway correct: \u2192 IP4.GATEWAY ? Is the DNS correct: \u2192 IP4.DNS ? Is the route correct:\u2192 IP4.ROUTE ? If everything checks - continue to testing your connection - use the data from your system.","title":"Network info"},{"location":"manjaro/network/network-basic-troubleshooting/#connectivity-check","text":"From man ping When using ping for fault isolation, it should first be run on the local host, to verify that the local network interface is up and running. Then, hosts and gateways further and further away should be \u201cpinged\u201d. Round-trip times and packet loss statistics are computed. If duplicate packets are received, they are not included in the packet loss calculation, although the round trip time of these packets is used in calculating the minimum/average/maximum/mdev round-trip time numbers. The ping app will continue sending packages until you terminate with Ctrl c . This can be useful if you want to know when your router becomes available after restart. But you can also limit the number of packages when you invoke the command Gateway connection ping -c 3 IP4.GATEWAY Name server connection ping -c 3 IP4.DNS","title":"connectivity check"},{"location":"manjaro/network/network-basic-troubleshooting/#routing-check","text":":information_source: Requires traceroute To check how the package travels in the network we use traceroute . This app sends back all the hops it makes until it reaches it destination. These hops are useful to determine if the issue at hand is internal or external. You can verify the internal hops by comparing the output of the traceroute command with the output of the above nmcli command. To check external routing use a known external IP address e.g. one of Google's nameservers traceroute 8.8.8.8","title":"routing check"},{"location":"manjaro/network/network-basic-troubleshooting/#dns-check","text":"Verify if the name lookup works as expected using drill . Using a couple of different domain names will ensure it is not a cached result. Try a domain you have never looked up before e.g. nix.dk (one of mine) \u279c ~ drill nix.dk ;; ->>HEADER<<- opcode: QUERY, rcode: NOERROR, id: 44615 ;; flags: qr rd ra ; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0 ;; QUESTION SECTION: ;; nix.dk. IN A ;; ANSWER SECTION: nix.dk. 3600 IN A 5.103.137.72 ;; AUTHORITY SECTION: ;; ADDITIONAL SECTION: ;; Query time: 18 msec ;; SERVER: 127.0.0.53 ;; WHEN: Tue Dec 21 13:29:08 2021 ;; MSG SIZE rcvd: 40","title":"dns check"},{"location":"manjaro/network/network-basic-troubleshooting/#domain-traceroute-check","text":":information_source: Requires traceroute Being able to resolve the domain name does not imply you can reach the domain - so knowing where the connection breaks is often informative. ISP support if often more responsive the more you know. traceroute nix.dk","title":"domain traceroute check"},{"location":"manjaro/network/network-basic-troubleshooting/#locating-devices-on-your-network","text":":information_source: Requires arp-scan Every network'd device has several unique identifiers. MAC address IP address hostname Locating the devices on your network can be done using arp-scan. You will need to be root, or arp-scan must be SUID root, in order to run arp-scan, because the functions that it uses to read and write packets require root privilege. # arp-scan --localnet Interface: eno1, type: EN10MB, MAC: 00:d8:61:xx:yy:zz, IPv4: 10.10.10.20 Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan) 10.10.10.1 fc:ec:da:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.2 14:91:82:xx:yy:zz Belkin International Inc. 10.10.10.3 8e:3b:ad:xx:yy:zz (Unknown: locally administered) 10.10.10.4 b8:27:eb:xx:yy:zz Raspberry Pi Foundation 10.10.10.5 fc:ec:da:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.10 00:11:32:xx:yy:zz Synology Incorporated 10.10.10.19 94:57:a5:xx:yy:zz Hewlett Packard 10.10.10.30 18:e8:29:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.31 fc:ec:da:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.32 b4:fb:e4:xx:yy:zz Ubiquiti Networks Inc. 10.10.10.201 3c:d9:2b:xx:yy:zz Hewlett Packard 10.10.10.204 b4:fb:e4:xx:yy:zz Ubiquiti Networks Inc. 12 packets received by filter, 0 packets dropped by kernel Ending arp-scan 1.9.7: 256 hosts scanned in 2.039 seconds (125.55 hosts/sec). 12 responded","title":"Locating devices on your network"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/","text":"Network configuration Difficulty: \u2605\u2605\u2605\u2605\u2605 Serving a local network Resolving local network devices can be a pain because the name query is often forwarded to root nameservers or ISP cache servers which returns NXDOMAIN. To create a robust LAN whether it is for home or small business use you need an internet facing domain which access to DNS control panel. These notes uses bind on a Raspberry Pi running the default Raspberry Pi OS. !! DO NOT !! .local is used with the AVAHI zeroconf specification. Do not invent you own .lan or something similar - the result will not be as expected. !!! REQUIRED !!! Experience with terminal is mandatory as all setup is done using a SSH connection and any error will break your connection. Knowledge of DNS, zone files and dhcp especially ISC bind and ISC dhcp is also mandatory. Install bind and dhcp Ensure your system is up-to-date then install bind and dhcp packages apt update && sudo apt upgrade -y apt install bind9 isc-dhcp-server -y Example config Object Value domain mydomain.org local domain corp.mydomain.org local net/subnet 172.16.10.0/24 local gateway IP 172.16.10.1 local nameserver IP 172.16.10.2 dhcp range 172.16.10.100 to 200 temp nameserver IP 91.239.100.100 The temporary nameserver is provided by uncensoreddns.org Static IP Assign a static IP to your Pi by editing your network configuration. Create a file /etc/network/interfaces and add content auto lo iface lo inet loopback auto eth0 iface eth0 inet static address 172.16.10.2 netmask 255.255.255.0 gateway 172.16.10.1 dns-nameservers 91.239.100.100 # dns-nameservers 127.0.0.1 Double check your entries and reload sudo systemctl daemon-reload sudo systemctl reload network From another terminal on your workstation ping your Pi ping 172.16.10.2 On your Pi check the lookup dig domain.org Ensure you have a working Pi before continuing Setup your public DNS Login into your domain dns controlpanel and create the following records and save the changes A-record ns.corp.domain.org with IP 172.16.10.2 Nameserver ns.corp.domain.org for corp.domain.org Dump zone file from your control panel and verify the zone is correct ns.corp.domain.org. 43200 IN A 172.16.10.2 corp.domain.org. 43200 IN NS ns.corp.domain.org. 43200 A 172.16.10.0 corp.domain.org zone Enable and start the local nameserver systemctl enable bind9.service systemctl start bind9.service Create a local zone file /etc/bind/db.corp.domain.org with content $TTL 1h @ IN SOA ns.corp.domain.org. admin.domain.org. ( 1 ; Serial 3600 ; Refresh 3600 ; Retry 1W ; Exire 3H ; Negative Cache TTL ) @ IN NS ns.corp.domain.org. ns IN A 172.16.10.2 mail IN A 172.16.10.3 webmail IN CNAME mail.corp.domain.org. Check the zone named-checkconf /etc/bind/db.corp.domain.org 172.16.10.0/24 reverse zone Create a reverse zone file /etc/bind/db.172.16.10 with content @ IN SOA ns.corp.domain.org. admin.domain.org. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 604800 ; Negative Cache TTL ) @ IN NS ns.corp.domain.org. 2 IN PTR ns.corp.domain.org 3 IN PTR mail.corp.domain.org Check the zone named-checkconf /etc/bind/db.172.160.10 Edit /etc/bind/zones.rfc1918 and comment the line for your reverse zone file and save # zone \"16.172.in-addr.arpa\" { type master; file \"/etc/bind/db.empty\"; }; Check the zone named-checkconf /etc/bind/zones.rfc1918 Adding zones Edit /etc/bind/named.conf.local and add the new new zones and save the file zone \"corp.domain.org\" { type master; file \"/etc/bind/db.corp.domain.org; }; zone \"10.16.172.in-addr.arpa\" { type master; file \"/etc/bind/db.172.16.10\"; }; Check the zone named-checkconf /etc/bind/named.conf.local Check root servers Check the root hints in db.root and update the file if necessary (remember to check the zone if you edit) dig +bufsize=1200 +norec NS . @a.root-servers.net | egrep -v ';|^$' | sort Check the options file Edit the file /etc/bind/named.conf.options if necessary - remember to check the zone after edit. Time of reckoning Reload the bind9 service systemctl reload bind9.service On the Pi test your lookup dig corp.domain.org Change your Raspberry Pi network to use local bind service by editing the file /etc/network/interfaces file Change the temporay nameserver to 127.0.0.1 save the file and reload networking. #dns-nameservers 91.239.100.100 dns-nameservers 127.0.0.1 systemctl reload networking On the Pi test your lookup one more time - you should get the same answer - this time from your Pi dig corp.domain.org Setting up isc-dhcp Edit the file /etc/dhcp/dhcpd.conf with content ddns-update-style interim; ddns-updates on; do-forward-updates on; option domain-name \"corp.domain.org\"; option domain-name-servers 172.16.10.2; option broadcast-address 172.16.10.255; option routers 172.16.10.1; default-lease-time 86400; max-lease-time 604800; subnet 172.16.10.0 netmask 255.255.255.0 { range 172.16.10.101 172.16.10.200; }; ! Only one DHCP service is allowed for a network so disable all other DHCP services. When you have disabled router DHCP - enable and start the isc-dhcp-server.service systemctl enable isc-dhcp-server.service systemctl start isc-dhcp-server.service BIND ad blocker When you have gone through lengths to set up your dns - you might as well utilize bind to block ads and known malware domains. Below is the README from https://github.com/Trellmor/bind-adblock which I have utilized to sanitize my network. The BIND ad blocker fetches various blocklists and generate a BIND zone from them. Configure BIND to return NXDOMAIN for ad and tracking domains to stop clients from contacting them. Requires BIND 9.8 or newer for RPZ support. Uses the following sources: Peter Lowe\u2019s Ad and tracking server list Malware domains MVPS HOSTS Adaway default blocklist Dan Pollock\u2019s hosts file MalwareDomainList.com Hosts List StevenBlack Unified hosts file CAMELEON Disconnect.me Basic tracking list Disconnect.me Ad Filter list Polish CERT Phishing list Setup Python packages See requirements.txt To install pip install -r requirements.txt Configure BIND Add the response-policy statement to the BIND options // For AdBlock response-policy { zone \"rpz.example.com\"; }; Add your rpz zone. Replace example.com with a domain of your choice. // AdBlock zone \"rpz.example.com\" { type master; file \"/etc/bind/db.rpz.example.com\"; masterfile-format text; allow-query { none; }; }; Create a zone file for your zone. Replace example.com with the domain you used before. @ 3600 IN SOA @ admin.example.com. 0 86400 7200 2592000 86400 @ 3600 IN NS ns.example.com. Usage usage: update-zonefile.py [-h] [--no-bind] [--raw] [--empty] zonefile origin Update zone file from public DNS ad blocking lists positional arguments: zonefile path to zone file origin zone origin optional arguments: -h, --help show this help message and exit --no-bind Don't try to check/reload bind zone --raw Save the zone file in raw format. Requires named-compilezone --empty Create header-only (empty) rpz zone file Example: update-zonefile.py /etc/bind/db.rpz.example.com rpz.example.com update-zonefile.py will update the zone file with the fetched adserver lists and issue a rndc reload origin afterwards. Whitelist You can either use an additional zone to whitelist domains (Or add them to config.yml ) See Whitelist for adding a whitelist zone.","title":"Using bind for local domain"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#network-configuration","text":"Difficulty: \u2605\u2605\u2605\u2605\u2605","title":"Network configuration"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#serving-a-local-network","text":"Resolving local network devices can be a pain because the name query is often forwarded to root nameservers or ISP cache servers which returns NXDOMAIN. To create a robust LAN whether it is for home or small business use you need an internet facing domain which access to DNS control panel. These notes uses bind on a Raspberry Pi running the default Raspberry Pi OS. !! DO NOT !! .local is used with the AVAHI zeroconf specification. Do not invent you own .lan or something similar - the result will not be as expected. !!! REQUIRED !!! Experience with terminal is mandatory as all setup is done using a SSH connection and any error will break your connection. Knowledge of DNS, zone files and dhcp especially ISC bind and ISC dhcp is also mandatory.","title":"Serving a local network"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#install-bind-and-dhcp","text":"Ensure your system is up-to-date then install bind and dhcp packages apt update && sudo apt upgrade -y apt install bind9 isc-dhcp-server -y","title":"Install bind and dhcp"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#example-config","text":"Object Value domain mydomain.org local domain corp.mydomain.org local net/subnet 172.16.10.0/24 local gateway IP 172.16.10.1 local nameserver IP 172.16.10.2 dhcp range 172.16.10.100 to 200 temp nameserver IP 91.239.100.100 The temporary nameserver is provided by uncensoreddns.org","title":"Example config"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#static-ip","text":"Assign a static IP to your Pi by editing your network configuration. Create a file /etc/network/interfaces and add content auto lo iface lo inet loopback auto eth0 iface eth0 inet static address 172.16.10.2 netmask 255.255.255.0 gateway 172.16.10.1 dns-nameservers 91.239.100.100 # dns-nameservers 127.0.0.1 Double check your entries and reload sudo systemctl daemon-reload sudo systemctl reload network From another terminal on your workstation ping your Pi ping 172.16.10.2 On your Pi check the lookup dig domain.org Ensure you have a working Pi before continuing","title":"Static IP"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#setup-your-public-dns","text":"Login into your domain dns controlpanel and create the following records and save the changes A-record ns.corp.domain.org with IP 172.16.10.2 Nameserver ns.corp.domain.org for corp.domain.org Dump zone file from your control panel and verify the zone is correct ns.corp.domain.org. 43200 IN A 172.16.10.2 corp.domain.org. 43200 IN NS ns.corp.domain.org. 43200 A 172.16.10.0","title":"Setup your public DNS"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#corpdomainorg-zone","text":"Enable and start the local nameserver systemctl enable bind9.service systemctl start bind9.service Create a local zone file /etc/bind/db.corp.domain.org with content $TTL 1h @ IN SOA ns.corp.domain.org. admin.domain.org. ( 1 ; Serial 3600 ; Refresh 3600 ; Retry 1W ; Exire 3H ; Negative Cache TTL ) @ IN NS ns.corp.domain.org. ns IN A 172.16.10.2 mail IN A 172.16.10.3 webmail IN CNAME mail.corp.domain.org. Check the zone named-checkconf /etc/bind/db.corp.domain.org","title":"corp.domain.org zone"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#1721610024-reverse-zone","text":"Create a reverse zone file /etc/bind/db.172.16.10 with content @ IN SOA ns.corp.domain.org. admin.domain.org. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 604800 ; Negative Cache TTL ) @ IN NS ns.corp.domain.org. 2 IN PTR ns.corp.domain.org 3 IN PTR mail.corp.domain.org Check the zone named-checkconf /etc/bind/db.172.160.10 Edit /etc/bind/zones.rfc1918 and comment the line for your reverse zone file and save # zone \"16.172.in-addr.arpa\" { type master; file \"/etc/bind/db.empty\"; }; Check the zone named-checkconf /etc/bind/zones.rfc1918","title":"172.16.10.0/24 reverse zone"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#adding-zones","text":"Edit /etc/bind/named.conf.local and add the new new zones and save the file zone \"corp.domain.org\" { type master; file \"/etc/bind/db.corp.domain.org; }; zone \"10.16.172.in-addr.arpa\" { type master; file \"/etc/bind/db.172.16.10\"; }; Check the zone named-checkconf /etc/bind/named.conf.local","title":"Adding zones"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#check-root-servers","text":"Check the root hints in db.root and update the file if necessary (remember to check the zone if you edit) dig +bufsize=1200 +norec NS . @a.root-servers.net | egrep -v ';|^$' | sort","title":"Check root servers"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#check-the-options-file","text":"Edit the file /etc/bind/named.conf.options if necessary - remember to check the zone after edit.","title":"Check the options file"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#time-of-reckoning","text":"Reload the bind9 service systemctl reload bind9.service On the Pi test your lookup dig corp.domain.org Change your Raspberry Pi network to use local bind service by editing the file /etc/network/interfaces file Change the temporay nameserver to 127.0.0.1 save the file and reload networking. #dns-nameservers 91.239.100.100 dns-nameservers 127.0.0.1 systemctl reload networking On the Pi test your lookup one more time - you should get the same answer - this time from your Pi dig corp.domain.org","title":"Time of reckoning"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#setting-up-isc-dhcp","text":"Edit the file /etc/dhcp/dhcpd.conf with content ddns-update-style interim; ddns-updates on; do-forward-updates on; option domain-name \"corp.domain.org\"; option domain-name-servers 172.16.10.2; option broadcast-address 172.16.10.255; option routers 172.16.10.1; default-lease-time 86400; max-lease-time 604800; subnet 172.16.10.0 netmask 255.255.255.0 { range 172.16.10.101 172.16.10.200; }; ! Only one DHCP service is allowed for a network so disable all other DHCP services. When you have disabled router DHCP - enable and start the isc-dhcp-server.service systemctl enable isc-dhcp-server.service systemctl start isc-dhcp-server.service","title":"Setting up isc-dhcp"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#bind-ad-blocker","text":"When you have gone through lengths to set up your dns - you might as well utilize bind to block ads and known malware domains. Below is the README from https://github.com/Trellmor/bind-adblock which I have utilized to sanitize my network. The BIND ad blocker fetches various blocklists and generate a BIND zone from them. Configure BIND to return NXDOMAIN for ad and tracking domains to stop clients from contacting them. Requires BIND 9.8 or newer for RPZ support. Uses the following sources: Peter Lowe\u2019s Ad and tracking server list Malware domains MVPS HOSTS Adaway default blocklist Dan Pollock\u2019s hosts file MalwareDomainList.com Hosts List StevenBlack Unified hosts file CAMELEON Disconnect.me Basic tracking list Disconnect.me Ad Filter list Polish CERT Phishing list","title":"BIND ad blocker"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#setup","text":"","title":"Setup"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#python-packages","text":"See requirements.txt To install pip install -r requirements.txt","title":"Python packages"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#configure-bind","text":"Add the response-policy statement to the BIND options // For AdBlock response-policy { zone \"rpz.example.com\"; }; Add your rpz zone. Replace example.com with a domain of your choice. // AdBlock zone \"rpz.example.com\" { type master; file \"/etc/bind/db.rpz.example.com\"; masterfile-format text; allow-query { none; }; }; Create a zone file for your zone. Replace example.com with the domain you used before. @ 3600 IN SOA @ admin.example.com. 0 86400 7200 2592000 86400 @ 3600 IN NS ns.example.com.","title":"Configure BIND"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#usage","text":"usage: update-zonefile.py [-h] [--no-bind] [--raw] [--empty] zonefile origin Update zone file from public DNS ad blocking lists positional arguments: zonefile path to zone file origin zone origin optional arguments: -h, --help show this help message and exit --no-bind Don't try to check/reload bind zone --raw Save the zone file in raw format. Requires named-compilezone --empty Create header-only (empty) rpz zone file Example: update-zonefile.py /etc/bind/db.rpz.example.com rpz.example.com update-zonefile.py will update the zone file with the fetched adserver lists and issue a rndc reload origin afterwards.","title":"Usage"},{"location":"manjaro/network/network-dns-using-bind-for-local-domain/#whitelist","text":"You can either use an additional zone to whitelist domains (Or add them to config.yml ) See Whitelist for adding a whitelist zone.","title":"Whitelist"},{"location":"manjaro/network/network-share-peer-to-peer-connection/","text":"Computer A - having internet connection- using phone tether or wlan nmcli connection modify myconnection ipv4.method shared sudo systemctl restart NetworkManager Computer B having no network nmcli connection modify myconnection ipv4.method auto sudo systemctl restart NetworkManager Connect ethernet cable Source Connect 2 PCs, one has internet via USB-tethering - Manjaro Linux Forum","title":"Share network connection peer-to-peer"},{"location":"manjaro/network/network-tigervnc-over-ssh/","text":"VNC VNC is a protocol where you use your keyboard/mouse/screen an mouse to monitor or control a remote system. This document is a real-world implementation of the document(s) found at Archlinux Wiki - TigerVNC . NOTE : The setup is not implementing any VNC encryption so SSH will be used to establish the connection. The benefit of using SSH is that you can easily adapt this to target any remote server. Target system On the system to be controlled install package tigervnc Config Replace the phrase $USERNAME with the username of the actual user you want to configure. Create the file ~/$USERNAME/.vnc/config with content ( replace session according to your installation ) session=openbox geometry=1400x900 localhost dpi=96 Create a password for the user using vncpasswd Edit /etc/tigervnc/vncserver.users and append :2=$USERNAME Start a vncserver at the selected display systemctl enable --now vncserver@:2 Controlling system Install the package tigervnc Connect to target system SSH provides a secure channel and using key based authentication is the recommended method. Open a ssh connection using port mapping ssh $USERNAME@client -L 9902:localhost:5902 Then launch the VNC viewer and input the following connection details then click connect localhost:9902 Input the password created earlier (ignore the warning as we are using an encrypted connection) and you will see the remote system.","title":"TigerVNC over SSH"},{"location":"manjaro/network/network-tigervnc-over-ssh/#vnc","text":"VNC is a protocol where you use your keyboard/mouse/screen an mouse to monitor or control a remote system. This document is a real-world implementation of the document(s) found at Archlinux Wiki - TigerVNC . NOTE : The setup is not implementing any VNC encryption so SSH will be used to establish the connection. The benefit of using SSH is that you can easily adapt this to target any remote server.","title":"VNC"},{"location":"manjaro/network/network-tigervnc-over-ssh/#target-system","text":"On the system to be controlled install package tigervnc","title":"Target system"},{"location":"manjaro/network/network-tigervnc-over-ssh/#config","text":"Replace the phrase $USERNAME with the username of the actual user you want to configure. Create the file ~/$USERNAME/.vnc/config with content ( replace session according to your installation ) session=openbox geometry=1400x900 localhost dpi=96 Create a password for the user using vncpasswd Edit /etc/tigervnc/vncserver.users and append :2=$USERNAME Start a vncserver at the selected display systemctl enable --now vncserver@:2","title":"Config"},{"location":"manjaro/network/network-tigervnc-over-ssh/#controlling-system","text":"Install the package tigervnc","title":"Controlling system"},{"location":"manjaro/network/network-tigervnc-over-ssh/#connect-to-target-system","text":"SSH provides a secure channel and using key based authentication is the recommended method. Open a ssh connection using port mapping ssh $USERNAME@client -L 9902:localhost:5902 Then launch the VNC viewer and input the following connection details then click connect localhost:9902 Input the password created earlier (ignore the warning as we are using an encrypted connection) and you will see the remote system.","title":"Connect to target system"},{"location":"manjaro/network/networkmanager-disable-connectivity-check/","text":"Connectivity check NetworkManager handles network connection and periodically checks if an internet connection exist - default 300s. Disable this by creating a file sudo cp /usr/lib/NetworkManager/conf.d/20-connectivity.conf /etc/NetworkManager/conf.d Append the following to the file echo \"interval=0\" | sudo tee -a /etc/NetworkManager/conf.d/20-connectivity.conf Reload the configuration files and restart the service sudo systemctl daemon-reload sudo systemctl restart NetworkManager The interval = 0 disables the check. Change the uri to what ever service trusted or controllable. Consider the implications as NetworkManager is now agnostic on the internet connection.","title":"Disable NetworkManager connectivity check"},{"location":"manjaro/network/networkmanager-disable-connectivity-check/#connectivity-check","text":"NetworkManager handles network connection and periodically checks if an internet connection exist - default 300s. Disable this by creating a file sudo cp /usr/lib/NetworkManager/conf.d/20-connectivity.conf /etc/NetworkManager/conf.d Append the following to the file echo \"interval=0\" | sudo tee -a /etc/NetworkManager/conf.d/20-connectivity.conf Reload the configuration files and restart the service sudo systemctl daemon-reload sudo systemctl restart NetworkManager The interval = 0 disables the check. Change the uri to what ever service trusted or controllable. Consider the implications as NetworkManager is now agnostic on the internet connection.","title":"Connectivity check"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/","text":"Goal Sharing data between 2 computer in both directions. We will apply the sharing of the ~/Music folder and we will ensure there is no duplicated data. This guide is an application of the Arch wiki guide to NFS Preparation On Manjaro the package providing NFS is nfs-utils and is installed as part of the system. As the NFS service works using either IP address or hostnames it is a good idea to test if you can ping a computer using its hostname. We will use the client/server topology so select a system with a lot of available storage as server - as it makes sense to designate the available storage to as a network share. A server needs to be powered up and visible on the network and have a predictable address on the network. In this guide we assume you are using Network Manager and you set a static IP for your network card. You can use WiFi but it is not as good as a wired connection. For this guide we assume - network: 192.168.1.0 - subnet: 255.255.255.0 - server IP: 192.168.1.20 - computername: server01 The share As we want to avoid duplicating data we will move the relevant folder from the home folder to a designated structure and symlink the data into the home folder. Create the data structure On the server create the folder structure and make the share point writable by world - in this example the Music folder. # mkdir -p /data/Music # chmod ugo+rwx /data/Music Move the content of the ~/Music folder to the new folder - remove the empty ~/Music folder and symlink it to the new location $ mv ~/Music/* /data/Music/ $ rm -f ~/Music $ ln -sf /data/Music ~/Music Verify it is done right by listing the content of ~/Music $ ls ~/Music Create export folders To share the folders using NFS we need an export point and the /srv folder is entrypoint. Create a folder to designate this is the NFS service point. # mkdir -p /srv/nfs/Music Server bind mount To avoid sharing a location which could expose the system we create a bind mount in the file system table binding the data folder with the nfs export point /etc/fstab /data/Music /srv/nfs/Music none bind 0 0 Mount without restart Remount the mount points using mount # mount -a Export the shares Edit the file /etc/exports share the root of the NFS and the share itself and access control for the shares. NFS works only with IP and/or hostname restrictions so it is possible to restrict further down using only IP addresses or hostnames. The example below adapted from the Arch wiki - tested and tried - it works. Additionally you can export the same share multiple times thus limiting access to a specific share to e.g. two devices - if the device uses a dynamic IP you can specifiy hostname and get the same result as if it uses static IP. In the example below we have allowed all computers on the network to connect to the Music share /etc/exports /srv/nfs 192.168.1.0/24(rw,sync,crossmnt,fsid=0) /srv/nfs/Music 192.168.1.0/24(rw,sync) Service Enable and start the service. # systemctl enable --now nfs-server.service Client Enable and start the service # systemctl enable --now nfs-client.target Mounting Manual Using a manual or fstab mount - you would create a similar folder structure on the client If you choose systemd units - systemd will take care of the folder creation - and all you have to do is symlink the folder when it has been mounted for the first time fh@ts:~|\u21d2 tree -L 2 /data /data \u2514\u2500\u2500 nfs \u2514\u2500\u2500 web Manual mount the folder from the server $ sudo mount -t nfs server01:/Music ~/data/nfs/music Verify the share is up by listing the content of the mount $ ls /data/nfs/music If you want the shared music folder to appear directly as Music on client you can symlink directly to the clients Music folder - just ensure it is empty. ln -sf /data/nfs/music ~/Music Mount using fstab Using fstab requires the folder structure to present like a manual mount The line in fstab could look like this server01:/nfs/music /data/nfs/music nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 Using systemd units The folder structure is not required as systemd will create it on first mount. The system units are required to be named as the mount path followed by .mount # touch /etc/systemd/system/data-nfs-music.mount [Unit] Description=Music After=network.target [Mount] What=server01:/nfs/music Where=/data/nfs/music Type=nfs Options=_netdev,auto [Install] WantedBy=multi-user.target Enable the mount # systemctl enable data-nfs-music.mount Then the automount unit (same name rule) # touch /etc/systemd/system/data-nfs-music.automount [Unit] Description=Automount music share ConditionPathExists=/data/nfs/music [Automount] Where=/data/nfs/music TimeoutIdleSec=10 [Install] WantedBy=multi-user.target Before you start the automount unit - ensure the share is not mounted - or the automount will fail. Enable and start the automount # systemctl enable --now data-nfs-music.automount Navigate to the folder /data/nfs/music and verify the it has the content from your nfs service. Conclusion You have now shared your collection of music on your local network. Any change to the ~/Music folder will immediately be reflected on the network. Background on the chosen folder tree On the nix filesystem we have a location named /mnt *. This location is mostly used to mount filesystems to chroot into, make changes and exit. The folder is described as a place for temporary mounts Filesystem Hierachy Standard Path Usage /mnt Temporarily mounted filesystems. The standard also suggests a folder for shared data Path Usage /srv Site-specific data served by this system, such as data and scripts for web servers, data offered by FTP servers ... The SysAdmin recommendation What follows here is my personal experience as a sysadmin and believe me - make it simple - easily memorable - you can thank me later. Your data As a safeguard of your system, the actual data should be located in a separate structure. You will later be adding bind mounts for them. The data structure can - as starting point - be anything but sticking to the recognizable - use a distinctive pattern and simple rules Partitions mount in folders right below /data/ Shares from other systems in service/folder structure e.g. /data/nfs/data Move local data to designated folders and use local symlinks to users home e.g. move the ~/Music to /data/local/Music and symlink the folder back ln -s /data/local/Music ~/Music Example Starting in /data/ your structure could look like this /data >>> tree -L 2 . \u251c\u2500\u2500 build \u251c\u2500\u2500 nfs \u2502 \u2514\u2500\u2500 data \u251c\u2500\u2500 smb \u2502 \u2514\u2500\u2500 data \u251c\u2500\u2500 local \u2502 \u251c\u2500\u2500 Music \u2502 \u2514\u2500\u2500 Video \u251c\u2500\u2500 projects \u2514\u2500\u2500 virtualbox Mount your partitions using fstab Your shares For the data you plan to share, create a similar structure using /srv/ as base. /srv >>> tree -L 2 . \u2514\u2500\u2500 nfs \u251c\u2500\u2500 Music \u2514\u2500\u2500 Video Add bind mounts to fstab - as bind mounts adds a layer of security to your shares - as you should avoid sharing anything which eventually could be used to traverse the root of your system. /data/local/Music /srv/nfs/Music none bind 0 0 /data/local/Video /srv/nfs/Video none bind 0 0 To avoid duplication of data you could create a symlink to your home folder - or - in case of indexing utilities like Albert which do not follow symlinks you could create an additional bind mount for the user(s) on the system. As example - replace username with the actual username for which you would like to make the folder indexable. /data/local/Music /home/username/Music none bind 0 0 Further reading https://wiki.archlinux.org/index.php/NFS https://wiki.archlinux.org/index.php/samba Windows NFS Client Based on the comments below - there are options to use Windows as NFS client. The forum do not recommend one solition for another and do not support such client. Windows 10 PRO and Enterprise Editions supports NFS Windows subsystem for Linux https://github.com/DeCoRawr/NFSClient/ Revisions 2020-03-21 Fix error in mv command Added systemd units 2019-09 Initial guide","title":"Setting up NFS using Manjaro"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#goal","text":"Sharing data between 2 computer in both directions. We will apply the sharing of the ~/Music folder and we will ensure there is no duplicated data. This guide is an application of the Arch wiki guide to NFS","title":"Goal"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#preparation","text":"On Manjaro the package providing NFS is nfs-utils and is installed as part of the system. As the NFS service works using either IP address or hostnames it is a good idea to test if you can ping a computer using its hostname. We will use the client/server topology so select a system with a lot of available storage as server - as it makes sense to designate the available storage to as a network share. A server needs to be powered up and visible on the network and have a predictable address on the network. In this guide we assume you are using Network Manager and you set a static IP for your network card. You can use WiFi but it is not as good as a wired connection. For this guide we assume - network: 192.168.1.0 - subnet: 255.255.255.0 - server IP: 192.168.1.20 - computername: server01","title":"Preparation"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#the-share","text":"As we want to avoid duplicating data we will move the relevant folder from the home folder to a designated structure and symlink the data into the home folder.","title":"The share"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#create-the-data-structure","text":"On the server create the folder structure and make the share point writable by world - in this example the Music folder. # mkdir -p /data/Music # chmod ugo+rwx /data/Music Move the content of the ~/Music folder to the new folder - remove the empty ~/Music folder and symlink it to the new location $ mv ~/Music/* /data/Music/ $ rm -f ~/Music $ ln -sf /data/Music ~/Music Verify it is done right by listing the content of ~/Music $ ls ~/Music","title":"Create the data structure"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#create-export-folders","text":"To share the folders using NFS we need an export point and the /srv folder is entrypoint. Create a folder to designate this is the NFS service point. # mkdir -p /srv/nfs/Music","title":"Create export folders"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#server-bind-mount","text":"To avoid sharing a location which could expose the system we create a bind mount in the file system table binding the data folder with the nfs export point /etc/fstab /data/Music /srv/nfs/Music none bind 0 0","title":"Server bind mount"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#mount-without-restart","text":"Remount the mount points using mount # mount -a","title":"Mount without restart"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#export-the-shares","text":"Edit the file /etc/exports share the root of the NFS and the share itself and access control for the shares. NFS works only with IP and/or hostname restrictions so it is possible to restrict further down using only IP addresses or hostnames. The example below adapted from the Arch wiki - tested and tried - it works. Additionally you can export the same share multiple times thus limiting access to a specific share to e.g. two devices - if the device uses a dynamic IP you can specifiy hostname and get the same result as if it uses static IP. In the example below we have allowed all computers on the network to connect to the Music share /etc/exports /srv/nfs 192.168.1.0/24(rw,sync,crossmnt,fsid=0) /srv/nfs/Music 192.168.1.0/24(rw,sync)","title":"Export the shares"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#service","text":"Enable and start the service. # systemctl enable --now nfs-server.service","title":"Service"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#client","text":"Enable and start the service # systemctl enable --now nfs-client.target","title":"Client"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#mounting","text":"","title":"Mounting"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#manual","text":"Using a manual or fstab mount - you would create a similar folder structure on the client If you choose systemd units - systemd will take care of the folder creation - and all you have to do is symlink the folder when it has been mounted for the first time fh@ts:~|\u21d2 tree -L 2 /data /data \u2514\u2500\u2500 nfs \u2514\u2500\u2500 web Manual mount the folder from the server $ sudo mount -t nfs server01:/Music ~/data/nfs/music Verify the share is up by listing the content of the mount $ ls /data/nfs/music If you want the shared music folder to appear directly as Music on client you can symlink directly to the clients Music folder - just ensure it is empty. ln -sf /data/nfs/music ~/Music","title":"Manual"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#mount-using-fstab","text":"Using fstab requires the folder structure to present like a manual mount The line in fstab could look like this server01:/nfs/music /data/nfs/music nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0","title":"Mount using fstab"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#using-systemd-units","text":"The folder structure is not required as systemd will create it on first mount. The system units are required to be named as the mount path followed by .mount # touch /etc/systemd/system/data-nfs-music.mount [Unit] Description=Music After=network.target [Mount] What=server01:/nfs/music Where=/data/nfs/music Type=nfs Options=_netdev,auto [Install] WantedBy=multi-user.target Enable the mount # systemctl enable data-nfs-music.mount Then the automount unit (same name rule) # touch /etc/systemd/system/data-nfs-music.automount [Unit] Description=Automount music share ConditionPathExists=/data/nfs/music [Automount] Where=/data/nfs/music TimeoutIdleSec=10 [Install] WantedBy=multi-user.target Before you start the automount unit - ensure the share is not mounted - or the automount will fail. Enable and start the automount # systemctl enable --now data-nfs-music.automount Navigate to the folder /data/nfs/music and verify the it has the content from your nfs service.","title":"Using systemd units"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#conclusion","text":"You have now shared your collection of music on your local network. Any change to the ~/Music folder will immediately be reflected on the network.","title":"Conclusion"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#background-on-the-chosen-folder-tree","text":"On the nix filesystem we have a location named /mnt *. This location is mostly used to mount filesystems to chroot into, make changes and exit. The folder is described as a place for temporary mounts Filesystem Hierachy Standard Path Usage /mnt Temporarily mounted filesystems. The standard also suggests a folder for shared data Path Usage /srv Site-specific data served by this system, such as data and scripts for web servers, data offered by FTP servers ...","title":"Background on the chosen folder tree"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#the-sysadmin-recommendation","text":"What follows here is my personal experience as a sysadmin and believe me - make it simple - easily memorable - you can thank me later.","title":"The SysAdmin recommendation"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#your-data","text":"As a safeguard of your system, the actual data should be located in a separate structure. You will later be adding bind mounts for them. The data structure can - as starting point - be anything but sticking to the recognizable - use a distinctive pattern and simple rules Partitions mount in folders right below /data/ Shares from other systems in service/folder structure e.g. /data/nfs/data Move local data to designated folders and use local symlinks to users home e.g. move the ~/Music to /data/local/Music and symlink the folder back ln -s /data/local/Music ~/Music","title":"Your data"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#example","text":"Starting in /data/ your structure could look like this /data >>> tree -L 2 . \u251c\u2500\u2500 build \u251c\u2500\u2500 nfs \u2502 \u2514\u2500\u2500 data \u251c\u2500\u2500 smb \u2502 \u2514\u2500\u2500 data \u251c\u2500\u2500 local \u2502 \u251c\u2500\u2500 Music \u2502 \u2514\u2500\u2500 Video \u251c\u2500\u2500 projects \u2514\u2500\u2500 virtualbox Mount your partitions using fstab","title":"Example"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#your-shares","text":"For the data you plan to share, create a similar structure using /srv/ as base. /srv >>> tree -L 2 . \u2514\u2500\u2500 nfs \u251c\u2500\u2500 Music \u2514\u2500\u2500 Video Add bind mounts to fstab - as bind mounts adds a layer of security to your shares - as you should avoid sharing anything which eventually could be used to traverse the root of your system. /data/local/Music /srv/nfs/Music none bind 0 0 /data/local/Video /srv/nfs/Video none bind 0 0 To avoid duplication of data you could create a symlink to your home folder - or - in case of indexing utilities like Albert which do not follow symlinks you could create an additional bind mount for the user(s) on the system. As example - replace username with the actual username for which you would like to make the folder indexable. /data/local/Music /home/username/Music none bind 0 0","title":"Your shares"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#further-reading","text":"https://wiki.archlinux.org/index.php/NFS https://wiki.archlinux.org/index.php/samba","title":"Further reading"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#windows-nfs-client","text":"Based on the comments below - there are options to use Windows as NFS client. The forum do not recommend one solition for another and do not support such client. Windows 10 PRO and Enterprise Editions supports NFS Windows subsystem for Linux https://github.com/DeCoRawr/NFSClient/","title":"Windows NFS Client"},{"location":"manjaro/nfs/nfs-file-sharing-manjaro/#revisions","text":"2020-03-21 Fix error in mv command Added systemd units 2019-09 Initial guide","title":"Revisions"},{"location":"manjaro/nfs/nfs-synology-nas/","text":"Setting up NFS on Synology NAS Access control NFS do not use access control but IP address restriction. DSM control panel File Services Open File Services \u2192 enable NFS \u2192 Enable NFSv4 (do not add domain) Click Apply Shared Folder Open Shared Folder \u2192 Edit your shared folder \u2192 NFS Permissions \u2192 Add a single client based on IP Permissions [details=\"Sample Screeenshot\"] [/details] ReadWrite Map all to admin async no no priv port denied crossmount denied You can add as many clients you need to any shared folder. Synology do not recommend using subnets as this give any client connected to your network same permissions as yourself. On your Manjaro client Enable and start services to make Manjaro act as a NFS client. $ sudo systemctl enable --now nfs-client.target $ sudo systemctl enable --now NetworkManager-wait-online.service List the available mounts on your diskstation $ showmount -e diskstation [details=\"Sample output\"] \u276f showmount -e diskstation Export list for diskstation: /volume1/data 192.168.x.x,192.168.x.y /volume1/web 192.168.x.x,192.168.x.y /volume1/video 192.168.x.x /volume1/photo 192.168.x.x /volume1/music 192.168.x.x [/details] Create folder structure for mounting $ sudo mkdir -p /data/nfs/video /data/nfs/music /data/nfs/photo Set permissions on the nfs sub folder structure $ sudo chmod -R ugo+rwx /data/nfs Mounting Note: Server name needs to be a valid hostname (not just IP address). Otherwise mounting of remote share will hang. - Arch wiki Manually $ sudo mount -t nfs diskstation:/volume1/video /data/nfs/video If you want to auto mount shares on client add the share to /etc/fstab diskstation:/volume1/video /data/nfs/video nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 Conclusion You should have an idea on how you make your Manjaro connect to your NAS using NFS.","title":"Connect to Synology NFS share"},{"location":"manjaro/nfs/nfs-synology-nas/#setting-up-nfs-on-synology-nas","text":"","title":"Setting up NFS on Synology NAS"},{"location":"manjaro/nfs/nfs-synology-nas/#access-control","text":"NFS do not use access control but IP address restriction.","title":"Access control"},{"location":"manjaro/nfs/nfs-synology-nas/#dsm-control-panel","text":"","title":"DSM control panel"},{"location":"manjaro/nfs/nfs-synology-nas/#file-services","text":"Open File Services \u2192 enable NFS \u2192 Enable NFSv4 (do not add domain) Click Apply","title":"File Services"},{"location":"manjaro/nfs/nfs-synology-nas/#shared-folder","text":"Open Shared Folder \u2192 Edit your shared folder \u2192 NFS Permissions \u2192 Add a single client based on IP","title":"Shared Folder"},{"location":"manjaro/nfs/nfs-synology-nas/#permissions","text":"[details=\"Sample Screeenshot\"] [/details] ReadWrite Map all to admin async no no priv port denied crossmount denied You can add as many clients you need to any shared folder. Synology do not recommend using subnets as this give any client connected to your network same permissions as yourself.","title":"Permissions"},{"location":"manjaro/nfs/nfs-synology-nas/#on-your-manjaro-client","text":"Enable and start services to make Manjaro act as a NFS client. $ sudo systemctl enable --now nfs-client.target $ sudo systemctl enable --now NetworkManager-wait-online.service List the available mounts on your diskstation $ showmount -e diskstation [details=\"Sample output\"] \u276f showmount -e diskstation Export list for diskstation: /volume1/data 192.168.x.x,192.168.x.y /volume1/web 192.168.x.x,192.168.x.y /volume1/video 192.168.x.x /volume1/photo 192.168.x.x /volume1/music 192.168.x.x [/details]","title":"On your Manjaro client"},{"location":"manjaro/nfs/nfs-synology-nas/#create-folder-structure-for-mounting","text":"$ sudo mkdir -p /data/nfs/video /data/nfs/music /data/nfs/photo Set permissions on the nfs sub folder structure $ sudo chmod -R ugo+rwx /data/nfs","title":"Create folder structure for mounting"},{"location":"manjaro/nfs/nfs-synology-nas/#mounting","text":"Note: Server name needs to be a valid hostname (not just IP address). Otherwise mounting of remote share will hang. - Arch wiki Manually $ sudo mount -t nfs diskstation:/volume1/video /data/nfs/video If you want to auto mount shares on client add the share to /etc/fstab diskstation:/volume1/video /data/nfs/video nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0","title":"Mounting"},{"location":"manjaro/nfs/nfs-synology-nas/#conclusion","text":"You should have an idea on how you make your Manjaro connect to your NAS using NFS.","title":"Conclusion"},{"location":"manjaro/notes/manjaro-arm-hacking-desktop-installer/","text":"Working around the desktop installer image requiring peripherals to complete. Prerequisite network scanner e.g. nmap , arp-scan or ipscan ethernet connection Raspberry Pi connected using ethernet Download desktop the image Write image to sd-card Insert image into your RPI Connect ethernet cable Power device Wait until the device settles - the green activity led becomes quiet Scan the network and locate the device IP nmap -p 22 --open ip.x.y.0/24 Open an ssh connection to the device using oem as username and password ssh oem@ip.x.y.z Ensure the system is up-to-date with a current mirror and current metadata sudo pacman-mirrors --continent && sudo pacman -Syy Remove the calamares oem installer sudo pacman -Rns calamares calamares-arm-oem Sync the command line oem installer sudo pacman -S manjaro-arm-oem-install Execute the oem setup script sudo bash /usr/share/manjaro-arm-oem-install/manjaro-arm-oem-install Done Remote GUI A headless system with a GUI desktop is useless unless you can access that desktop from elsewhere. https://root.nix.dk/network-notes/tigervnc-over-ssh Cross posted to Manjaro Forum","title":"Hacking ARM desktop installer"},{"location":"manjaro/notes/manjaro-arm-hacking-desktop-installer/#remote-gui","text":"A headless system with a GUI desktop is useless unless you can access that desktop from elsewhere. https://root.nix.dk/network-notes/tigervnc-over-ssh Cross posted to Manjaro Forum","title":"Remote GUI"},{"location":"manjaro/notes/manjaro-arm-hacking-installer-to-enable-wifi/","text":"Difficulty: \u2605\u2605\u2606\u2606\u2606 ARM image WiFi connection hack This is specifically useful for Pi Zero W but it works for any Pi with onboard wifi. Assuming you already have downloaded a Manjaro ARM image (any flavor) and have the urge to connect over WiFi to finalize the setup process. Open a terminal and do su -l root Mount the root image from the sdcard mkdir tmproot mount /dev/mmcblk0p2 tmproot Create a network definition cat << EOF >> root/etc/systemd/network/wlan0.network [Match] Name=wlan0 [Network] DHCP=yes EOF Create a wpa_supplicant configuration - replace the variables $SSID and $PASS with your actual values wpa_passphrase \"$SSID\" \"$PASS\" > tmproot/etc/wpa_supplicant/wpa_supplicant-wlan0.conf Create a symlink to start wpa_supplicant for the wlan0 ln -s /usr/lib/systemd/system/wpa_supplicant@.service \\ tmproot/etc/systemd/system/multi-user.target.wants/wpa_supplicant@wlan0.service Unmount the partition and exit root context umount tmproot rm -r tmproot exit Insert the sd-card in your pi and power up https://root.nix.dk/en/utility-scripts/manjaro-arm-image-wifi-hack https://root.nix.dk/en/manjaro/hacking-arm-desktop-installer Cross posted at Manjaro Forum","title":"Hacking ARM install image to connect to WiFi"},{"location":"manjaro/notes/manjaro-arm-hacking-installer-to-enable-wifi/#arm-image-wifi-connection-hack","text":"This is specifically useful for Pi Zero W but it works for any Pi with onboard wifi. Assuming you already have downloaded a Manjaro ARM image (any flavor) and have the urge to connect over WiFi to finalize the setup process. Open a terminal and do su -l root Mount the root image from the sdcard mkdir tmproot mount /dev/mmcblk0p2 tmproot Create a network definition cat << EOF >> root/etc/systemd/network/wlan0.network [Match] Name=wlan0 [Network] DHCP=yes EOF Create a wpa_supplicant configuration - replace the variables $SSID and $PASS with your actual values wpa_passphrase \"$SSID\" \"$PASS\" > tmproot/etc/wpa_supplicant/wpa_supplicant-wlan0.conf Create a symlink to start wpa_supplicant for the wlan0 ln -s /usr/lib/systemd/system/wpa_supplicant@.service \\ tmproot/etc/systemd/system/multi-user.target.wants/wpa_supplicant@wlan0.service Unmount the partition and exit root context umount tmproot rm -r tmproot exit Insert the sd-card in your pi and power up https://root.nix.dk/en/utility-scripts/manjaro-arm-image-wifi-hack https://root.nix.dk/en/manjaro/hacking-arm-desktop-installer Cross posted at Manjaro Forum","title":"ARM image WiFi connection hack"},{"location":"manjaro/notes/manjaro-be-compatible-with-vpn-providers/","text":"VPN compatibility Major VPN providers offer a GUI application which handles all aspects of the connection. Every now and then the topics on troubleshooting a given VPN provider surfaces and a lot of topics boils down to DNS and for good reason. Whether you are using an app offered by your provider or you are using configuration files it is of utmost importance you ensure correct configuration of DNS. Manjaro default resolver Since the dawn of Manjaro, the network has been configured using NetworkManager and resolved provided by openresolv package. VPN provider expectations All VPN providers maintains compatibility with Ubuntu, Debian and Fedora and as they all use systemd-resolved as DNS resolver, in fact they expect it to be so. This makes it a - at times, hairpulling - challenge to get the VPN into an functional state where DNS work both before and after connection. Provider provisioned apps There is a helper package systemd-resolvconf which provides a symlink to resolvctl in case you are used to resolvconf on the commandline or an older application expects resolvconf to be a working binary. However, if the DHCP and VPN clients use the resolvconf program to set name servers and search domains (see openresolv#Users for a list of software that use resolvconf ), the additional package systemd-resolvconf is needed to provide the /usr/bin/resolvconf symlink. -- https://wiki.archlinux.org/title/Systemd-resolved#Automatically The process is simple backup your resolv.conf enable systemd-resolved create a symlink linking the stub-resolv.conf as resolv.conf uninstall openresolv install systemd-resolvconf Copy and paste these commands and you are done sudo cp /etc/resolv.conf /etc/resolv.conf.bak sudo systemctl enable --now systemd-resolved sudo ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf sudo pacman -Rns openresolv sudo pacman -Syu systemd-resolvconf If you want to provide custom DNS entries you can do so in /etc/systemd/resolved.conf OpenVPN TODO Resources https://wiki.archlinux.org/title/Systemd-resolved https://man.archlinux.org/man/resolvectl.1 https://man.archlinux.org/man/resolved.conf.5 https://forum.manjaro.org/t/81016","title":"Make Manjaro compatible with VPN providers"},{"location":"manjaro/notes/manjaro-be-compatible-with-vpn-providers/#vpn-compatibility","text":"Major VPN providers offer a GUI application which handles all aspects of the connection. Every now and then the topics on troubleshooting a given VPN provider surfaces and a lot of topics boils down to DNS and for good reason. Whether you are using an app offered by your provider or you are using configuration files it is of utmost importance you ensure correct configuration of DNS.","title":"VPN compatibility"},{"location":"manjaro/notes/manjaro-be-compatible-with-vpn-providers/#manjaro-default-resolver","text":"Since the dawn of Manjaro, the network has been configured using NetworkManager and resolved provided by openresolv package.","title":"Manjaro default resolver"},{"location":"manjaro/notes/manjaro-be-compatible-with-vpn-providers/#vpn-provider-expectations","text":"All VPN providers maintains compatibility with Ubuntu, Debian and Fedora and as they all use systemd-resolved as DNS resolver, in fact they expect it to be so. This makes it a - at times, hairpulling - challenge to get the VPN into an functional state where DNS work both before and after connection.","title":"VPN provider expectations"},{"location":"manjaro/notes/manjaro-be-compatible-with-vpn-providers/#provider-provisioned-apps","text":"There is a helper package systemd-resolvconf which provides a symlink to resolvctl in case you are used to resolvconf on the commandline or an older application expects resolvconf to be a working binary. However, if the DHCP and VPN clients use the resolvconf program to set name servers and search domains (see openresolv#Users for a list of software that use resolvconf ), the additional package systemd-resolvconf is needed to provide the /usr/bin/resolvconf symlink. -- https://wiki.archlinux.org/title/Systemd-resolved#Automatically The process is simple backup your resolv.conf enable systemd-resolved create a symlink linking the stub-resolv.conf as resolv.conf uninstall openresolv install systemd-resolvconf Copy and paste these commands and you are done sudo cp /etc/resolv.conf /etc/resolv.conf.bak sudo systemctl enable --now systemd-resolved sudo ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf sudo pacman -Rns openresolv sudo pacman -Syu systemd-resolvconf If you want to provide custom DNS entries you can do so in /etc/systemd/resolved.conf","title":"Provider provisioned apps"},{"location":"manjaro/notes/manjaro-be-compatible-with-vpn-providers/#openvpn","text":"TODO","title":"OpenVPN"},{"location":"manjaro/notes/manjaro-be-compatible-with-vpn-providers/#resources","text":"https://wiki.archlinux.org/title/Systemd-resolved https://man.archlinux.org/man/resolvectl.1 https://man.archlinux.org/man/resolved.conf.5 https://forum.manjaro.org/t/81016","title":"Resources"},{"location":"manjaro/notes/manjaro-convert-to-arch/","text":"Migrate Manjaro to Arch This is a rewrite of Jonathon's guide with some additions discovered while migrating a test system. Note that your resulting system does not count as a real Arch installation because real Arch requires knowledge of what you need, why you need it and the process to achieve your goal. Manjaro, EndeavourOS and any other Archbased distribution out there is not considered a real Arch system. Catch up with unstable Switch Manjaro to unstable branch and run a full update sudo pacman-mirrors -aB unstable sudo pacman -Syyu Graphic drivers If you are using Nvidia proprietary - switch to the opensource driver - ensure your graphic driver are in a working state before you begin the migration. Manjaro nvidia drivers is tied into the different kernels - so you will get into trouble when replacing the Manjaro kernel with Arch Linux stock kernel. As a - sort of - failsafe, install all free drivers using the meta package xorg-drivers sudo pacman -Syu xorg-drivers Replace mirrors Pick up a set of Arch mirrors from https://www.archlinux.org/mirrorlist/ 1 , e.g.: /etc/pacman.d/mirrorlist ## United Kingdom Server = https://mirror.netweaver.uk/archlinux/$repo/os/$arch ## Netherlands Server = https://mirror.mijn.host/archlinux/$repo/os/$arch Remove Manjaro packages Remove a few Manjaro specific packages Note that -Rdd won't check for dependencies so you will have to go back later and look over your packages. sudo pacman -Rdd pacman-mirrors manjaro-release bashrc-manjaro Install the Arch equivalent and yes, -Sy is discouraged but we need to do it this way - we will fix later in the process. sudo pacman -Syy pacman pacman-contrib Upgrade, install kernel, replace overlay packages Check this list yourself to make sure you're happy with it. You might want to tweak it: sudo pacman -Syu base linux linux-headers filesystem grub sudo systemd systemd-libs systemd-sysvcompat xorg-server xorg-server-common xorg-xwayland Watch out for changes resulting in a .pacsave Resolve those now, e.g. move the files back into place. Important ones are covered below. You will need to restore your vconsole.conf , locale.conf and your hostname file sudo cp /etc/vconsole.conf.pacsave /etc/vconsole.conf sudo cp /etc/locale.conf.pacsave /etc/locale.conf sudo cp /etc/hostname.pacsave /etc/hostname Ensure GRUB menu built correctly Check the output carefully and re-run if necessary sudo grub-mkconfig -o /boot/grub/grub.cfg You create add a GRUB hook to do some housekeeping on kernel modules when kernel changes /usr/share/libalpm/hooks/grub.hook [Trigger] Type = File Operation = Install Operation = Remove Target = usr/lib/modules/*/vmlinuz Target = boot/vmlinuz* [Action] Description = Updating Grub-Bootmenu When = PostTransaction Exec = /usr/bin/grub-mkconfig -o /boot/grub/grub.cfg Reinstall GRUB Replace Manjaro's GRUB boot loader with the Arch boot loader sudo grub-install /dev/$YOUR-BOOT-DISK Obviously, check that destination device as you normally would. Check for other Manjaro-specific packages and replace/remove Be careful as you would probably want to keep your theme packages Check for non-repo packages pacman -Qm Note: this will show AUR packages too! Check for things like kernel variants. Some packages in Manjaro's [community] will have AUR equivalents. Remove and replace as you see fit. This bit is important to check. Don't just copy, paste, and run. sudo pacman -Rdd $(pacman -Qsq manjaro-) $(pacman -Qsq mhwd) This bit is important to check. Don't just copy, paste, and run. List your installed kernels using mhwd -li Add the kernel packages to the list below - and if you know you have headers - add those too Example packages to be removed linux510 linux510-headers manjaro-application-utility manjaro-documentation-en manjaro-firmware manjaro-hello manjaro-icons manjaro-keyring manjaro-settings-manager manjaro-system manjaro-zsh-config mhwd mhwd-amdgpu mhwd-ati mhwd-db mhwd-nvidia-340xx mhwd-nvidia-390xx mhwd-nvidia-418xx mhwd-nvidia-430xx mhwd-nvidia-435xx mhwd-nvidia-440xx Remove old kernel initramfs files Look under /boot and remove any files generated by Manjaro's kernel packages, then regenerate the GRUB config. Look for packages with kernel related names like linuxXX- Check configuration files For example: Merge pacnew using pacdiff Remove SyncFirst line from /etc/pacman.conf If you are using your ~/.local/bin folder - you must add the folder to your path. As an alternative you can recreate the file /etc/profiles.d/home-local-bin.sh echo 'export PATH=\"$HOME/.local/bin:$PATH\"' | sudo tee -i /etc/profile.d/home-local-bin.sh Re-check for updates. Sync your system to match Arch repos - Manjaro packages may be ahead in terms of pkgrel which is why the downgrade argument ( uu ) is used. sudo pacman -Syuu Ensure GRUB is correct. sudo grub-mkconfig -o /boot/grub/grub.cfg Reboot That should be all you need to do. Once booted, tidy the remaining Manjaro kernel and check again for orphans etc. There may be some other smaller issues cause by lingering configuration differences. Also remember that these might not be common with Arch, so please don't report them as bugs to Arch! If you find any other weird issues, make sure you step through the Arch install guide and make sure all the basics are in place. Migrating to ... As an example - you could migrate to EndeavourOS. 1. Create an EndeavourOS mirrorlist /etc/pacman.d/endeavouros-mirrorlist ## Germany Server = https://mirror.alpix.eu/endeavouros/repo/$repo/$arch Add EndeavourOS to pacman.conf (below [multilib]) [endeavouros] Include = /etc/pacman.d/endeavouros-mirrorlist Import EndeavourOS key sudo pacman-key --keyserver hkp://pool.sks-keyservers.net -r 003DB8B0CB23504F sudo pacman-key --lsign 003DB8B0CB23504F Add a few packages from EndeavourOS repo sudo pacman -Syu yay reflector-simple eos-rankmirrors Update mirrors reflector-simple eos-rankmirrors","title":"Convert Manjaro to Arch"},{"location":"manjaro/notes/manjaro-convert-to-arch/#migrate-manjaro-to-arch","text":"This is a rewrite of Jonathon's guide with some additions discovered while migrating a test system. Note that your resulting system does not count as a real Arch installation because real Arch requires knowledge of what you need, why you need it and the process to achieve your goal. Manjaro, EndeavourOS and any other Archbased distribution out there is not considered a real Arch system.","title":"Migrate Manjaro to Arch"},{"location":"manjaro/notes/manjaro-convert-to-arch/#catch-up-with-unstable","text":"Switch Manjaro to unstable branch and run a full update sudo pacman-mirrors -aB unstable sudo pacman -Syyu","title":"Catch up with unstable"},{"location":"manjaro/notes/manjaro-convert-to-arch/#graphic-drivers","text":"If you are using Nvidia proprietary - switch to the opensource driver - ensure your graphic driver are in a working state before you begin the migration. Manjaro nvidia drivers is tied into the different kernels - so you will get into trouble when replacing the Manjaro kernel with Arch Linux stock kernel. As a - sort of - failsafe, install all free drivers using the meta package xorg-drivers sudo pacman -Syu xorg-drivers","title":"Graphic drivers"},{"location":"manjaro/notes/manjaro-convert-to-arch/#replace-mirrors","text":"Pick up a set of Arch mirrors from https://www.archlinux.org/mirrorlist/ 1 , e.g.: /etc/pacman.d/mirrorlist ## United Kingdom Server = https://mirror.netweaver.uk/archlinux/$repo/os/$arch ## Netherlands Server = https://mirror.mijn.host/archlinux/$repo/os/$arch","title":"Replace mirrors"},{"location":"manjaro/notes/manjaro-convert-to-arch/#remove-manjaro-packages","text":"Remove a few Manjaro specific packages Note that -Rdd won't check for dependencies so you will have to go back later and look over your packages. sudo pacman -Rdd pacman-mirrors manjaro-release bashrc-manjaro Install the Arch equivalent and yes, -Sy is discouraged but we need to do it this way - we will fix later in the process. sudo pacman -Syy pacman pacman-contrib","title":"Remove Manjaro packages"},{"location":"manjaro/notes/manjaro-convert-to-arch/#upgrade-install-kernel-replace-overlay-packages","text":"Check this list yourself to make sure you're happy with it. You might want to tweak it: sudo pacman -Syu base linux linux-headers filesystem grub sudo systemd systemd-libs systemd-sysvcompat xorg-server xorg-server-common xorg-xwayland Watch out for changes resulting in a .pacsave Resolve those now, e.g. move the files back into place. Important ones are covered below. You will need to restore your vconsole.conf , locale.conf and your hostname file sudo cp /etc/vconsole.conf.pacsave /etc/vconsole.conf sudo cp /etc/locale.conf.pacsave /etc/locale.conf sudo cp /etc/hostname.pacsave /etc/hostname","title":"Upgrade, install kernel, replace overlay packages"},{"location":"manjaro/notes/manjaro-convert-to-arch/#ensure-grub-menu-built-correctly","text":"Check the output carefully and re-run if necessary sudo grub-mkconfig -o /boot/grub/grub.cfg You create add a GRUB hook to do some housekeeping on kernel modules when kernel changes /usr/share/libalpm/hooks/grub.hook [Trigger] Type = File Operation = Install Operation = Remove Target = usr/lib/modules/*/vmlinuz Target = boot/vmlinuz* [Action] Description = Updating Grub-Bootmenu When = PostTransaction Exec = /usr/bin/grub-mkconfig -o /boot/grub/grub.cfg","title":"Ensure GRUB menu built correctly"},{"location":"manjaro/notes/manjaro-convert-to-arch/#reinstall-grub","text":"Replace Manjaro's GRUB boot loader with the Arch boot loader sudo grub-install /dev/$YOUR-BOOT-DISK Obviously, check that destination device as you normally would.","title":"Reinstall GRUB"},{"location":"manjaro/notes/manjaro-convert-to-arch/#check-for-other-manjaro-specific-packages-and-replaceremove","text":"Be careful as you would probably want to keep your theme packages Check for non-repo packages pacman -Qm Note: this will show AUR packages too! Check for things like kernel variants. Some packages in Manjaro's [community] will have AUR equivalents. Remove and replace as you see fit. This bit is important to check. Don't just copy, paste, and run. sudo pacman -Rdd $(pacman -Qsq manjaro-) $(pacman -Qsq mhwd) This bit is important to check. Don't just copy, paste, and run. List your installed kernels using mhwd -li Add the kernel packages to the list below - and if you know you have headers - add those too Example packages to be removed linux510 linux510-headers manjaro-application-utility manjaro-documentation-en manjaro-firmware manjaro-hello manjaro-icons manjaro-keyring manjaro-settings-manager manjaro-system manjaro-zsh-config mhwd mhwd-amdgpu mhwd-ati mhwd-db mhwd-nvidia-340xx mhwd-nvidia-390xx mhwd-nvidia-418xx mhwd-nvidia-430xx mhwd-nvidia-435xx mhwd-nvidia-440xx","title":"Check for other Manjaro-specific packages and replace/remove"},{"location":"manjaro/notes/manjaro-convert-to-arch/#remove-old-kernel-initramfs-files","text":"Look under /boot and remove any files generated by Manjaro's kernel packages, then regenerate the GRUB config. Look for packages with kernel related names like linuxXX-","title":"Remove old kernel initramfs files"},{"location":"manjaro/notes/manjaro-convert-to-arch/#check-configuration-files","text":"For example: Merge pacnew using pacdiff Remove SyncFirst line from /etc/pacman.conf If you are using your ~/.local/bin folder - you must add the folder to your path. As an alternative you can recreate the file /etc/profiles.d/home-local-bin.sh echo 'export PATH=\"$HOME/.local/bin:$PATH\"' | sudo tee -i /etc/profile.d/home-local-bin.sh","title":"Check configuration files"},{"location":"manjaro/notes/manjaro-convert-to-arch/#re-check-for-updates","text":"Sync your system to match Arch repos - Manjaro packages may be ahead in terms of pkgrel which is why the downgrade argument ( uu ) is used. sudo pacman -Syuu Ensure GRUB is correct. sudo grub-mkconfig -o /boot/grub/grub.cfg","title":"Re-check for updates."},{"location":"manjaro/notes/manjaro-convert-to-arch/#reboot","text":"That should be all you need to do. Once booted, tidy the remaining Manjaro kernel and check again for orphans etc. There may be some other smaller issues cause by lingering configuration differences. Also remember that these might not be common with Arch, so please don't report them as bugs to Arch! If you find any other weird issues, make sure you step through the Arch install guide and make sure all the basics are in place.","title":"Reboot"},{"location":"manjaro/notes/manjaro-convert-to-arch/#migrating-to","text":"As an example - you could migrate to EndeavourOS. 1. Create an EndeavourOS mirrorlist /etc/pacman.d/endeavouros-mirrorlist ## Germany Server = https://mirror.alpix.eu/endeavouros/repo/$repo/$arch Add EndeavourOS to pacman.conf (below [multilib]) [endeavouros] Include = /etc/pacman.d/endeavouros-mirrorlist Import EndeavourOS key sudo pacman-key --keyserver hkp://pool.sks-keyservers.net -r 003DB8B0CB23504F sudo pacman-key --lsign 003DB8B0CB23504F Add a few packages from EndeavourOS repo sudo pacman -Syu yay reflector-simple eos-rankmirrors Update mirrors reflector-simple eos-rankmirrors","title":"Migrating to ..."},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/","text":"Difficulty: \u2605\u2605\u2606\u2606\u2606 Dual boot - Step by Step Target systems Firmware Checklist Windows preparation Manjaro installation Revisions Target systems UEFI Computers with preinstalled Windows (Windows 10) is computers using UEFI firmware. This guide is a generic guide targeted at UEFI installations . However some of the guide does apply even if you are using a BIOS/MBR setup. If you are using a BIOS/MBR (DOS) partition schema watch out for this :information_source: Skip if using BIOS/MBR To ensure a successful dual-boot installation using Windows and Manjaro there are a few steps to be taken. Installation type :exclamation: DO NOT mix UEFI with MBR partition scheme. Always check your Windows root filesystem using fdisk on the live ISO. If the output contains Disklabel type: dos :warning: do not install as EFI . Windows may be installed in different ways which can affect the system various ways. The first clue you get using the fdisk command from the live ISO. Windows 7 only supported DOS MBR partitions schema even the system did support EFI. Manjaro supports both GPT and DOS partitioning and it is very easy to start the Manjaro installer in EFI mode on a system supporting it. To ensure a successful dual-boot on Windows 7 systems you must disable EFI in the firmware. [details=\"Example for Windows 7 Home Premium 64bit in a VBoxVM\"] The disklabel type is dos which tells us this is a MBR partition and thus the system is booting from BIOS. [manjaro manjaro]# sudo fdisk -l ... Disklabel type: dos Disk identifier: 0x9ab5fdd2 ... Device Boot Start End Sectors Size Id Type /dev/sda1 * 2048 206847 204800 100M 7 HPFS/NTFS/exFAT /dev/sda2 206848 67106815 66899968 31.9G 7 HPFS/NTFS/exFAT [/details] Firmware The firmware is a crucial part of your system as it controls aspects on how the Linux kernel will interact with your the hardware. Some system firmware is setup in such a way that a Linux system does not recognize disk devices. Firmware checklist for BIOS systems :white_small_square: Use latest available firmware :white_small_square: Disable EFI :white_small_square: Disable RAID option :white_small_square: Enable AHCI Firmware checklist for EFI Systems :white_small_square: Disable CSM (Legacy) boot :white_small_square: Disable Secure Boot :white_small_square: Enable AHCI :white_small_square: Use latest available firmware :white_small_square: Disable Optane Memory and Rapid Storage Technology (RST) :white_small_square: Disable RAID option :white_small_square: Disable Fast Boot (if unable to boot from USB) Some systems require the user to set a firmware password before more advanced options becomes available. Intel Optane Memory and Intel Rapid Storage Technology Lately nvme devices has emerged labelled Intel Volume Management Device. These devices is a variation of Intel RST and requires the vmd module to be loaded for the OS to recognize it. As of October 2021 Manjaro has added support for the vmd module when required. (https://gitlab.manjaro.org/packages/core/mkinitcpio/-/issues/1) Is Linux* supported when using Intel\u00ae Optane\u2122 memory for system acceleration? No, the accelerated SATA drive must be running Windows 10 64-bit to use the Intel\u00ae Rapid Storage Technology (Intel\u00ae RST) driver software. This enables the supported/validated method of using the Intel\u00ae Optane\u2122 memory for acceleration of the most commonly used data. Using the device with other software for caching is is not supported or validated. - https://www.intel.com/content/www/us/en/support/articles/000024018/memory-and-storage/intel-optane-memory.html BitLocker :warning: BitLocker encryption is not compatible with a Manjaro Linux installation. Without any prior knowledge or hands-on experience with BitLocker - we have enough evidence to discourage dual booting a BitLocker environment. One possible reason a BitLocker environment won't boot could be that Secure Boot has to be disabled for the system to be able to boot Manjaro Linux. If you depend on BitLocker - e.g. corporate requirement - don't install Manjaro as you will have to disable BitLocker to be able to use both systems. General Windows preparation Filesystem check Linux is picky when it comes the Windows filesystem. Any inconsistencies in the filesystem and Linux will mount the filesystem read-only . The Windows command to fix the file system is chkdsk c: /F System clock Configure your Windows installation to use UTC. https://archived.forum.manjaro.org/t/howto-get-your-time-timezone-right-using-manjaro-windows-dual-boot/89359 Backup your documents You can skip this but it is not recommended. Backup any data you might want to keep to an external location of any kind. Partition cleanup If you have experimented a lot and/or had a failed installation and/or you have a messy partition scheme you will have to manually delete those extra partitions with the Windows Disk Manager tool. Be careful that you do not delete partitions required by Windows or by an OEM recovery tool. Disk space Use Windows disk tool to make room for a secondary Linux installation because Windows is the best tool to release space. So boot into Windows. Rightclick on Start \u2192 select Disk Manager In Disk Manager - rightclick on your Windows drive C: \u2192 select Shrink partition A reasonable size to release - depending on available space - would be 32768-65536 MiB (32-64GiB) or more. When you are ready click Shrink When you are done you are ready for the Manjaro installation. Clean your Windows system If you are like most users, your system came with Windows and your system has since been upgraded to Windows 10 (which leaves the old system behind). Major version upgrades - like 1804 - also leaves the old system behind and therefore a tremendous amount of dead data on your system that needs to be cleaned. Open Windows Explorer File manager and select My Computer . Right click on you local drive C: \u2192 Properties Click on Disk Cleanup button \u2192 wait Click on the Cleanup Systemfiles \u2192 wait check all items in the list (including the old Windows installation) \u2192 OK Wait \u2192 wait until finished. Close all windows Windows 10 preparation Disable Windows features Do you plan on doing read/write on your Windows partition? Disable Windows options like Fast Startup Hybrid Sleep Windows Hybrid Sleep defaults to enabled on desktop computers and disabled for laptop computers. Why should I do that? When Windows uses the above options it leaves the file system in a dirty state . When the file system is in this state the Linux filesystem tool ntfs-3g mounts the file system read-only , effectively blocking you from making changes to your files on the Windows partition. To disable Windows Fast Startup you need to access the Windows Control Panel. You find it by clicking on Windows Start button \u2192 type control \u2192 select Control Panel desktop app. In the Control Panel app Click on System and Security Click on Power Options Click on Choose what power buttons do a. Click on Change settings that are currently unavailable b. Uncheck the option Turn on fast startup Click on Save Changes If for any reason you want to turn off hibernation completely * Open command prompt as Administrator * Input powercfg /h off and press Enter Installation considerations Some of the choices presented here can be argued and the following two points I would like to address beforehand. Auto partitioning vs Manual partitioning Some will argue that one should select the auto partition in the Disk preparation section of the installer. The strategy described here ensures no messing with the Windows EFI partition and therefore no problems with Windows removing the Manjaro boot loader. Separate root and /home Separation of the system root and the home folder is not required but is another benefit of using manual partitioning. The separation of your personal data from the system - using a designated partition for the system's home folder makes it a bit easier to maintain your system. It is no secure replacement for a backup strategy it is just a handy solution should you decide to reinstall your system. One pitfall here is making the root partition too small - using the recommended minimum size requires you to do regular system maintenance to avoid the system disk running full and thus making your system very hard to boot. Depending on your available disk space your system root could be from 20-64GiB. The remaining is assigned to your personal data. Swap size Setting a swap partition is the better choice because a little swap is - in most cases - better than none. The chosen size depends on your system, available RAM and disk type. Use the suggested size of 2 GiB or research and adjust accordingly to system, taste and need. If you plan on using hibernation ensure the swap can hold system and graphics memory. Manjaro installation Now that you have partition sizes defined let start and the numbers are MB which is the unit Calamares makes use of Reboot your computer to the live USB media. Launch the graphical installer - it is named Calamares. Follow the guide until you reach the Disk selection/preparation Select Manual partitioning \u2192 Next . Select the correct disk selected - should be easy to see. EFI PARTITION :information_source: Skip if using BIOS/MBR Select the unpartitioned space \u2192 Create a. Size \u2192 input 512 b. Filesystem \u2192 select FAT32 c. Mountpoint \u2192 select /boot/efi d. Flags \u2192 check boot \u2192 OK SWAP PARTITION Select the unpartitioned space \u2192 Create a. Size \u2192 input 2048 b. Filesystem \u2192 select linuxswap \u2192 OK ROOT PARTITION Select the unpartitioned space \u2192 Create a. Size \u2192 input 20480 (min. recommended size) b. Filesystem \u2192 select ext4 c. Mountpoint \u2192 select / (root) \u2192 OK HOME PARTITION Select the unpartitioned space \u2192 Create a. Size \u2192 Use remaining b. Filesystem \u2192 select ext4 c. Mountpoint \u2192 select /home \u2192 OK :information_source: Skip if using BIOS/MBR Continue with the guide and when finished do not reboot . Open a terminal Input efibootmgr \u2192 Enter Verify the BootOrder - you should have a manjaro entry and the corresponding number should be first in the BootOrder Before you reboot :information_source: Skip if using BIOS/MBR Check your system's boot priorities Oh No - It boots directly to Windows - What do I do? :information_source: Skip if using BIOS/MBR Just boot to Windows. Run CMD as Administrator bcdedit /set {bootmgr} path \\EFI\\Manjaro\\grubx64.efi Reboot Bootloader repairs If that not do the trick then @gohlip has a goldmine of tips to get grub bootloader right. https://archived.forum.manjaro.org/t/using-livecd-v17-0-1-as-grub-to-boot-os-with-broken-bootloader/24916 Revisions Info on Intel RST - vmd module (2021-10-26) Discourage dual-boot BitLocker enabled (2020-11-20) Revision for Windows 7 (2020-11-10) Revision for Calamares 3.2.22.r7667 Major revision (2020-03-13) Initial guide July 2018","title":"Dual boot Manjaro and Windows"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#dual-boot-step-by-step","text":"Target systems Firmware Checklist Windows preparation Manjaro installation Revisions","title":"Dual boot - Step by Step"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#target-systems-uefi","text":"Computers with preinstalled Windows (Windows 10) is computers using UEFI firmware. This guide is a generic guide targeted at UEFI installations . However some of the guide does apply even if you are using a BIOS/MBR setup. If you are using a BIOS/MBR (DOS) partition schema watch out for this :information_source: Skip if using BIOS/MBR To ensure a successful dual-boot installation using Windows and Manjaro there are a few steps to be taken.","title":"Target systems UEFI"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#installation-type","text":":exclamation: DO NOT mix UEFI with MBR partition scheme. Always check your Windows root filesystem using fdisk on the live ISO. If the output contains Disklabel type: dos :warning: do not install as EFI . Windows may be installed in different ways which can affect the system various ways. The first clue you get using the fdisk command from the live ISO. Windows 7 only supported DOS MBR partitions schema even the system did support EFI. Manjaro supports both GPT and DOS partitioning and it is very easy to start the Manjaro installer in EFI mode on a system supporting it. To ensure a successful dual-boot on Windows 7 systems you must disable EFI in the firmware. [details=\"Example for Windows 7 Home Premium 64bit in a VBoxVM\"] The disklabel type is dos which tells us this is a MBR partition and thus the system is booting from BIOS. [manjaro manjaro]# sudo fdisk -l ... Disklabel type: dos Disk identifier: 0x9ab5fdd2 ... Device Boot Start End Sectors Size Id Type /dev/sda1 * 2048 206847 204800 100M 7 HPFS/NTFS/exFAT /dev/sda2 206848 67106815 66899968 31.9G 7 HPFS/NTFS/exFAT [/details]","title":"Installation type"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#firmware","text":"The firmware is a crucial part of your system as it controls aspects on how the Linux kernel will interact with your the hardware. Some system firmware is setup in such a way that a Linux system does not recognize disk devices.","title":"Firmware"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#firmware-checklist-for-bios-systems","text":":white_small_square: Use latest available firmware :white_small_square: Disable EFI :white_small_square: Disable RAID option :white_small_square: Enable AHCI","title":"Firmware checklist for BIOS systems"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#firmware-checklist-for-efi-systems","text":":white_small_square: Disable CSM (Legacy) boot :white_small_square: Disable Secure Boot :white_small_square: Enable AHCI :white_small_square: Use latest available firmware :white_small_square: Disable Optane Memory and Rapid Storage Technology (RST) :white_small_square: Disable RAID option :white_small_square: Disable Fast Boot (if unable to boot from USB) Some systems require the user to set a firmware password before more advanced options becomes available.","title":"Firmware checklist for EFI Systems"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#intel-optane-memory-and-intel-rapid-storage-technology","text":"Lately nvme devices has emerged labelled Intel Volume Management Device. These devices is a variation of Intel RST and requires the vmd module to be loaded for the OS to recognize it. As of October 2021 Manjaro has added support for the vmd module when required. (https://gitlab.manjaro.org/packages/core/mkinitcpio/-/issues/1) Is Linux* supported when using Intel\u00ae Optane\u2122 memory for system acceleration? No, the accelerated SATA drive must be running Windows 10 64-bit to use the Intel\u00ae Rapid Storage Technology (Intel\u00ae RST) driver software. This enables the supported/validated method of using the Intel\u00ae Optane\u2122 memory for acceleration of the most commonly used data. Using the device with other software for caching is is not supported or validated. - https://www.intel.com/content/www/us/en/support/articles/000024018/memory-and-storage/intel-optane-memory.html","title":"Intel Optane Memory and Intel Rapid Storage Technology"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#bitlocker","text":":warning: BitLocker encryption is not compatible with a Manjaro Linux installation. Without any prior knowledge or hands-on experience with BitLocker - we have enough evidence to discourage dual booting a BitLocker environment. One possible reason a BitLocker environment won't boot could be that Secure Boot has to be disabled for the system to be able to boot Manjaro Linux. If you depend on BitLocker - e.g. corporate requirement - don't install Manjaro as you will have to disable BitLocker to be able to use both systems.","title":"BitLocker"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#general-windows-preparation","text":"","title":"General Windows preparation"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#filesystem-check","text":"Linux is picky when it comes the Windows filesystem. Any inconsistencies in the filesystem and Linux will mount the filesystem read-only . The Windows command to fix the file system is chkdsk c: /F","title":"Filesystem check"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#system-clock","text":"Configure your Windows installation to use UTC. https://archived.forum.manjaro.org/t/howto-get-your-time-timezone-right-using-manjaro-windows-dual-boot/89359","title":"System clock"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#backup-your-documents","text":"You can skip this but it is not recommended. Backup any data you might want to keep to an external location of any kind.","title":"Backup your documents"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#partition-cleanup","text":"If you have experimented a lot and/or had a failed installation and/or you have a messy partition scheme you will have to manually delete those extra partitions with the Windows Disk Manager tool. Be careful that you do not delete partitions required by Windows or by an OEM recovery tool.","title":"Partition cleanup"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#disk-space","text":"Use Windows disk tool to make room for a secondary Linux installation because Windows is the best tool to release space. So boot into Windows. Rightclick on Start \u2192 select Disk Manager In Disk Manager - rightclick on your Windows drive C: \u2192 select Shrink partition A reasonable size to release - depending on available space - would be 32768-65536 MiB (32-64GiB) or more. When you are ready click Shrink When you are done you are ready for the Manjaro installation.","title":"Disk space"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#clean-your-windows-system","text":"If you are like most users, your system came with Windows and your system has since been upgraded to Windows 10 (which leaves the old system behind). Major version upgrades - like 1804 - also leaves the old system behind and therefore a tremendous amount of dead data on your system that needs to be cleaned. Open Windows Explorer File manager and select My Computer . Right click on you local drive C: \u2192 Properties Click on Disk Cleanup button \u2192 wait Click on the Cleanup Systemfiles \u2192 wait check all items in the list (including the old Windows installation) \u2192 OK Wait \u2192 wait until finished. Close all windows","title":"Clean your Windows system"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#windows-10-preparation","text":"","title":"Windows 10 preparation"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#disable-windows-features","text":"Do you plan on doing read/write on your Windows partition? Disable Windows options like Fast Startup Hybrid Sleep Windows Hybrid Sleep defaults to enabled on desktop computers and disabled for laptop computers. Why should I do that? When Windows uses the above options it leaves the file system in a dirty state . When the file system is in this state the Linux filesystem tool ntfs-3g mounts the file system read-only , effectively blocking you from making changes to your files on the Windows partition. To disable Windows Fast Startup you need to access the Windows Control Panel. You find it by clicking on Windows Start button \u2192 type control \u2192 select Control Panel desktop app. In the Control Panel app Click on System and Security Click on Power Options Click on Choose what power buttons do a. Click on Change settings that are currently unavailable b. Uncheck the option Turn on fast startup Click on Save Changes If for any reason you want to turn off hibernation completely * Open command prompt as Administrator * Input powercfg /h off and press Enter","title":"Disable Windows features"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#installation-considerations","text":"Some of the choices presented here can be argued and the following two points I would like to address beforehand.","title":"Installation considerations"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#auto-partitioning-vs-manual-partitioning","text":"Some will argue that one should select the auto partition in the Disk preparation section of the installer. The strategy described here ensures no messing with the Windows EFI partition and therefore no problems with Windows removing the Manjaro boot loader.","title":"Auto partitioning vs Manual partitioning"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#separate-root-and-home","text":"Separation of the system root and the home folder is not required but is another benefit of using manual partitioning. The separation of your personal data from the system - using a designated partition for the system's home folder makes it a bit easier to maintain your system. It is no secure replacement for a backup strategy it is just a handy solution should you decide to reinstall your system. One pitfall here is making the root partition too small - using the recommended minimum size requires you to do regular system maintenance to avoid the system disk running full and thus making your system very hard to boot. Depending on your available disk space your system root could be from 20-64GiB. The remaining is assigned to your personal data.","title":"Separate root and /home"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#swap-size","text":"Setting a swap partition is the better choice because a little swap is - in most cases - better than none. The chosen size depends on your system, available RAM and disk type. Use the suggested size of 2 GiB or research and adjust accordingly to system, taste and need. If you plan on using hibernation ensure the swap can hold system and graphics memory.","title":"Swap size"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#manjaro-installation","text":"Now that you have partition sizes defined let start and the numbers are MB which is the unit Calamares makes use of Reboot your computer to the live USB media. Launch the graphical installer - it is named Calamares. Follow the guide until you reach the Disk selection/preparation Select Manual partitioning \u2192 Next . Select the correct disk selected - should be easy to see. EFI PARTITION :information_source: Skip if using BIOS/MBR Select the unpartitioned space \u2192 Create a. Size \u2192 input 512 b. Filesystem \u2192 select FAT32 c. Mountpoint \u2192 select /boot/efi d. Flags \u2192 check boot \u2192 OK SWAP PARTITION Select the unpartitioned space \u2192 Create a. Size \u2192 input 2048 b. Filesystem \u2192 select linuxswap \u2192 OK ROOT PARTITION Select the unpartitioned space \u2192 Create a. Size \u2192 input 20480 (min. recommended size) b. Filesystem \u2192 select ext4 c. Mountpoint \u2192 select / (root) \u2192 OK HOME PARTITION Select the unpartitioned space \u2192 Create a. Size \u2192 Use remaining b. Filesystem \u2192 select ext4 c. Mountpoint \u2192 select /home \u2192 OK :information_source: Skip if using BIOS/MBR Continue with the guide and when finished do not reboot . Open a terminal Input efibootmgr \u2192 Enter Verify the BootOrder - you should have a manjaro entry and the corresponding number should be first in the BootOrder","title":"Manjaro installation"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#before-you-reboot","text":":information_source: Skip if using BIOS/MBR Check your system's boot priorities","title":"Before you reboot"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#oh-no-it-boots-directly-to-windows-what-do-i-do","text":":information_source: Skip if using BIOS/MBR Just boot to Windows. Run CMD as Administrator bcdedit /set {bootmgr} path \\EFI\\Manjaro\\grubx64.efi Reboot","title":"Oh No - It boots directly to Windows - What do I do?"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#bootloader-repairs","text":"If that not do the trick then @gohlip has a goldmine of tips to get grub bootloader right. https://archived.forum.manjaro.org/t/using-livecd-v17-0-1-as-grub-to-boot-os-with-broken-bootloader/24916","title":"Bootloader repairs"},{"location":"manjaro/notes/manjaro-dual-boot-manjaro-and-windows/#revisions","text":"Info on Intel RST - vmd module (2021-10-26) Discourage dual-boot BitLocker enabled (2020-11-20) Revision for Windows 7 (2020-11-10) Revision for Calamares 3.2.22.r7667 Major revision (2020-03-13) Initial guide July 2018","title":"Revisions"},{"location":"manjaro/notes/manjaro-dual-boot-windows/","text":"Calamares dual-boot installation Firmware Checklist Boot mode Windows preparation Manjaro installation Revisions Firmware The firmware is a crucial part of your system as it controls aspects on how the Linux kernel will interact with your the hardware. Some system firmware is setup in such a way that a Linux system does not recognize disk devices. Checklist Use latest available firmware (check your vendor's support section) Disable Intel Optane memory (incompatible with Linux) Disable Fake RAID option (or check archlinux wiki ) Enable AHCI Disable Secure Boot (or check archlinux wiki ) Disable Windows Fast Boot, Windows hibernation and/or Windows hybrid sleep. System boot method (BIOS or UEFI) Some systems require the user to set a firmware password before more advanced options becomes available. Boot mode UEFI vs BIOS Computers with preinstalled Windows (Windows 10) is computers using UEFI firmware. However your system may be configured to allow BIOS boot also labeled as Legacy , CSM (Compatibility Mode) or BIOS/MBR . The main difference is partition layout schema used. Partition schema This is the original schema which has limitations on modern systems. The most notable limitation is the number of partitions which is 4 primary partitions compared to GPT which allows for 128 partitions. UEFI does not work with MBR partition schema An EFI based system uses GPT partition schema and using GRUB boot loader it is also possible to use GPT while still using the older BIOS boot method. It is very important to choose the correct combination - otherwise Calamares installer will fail in the end when reaching the boot loader stage of the installation. Installing in EFI mode This requires a separate partition flagged as boot . The partition must be formatted using FAT32 and is usually mounted to /boot/efi . Installing in BIOS mode If you choose to install a system using BIOS boot mechanism you must boot the system in BIOS mode you must select manual partitioning in Calamares. Besides the usual root and possibly home you must create 32MB unformatted partition - which must be flagged as bios-boot - do not format the partition. When asked for the boot loader location - select this unformatted partition as target for the bootloader. Windows preparation The next parts of this section is all executed inside your current Windows installation. Filesystem check Linux is picky when it comes the Windows filesystem. Any inconsistencies in the filesystem and Linux will mount the filesystem read-only . The Windows command to fix the file system is chkdsk c: /F System clock Configure your Windows installation to use UTC. This is done best with a registry import file. Create a new file using Notepad with this content (e.g. utc.txt ) Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation] \"RealTimeIsUniversal\"=dword:00000001 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpClient] \"Enabled\"=dword:00000000 Open a command prompt and navigate to your desktop folder and rename the file to utc.reg C:\\Users\\**username**> cd Desktop C:\\Users\\**username**\\Desktop> move utc.txt utc.reg You can now import the file into the registry by double clicking the filename - accept the disclaimer to import the keys. Disable Windows features Do you plan on doing read/write on your Windows partition? Disable Windows options like Fast Startup Hybrid Sleep Windows Hybrid Sleep defaults to enabled on desktop computers and disabled for laptop computers. Why should I do that? When Windows uses the above options the filesystem is tainted which causes the system to mount the file system read-only , effectively blocking you from making changes to your files on the Windows partition. To disable Windows Fast Startup you need to access the Windows Control Panel. You find it by clicking on Windows Start button \u2192 type control \u2192 select Control Panel desktop app. In the Control Panel app Click on System and Security Click on Power Options Click on Choose what power buttons do a. Click on Change settings that are currently unavailable b. Uncheck the option Turn on fast startup Click on Save Changes If for any reason you want to turn off hibernation completely Open command prompt as Administrator Input powercfg /h off and press Enter Clean your Windows system If you are like most users, your system came with Windows and your system has since been upgraded to Windows 10 (which leaves the old system behind). Major version upgrades - like 1804 - also leaves the old system behind and therefore a tremendous amount of dead data on your system that needs to be cleaned. Open Windows Explorer File manager and select My Computer . Right click on you local drive C: \u2192 Properties Click on Disk Cleanup button \u2192 wait Click on the Cleanup Systemfiles \u2192 wait check all items in the list (including the old Windows installation) \u2192 OK Wait \u2192 wait until finished. Close all windows Backup your documents This should be an obvious step. Backup any data you might want to keep to an external location of any kind. Partition cleanup If you have experimented a lot and/or had a failed installation and/or you have a messy partition scheme you will have to manually delete those extra partitions with the Windows Disk Manager tool. Be careful that you do not delete partitions required by Windows or by an OEM recovery tool. Disk space Use Windows disk tool to make room for a secondary Linux installation because Windows is the best tool to release space. So boot into Windows. Rightclick on Start \u2192 select Disk Manager In Disk Manager - rightclick on your Windows drive C: \u2192 select Shrink partition A reasonable size to release - depending on available space - would be 32768-65536 MiB (32-64GiB) or more. When you are ready click Shrink When you are done you are ready for the Manjaro installation. Installation Some of the choices presented here can be argued and the following two points I would like to address beforehand. Auto partitioning vs Manual partitioning Some will argue that one should select the auto partition in the Disk preparation section of the installer. The strategy described here ensures no messing with the Windows EFI partition and therefore no problems with Windows rewriting the $esp. Separate root and /home Separation of the system root and the home folder is not required but is another benefit of using manual partitioning. The separation of your personal data from the system - using a designated partition for the system's home folder makes it a bit easier to maintain your system. It is no secure replacement for a backup strategy it is just a handy solution should you decide to reinstall your system. One pitfall here is making the root partition too small - using the recommended minimum size requires you to do regular system maintenance to avoid the system disk running full and thus making your system very hard to boot. Other considerations is application distribution methods such as snap and flatpak both of which requires a considerable amounts a disk estate. Depending on your available disk space your system root could be from 32-64GB. The remaining is assigned to your personal data. The number mentioned is just examples - they will work if you are just getting your fet wet and needs a gentle hand holding. Swap size Setting a swap partition is the better choice because a little swap is - in most cases - better than none. The chosen size depends on your system, available RAM and disk type. Use the suggested size of 2 GiB *or* research and adjust accordingly to system, taste and need. If you plan on using hibernation ensure the swap can hold both system and graphics memory. Installation Now that you have partition sizes defined let start and the numbers are MB which is the unit Calamares makes use of Reboot your computer to the live USB media. Launch the graphical installer - it is named Calamares. Follow the guide until you reach the Disk selection/preparation Select Manual partitioning \u2192 Next . Select the correct disk selected - should be easy to see. BOOT PARTITION either or - not both EFI a. Select the unpartitioned space \u2192 Create b. Size \u2192 input 512 c. Filesystem \u2192 select FAT32 d. Mountpoint \u2192 select /boot/efi e. Flags \u2192 check boot \u2192 OK BIOS a. Select unpartitioned space \u2192 Create b. Size \u2192 input 32 c. Filesystem \u2192 select unformatted d. Flags \u2192 check bios-boot \u2192 OK SWAP PARTITION a. Select the unpartitioned space \u2192 Create b. Size \u2192 input 2048 or the number you decided to use c.. Filesystem \u2192 select linuxswap \u2192 OK ROOT PARTITION a. Select the unpartitioned space \u2192 Create b. Size \u2192 input 32768 (32G) or the number you decided to use d.. Filesystem \u2192 select ext4 d. Mountpoint \u2192 select / (root) \u2192 OK HOME PARTITION a. Select the unpartitioned space \u2192 Create b. Size \u2192 Use remaining b. Filesystem \u2192 select ext4 d. Mountpoint \u2192 select /home \u2192 OK Next Reboot That's it Enjoy ...","title":"Linux dual-boot Windows"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#calamares-dual-boot-installation","text":"Firmware Checklist Boot mode Windows preparation Manjaro installation Revisions","title":"Calamares dual-boot installation"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#firmware","text":"The firmware is a crucial part of your system as it controls aspects on how the Linux kernel will interact with your the hardware. Some system firmware is setup in such a way that a Linux system does not recognize disk devices.","title":"Firmware"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#checklist","text":"Use latest available firmware (check your vendor's support section) Disable Intel Optane memory (incompatible with Linux) Disable Fake RAID option (or check archlinux wiki ) Enable AHCI Disable Secure Boot (or check archlinux wiki ) Disable Windows Fast Boot, Windows hibernation and/or Windows hybrid sleep. System boot method (BIOS or UEFI) Some systems require the user to set a firmware password before more advanced options becomes available.","title":"Checklist"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#boot-mode-uefi-vs-bios","text":"Computers with preinstalled Windows (Windows 10) is computers using UEFI firmware. However your system may be configured to allow BIOS boot also labeled as Legacy , CSM (Compatibility Mode) or BIOS/MBR . The main difference is partition layout schema used.","title":"Boot mode UEFI vs BIOS"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#partition-schema","text":"This is the original schema which has limitations on modern systems. The most notable limitation is the number of partitions which is 4 primary partitions compared to GPT which allows for 128 partitions. UEFI does not work with MBR partition schema An EFI based system uses GPT partition schema and using GRUB boot loader it is also possible to use GPT while still using the older BIOS boot method. It is very important to choose the correct combination - otherwise Calamares installer will fail in the end when reaching the boot loader stage of the installation.","title":"Partition schema"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#installing-in-efi-mode","text":"This requires a separate partition flagged as boot . The partition must be formatted using FAT32 and is usually mounted to /boot/efi .","title":"Installing in EFI mode"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#installing-in-bios-mode","text":"If you choose to install a system using BIOS boot mechanism you must boot the system in BIOS mode you must select manual partitioning in Calamares. Besides the usual root and possibly home you must create 32MB unformatted partition - which must be flagged as bios-boot - do not format the partition. When asked for the boot loader location - select this unformatted partition as target for the bootloader.","title":"Installing in BIOS mode"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#windows-preparation","text":"The next parts of this section is all executed inside your current Windows installation.","title":"Windows preparation"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#filesystem-check","text":"Linux is picky when it comes the Windows filesystem. Any inconsistencies in the filesystem and Linux will mount the filesystem read-only . The Windows command to fix the file system is chkdsk c: /F","title":"Filesystem check"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#system-clock","text":"Configure your Windows installation to use UTC. This is done best with a registry import file. Create a new file using Notepad with this content (e.g. utc.txt ) Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\TimeZoneInformation] \"RealTimeIsUniversal\"=dword:00000001 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpClient] \"Enabled\"=dword:00000000 Open a command prompt and navigate to your desktop folder and rename the file to utc.reg C:\\Users\\**username**> cd Desktop C:\\Users\\**username**\\Desktop> move utc.txt utc.reg You can now import the file into the registry by double clicking the filename - accept the disclaimer to import the keys.","title":"System clock"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#disable-windows-features","text":"Do you plan on doing read/write on your Windows partition? Disable Windows options like Fast Startup Hybrid Sleep Windows Hybrid Sleep defaults to enabled on desktop computers and disabled for laptop computers. Why should I do that? When Windows uses the above options the filesystem is tainted which causes the system to mount the file system read-only , effectively blocking you from making changes to your files on the Windows partition. To disable Windows Fast Startup you need to access the Windows Control Panel. You find it by clicking on Windows Start button \u2192 type control \u2192 select Control Panel desktop app. In the Control Panel app Click on System and Security Click on Power Options Click on Choose what power buttons do a. Click on Change settings that are currently unavailable b. Uncheck the option Turn on fast startup Click on Save Changes If for any reason you want to turn off hibernation completely Open command prompt as Administrator Input powercfg /h off and press Enter","title":"Disable Windows features"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#clean-your-windows-system","text":"If you are like most users, your system came with Windows and your system has since been upgraded to Windows 10 (which leaves the old system behind). Major version upgrades - like 1804 - also leaves the old system behind and therefore a tremendous amount of dead data on your system that needs to be cleaned. Open Windows Explorer File manager and select My Computer . Right click on you local drive C: \u2192 Properties Click on Disk Cleanup button \u2192 wait Click on the Cleanup Systemfiles \u2192 wait check all items in the list (including the old Windows installation) \u2192 OK Wait \u2192 wait until finished. Close all windows","title":"Clean your Windows system"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#backup-your-documents","text":"This should be an obvious step. Backup any data you might want to keep to an external location of any kind.","title":"Backup your documents"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#partition-cleanup","text":"If you have experimented a lot and/or had a failed installation and/or you have a messy partition scheme you will have to manually delete those extra partitions with the Windows Disk Manager tool. Be careful that you do not delete partitions required by Windows or by an OEM recovery tool.","title":"Partition cleanup"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#disk-space","text":"Use Windows disk tool to make room for a secondary Linux installation because Windows is the best tool to release space. So boot into Windows. Rightclick on Start \u2192 select Disk Manager In Disk Manager - rightclick on your Windows drive C: \u2192 select Shrink partition A reasonable size to release - depending on available space - would be 32768-65536 MiB (32-64GiB) or more. When you are ready click Shrink When you are done you are ready for the Manjaro installation.","title":"Disk space"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#installation","text":"Some of the choices presented here can be argued and the following two points I would like to address beforehand.","title":"Installation"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#auto-partitioning-vs-manual-partitioning","text":"Some will argue that one should select the auto partition in the Disk preparation section of the installer. The strategy described here ensures no messing with the Windows EFI partition and therefore no problems with Windows rewriting the $esp.","title":"Auto partitioning vs Manual partitioning"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#separate-root-and-home","text":"Separation of the system root and the home folder is not required but is another benefit of using manual partitioning. The separation of your personal data from the system - using a designated partition for the system's home folder makes it a bit easier to maintain your system. It is no secure replacement for a backup strategy it is just a handy solution should you decide to reinstall your system. One pitfall here is making the root partition too small - using the recommended minimum size requires you to do regular system maintenance to avoid the system disk running full and thus making your system very hard to boot. Other considerations is application distribution methods such as snap and flatpak both of which requires a considerable amounts a disk estate. Depending on your available disk space your system root could be from 32-64GB. The remaining is assigned to your personal data. The number mentioned is just examples - they will work if you are just getting your fet wet and needs a gentle hand holding.","title":"Separate root and /home"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#swap-size","text":"Setting a swap partition is the better choice because a little swap is - in most cases - better than none. The chosen size depends on your system, available RAM and disk type. Use the suggested size of 2 GiB *or* research and adjust accordingly to system, taste and need. If you plan on using hibernation ensure the swap can hold both system and graphics memory.","title":"Swap size"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#installation_1","text":"Now that you have partition sizes defined let start and the numbers are MB which is the unit Calamares makes use of Reboot your computer to the live USB media. Launch the graphical installer - it is named Calamares. Follow the guide until you reach the Disk selection/preparation Select Manual partitioning \u2192 Next . Select the correct disk selected - should be easy to see. BOOT PARTITION either or - not both EFI a. Select the unpartitioned space \u2192 Create b. Size \u2192 input 512 c. Filesystem \u2192 select FAT32 d. Mountpoint \u2192 select /boot/efi e. Flags \u2192 check boot \u2192 OK BIOS a. Select unpartitioned space \u2192 Create b. Size \u2192 input 32 c. Filesystem \u2192 select unformatted d. Flags \u2192 check bios-boot \u2192 OK SWAP PARTITION a. Select the unpartitioned space \u2192 Create b. Size \u2192 input 2048 or the number you decided to use c.. Filesystem \u2192 select linuxswap \u2192 OK ROOT PARTITION a. Select the unpartitioned space \u2192 Create b. Size \u2192 input 32768 (32G) or the number you decided to use d.. Filesystem \u2192 select ext4 d. Mountpoint \u2192 select / (root) \u2192 OK HOME PARTITION a. Select the unpartitioned space \u2192 Create b. Size \u2192 Use remaining b. Filesystem \u2192 select ext4 d. Mountpoint \u2192 select /home \u2192 OK Next Reboot","title":"Installation"},{"location":"manjaro/notes/manjaro-dual-boot-windows/#thats-it","text":"Enjoy ...","title":"That's it"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/","text":"Manjaro ISO From time to time the question is raised on how an ISO is written to USB - especially large capacity USB. Why can't I use the remaining space on my 32GB USB? This is because Manjaro ISO is a ISO9660 cd-rom file system and such filesystem is immutable - you cannot change it. As such a 2GB ISO makes it impossible to use the excess space for anything - it just sits there unused. So what can we do? The choices ventoy Manjaro on-a-stick Multi Boot USB 1. ventoy ventoy is a set of small binaries compiled from various open source projects - most notably grub and exfat. It is also available for Windows from the ventoy web It installs bootloader for efi and mbr and formats the remaining part of the device using exfat. Copy your ISO files to the partition and boot the your system from the stick. ventoy locates all ISO files and presents them the same manner as below script. Then you select the ISO to boot. It is even simpler than below method. Install the package from the repo pamac install ventoy When done run the script to display your options ventoy Locate your usb stick lsblk Then initialize the stick (one time operation) sudo ventoy -i /dev/sdy When done the disk is available in your file manager - copy your ISO files to the stick. :exclamation: Eject the stick using the eject button in your file manager and wait. Depending on the number of ISO, the speed and quality of your USB disk it will take a long time to complete. Have patience ... patience - only when the USB disappears from your file manager you can remove it. You can use this method for Windows ISO too https://archived.forum.manjaro.org/t/howto-use-manjaro-to-create-a-bootable-windows-usb/92780 2. Manjaro on a stick One way of doing this is creating a Manjaro installation on USB with an added script for booting ISO directly from Grub. https://archived.forum.manjaro.org/t/howto-run-manjaro-on-a-stick/109520?u=linux-aarhus Later I will describe a stand-alone solution based on the same script used in above article. 3. Multi Boot USB https://mbusb.aguslr.com/ With the script it is insanely easy to create a stick that boots a variety of ISOs. And Arch based ISOs work extremely well - including Manjaro. You can download the collection of scripts as an archive or your can clone from Github - what ever you prefer. This guide uses git. Install git - if you don't have it \u276f sudo pacman -Syu git Clone the repo \u276f git clone https://github.com/aguslr/multibootusb Cloning into 'multibootusb'... ... Navigate into the repo folder \u276f cd multibootusb To get an idea of what the script is doing \u276f ./makeUSB.sh -h Script to prepare multiboot USB drive Usage: makeUSB.sh [options] device [fs-type] [data-size] device Device to modify (e.g. /dev/sdb) fs-type Filesystem type for the data partition [ext3|ext4|vfat|ntfs] data-size Data partition size (e.g. 5G) -b, --hybrid Create a hybrid MBR -c, --clone Clone Git repository on the device -e, --efi Enable EFI compatibility -i, --interactive Launch gdisk to create a hybrid MBR -h, --help Display this message -s, --subdirectory <NAME> Specify a data subdirectory (default: \"boot\") The default fs-type is vfat . The data-size is not defined. The data-size option is only useful if you want to set aside space for a persistent storage partition. The storage space for ISO files is then limited to the specified size of e.g. 5G. When you use the data-size option - the remainder of the USB is left untouched. To be able to actually use the space you will need to manually create a partition using the remaining space. One example is a LUKS encrypted container for your sensitive data. Remove USB and list devices \u276f lsblk -la Insert USB and do it again - note the added device and create the USB - using vfat makes the device visible in Windows too. The following commands will assume your device is /dev/sdy - replace the device name with the device name from your system. NOTE : The script prints each command to the console before executing - so you can follow what the script is currently doing. The following creates a hybrid USB using vfat \u276f sudo ./makeUSB.sh -b -e /dev/sdy vfat To create an USB only for Linux use ext4 \u276f sudo ./makeUSB.sh -b -e /dev/sdy ext4 Download a Manjaro ISO, open the device in your file manager and copy a Manjaro ISO to the folder /boot/isos on the USB. Use the eject function of your file manager. You can also do it from terminal. IMPORTANT : Do not remove the device until all buffers are flushed to disk. If you want to make sure the ISO is written correct - checksum verify the resulting ISO on the USB stick. \u276f mkdir ~/usb-multiboot \u276f sudo mount /dev/sdy3 ~/usb-multiboot \u276f cp ~/Downloads/manjaro*.iso ~/usb-multiboot/boot/isos \u276f sync \u276f sudo umount ~/usb-multiboot \u276f sync Boot your system from the USB Select Multiboot > Wait while configuration is read The more ISOs the longer read time Tips The stick presumably supports more than 100 different distributions - so the Multiboot > menu takes a while to load - because of the dynamic nature of including the ISOs. To speed up the initial USB Multiboot configuration - you can remove folders from /boot/grub/mbusb.d/ you don't intend to use. Issues If you encounter any issues with the script or the configuration files for booting an ISO - please create an issue at the project's Github page. Revisions [date=2020-05-09 time=09:15:00 timezone=\"Europe/Copenhagen\"] * added ventoy","title":"ISO to USB no wasted space"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#manjaro-iso","text":"From time to time the question is raised on how an ISO is written to USB - especially large capacity USB. Why can't I use the remaining space on my 32GB USB? This is because Manjaro ISO is a ISO9660 cd-rom file system and such filesystem is immutable - you cannot change it. As such a 2GB ISO makes it impossible to use the excess space for anything - it just sits there unused. So what can we do?","title":"Manjaro ISO"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#the-choices","text":"ventoy Manjaro on-a-stick Multi Boot USB","title":"The choices"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#1-ventoy","text":"ventoy is a set of small binaries compiled from various open source projects - most notably grub and exfat. It is also available for Windows from the ventoy web It installs bootloader for efi and mbr and formats the remaining part of the device using exfat. Copy your ISO files to the partition and boot the your system from the stick. ventoy locates all ISO files and presents them the same manner as below script. Then you select the ISO to boot. It is even simpler than below method. Install the package from the repo pamac install ventoy When done run the script to display your options ventoy Locate your usb stick lsblk Then initialize the stick (one time operation) sudo ventoy -i /dev/sdy When done the disk is available in your file manager - copy your ISO files to the stick. :exclamation: Eject the stick using the eject button in your file manager and wait. Depending on the number of ISO, the speed and quality of your USB disk it will take a long time to complete. Have patience ... patience - only when the USB disappears from your file manager you can remove it. You can use this method for Windows ISO too https://archived.forum.manjaro.org/t/howto-use-manjaro-to-create-a-bootable-windows-usb/92780","title":"1. ventoy"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#2-manjaro-on-a-stick","text":"One way of doing this is creating a Manjaro installation on USB with an added script for booting ISO directly from Grub. https://archived.forum.manjaro.org/t/howto-run-manjaro-on-a-stick/109520?u=linux-aarhus Later I will describe a stand-alone solution based on the same script used in above article.","title":"2. Manjaro on a stick"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#3-multi-boot-usb","text":"https://mbusb.aguslr.com/ With the script it is insanely easy to create a stick that boots a variety of ISOs. And Arch based ISOs work extremely well - including Manjaro. You can download the collection of scripts as an archive or your can clone from Github - what ever you prefer. This guide uses git. Install git - if you don't have it \u276f sudo pacman -Syu git Clone the repo \u276f git clone https://github.com/aguslr/multibootusb Cloning into 'multibootusb'... ... Navigate into the repo folder \u276f cd multibootusb To get an idea of what the script is doing \u276f ./makeUSB.sh -h Script to prepare multiboot USB drive Usage: makeUSB.sh [options] device [fs-type] [data-size] device Device to modify (e.g. /dev/sdb) fs-type Filesystem type for the data partition [ext3|ext4|vfat|ntfs] data-size Data partition size (e.g. 5G) -b, --hybrid Create a hybrid MBR -c, --clone Clone Git repository on the device -e, --efi Enable EFI compatibility -i, --interactive Launch gdisk to create a hybrid MBR -h, --help Display this message -s, --subdirectory <NAME> Specify a data subdirectory (default: \"boot\") The default fs-type is vfat . The data-size is not defined. The data-size option is only useful if you want to set aside space for a persistent storage partition. The storage space for ISO files is then limited to the specified size of e.g. 5G. When you use the data-size option - the remainder of the USB is left untouched. To be able to actually use the space you will need to manually create a partition using the remaining space. One example is a LUKS encrypted container for your sensitive data. Remove USB and list devices \u276f lsblk -la Insert USB and do it again - note the added device and create the USB - using vfat makes the device visible in Windows too. The following commands will assume your device is /dev/sdy - replace the device name with the device name from your system. NOTE : The script prints each command to the console before executing - so you can follow what the script is currently doing. The following creates a hybrid USB using vfat \u276f sudo ./makeUSB.sh -b -e /dev/sdy vfat To create an USB only for Linux use ext4 \u276f sudo ./makeUSB.sh -b -e /dev/sdy ext4 Download a Manjaro ISO, open the device in your file manager and copy a Manjaro ISO to the folder /boot/isos on the USB. Use the eject function of your file manager. You can also do it from terminal. IMPORTANT : Do not remove the device until all buffers are flushed to disk. If you want to make sure the ISO is written correct - checksum verify the resulting ISO on the USB stick. \u276f mkdir ~/usb-multiboot \u276f sudo mount /dev/sdy3 ~/usb-multiboot \u276f cp ~/Downloads/manjaro*.iso ~/usb-multiboot/boot/isos \u276f sync \u276f sudo umount ~/usb-multiboot \u276f sync Boot your system from the USB Select Multiboot > Wait while configuration is read The more ISOs the longer read time","title":"3. Multi Boot USB"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#tips","text":"The stick presumably supports more than 100 different distributions - so the Multiboot > menu takes a while to load - because of the dynamic nature of including the ISOs. To speed up the initial USB Multiboot configuration - you can remove folders from /boot/grub/mbusb.d/ you don't intend to use.","title":"Tips"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#issues","text":"If you encounter any issues with the script or the configuration files for booting an ISO - please create an issue at the project's Github page.","title":"Issues"},{"location":"manjaro/notes/manjaro-iso-to-usb-no-wasted-space/#revisions","text":"[date=2020-05-09 time=09:15:00 timezone=\"Europe/Copenhagen\"] * added ventoy","title":"Revisions"},{"location":"manjaro/notes/manjaro-iso-tty-autologin/","text":"Automated login to TTY with Manjaro Create a directory named getty@tty1.service.d/ inside the systemd system unit files directory: sudo mkdir -p /etc/systemd/system/getty@tty1.service.d/ Create a file in this folder called override.conf with the following content: # /etc/systemd/system/getty@tty1.service.d/override.conf [Service] ExecStart= ExecStart=-/usr/bin/agetty --autologin YOUR_USERNAME_HERE --noclear %I $TERM","title":"Automated ISO login"},{"location":"manjaro/notes/manjaro-iso-tty-autologin/#automated-login-to-tty-with-manjaro","text":"Create a directory named getty@tty1.service.d/ inside the systemd system unit files directory: sudo mkdir -p /etc/systemd/system/getty@tty1.service.d/ Create a file in this folder called override.conf with the following content: # /etc/systemd/system/getty@tty1.service.d/override.conf [Service] ExecStart= ExecStart=-/usr/bin/agetty --autologin YOUR_USERNAME_HERE --noclear %I $TERM","title":"Automated login to TTY with Manjaro"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/","text":"BE WARNED Even Gparted is a proven tool to do the job - the risk of losing data is always present when you work with the filesystem. The author of this guide is not to be blamed if you mess up and loose data . USING THIS GUIDE IS ENTIRELY YOUR RESPONSIBILITY . Target audience This guide has been written for a default Manjaro EFI based system using GPT partition scheme. Two partitions $esp partition as first partition - sdy1 Single root partition as second partition - sdy2 You have booted a live ISO Several steps in the guide cannot be done if a partition is mounted. The scope of this guide is not to cater for complex systems like dual-boot. You can of course amend the guide to suit your specific system. Don't hesitate to ask - after all that is what the community forum is all about. Using live ISO and Gparted In this guide the device is assumed to be located at /dev/sdy . Usually it isn't and you need to locate the device you want to operate on. Use the terminal to locate you device path and replace sdy with the device name you find. $ lsblk Switch to a root shell - on a live ISO the password is manjaro $ su -l root Password: [manjaro ~]# 1. File system check If errors are found - do not proceed unless you have fixed them. # fsck /dev/sdy2 2. Backup Now is the time to backup important data to external media - whether this is a physical or an online storage location. 3. Resizing The Manjaro system itself do not require much space when /home is on a separate partition. A root partition of 32-64G is more than adequate. A. Shrink root partition Release as much space as you can - preferably at least the space needed to hold the entire content of your current $USER folder. B. Create partition Create a new partition using the claimed space and format to ext4 - it will become sdy3 # mkfs.ext4 /dev/sdy3 C. Temporary folders Create two temporary folders e.g. /mnt/home and /mnt/root # mkdir -p /mnt/home # mkdir -p /mnt/root D. Mount the partitions # mount /dev/sdy2 /mnt/root # mount /dev/sdy3 /mnt/home E. Move data Then move the folder /mnt/root/your-user-name to the new partition. # mv -r /mnt/root/home/your-user-name /mnt/home/ Depending on the amount of data and how much space you currently occupy - you may need to unmount the temporary mounts and repeat the shrinking of your primary partition. Extend the new partition with the released space - remount and continue the moving of data. NOTE : You can do a simple cut'n'paste within Thunar just remember to launch Thunar from the root shell. Remember your dot-files/folders - press Ctrl + h to toggle hidden files. 4. Install Manjaro How you want to finish is up to you. Using the Calamares graphic installer presents two options. NOTE : Formatting of the $esp partition - not strictly required - but recommended. Option 1 During install select the Manual partition option Select the previous efi partition mount point /boot/efi format using FAT32 ensure $esp and boot is selected Select the previous root partition Mount point / Format using ext4 Select the new partition Mount point /home do not format Continue the installer and reboot when done. Option 2 During install select the Manual partition option Select the previous efi partition mount point /boot/efi format using FAT32 ensure $esp and boot is selected Select the previous root partition Mount point / format using ext4 Continue the install and reboot Link your data When you have rebooted you can use the groundwork presented in the linked article from the #technical-issues-and-assistance:tutorials section https://archived.forum.manjaro.org/t/howto-move-your-personal-data-to-different-partition/47790?u=linux-aarhus Conclusion If you reached this far without breaking sweat - you are a champion. :checkered_flag:","title":"Reinstall Manjaro without loosing data"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#be-warned","text":"Even Gparted is a proven tool to do the job - the risk of losing data is always present when you work with the filesystem. The author of this guide is not to be blamed if you mess up and loose data . USING THIS GUIDE IS ENTIRELY YOUR RESPONSIBILITY .","title":"BE WARNED"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#target-audience","text":"This guide has been written for a default Manjaro EFI based system using GPT partition scheme. Two partitions $esp partition as first partition - sdy1 Single root partition as second partition - sdy2 You have booted a live ISO Several steps in the guide cannot be done if a partition is mounted. The scope of this guide is not to cater for complex systems like dual-boot. You can of course amend the guide to suit your specific system. Don't hesitate to ask - after all that is what the community forum is all about.","title":"Target audience"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#using-live-iso-and-gparted","text":"In this guide the device is assumed to be located at /dev/sdy . Usually it isn't and you need to locate the device you want to operate on. Use the terminal to locate you device path and replace sdy with the device name you find. $ lsblk Switch to a root shell - on a live ISO the password is manjaro $ su -l root Password: [manjaro ~]#","title":"Using live ISO and Gparted"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#1-file-system-check","text":"If errors are found - do not proceed unless you have fixed them. # fsck /dev/sdy2","title":"1. File system check"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#2-backup","text":"Now is the time to backup important data to external media - whether this is a physical or an online storage location.","title":"2. Backup"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#3-resizing","text":"The Manjaro system itself do not require much space when /home is on a separate partition. A root partition of 32-64G is more than adequate.","title":"3. Resizing"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#a-shrink-root-partition","text":"Release as much space as you can - preferably at least the space needed to hold the entire content of your current $USER folder.","title":"A. Shrink root partition"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#b-create-partition","text":"Create a new partition using the claimed space and format to ext4 - it will become sdy3 # mkfs.ext4 /dev/sdy3","title":"B. Create partition"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#c-temporary-folders","text":"Create two temporary folders e.g. /mnt/home and /mnt/root # mkdir -p /mnt/home # mkdir -p /mnt/root","title":"C. Temporary folders"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#d-mount-the-partitions","text":"# mount /dev/sdy2 /mnt/root # mount /dev/sdy3 /mnt/home","title":"D. Mount the partitions"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#e-move-data","text":"Then move the folder /mnt/root/your-user-name to the new partition. # mv -r /mnt/root/home/your-user-name /mnt/home/ Depending on the amount of data and how much space you currently occupy - you may need to unmount the temporary mounts and repeat the shrinking of your primary partition. Extend the new partition with the released space - remount and continue the moving of data. NOTE : You can do a simple cut'n'paste within Thunar just remember to launch Thunar from the root shell. Remember your dot-files/folders - press Ctrl + h to toggle hidden files.","title":"E. Move data"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#4-install-manjaro","text":"How you want to finish is up to you. Using the Calamares graphic installer presents two options. NOTE : Formatting of the $esp partition - not strictly required - but recommended.","title":"4. Install Manjaro"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#option-1","text":"During install select the Manual partition option Select the previous efi partition mount point /boot/efi format using FAT32 ensure $esp and boot is selected Select the previous root partition Mount point / Format using ext4 Select the new partition Mount point /home do not format Continue the installer and reboot when done.","title":"Option 1"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#option-2","text":"During install select the Manual partition option Select the previous efi partition mount point /boot/efi format using FAT32 ensure $esp and boot is selected Select the previous root partition Mount point / format using ext4 Continue the install and reboot","title":"Option 2"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#link-your-data","text":"When you have rebooted you can use the groundwork presented in the linked article from the #technical-issues-and-assistance:tutorials section https://archived.forum.manjaro.org/t/howto-move-your-personal-data-to-different-partition/47790?u=linux-aarhus","title":"Link your data"},{"location":"manjaro/notes/manjaro-reinstall-withoug-losing-data/#conclusion","text":"If you reached this far without breaking sweat - you are a champion. :checkered_flag:","title":"Conclusion"},{"location":"manjaro/notes/manjaro-run-java-application/","text":"What is a jar file A jar is java package - a zip-compressed archive - including the code for a java application. How can I start the application The jar requires at least JRE (Java Runtime Environment) - some requires the full JDK (Java Development Kit). A JDK contains the corresponding JRE. If in doubt of the actual requirements of the application - install the JDK. To install the latest JRE sudo pacman -Syu jre-openjdk Or the complete environment sudo pacman -Syu jdk-openjdk Commandline To run the application contained in the jar java -jar java-app.jar Create a script and a launcher If you want to launch the program from your menu or the terminal - create a script and a launcher as follows. Create the bin folder mkdir ~/.local/bin Move the jar to the bin folder Assuming it is in Downloads mv ~/Downloads/java-app.jar ~/.local/bin Create the script Open your favorite text editor with a new file and save it as ~/.local/bin/java-app with below content - the \"$@\" ensures that any arguments to the script is passed on to the java-app.jar file #!/bin/sh java -jar ~/.local/bin/java-app.jar \"$@\" Make the script executable chmod +x ~/.local/bin/java-app Create the application folder mkdir -p ~/.local/share/applications Create the desktop launcher Use the text editor to create a new file and save it as ~/.local/share/applications/java-app.desktop with below content [Desktop Entry] Encoding=UTF-8 Name=Some Java App Comment=Run the java-app.jar program GenericName=Some Java App Exec=~/.local/bin/java-app Terminal=false Type=Application Icon=java-app-icon Categories=Application; StartupWMClass=java-app StartupNotify=true Conclusion You are now be able to run Some Java App by providing the script name and any arguments for the java-app.jar and you can find it in the system's menu tree.","title":"Run a Java program on Manjaro"},{"location":"manjaro/notes/manjaro-run-java-application/#what-is-a-jar-file","text":"A jar is java package - a zip-compressed archive - including the code for a java application.","title":"What is a jar file"},{"location":"manjaro/notes/manjaro-run-java-application/#how-can-i-start-the-application","text":"The jar requires at least JRE (Java Runtime Environment) - some requires the full JDK (Java Development Kit). A JDK contains the corresponding JRE. If in doubt of the actual requirements of the application - install the JDK. To install the latest JRE sudo pacman -Syu jre-openjdk Or the complete environment sudo pacman -Syu jdk-openjdk","title":"How can I start the application"},{"location":"manjaro/notes/manjaro-run-java-application/#commandline","text":"To run the application contained in the jar java -jar java-app.jar","title":"Commandline"},{"location":"manjaro/notes/manjaro-run-java-application/#create-a-script-and-a-launcher","text":"If you want to launch the program from your menu or the terminal - create a script and a launcher as follows. Create the bin folder mkdir ~/.local/bin Move the jar to the bin folder Assuming it is in Downloads mv ~/Downloads/java-app.jar ~/.local/bin Create the script Open your favorite text editor with a new file and save it as ~/.local/bin/java-app with below content - the \"$@\" ensures that any arguments to the script is passed on to the java-app.jar file #!/bin/sh java -jar ~/.local/bin/java-app.jar \"$@\" Make the script executable chmod +x ~/.local/bin/java-app Create the application folder mkdir -p ~/.local/share/applications Create the desktop launcher Use the text editor to create a new file and save it as ~/.local/share/applications/java-app.desktop with below content [Desktop Entry] Encoding=UTF-8 Name=Some Java App Comment=Run the java-app.jar program GenericName=Some Java App Exec=~/.local/bin/java-app Terminal=false Type=Application Icon=java-app-icon Categories=Application; StartupWMClass=java-app StartupNotify=true","title":"Create a script and a launcher"},{"location":"manjaro/notes/manjaro-run-java-application/#conclusion","text":"You are now be able to run Some Java App by providing the script name and any arguments for the java-app.jar and you can find it in the system's menu tree.","title":"Conclusion"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/","text":"Simple Manjaro NAS This is a short guide showing how you can add NAS filesharing capabilities to a running Manjaro installation thus adding simple NAS functionality. prepare your system The first step is mandatory - to ensure the system is fully up-to-date sudo pacman -Syu This little project will use the web-based cockpit administration application. This application is maintained by Red Hat developers - so all documentation inside the app is pointing to Red Hat documentation. Cockpit is a modular web application allowing the administrator to add various plugins or applications. A lot of plugins exist - they are user contributions - so it is recommended to properly assess your requirements and the plugin, before you pour it onto your production system. add firewall protection To fend off unwanted traffic - you should consider adding the firewalld to your system - cockpit has an excellent applet for maintaining firewalld (only the default zone is managed and only if NetworkManager is used to manage the network connection) . sudo pacman -S firewalld Then enable and activate the firewalld sudo systemctl enable --now firewalld Be aware that upon starting the firewall, you immediately block everything except the default rules: dhcpv6-client and ssh . To access the system using cockpit and allowing the filesharing you must add cockpit and samba to the firewall. First enable the rules sudo firewall-cmd --add-service={samba,cockpit} --permanent Then activate the rules sudo firewall-cmd --add-service={samba,cockpit} cockpit Should you want to explore some Arch Linux based documentation - see this entry point into the Arch Linux wiki -> https://wiki.archlinux.org/title/Cockpit Installing cockpit is simple sudo pacman -Syu cockpit Then enable the web service sudo systemctl enable --now cockpit.socket Also enable avahi services for better discovery of your shares in your local network. sudo systemctl enable --now avahi-daemon.socket avahi-daemon.service avahi-dnsconfd.service The webservice is running on port 9090 - so open a browser and point it to your system ip address or simply http://localhost:9090 Before we continue - login and explore the basic features - where a web based terminal is an important part. Other parts are Logs Networking and firewall (assuming Network Manager) Accounts Services cockpit files cockpit-files is a file manager plugion to have a basic remote file management solution sudo pacman -S cockpit-files cockpit storage cockpit-storaged is a device manager, adding physical storage management to the webapp. sudo pacman -S cockpit-storaged cockpit file-sharing A word of warning and caution : Public writable shares are at risk of unautorized changes by ransomware so it is important to secure your shares with username and password. Adding the File Sharing component makes it easy to configure and maintain SMB and NFS shares for your local network. The plugin source is on Github and a PKGBUILD is found with AUR -> https://github.com/45Drives/cockpit-file-sharing -> https://aur.archlinux.org/packages/cockpit-file-sharing Building is straight forward - you can do it in the cockpit terminal - we use pamac - but you can use your preferred AUR helper pamac build cockpit-file-sharing Before you can start the service - you need to create an empty /etc/smb.conf . This can be achieve in the Terminal , execute the command sudo touch /etc/samba/smb.conf Then navigate to the Services section in cockpit and while on the Services tab, use the filter box, locate smb, click the link and enable the service. configure samba Start in the Accounts section and create a group called smbusers Select your account and add it to the newly created group. configure file-sharing Click File Sharing in the left pane. At the top you have two options Samba and NFS . First fill in the Global section. See https://forum.manjaro.org/t/root-tip-how-to-samba-server-from-scratch/125550 for more configuration. Define a new share by clicking the + sign in the Shares section The Share Name and Path are mandatory - and the path must exist, if it does not the input will show a link named Create now . If the path is valid - you see a link underneath named Edit Permissions - and this is for ensuring the correct permission has been set for the physical share path. When all is set - click Confirm button Normally when you reconfigure your samba service or shares - you should ensure to restart the service otherwise the changes will not take effect - but using the cockpit applet will switch the configuration from being file-based (/etc/samba/smb.conf to be database based - thus the changes should immediately reflect on the service. published at https://forum.manjaro.org/t/root-tip-how-to-manjaro-nas-network-attached-storage-service/170789","title":"Manjaro NAS (network attached storage)"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#simple-manjaro-nas","text":"This is a short guide showing how you can add NAS filesharing capabilities to a running Manjaro installation thus adding simple NAS functionality.","title":"Simple Manjaro NAS"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#prepare-your-system","text":"The first step is mandatory - to ensure the system is fully up-to-date sudo pacman -Syu This little project will use the web-based cockpit administration application. This application is maintained by Red Hat developers - so all documentation inside the app is pointing to Red Hat documentation. Cockpit is a modular web application allowing the administrator to add various plugins or applications. A lot of plugins exist - they are user contributions - so it is recommended to properly assess your requirements and the plugin, before you pour it onto your production system.","title":"prepare your system"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#add-firewall-protection","text":"To fend off unwanted traffic - you should consider adding the firewalld to your system - cockpit has an excellent applet for maintaining firewalld (only the default zone is managed and only if NetworkManager is used to manage the network connection) . sudo pacman -S firewalld Then enable and activate the firewalld sudo systemctl enable --now firewalld Be aware that upon starting the firewall, you immediately block everything except the default rules: dhcpv6-client and ssh . To access the system using cockpit and allowing the filesharing you must add cockpit and samba to the firewall. First enable the rules sudo firewall-cmd --add-service={samba,cockpit} --permanent Then activate the rules sudo firewall-cmd --add-service={samba,cockpit}","title":"add firewall protection"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#cockpit","text":"Should you want to explore some Arch Linux based documentation - see this entry point into the Arch Linux wiki -> https://wiki.archlinux.org/title/Cockpit Installing cockpit is simple sudo pacman -Syu cockpit Then enable the web service sudo systemctl enable --now cockpit.socket Also enable avahi services for better discovery of your shares in your local network. sudo systemctl enable --now avahi-daemon.socket avahi-daemon.service avahi-dnsconfd.service The webservice is running on port 9090 - so open a browser and point it to your system ip address or simply http://localhost:9090 Before we continue - login and explore the basic features - where a web based terminal is an important part. Other parts are Logs Networking and firewall (assuming Network Manager) Accounts Services","title":"cockpit"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#cockpit-files","text":"cockpit-files is a file manager plugion to have a basic remote file management solution sudo pacman -S cockpit-files","title":"cockpit files"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#cockpit-storage","text":"cockpit-storaged is a device manager, adding physical storage management to the webapp. sudo pacman -S cockpit-storaged","title":"cockpit storage"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#cockpit-file-sharing","text":"A word of warning and caution : Public writable shares are at risk of unautorized changes by ransomware so it is important to secure your shares with username and password. Adding the File Sharing component makes it easy to configure and maintain SMB and NFS shares for your local network. The plugin source is on Github and a PKGBUILD is found with AUR -> https://github.com/45Drives/cockpit-file-sharing -> https://aur.archlinux.org/packages/cockpit-file-sharing Building is straight forward - you can do it in the cockpit terminal - we use pamac - but you can use your preferred AUR helper pamac build cockpit-file-sharing Before you can start the service - you need to create an empty /etc/smb.conf . This can be achieve in the Terminal , execute the command sudo touch /etc/samba/smb.conf Then navigate to the Services section in cockpit and while on the Services tab, use the filter box, locate smb, click the link and enable the service.","title":"cockpit file-sharing"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#configure-samba","text":"Start in the Accounts section and create a group called smbusers Select your account and add it to the newly created group.","title":"configure samba"},{"location":"manjaro/notes/manjaro-simple-nas-configuration/#configure-file-sharing","text":"Click File Sharing in the left pane. At the top you have two options Samba and NFS . First fill in the Global section. See https://forum.manjaro.org/t/root-tip-how-to-samba-server-from-scratch/125550 for more configuration. Define a new share by clicking the + sign in the Shares section The Share Name and Path are mandatory - and the path must exist, if it does not the input will show a link named Create now . If the path is valid - you see a link underneath named Edit Permissions - and this is for ensuring the correct permission has been set for the physical share path. When all is set - click Confirm button Normally when you reconfigure your samba service or shares - you should ensure to restart the service otherwise the changes will not take effect - but using the cockpit applet will switch the configuration from being file-based (/etc/samba/smb.conf to be database based - thus the changes should immediately reflect on the service. published at https://forum.manjaro.org/t/root-tip-how-to-manjaro-nas-network-attached-storage-service/170789","title":"configure file-sharing"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/","text":"Synopsis Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. For the purpose of increased usability, uptime or other reasons some like to have several systems installed That repeatedly creates the issue on how to handle not only the home folder but also data you would like to share between distributions - that can be configurations and/or personal files. The purpose of this document is to create an easy and convenient way of safeguarding or sharing personal data files while retaining the home folder. Preparation One comment I always hear is you can't make folders outside the folder standards so here is the a [link to the definition] (http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION) and I quote The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. So to emphasize Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a custom partitioned system with three or more partitions partitions or more will suffice. As we will be moving folders which traditionally are those taking most space like Documents , Downloads , Music , Pictures , *Video we will be keeping the user's home folder as the standard location /home/$USER* You can easily do this without reinstalling - suffice you have enough diskspace to resize your root partition. Don't touch your $esp partition - it will probably make your system unbootable. Efi System Partition (ESP) Root with home User data If you are not reinstalling then begin with resizing either the root partition or another suitable partition. If you choose to resize your root partition - you need reboot your system on a live media with the suitable software as a mounted partition cannot be shrinked only extended. Setting up the partition Mount point Create a mount point in the root of the file system and set permissions. sudo mkdir /data/shared sudo chmod ugo+rws /data/shared Next step is to mount the partition and modify fstab to mount it at boot. The simple and preferred method is to use the Gnome Disk Utility and modify the mount options so the partition mounts at boot time in the /data/shared folder. Foldernames in this document This document will assume xdg-user-dirs english foldernames. You can of course adapt it entirely to your preferences. So lets move to creating folders. Created folders Ensure your partition is mounted at the designated mountpoint before continuing. Create the folders you want to share between systems or between users e.g. for Music, Pictures and Documents. mkdir /data/shared/Music /data/shared/Pictures /data/shared/Documents The /shared folder is writeable by everyone so if you are maintaining a multi user system you can furter adapt the folder structure by creating a $USER folder with permissions for the user only e.g. sudo mkdir /data/shared/$USER sudo chown $USER:$USER /data/shared/$USER sudo chmod u+rwx,go-rwx /data/shared/$USER Create the mount script Assuming you have created a symlink to the shared folder named Data we create folder to hold our scripts $ mkdir ~/Data/scripts Copy your /etc/fstab to the scripts folder $ cp /etc/fstab ~/Data/scripts/fstab.txt Edit the file fstab.txt and remove everything except the line which mounts your data partition. Proceed with creating a script in the scripts folder and make it executable $ touch ~/Data/scripts/20-mod-fstab $ chmod +x ~/Data/scripts/20-mod-fstab Edit the script file and paste the following content into it #!/bin/bash scriptdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi echo \"Modifying a copy of /etc/fstab -> ${scriptdir}/fstab.org ...\" cp /etc/fstab ${scriptdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${scriptdir}/fstab.org echo \"Merging `fstab.txt` into `fstab.org`\" cat ${scriptdir}/fstab.txt >> ${scriptdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab ...\" sudo mv -bi ${scriptdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" This script is a convenience script to be used when ever you have reinstalled your system and you you need to re-establish the mount point. The script expects the mount folder to be present . Link your data Depending in the folders you want to control you must ceate a symbolic link in your home to the new location. Decide which folders you want to control and create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/30-link-data $ chmod +x ~/Data/scripts/30-link-data Edit the file and and paste the following content into it. Modify the script to match your system and the folders you want to control and save the file. If want bulletproof folder structure consider the information here #!/bin/bash echo \"Moving and linking folders\" cd ~ # moving and linking documents mv -i Documents ~/Data ln -s ~/Data/Documents # moving and linking music mv -i Music ~/Data ln -s ~/Data/Music # moving and linking pictures mv -i Pictures ~/Data ln -s ~/Data/Pictures The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist. Data structure Create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/10-create-data-structure $ chmod +x ~/Data/scripts/10-create-data-structure Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash datadir=\"/home/$USER/Data\" echo \"Creating Data mount structure\" mkdir -p ${datadir} The script is used to create your desired data structure. Add what you deem necessary. Conclusion You have now created three scripts and a text file which can be used whenever you have reinstalled your system. Just run the scripts in sequence 10- 20- 30- and your data is mounted, linked and available - all within minutes. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there.","title":"Sharing data in multi-boot environment"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#synopsis","text":"Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. For the purpose of increased usability, uptime or other reasons some like to have several systems installed That repeatedly creates the issue on how to handle not only the home folder but also data you would like to share between distributions - that can be configurations and/or personal files. The purpose of this document is to create an easy and convenient way of safeguarding or sharing personal data files while retaining the home folder.","title":"Synopsis"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#preparation","text":"One comment I always hear is you can't make folders outside the folder standards so here is the a [link to the definition] (http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION) and I quote The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. So to emphasize Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a custom partitioned system with three or more partitions partitions or more will suffice. As we will be moving folders which traditionally are those taking most space like Documents , Downloads , Music , Pictures , *Video we will be keeping the user's home folder as the standard location /home/$USER* You can easily do this without reinstalling - suffice you have enough diskspace to resize your root partition. Don't touch your $esp partition - it will probably make your system unbootable. Efi System Partition (ESP) Root with home User data If you are not reinstalling then begin with resizing either the root partition or another suitable partition. If you choose to resize your root partition - you need reboot your system on a live media with the suitable software as a mounted partition cannot be shrinked only extended.","title":"Preparation"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#setting-up-the-partition","text":"","title":"Setting up the partition"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#mount-point","text":"Create a mount point in the root of the file system and set permissions. sudo mkdir /data/shared sudo chmod ugo+rws /data/shared Next step is to mount the partition and modify fstab to mount it at boot. The simple and preferred method is to use the Gnome Disk Utility and modify the mount options so the partition mounts at boot time in the /data/shared folder.","title":"Mount point"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#foldernames-in-this-document","text":"This document will assume xdg-user-dirs english foldernames. You can of course adapt it entirely to your preferences. So lets move to creating folders.","title":"Foldernames in this document"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#created-folders","text":"Ensure your partition is mounted at the designated mountpoint before continuing. Create the folders you want to share between systems or between users e.g. for Music, Pictures and Documents. mkdir /data/shared/Music /data/shared/Pictures /data/shared/Documents The /shared folder is writeable by everyone so if you are maintaining a multi user system you can furter adapt the folder structure by creating a $USER folder with permissions for the user only e.g. sudo mkdir /data/shared/$USER sudo chown $USER:$USER /data/shared/$USER sudo chmod u+rwx,go-rwx /data/shared/$USER","title":"Created folders"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#create-the-mount-script","text":"Assuming you have created a symlink to the shared folder named Data we create folder to hold our scripts $ mkdir ~/Data/scripts Copy your /etc/fstab to the scripts folder $ cp /etc/fstab ~/Data/scripts/fstab.txt Edit the file fstab.txt and remove everything except the line which mounts your data partition. Proceed with creating a script in the scripts folder and make it executable $ touch ~/Data/scripts/20-mod-fstab $ chmod +x ~/Data/scripts/20-mod-fstab Edit the script file and paste the following content into it #!/bin/bash scriptdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi echo \"Modifying a copy of /etc/fstab -> ${scriptdir}/fstab.org ...\" cp /etc/fstab ${scriptdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${scriptdir}/fstab.org echo \"Merging `fstab.txt` into `fstab.org`\" cat ${scriptdir}/fstab.txt >> ${scriptdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab ...\" sudo mv -bi ${scriptdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" This script is a convenience script to be used when ever you have reinstalled your system and you you need to re-establish the mount point. The script expects the mount folder to be present .","title":"Create the mount script"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#link-your-data","text":"Depending in the folders you want to control you must ceate a symbolic link in your home to the new location. Decide which folders you want to control and create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/30-link-data $ chmod +x ~/Data/scripts/30-link-data Edit the file and and paste the following content into it. Modify the script to match your system and the folders you want to control and save the file. If want bulletproof folder structure consider the information here #!/bin/bash echo \"Moving and linking folders\" cd ~ # moving and linking documents mv -i Documents ~/Data ln -s ~/Data/Documents # moving and linking music mv -i Music ~/Data ln -s ~/Data/Music # moving and linking pictures mv -i Pictures ~/Data ln -s ~/Data/Pictures The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist.","title":"Link your data"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#data-structure","text":"Create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/10-create-data-structure $ chmod +x ~/Data/scripts/10-create-data-structure Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash datadir=\"/home/$USER/Data\" echo \"Creating Data mount structure\" mkdir -p ${datadir} The script is used to create your desired data structure. Add what you deem necessary.","title":"Data structure"},{"location":"manjaro/notes/share-data-in-multi-boot-environment/#conclusion","text":"You have now created three scripts and a text file which can be used whenever you have reinstalled your system. Just run the scripts in sequence 10- 20- 30- and your data is mounted, linked and available - all within minutes. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there.","title":"Conclusion"},{"location":"manjaro/notes/share-data-in-multiuser-environment/","text":"Data sharing Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. For the purpose of increased usability, uptime or other reasons, some like to have several systems installed. That repeatedly creates the issue on how to handle not only the home folder but also data you would like to share between distributions or multiple users of the same system - that can be configurations and/or personal files. The purpose of this document is to create an easy and convenient way of safeguarding or sharing personal data files while retaining the home folder. Everything in this document is meant as a starting point for creating your own adapted version. It is not one-size-fits-all but it should give you - the reader - an idea on how to achieve the goal of protecting user data during re-installation and restore these without extensive copy operations. Besides the above it is intended to provide a reasonable simple way of sharing data between users or systems. This guide is a modified version of the guide detailing how to store personal data on a different partition . Preparation One comment I always hear is you can't make folders outside the folder standards so here is the link to the FHS definition and I quote The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. So to emphasize Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a custom partitioned system with three or more partitions partitions will suffice. As we will be moving folders which traditionally are those taking most space like Documents , Downloads , Music , Pictures , *Video we will be keeping the user's home folder as the standard location /home/$USER* You can easily do this without reinstalling - suffice you have enough diskspace to resize your root partition. Don't touch your $esp partition - it will probably make your system unbootable. Efi System Partition (ESP) Root with home User data Ensure the data partition is formatted with a filesystem which can be read by the systems accessing the partition. The general recommendation in this context is ext4. If you want to share files between Windows and Linux format the partition with exFAT. If you are not reinstalling then begin with resizing either the root partition or another suitable partition. If you choose to resize your root partition - you need reboot your system on a live media with the suitable software as a mounted partition cannot be shrinked only extended. Setting up the partition Mount point Create a mount point in the root of the file system and set permissions. sudo mkdir /data/shared sudo chmod ugo+rwx /data/shared Next step is to mount the partition and modify fstab to mount it at boot. The simple and preferred method is to use the Gnome Disk Utility and modify the mount options so the partition mounts at boot time in the /data/shared folder. A suitable set of mount options is defaults,rw,noatime Foldernames in this document This document will assume xdg-user-dirs english foldernames. You can of course adapt it entirely to your preferences. So lets move to creating folders. Creating folders Ensure your partition is mounted at the designated mountpoint before continuing. Create the folders you want to share between systems or between users e.g. for Music, Pictures and Documents. mkdir /data/shared/Music /data/shared/Pictures /data/shared/Documents The /data/shared folder is writeable by everyone so if you are maintaining a multi user system you can further adapt the folder structure by creating a $USER folder with permissions for the user only e.g. sudo mkdir /data/shared/$USER sudo chown $USER:$USER /data/shared/$USER sudo chmod u+rwx,go-rwx /data/shared/$USER Create the mount script Assuming you have created a symlink to the shared folder named Data we create folder to hold our scripts $ mkdir ~/Data/scripts Copy your /etc/fstab to the scripts folder $ cp /etc/fstab ~/Data/scripts/fstab.txt Edit the file fstab.txt and remove everything except the line which mounts your data partition. Proceed with creating a script in the scripts folder and make it executable $ touch ~/Data/scripts/20-mod-fstab $ chmod +x ~/Data/scripts/20-mod-fstab Edit the script file and paste the following content into it #!/bin/bash scriptdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi echo \"Modifying a copy of /etc/fstab -> ${scriptdir}/fstab.org ...\" cp /etc/fstab ${scriptdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${scriptdir}/fstab.org echo \"Merging `fstab.txt` into `fstab.org`\" cat ${scriptdir}/fstab.txt >> ${scriptdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab ...\" sudo mv -bi ${scriptdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" This script is a convenience script to be used when ever you have reinstalled your system and you you need to re-establish the mount point. The script expects the mount folder to be present . Link your data Depending on the folders you want to control you must ceate a symbolic link in your home to the new location. Decide which folders you want to control and create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/30-link-data $ chmod +x ~/Data/scripts/30-link-data Edit the file and and paste the following content into it. Modify the script to match your system and the folders you want to control and save the file. If want bulletproof folder structure consider the information here #!/bin/bash echo \"Moving and linking folders\" cd ~ # moving and linking documents mv -i Documents ~/Data ln -s ~/Data/Documents # moving and linking music mv -i Music ~/Data ln -s ~/Data/Music # moving and linking pictures mv -i Pictures ~/Data ln -s ~/Data/Pictures The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist. Data structure Create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/10-create-data-structure $ chmod +x ~/Data/scripts/10-create-data-structure Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash datadir=\"/home/$USER/Data\" echo \"Creating Data symlink\" ln -s /data/shared ${datadir} The script is used to create your desired data structure. Add what you deem necessary. Conclusion You have now created three scripts and a text file which can be used whenever you have reinstalled your system. Just run the scripts in sequence 10- 20- 30- and your data is mounted, linked and available - all within minutes. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there. Reference files [details=\"mounting details\"] /data/private/scripts >>> cat fstab.txt UUID=456bf27c-7e14-48b4-9df8-a49254dcf79e /data/projects ext4 defaults,noatime 0 2 UUID=899b1bc4-219c-4b92-8539-0aa118d9780a /data/build ext4 defaults,noatime 0 2 UUID=1f3d1a6e-b4b5-46da-909a-8a87a45dd18b /data/private ext4 defaults,noatime 0 2 #UUID=67f922cd-a61f-4d5e-84c0-ac8335a7ce67 /data/virtualbox ext4 defaults,noatime 0 2 UUID=a27d7c58-0ebb-4c93-bcec-f9387f7d34f6 /data/virtualbox ext4 defaults,noatime 0 2 #UUID=b925148a-0729-447a-ad95-4d9e27dcb442 /data/usb/seagate ext4 defaults,noatime 0 2 tmpfs /var/spool tmpfs defaults,noatime,mode=1777 0 0 tmpfs /var/tmp tmpfs defaults,noatime,mode=1777 0 0 diskstation:/volume1/data /data/nfs/data nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/music /data/nfs/music nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/photo /data/nfs/photo nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/video /data/nfs/video nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/web /data/nfs/web nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 [/details] [details=\"10-net-services\"] /data/private/scripts >>> cat 10-net-services #!/bin/bash echo \"Using sudo ...\" echo \"Start and enable nfs-client.target\" sudo systemctl enable --now nfs-client.target sudo systemctl enable --now NetworkManager-wait-online.service [/details] [details=\"20-create-data-structure\"] /data/private/scripts >>> cat 20-create-data-structure #!/bin/bash datadir=\"/data/\" echo \"Creating Data mount structure\" sudo mkdir ${datadir} sudo mkdir ${datadir}/nfs sudo mkdir ${datadir}/build sudo mkdir ${datadir}/private sudo mkdir ${datadir}/projects sudo mkdir ${datadir}/virtualbox sudo chown $USER ${datadir}/nfs \\ ${datadir}/build \\ ${datadir}/private \\ ${datadir}/projects \\ ${datadir}/virtualbox mkdir ${datadir}/nfs/data \\ ${datadir}/nfs/music \\ ${datadir}/nfs/photo \\ ${datadir}/nfs/video \\ ${datadir}/nfs/web [/details] [details=\"30-mod-fstab\"] /data/private/scripts >>> cat 30-mod-fstab #!/bin/bash echo \"Modifying a copy of /etc/fstab...\" workdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi cp /etc/fstab ${workdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${workdir}/fstab.org echo \"Merging 'fstab.txt' with 'fstab.org'\" cat ${workdir}/fstab.txt >> ${workdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab...\" sudo mv ${workdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" [/details] [details=\"40-link-data\"] /data/private/scripts >>> cat 40-link-data #!/bin/bash cd ~ #linking root data folder ln -s /data ~/Data echo \"Linking Documents folder...\" rm -rf Documents ln -sf /data/private/.home/Documents echo \"Linking Downloads folder...\" rm -rf Downloads ln -sf /data/private/.home/Downloads echo \"Linking Music folder...\" rm -rf Music ln -sf /data/private/.home/Music echo \"Linking Pictures folder...\" rm -rf Pictures ln -sf /data/private/.home/Pictures echo \"Linking Manjaro tools config folder...\" ln -sf /data/private/manjaro-tools-config ~/.config/manjaro-tools echo \"Linking Thunderbird data folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking Virtual Environments folder...\" ln -sf /data/projects/.virtualenvs echo \"Linking VirtualBox VMs...\" ln -sf /data/virtualbox/VirtualBox\\ VMs echo \"Copying Git config...\" ln -sf /data/private/.home/.gitconfig echo \"Linking makepkg config...\" ln -sf /data/private/.home/.makepkg.conf echo \"Linking Transifex config...\" ln -sf /data/private/.home/.transifexrc echo \"Linking netrc config...\" ln -sf /data/private/.home/.netrc ~/ chown fh:fh ~/.netrc chmod u+rwx,go-rwx ~/.netrc echo \"Copying SSH config folder...\" cp -r /data/private/.home/.ssh ~/.ssh chown fh:fh ~/.ssh -R chmod u+rwx,go-rwx ~/.ssh -R echo \"Linking thunderbird folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking GPG keyring\" rm -f ~/.gnupg ln -sf /data/private/.home/.gnupg chown fh:fh ~/.gnupg -R chmod u+rwx,go-rwx ~/.gnupg -R echo \"Done!\" [/details]","title":"Sharing data in multiuser environment"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#data-sharing","text":"Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. For the purpose of increased usability, uptime or other reasons, some like to have several systems installed. That repeatedly creates the issue on how to handle not only the home folder but also data you would like to share between distributions or multiple users of the same system - that can be configurations and/or personal files. The purpose of this document is to create an easy and convenient way of safeguarding or sharing personal data files while retaining the home folder. Everything in this document is meant as a starting point for creating your own adapted version. It is not one-size-fits-all but it should give you - the reader - an idea on how to achieve the goal of protecting user data during re-installation and restore these without extensive copy operations. Besides the above it is intended to provide a reasonable simple way of sharing data between users or systems. This guide is a modified version of the guide detailing how to store personal data on a different partition .","title":"Data sharing"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#preparation","text":"One comment I always hear is you can't make folders outside the folder standards so here is the link to the FHS definition and I quote The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. So to emphasize Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a custom partitioned system with three or more partitions partitions will suffice. As we will be moving folders which traditionally are those taking most space like Documents , Downloads , Music , Pictures , *Video we will be keeping the user's home folder as the standard location /home/$USER* You can easily do this without reinstalling - suffice you have enough diskspace to resize your root partition. Don't touch your $esp partition - it will probably make your system unbootable. Efi System Partition (ESP) Root with home User data Ensure the data partition is formatted with a filesystem which can be read by the systems accessing the partition. The general recommendation in this context is ext4. If you want to share files between Windows and Linux format the partition with exFAT. If you are not reinstalling then begin with resizing either the root partition or another suitable partition. If you choose to resize your root partition - you need reboot your system on a live media with the suitable software as a mounted partition cannot be shrinked only extended.","title":"Preparation"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#setting-up-the-partition","text":"","title":"Setting up the partition"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#mount-point","text":"Create a mount point in the root of the file system and set permissions. sudo mkdir /data/shared sudo chmod ugo+rwx /data/shared Next step is to mount the partition and modify fstab to mount it at boot. The simple and preferred method is to use the Gnome Disk Utility and modify the mount options so the partition mounts at boot time in the /data/shared folder. A suitable set of mount options is defaults,rw,noatime","title":"Mount point"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#foldernames-in-this-document","text":"This document will assume xdg-user-dirs english foldernames. You can of course adapt it entirely to your preferences. So lets move to creating folders.","title":"Foldernames in this document"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#creating-folders","text":"Ensure your partition is mounted at the designated mountpoint before continuing. Create the folders you want to share between systems or between users e.g. for Music, Pictures and Documents. mkdir /data/shared/Music /data/shared/Pictures /data/shared/Documents The /data/shared folder is writeable by everyone so if you are maintaining a multi user system you can further adapt the folder structure by creating a $USER folder with permissions for the user only e.g. sudo mkdir /data/shared/$USER sudo chown $USER:$USER /data/shared/$USER sudo chmod u+rwx,go-rwx /data/shared/$USER","title":"Creating folders"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#create-the-mount-script","text":"Assuming you have created a symlink to the shared folder named Data we create folder to hold our scripts $ mkdir ~/Data/scripts Copy your /etc/fstab to the scripts folder $ cp /etc/fstab ~/Data/scripts/fstab.txt Edit the file fstab.txt and remove everything except the line which mounts your data partition. Proceed with creating a script in the scripts folder and make it executable $ touch ~/Data/scripts/20-mod-fstab $ chmod +x ~/Data/scripts/20-mod-fstab Edit the script file and paste the following content into it #!/bin/bash scriptdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi echo \"Modifying a copy of /etc/fstab -> ${scriptdir}/fstab.org ...\" cp /etc/fstab ${scriptdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${scriptdir}/fstab.org echo \"Merging `fstab.txt` into `fstab.org`\" cat ${scriptdir}/fstab.txt >> ${scriptdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab ...\" sudo mv -bi ${scriptdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" This script is a convenience script to be used when ever you have reinstalled your system and you you need to re-establish the mount point. The script expects the mount folder to be present .","title":"Create the mount script"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#link-your-data","text":"Depending on the folders you want to control you must ceate a symbolic link in your home to the new location. Decide which folders you want to control and create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/30-link-data $ chmod +x ~/Data/scripts/30-link-data Edit the file and and paste the following content into it. Modify the script to match your system and the folders you want to control and save the file. If want bulletproof folder structure consider the information here #!/bin/bash echo \"Moving and linking folders\" cd ~ # moving and linking documents mv -i Documents ~/Data ln -s ~/Data/Documents # moving and linking music mv -i Music ~/Data ln -s ~/Data/Music # moving and linking pictures mv -i Pictures ~/Data ln -s ~/Data/Pictures The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist.","title":"Link your data"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#data-structure","text":"Create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/10-create-data-structure $ chmod +x ~/Data/scripts/10-create-data-structure Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash datadir=\"/home/$USER/Data\" echo \"Creating Data symlink\" ln -s /data/shared ${datadir} The script is used to create your desired data structure. Add what you deem necessary.","title":"Data structure"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#conclusion","text":"You have now created three scripts and a text file which can be used whenever you have reinstalled your system. Just run the scripts in sequence 10- 20- 30- and your data is mounted, linked and available - all within minutes. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there.","title":"Conclusion"},{"location":"manjaro/notes/share-data-in-multiuser-environment/#reference-files","text":"[details=\"mounting details\"] /data/private/scripts >>> cat fstab.txt UUID=456bf27c-7e14-48b4-9df8-a49254dcf79e /data/projects ext4 defaults,noatime 0 2 UUID=899b1bc4-219c-4b92-8539-0aa118d9780a /data/build ext4 defaults,noatime 0 2 UUID=1f3d1a6e-b4b5-46da-909a-8a87a45dd18b /data/private ext4 defaults,noatime 0 2 #UUID=67f922cd-a61f-4d5e-84c0-ac8335a7ce67 /data/virtualbox ext4 defaults,noatime 0 2 UUID=a27d7c58-0ebb-4c93-bcec-f9387f7d34f6 /data/virtualbox ext4 defaults,noatime 0 2 #UUID=b925148a-0729-447a-ad95-4d9e27dcb442 /data/usb/seagate ext4 defaults,noatime 0 2 tmpfs /var/spool tmpfs defaults,noatime,mode=1777 0 0 tmpfs /var/tmp tmpfs defaults,noatime,mode=1777 0 0 diskstation:/volume1/data /data/nfs/data nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/music /data/nfs/music nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/photo /data/nfs/photo nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/video /data/nfs/video nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/web /data/nfs/web nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 [/details] [details=\"10-net-services\"] /data/private/scripts >>> cat 10-net-services #!/bin/bash echo \"Using sudo ...\" echo \"Start and enable nfs-client.target\" sudo systemctl enable --now nfs-client.target sudo systemctl enable --now NetworkManager-wait-online.service [/details] [details=\"20-create-data-structure\"] /data/private/scripts >>> cat 20-create-data-structure #!/bin/bash datadir=\"/data/\" echo \"Creating Data mount structure\" sudo mkdir ${datadir} sudo mkdir ${datadir}/nfs sudo mkdir ${datadir}/build sudo mkdir ${datadir}/private sudo mkdir ${datadir}/projects sudo mkdir ${datadir}/virtualbox sudo chown $USER ${datadir}/nfs \\ ${datadir}/build \\ ${datadir}/private \\ ${datadir}/projects \\ ${datadir}/virtualbox mkdir ${datadir}/nfs/data \\ ${datadir}/nfs/music \\ ${datadir}/nfs/photo \\ ${datadir}/nfs/video \\ ${datadir}/nfs/web [/details] [details=\"30-mod-fstab\"] /data/private/scripts >>> cat 30-mod-fstab #!/bin/bash echo \"Modifying a copy of /etc/fstab...\" workdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi cp /etc/fstab ${workdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${workdir}/fstab.org echo \"Merging 'fstab.txt' with 'fstab.org'\" cat ${workdir}/fstab.txt >> ${workdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab...\" sudo mv ${workdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" [/details] [details=\"40-link-data\"] /data/private/scripts >>> cat 40-link-data #!/bin/bash cd ~ #linking root data folder ln -s /data ~/Data echo \"Linking Documents folder...\" rm -rf Documents ln -sf /data/private/.home/Documents echo \"Linking Downloads folder...\" rm -rf Downloads ln -sf /data/private/.home/Downloads echo \"Linking Music folder...\" rm -rf Music ln -sf /data/private/.home/Music echo \"Linking Pictures folder...\" rm -rf Pictures ln -sf /data/private/.home/Pictures echo \"Linking Manjaro tools config folder...\" ln -sf /data/private/manjaro-tools-config ~/.config/manjaro-tools echo \"Linking Thunderbird data folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking Virtual Environments folder...\" ln -sf /data/projects/.virtualenvs echo \"Linking VirtualBox VMs...\" ln -sf /data/virtualbox/VirtualBox\\ VMs echo \"Copying Git config...\" ln -sf /data/private/.home/.gitconfig echo \"Linking makepkg config...\" ln -sf /data/private/.home/.makepkg.conf echo \"Linking Transifex config...\" ln -sf /data/private/.home/.transifexrc echo \"Linking netrc config...\" ln -sf /data/private/.home/.netrc ~/ chown fh:fh ~/.netrc chmod u+rwx,go-rwx ~/.netrc echo \"Copying SSH config folder...\" cp -r /data/private/.home/.ssh ~/.ssh chown fh:fh ~/.ssh -R chmod u+rwx,go-rwx ~/.ssh -R echo \"Linking thunderbird folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking GPG keyring\" rm -f ~/.gnupg ln -sf /data/private/.home/.gnupg chown fh:fh ~/.gnupg -R chmod u+rwx,go-rwx ~/.gnupg -R echo \"Done!\" [/details]","title":"Reference files"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/","text":"Difficulty: \u2605\u2605\u2605\u2606\u2606 This document has been posted at Manjaro Forum which in turn is put together from my old topics from the archived forum [[1][11]] [[2][12]] SSH server security When you setup a SSH server on a public IP, your service will be spammed within minutes attempting to brute force your login. Your first task as admin of a SSH server is to secure it. Topic assumptions A Manjaro instance with at least two users, a root user and a user belonging to the %wheel group. A drop-in config in /etc/sudoers.d/ assigning permissions to the group. Such file is created with default Manjaro install $ cat /etc/sudoers.d/10-installer %wheel ALL=(ALL) ALL If you have installed Manjaro by hand you will need to establish such file by hand. Always use visudo as the filepermissions are important. SSH security Your SSH server is not the only server you may come across using a public key infrastucture. If you are a using services like Github, GitLab, SourceForge, OSDN and many more - you have come across this before. 1. Public key login Create key pair SSH public key infrastructure is actually a key pair consisting of both a public and a private key. The public part has the extension .pub and this is the key you place on the server or service. You create key pair using the ssh-keygen utility. This utility takes various arguments which affects how the key-pair is generated and where the files are placed. The defaults are sane but in case you want a stronger key, you can use the man-pages to expand your knowledge. $ man ssh-keygen It is recommended to use a separate key for each server and each device you are using to connect with and to tell the keys apart you use a different filename e.g. the name of the service. If you have a Linode cloud instance you could name the file linode or if you are using OSDN you may name it osdn . To create a key-pair for a service using the service name for the key-pair, you supply the path to the file using the -f argument - in this example I will use the name ssh-service with the cipher appened. When you create the key you have the option of using a password - or you can leave password blank. This of course lowers the security on client side - but you don't have to unlock the key-pair on use - and it is a matter of choice - just remember to keep you private keys safe - no matter using key password or not. EDIT: 2021-10-16 Due to recent changes and deprecation of ciphers considered unsafe you should add the -t option to specify the cipher to be used preferably ed25519 $ ssh-keygen -t ed25519 -f ~/.ssh/ssh-service-ed25519.ppk You don't need to use the .ppk part, but doing so makes it easy to configure FileZilla as SFTP client using a keyfile. Transfer the public key to the server Many VPS providers only provide a root account on the initial device in which case you will have to target root for the keyfile. Manjaro installations defaults to keyfile only for root login. Therefore you will need another user account on the device with sudo privilege to be able to upoload the keyfile. To upload the public part to the server - you can use the scp command which is an abbreviation of secure copy . The command consist of three parts: The command itself The path to the file to be copied Server and where to put the file In case of a VPS with only a root user $ scp ./ssh/ssh-service-ed25519.ppk.pub root@host:/root/.ssh Or in case of a rapsberry pi in your local network $ scp ./ssh/ssh-service-ed25519.ppk.pub $user@host:/home/$USER/.ssh/ Another option is to use ssh-copy to send the file to your ssh service ssh-copy-id -i ~/.ssh/ssh-service-ed25519.ppk.pub $USER@server.domain.tld Log off the server and test your connection using your identity file ssh $USER@server.domain.tld -i ~/.ssh/ssh-service-ed25519.ppk.pub If you - in the above key-generation supplied a password to protect your key-pair - you will be prompted to unlock the key-pair. If you did it right - you are now in a remote shell without being prompted for credentials. 2. Disable password login When you are logged in - using the public key - edit the file /etc/ssh/sshd_config sudo nano /etc/ssh/sshd_config Scroll down to the lines reading: # To disable tunneled clear text passwords, change to no here! #PasswordAuthentication yes #PermitEmptyPasswords no And change them to: PasswordAuthentication no 3. Change port While you are logged in - seriously consider changing the port from the default 22 to something else! Consult /etc/services to avoid a collision with known services - but in reality any port over 10000 can be used. The port is located at the top of the configuration # Port 22 #AddressFamily any #ListenAddress 0.0.0.0 #ListenAddress :: Uncomment the line and change the port number Port 33000 Save the changes and restart the sshd daemon # systemctl reload sshd 4. Connecting to the server Connecting to SSH server can be automated by means of the user's local configuration. Some points to remember: - the file is parsed from top to bottom - the first match is used so don't keep duplicated entries! If you plan to connect to the same server using different users, this can easily be done using different names for the Host entry. Every server or service is designated by the Host - all lines between Host entries belong to the preceding Host . $ nano ~/.ssh/config Add your server details - examples Host nickname Hostname server.domain.tld IdentityFile ~/.ssh/ssh-service-ed25519.ppk user root Port 33000 Host fido.domain.tld IdentityFile ~/.ssh/fido.ppk user fido ssh nickname Note on host key fingerprint Upon first connection to a - previously unknown - ssh service you will be challenged before connection - something like $ ssh user@hostname The authenticity of host 'hostname (v.x.y.z)' can't be established. ED25519 key fingerprint is SHA256:P4QBIqLt6g6JU5P3po0WRLF+mr0ypYhhG3iGgCprM20. This host key is known by the following other names/addresses: ~/.ssh/known_hosts:15: v.x.y.z Are you sure you want to continue connecting (yes/no/[fingerprint])? The ssh client will always try to match the remote system to a list of known hosts found in ~/.ssh/known_hosts and if no match is found the client challenge you to trust the host. If you accept the challenge - the host key fingerprint will be added to the list. If you - for any reason want to skip this check you can do so by adding an option to your connection command ssh -o StrictHostKeyChecking=no If you are wearing a blackhat and have a host which regularly changes IP or if you only connect to your own systems you could opt to completely ignore the fingerprints by adding it to your local ~/.ssh/config Host * StrictHostKeyChecking no A note on passwordless keyfiles When you have a lot of key-pairs (using no password) - you may run into the message - too many failed logins and subsequently - on a Manjaro system - the user may be locked. You can create a workaround for this by disabling identity agent for the host or you can specify the the identity file on the command line when you connect to the host. This can be done for all or for a single host Host nickname IdentityAgent none ... Or using a wildcard Host * IdentityAgent none ... 4. Secure your key-pairs You don't want to loose your key collection. IMPORTANT : Keep a copy of your ~/.ssh folder in a secure location and if you are using password less keys - keep them safe by: using a strong password on your system disabling the root account mandatory chown $USER:$USER .ssh -R && chmod u-x,go-rwx ~/.ssh/* 5. Firewall Next step is to ensure only allowed services are accessible by implementing a firewall. Firewalld Firewalld a very good firewall service - well suited on systemd based systems like Manjaro. Firewalld can be configured using the term application since an application is merely a definition of which ports should be allowed - e.g. a http application or ssh or smtp. When you configure the firewall you use zones to define where you are and services to define what you allow. Install firewalld: # pacman -Syu firewalld When firewalld is enabled and started the default zone is public which allows the computer to be visible but all ports closed. Adding a specific service (application) is easily done using the command line but you can also use the applet found in your system configuration area. A systray application is available if you install the dependencies for it (python-pyqt5). Adding services has immediate effect - no need to reload the service. Simply add the service to the allowed service to the desired zone Example - adding http to public zone # firewall-cmd --zone=public --add-service=http success It is important to realize that changes you make on the fly are not permanent. To make a certain service available permanently, add the --permanent argument # firewall-cmd --permanent --zone=public --add-service=http success What if you want to add your own service definition? Easy-peasy - look in the folder /usr/lib/firewalld/services and make a copy of an appropriate service definition. Example - you want to run a ssh server on a non default port. Copy the ssh.xml service definition to /etc/firewalld/services # cp /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/my-ssh.xml Edit the service definition # nano /etc/firewalld/services/my-ssh.xml Change the port to match your service and the short name to distinguish from the original service. <?xml version=\"1.0\" encoding=\"utf-8\"?> <service> <short>My SSH service</short> <description>Secure Shell (SSH) is a protocol for logging into and executing commands on remote machines. It provides secure encrypted communications. If you plan on accessing your machine remotely via SSH over a firewalled interface, enable this option. You need the openssh-server package installed for this option to be useful.</description> <port protocol=\"tcp\" port=\"30000\"/> </service> Wait 5-10 seconds for the service file to be recognized and activate it (Same rule on permanent applies) # firewall-cmd --zone=public --add-service=my-ssh --permanent success That's it - more info on firewalld can be found using the dedicated webpage https://firewalld.org/documentation/","title":"SSH server security"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#ssh-server-security","text":"When you setup a SSH server on a public IP, your service will be spammed within minutes attempting to brute force your login. Your first task as admin of a SSH server is to secure it.","title":"SSH server security"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#topic-assumptions","text":"A Manjaro instance with at least two users, a root user and a user belonging to the %wheel group. A drop-in config in /etc/sudoers.d/ assigning permissions to the group. Such file is created with default Manjaro install $ cat /etc/sudoers.d/10-installer %wheel ALL=(ALL) ALL If you have installed Manjaro by hand you will need to establish such file by hand. Always use visudo as the filepermissions are important.","title":"Topic assumptions"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#ssh-security","text":"Your SSH server is not the only server you may come across using a public key infrastucture. If you are a using services like Github, GitLab, SourceForge, OSDN and many more - you have come across this before.","title":"SSH security"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#1-public-key-login","text":"","title":"1. Public key login"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#create-key-pair","text":"SSH public key infrastructure is actually a key pair consisting of both a public and a private key. The public part has the extension .pub and this is the key you place on the server or service. You create key pair using the ssh-keygen utility. This utility takes various arguments which affects how the key-pair is generated and where the files are placed. The defaults are sane but in case you want a stronger key, you can use the man-pages to expand your knowledge. $ man ssh-keygen It is recommended to use a separate key for each server and each device you are using to connect with and to tell the keys apart you use a different filename e.g. the name of the service. If you have a Linode cloud instance you could name the file linode or if you are using OSDN you may name it osdn . To create a key-pair for a service using the service name for the key-pair, you supply the path to the file using the -f argument - in this example I will use the name ssh-service with the cipher appened. When you create the key you have the option of using a password - or you can leave password blank. This of course lowers the security on client side - but you don't have to unlock the key-pair on use - and it is a matter of choice - just remember to keep you private keys safe - no matter using key password or not. EDIT: 2021-10-16 Due to recent changes and deprecation of ciphers considered unsafe you should add the -t option to specify the cipher to be used preferably ed25519 $ ssh-keygen -t ed25519 -f ~/.ssh/ssh-service-ed25519.ppk You don't need to use the .ppk part, but doing so makes it easy to configure FileZilla as SFTP client using a keyfile.","title":"Create key pair"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#transfer-the-public-key-to-the-server","text":"Many VPS providers only provide a root account on the initial device in which case you will have to target root for the keyfile. Manjaro installations defaults to keyfile only for root login. Therefore you will need another user account on the device with sudo privilege to be able to upoload the keyfile. To upload the public part to the server - you can use the scp command which is an abbreviation of secure copy . The command consist of three parts: The command itself The path to the file to be copied Server and where to put the file In case of a VPS with only a root user $ scp ./ssh/ssh-service-ed25519.ppk.pub root@host:/root/.ssh Or in case of a rapsberry pi in your local network $ scp ./ssh/ssh-service-ed25519.ppk.pub $user@host:/home/$USER/.ssh/ Another option is to use ssh-copy to send the file to your ssh service ssh-copy-id -i ~/.ssh/ssh-service-ed25519.ppk.pub $USER@server.domain.tld Log off the server and test your connection using your identity file ssh $USER@server.domain.tld -i ~/.ssh/ssh-service-ed25519.ppk.pub If you - in the above key-generation supplied a password to protect your key-pair - you will be prompted to unlock the key-pair. If you did it right - you are now in a remote shell without being prompted for credentials.","title":"Transfer the public key to the server"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#2-disable-password-login","text":"When you are logged in - using the public key - edit the file /etc/ssh/sshd_config sudo nano /etc/ssh/sshd_config Scroll down to the lines reading: # To disable tunneled clear text passwords, change to no here! #PasswordAuthentication yes #PermitEmptyPasswords no And change them to: PasswordAuthentication no","title":"2. Disable password login"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#3-change-port","text":"While you are logged in - seriously consider changing the port from the default 22 to something else! Consult /etc/services to avoid a collision with known services - but in reality any port over 10000 can be used. The port is located at the top of the configuration # Port 22 #AddressFamily any #ListenAddress 0.0.0.0 #ListenAddress :: Uncomment the line and change the port number Port 33000 Save the changes and restart the sshd daemon # systemctl reload sshd","title":"3. Change port"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#4-connecting-to-the-server","text":"Connecting to SSH server can be automated by means of the user's local configuration. Some points to remember: - the file is parsed from top to bottom - the first match is used so don't keep duplicated entries! If you plan to connect to the same server using different users, this can easily be done using different names for the Host entry. Every server or service is designated by the Host - all lines between Host entries belong to the preceding Host . $ nano ~/.ssh/config Add your server details - examples Host nickname Hostname server.domain.tld IdentityFile ~/.ssh/ssh-service-ed25519.ppk user root Port 33000 Host fido.domain.tld IdentityFile ~/.ssh/fido.ppk user fido ssh nickname","title":"4. Connecting to the server"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#note-on-host-key-fingerprint","text":"Upon first connection to a - previously unknown - ssh service you will be challenged before connection - something like $ ssh user@hostname The authenticity of host 'hostname (v.x.y.z)' can't be established. ED25519 key fingerprint is SHA256:P4QBIqLt6g6JU5P3po0WRLF+mr0ypYhhG3iGgCprM20. This host key is known by the following other names/addresses: ~/.ssh/known_hosts:15: v.x.y.z Are you sure you want to continue connecting (yes/no/[fingerprint])? The ssh client will always try to match the remote system to a list of known hosts found in ~/.ssh/known_hosts and if no match is found the client challenge you to trust the host. If you accept the challenge - the host key fingerprint will be added to the list. If you - for any reason want to skip this check you can do so by adding an option to your connection command ssh -o StrictHostKeyChecking=no If you are wearing a blackhat and have a host which regularly changes IP or if you only connect to your own systems you could opt to completely ignore the fingerprints by adding it to your local ~/.ssh/config Host * StrictHostKeyChecking no","title":"Note on host key fingerprint"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#a-note-on-passwordless-keyfiles","text":"When you have a lot of key-pairs (using no password) - you may run into the message - too many failed logins and subsequently - on a Manjaro system - the user may be locked. You can create a workaround for this by disabling identity agent for the host or you can specify the the identity file on the command line when you connect to the host. This can be done for all or for a single host Host nickname IdentityAgent none ... Or using a wildcard Host * IdentityAgent none ...","title":"A note on passwordless keyfiles"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#4-secure-your-key-pairs","text":"You don't want to loose your key collection. IMPORTANT : Keep a copy of your ~/.ssh folder in a secure location and if you are using password less keys - keep them safe by: using a strong password on your system disabling the root account mandatory chown $USER:$USER .ssh -R && chmod u-x,go-rwx ~/.ssh/*","title":"4. Secure your key-pairs"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#5-firewall","text":"Next step is to ensure only allowed services are accessible by implementing a firewall.","title":"5. Firewall"},{"location":"manjaro/notes/ssh-secure-your-ssh-service/#firewalld","text":"Firewalld a very good firewall service - well suited on systemd based systems like Manjaro. Firewalld can be configured using the term application since an application is merely a definition of which ports should be allowed - e.g. a http application or ssh or smtp. When you configure the firewall you use zones to define where you are and services to define what you allow. Install firewalld: # pacman -Syu firewalld When firewalld is enabled and started the default zone is public which allows the computer to be visible but all ports closed. Adding a specific service (application) is easily done using the command line but you can also use the applet found in your system configuration area. A systray application is available if you install the dependencies for it (python-pyqt5). Adding services has immediate effect - no need to reload the service. Simply add the service to the allowed service to the desired zone Example - adding http to public zone # firewall-cmd --zone=public --add-service=http success It is important to realize that changes you make on the fly are not permanent. To make a certain service available permanently, add the --permanent argument # firewall-cmd --permanent --zone=public --add-service=http success What if you want to add your own service definition? Easy-peasy - look in the folder /usr/lib/firewalld/services and make a copy of an appropriate service definition. Example - you want to run a ssh server on a non default port. Copy the ssh.xml service definition to /etc/firewalld/services # cp /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/my-ssh.xml Edit the service definition # nano /etc/firewalld/services/my-ssh.xml Change the port to match your service and the short name to distinguish from the original service. <?xml version=\"1.0\" encoding=\"utf-8\"?> <service> <short>My SSH service</short> <description>Secure Shell (SSH) is a protocol for logging into and executing commands on remote machines. It provides secure encrypted communications. If you plan on accessing your machine remotely via SSH over a firewalled interface, enable this option. You need the openssh-server package installed for this option to be useful.</description> <port protocol=\"tcp\" port=\"30000\"/> </service> Wait 5-10 seconds for the service file to be recognized and activate it (Same rule on permanent applies) # firewall-cmd --zone=public --add-service=my-ssh --permanent success That's it - more info on firewalld can be found using the dedicated webpage https://firewalld.org/documentation/","title":"Firewalld"},{"location":"manjaro/notes/thunar-custom-actions/","text":"Add Thunar custom actions As a maintainer I have made some custom actions for Thunar. What we will cover Write ISO to USB Open a terminal using the current folder Launching Thunar as administrator Edit configuration as admin using GUI How? All custom actions are defined using the Configure custom actions... dialog in Thunar. It is found in the Edit menu. All examples will follow the pattern Navigate the Edit menu Click Configure custom actions... Click + to add an action Configure the action Save the action Only the first example will detail the action of opening the Configure custom action dialog Write ISO to USB For ISO writing I have a preference for Mint stick. I am thinking it is because it does 2 two things and does it well. There is several benefits using Mint stick Mint stick only allows USB devices USB device formatting USB image writing Install mintstick package sudo pacman -Syu mintstick Open Thunar and navigate to Edit \u2192 Configure custom actions... Click the + add an action Name: Write to USB Description: Write selected ISO to USB Command: mintstick -m iso -i %f Select a nice icon by clicking the icon e.g. from the Device icons dropdown locate the media-flash-memory-stick icon. Click the Appearance Conditions tab File patter: *.iso Select only the Other Files option Shortcut: Click and press e.g. F7 Click OK and close the window. Test it by navigating to a folder containing an ISO. Then right click the ISO and select the new Write to USB option. Close Mint stick and test selected shortcut e.g. F7 . Open terminal here Opening a terminal in a folder is probably one of the most useful features of the file manager. You can use a named terminal or you can use the exo-open app to launch the system's terminal defined by Preferred applications . To be able to use this you need the package exo installed. You can check if it is installed using which exo-open . Click + in the custom actions dialog to configure a new action * Name: Open Terminal Here * Description: Open terminal in current folder How do we get it to open in the folder currently open in Thunar? At the bottom of the Basics tab is a list of parameters you can use when executing a command. In this case we want the current folder to be the location opened in the terminal. We look at the list and find the %d parameter %d directory containing the file that is passed in %f Another parameter is referenced %f and this is exactly what we need %f the path to the first selected file or directory So our command will be Command: exo-open --launch TerminalEmulator %d Next is shortcut * Keyboard Shortcut: F4 And icon * Select a suitable icon - a terminal Now move to the Appearance Conditions tab * File Pattern: * * Select only the Directories option Save the action by clicking OK Launch Thunar as root Click + in the custom actions dialog to configure a new action * Name: Open Thunar as ROOT * Description: Open Thunar as ROOT * Command: thunar admin:%d The admin: is a protocol which allows for tasks to be launched with administrative privileges. This is part of the gvfs package ( G nome V irtual F ile S ystem). We are again using the %d parameter to use the current folder for root actions. Keyboard Shortcut: Ctrl F8 And icon * Select a suitable icon - red folder as a consequence alert Now move to the Appearance Conditions tab * File Pattern: * * Select Directories , Text Files and Other Files option Save the action by clicking OK Edit config as root using GUI Click + in the custom actions dialog to configure a new action * Name: Edit file as ROOT * Description: Edit file as ROOT * Command: xed admin:%f The command should be an editor supporting the admin protocol. This is true for xed and gedit . We use the %f parameter to pass the full path of the selected file to the editor Keyboard Shortcut: None And icon * Select a suitable icon - something signifying the consequence of the action Now move to the Appearance Conditions tab * File Pattern: * * Select only the Text Files option Save the action by clicking OK What if ... The editor I want to use does not support the admin protocol? You can use pkexec and add some environment variables - e.g. if you want to launch geany the command could look like this pkexec env DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY geany %f This is a work around - and may change in the future - who knows ... Recreate on other systems Creating the actions from scratch is a tedious task - if you have many. The easy way is to copy this file to another system. ~/.config/Thunar/uca.xml Conclusion You have now learned how you create custom actions in Thunar. I hope you find the guide useful. You can find inspiration for custom actions in this thread https://archived.forum.manjaro.org/t/thunar-custom-actions-are-awesome-what-are-yours/100835?u=linux-aarhus","title":"Thunar custom actions"},{"location":"manjaro/notes/thunar-custom-actions/#add-thunar-custom-actions","text":"As a maintainer I have made some custom actions for Thunar.","title":"Add Thunar custom actions"},{"location":"manjaro/notes/thunar-custom-actions/#what-we-will-cover","text":"Write ISO to USB Open a terminal using the current folder Launching Thunar as administrator Edit configuration as admin using GUI","title":"What we will cover"},{"location":"manjaro/notes/thunar-custom-actions/#how","text":"All custom actions are defined using the Configure custom actions... dialog in Thunar. It is found in the Edit menu. All examples will follow the pattern Navigate the Edit menu Click Configure custom actions... Click + to add an action Configure the action Save the action Only the first example will detail the action of opening the Configure custom action dialog","title":"How?"},{"location":"manjaro/notes/thunar-custom-actions/#write-iso-to-usb","text":"For ISO writing I have a preference for Mint stick. I am thinking it is because it does 2 two things and does it well. There is several benefits using Mint stick Mint stick only allows USB devices USB device formatting USB image writing Install mintstick package sudo pacman -Syu mintstick Open Thunar and navigate to Edit \u2192 Configure custom actions... Click the + add an action Name: Write to USB Description: Write selected ISO to USB Command: mintstick -m iso -i %f Select a nice icon by clicking the icon e.g. from the Device icons dropdown locate the media-flash-memory-stick icon. Click the Appearance Conditions tab File patter: *.iso Select only the Other Files option Shortcut: Click and press e.g. F7 Click OK and close the window. Test it by navigating to a folder containing an ISO. Then right click the ISO and select the new Write to USB option. Close Mint stick and test selected shortcut e.g. F7 .","title":"Write ISO to USB"},{"location":"manjaro/notes/thunar-custom-actions/#open-terminal-here","text":"Opening a terminal in a folder is probably one of the most useful features of the file manager. You can use a named terminal or you can use the exo-open app to launch the system's terminal defined by Preferred applications . To be able to use this you need the package exo installed. You can check if it is installed using which exo-open . Click + in the custom actions dialog to configure a new action * Name: Open Terminal Here * Description: Open terminal in current folder How do we get it to open in the folder currently open in Thunar? At the bottom of the Basics tab is a list of parameters you can use when executing a command. In this case we want the current folder to be the location opened in the terminal. We look at the list and find the %d parameter %d directory containing the file that is passed in %f Another parameter is referenced %f and this is exactly what we need %f the path to the first selected file or directory So our command will be Command: exo-open --launch TerminalEmulator %d Next is shortcut * Keyboard Shortcut: F4 And icon * Select a suitable icon - a terminal Now move to the Appearance Conditions tab * File Pattern: * * Select only the Directories option Save the action by clicking OK","title":"Open terminal here"},{"location":"manjaro/notes/thunar-custom-actions/#launch-thunar-as-root","text":"Click + in the custom actions dialog to configure a new action * Name: Open Thunar as ROOT * Description: Open Thunar as ROOT * Command: thunar admin:%d The admin: is a protocol which allows for tasks to be launched with administrative privileges. This is part of the gvfs package ( G nome V irtual F ile S ystem). We are again using the %d parameter to use the current folder for root actions. Keyboard Shortcut: Ctrl F8 And icon * Select a suitable icon - red folder as a consequence alert Now move to the Appearance Conditions tab * File Pattern: * * Select Directories , Text Files and Other Files option Save the action by clicking OK","title":"Launch Thunar as root"},{"location":"manjaro/notes/thunar-custom-actions/#edit-config-as-root-using-gui","text":"Click + in the custom actions dialog to configure a new action * Name: Edit file as ROOT * Description: Edit file as ROOT * Command: xed admin:%f The command should be an editor supporting the admin protocol. This is true for xed and gedit . We use the %f parameter to pass the full path of the selected file to the editor Keyboard Shortcut: None And icon * Select a suitable icon - something signifying the consequence of the action Now move to the Appearance Conditions tab * File Pattern: * * Select only the Text Files option Save the action by clicking OK","title":"Edit config as root using GUI"},{"location":"manjaro/notes/thunar-custom-actions/#what-if","text":"The editor I want to use does not support the admin protocol? You can use pkexec and add some environment variables - e.g. if you want to launch geany the command could look like this pkexec env DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY geany %f This is a work around - and may change in the future - who knows ...","title":"What if ..."},{"location":"manjaro/notes/thunar-custom-actions/#recreate-on-other-systems","text":"Creating the actions from scratch is a tedious task - if you have many. The easy way is to copy this file to another system. ~/.config/Thunar/uca.xml","title":"Recreate on other systems"},{"location":"manjaro/notes/thunar-custom-actions/#conclusion","text":"You have now learned how you create custom actions in Thunar. I hope you find the guide useful. You can find inspiration for custom actions in this thread https://archived.forum.manjaro.org/t/thunar-custom-actions-are-awesome-what-are-yours/100835?u=linux-aarhus","title":"Conclusion"},{"location":"manjaro/pine64/pinebook-pro-network-wifi-privacy-cycle/","text":"All credit - @DrYak at https://forum.pine64.org/showthread.php?tid=8313&pid=52645#pid52645 update 2020.06.16: some recent kernel update has changed the naming of the wifi device - now fe310000.mmc. For those who like a compact one-liner: sudo tee /sys/bus/platform/drivers/dwmmc_rockchip/{un,}bind <<< \"$(basename /sys/devices/platform/fe310*)\" TL;DR: use the two commands here to restart the Wifi driver after powering the Wifi again with the Privacy Switch for Wifi (Pine + F11) : $ echo 'fe310000.dwmmc' | sudo tee /sys/bus/platform/drivers/dwmmc_rockchip/unbind $ echo 'fe310000.dwmmc' | sudo tee /sys/bus/platform/drivers/dwmmc_rockchip/bind The full story : (Moving to a more general thread, because currently my reply is burried in the middle of the Manjaro discussion) Currently, the privacy switch for Wifi cannot put back Wifi on because soldered-on-motherboard SDIO modules aren't Plug'n'Play. Here's what you normally see if you try the usual rmmod + modprobe route: $ sudo rmmod brcmfmac brcmutil cfg80211 $ modprobe brcmfmac $ dmesg [ 1299.511038] usbcore: deregistering interface driver brcmfmac [ 1313.114017] platform regulatory.0: Direct firmware load for regulatory.db failed with error -2 [ 1313.114781] cfg80211: failed to load regulatory.db [ 1313.132537] brcmfmac: probe of mmc0:0001:1 failed with error -110 [ 1313.133192] brcmfmac: probe of mmc0:0001:2 failed with error -110 [ 1313.133865] usbcore: registered new interface driver brcmfmac There is a way though: You can find the actual soldered device that answers on the mmcn mentioned above and unbind and re-bind it. $ l`s -d /sys/devices/platform/*.dwmmc/mmc_host/mmc0 /sys/devices/platform/fe310000.dwmmc/mmc_host/mmc0 $ ls -d /sys/devices/platform/*.dwmmc/mmc_host/mmc*/mmc*/mmc*/ieee80211 /sys/devices/platform/fe310000.dwmmc/mmc_host/mmc0/mmc0:0001/mmc0:0001:2/ieee80211 $ echo 'fe310000.dwmmc' | sudo tee /sys/bus/platform/drivers/dwmmc_rockchip/unbind $ echo 'fe310000.dwmmc' | sudo tee /sys/bus/platform/drivers/dwmmc_rockchip/bind $ dmesg [ 1845.593897] mmc0: card 0001 removed [ 1849.712047] dwmmc_rockchip fe310000.dwmmc: IDMAC supports 32-bit address mode. [ 1849.712707] dwmmc_rockchip fe310000.dwmmc: Using internal DMA controller. [ 1849.713307] dwmmc_rockchip fe310000.dwmmc: Version ID is 270a [ 1849.713840] dwmmc_rockchip fe310000.dwmmc: DW MMC controller at irq 27,32 bit host data width,256 deep fifo [ 1849.714799] dwmmc_rockchip fe310000.dwmmc: allocated mmc-pwrseq [ 1849.715321] mmc_host mmc0: card is non-removable. [ 1849.728861] mmc_host mmc0: Bus speed (slot 0) = 400000Hz (slot req 400000Hz, actual 400000HZ div = 0) [ 1849.777673] mmc_host mmc0: Bus speed (slot 0) = 148500000Hz (slot req 150000000Hz, actual 148500000HZ div = 0) [ 1850.622467] dwmmc_rockchip fe310000.dwmmc: Successfully tuned phase to 47 [ 1850.627007] mmc0: new ultra high speed SDR104 SDIO card at address 0001 [ 1850.636215] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43456-sdio for chip BCM4345/9 [ 1852.731997] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43456-sdio for chip BCM4345/9 [ 1852.732808] brcmfmac: brcmf_c_process_clm_blob: no clm_blob available (err=-2), device may have limited channels available [ 1852.734049] brcmfmac: brcmf_c_preinit_dcmds: Firmware: BCM4345/9 wl0: Sep 7 2018 14:33:37 version 7.45.96.27 (42b546f@shgit) (r) FWID 01-c958c084 es7.c5.n4.a3 [ 1860.053215] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready Note if I'm not mistaken : the 'mmc0' numbering might change depending on how your OS enumerate its devices (see how /dev/mmcblk changes - on Manjaro the Wifi is on mmc0 and the internal eMMC is on mmc2, but on the factory shipped Debian - Wifi is on mmc2 and mmc0 has the external \u00b5SD) but fe310000.dwmmc is how this soldered MMC interface is mapped to the Rockchip and is fixed accross OSes (it is set in the .dtb) the bind + unbind trick can also be used if the Broadcom Wifi chip has gone crazy and needs restarting. (source: other people with similar problems of soldered MMC modules)","title":"Pinebook Pro Network Wifi Privacy Cycle"},{"location":"manjaro/pine64/pinephone-community-edition/","text":"Stability The pinephone hardware itself is tried and tested hardware - rock solid. The images is WIP and you should never expect it to work flawless. Don't complain but use the relevant bugtracker or forum threads to ask for help and be specific on how to reproduce the issue. The convergence unit is an invaluable tool as it makes it possible to attach external keyboard and thus making terminal usage much - much easier. Remember - the pinephone is an ARM based computer - and the terminal behaviour is comparable to your desktop system. pacman and pacman-mirrors works as you are used to. Be cautious The nano-to-micro sim adapter in the package is not a superfluous accessory. The sim reader is for micro sim - so if you have a nano sim - you will need it. The sim reader is the lower of the two slot - the upper slot is SD-card reader. The pictograms showing sim/sd-card can be misunderstood - this will short you sim and cause irreparable damage to it. Because the nano sim is smaller than an SD card you will most likely bend the third leg in the reader - with a high probability of causing damage to the PCB and subsequently your SD-card. So be sure to insert the cards in their appropriate slots. lower slot is micro sim slot upper slot is SD-card slot So by now you will all know - I melted my sim and learned to take apart the pinephone and replace the pcb with a new undamaged counterpart. Pinephone boot order Pinephone boots from USB or SD if present - otherwise the eMMC. Due to the high number of writes rumors are SD-cards don't last very long. Note: While the device won't boot using grub - an USB with a boot loader seems to halt the system start. Remove the USB from the convergence unit and restart the device. The benefit of the device boot order is obvious - you can try out other images without actually flashing your phone - but don't expect your SD-card to last for ever. Testing images Download the xz compressed image to your computer (links below) and unpack the image ~/Downloads $ ls Manjaro-ARM-plasma-mobile-dev-pinephone-201124.img.xz ~/Downloads $ unxz Manjaro-ARM-plasma-mobile-dev-pinephone-201124.img.xz ~/Downloads $ ls Manjaro-ARM-plasma-mobile-dev-pinephone-201124.img Then use your favorite image writing tool - mine is mintstick - to write the image to the SD-card. You can also use dd but you must ensure all data is written before removing the card from your computer. Ensure you get the $IMAGE and $DEVICE right - replace with actual values from your use-case/system. sudo dd if=$IMAGE of=$DEVICE status=progress bs=4k conv=noerror,fdatasync oflag=dsync 5091217408 bytes (5,1 GB, 4,7 GiB) copied, 1755 s, 2,9 MB/s 1243648+0 records in 1243648+0 records out 5093982208 bytes (5,1 GB, 4,7 GiB) copied, 1757,43 s, 2,9 MB/s When the flashing is done and you have synced/ejected the card - remove back cover and battery. Insert the SD-card in the upper slot - attach the battery and press the power button to load the system from SD-card. Using jumpdrive jumpdrive is a special image designed to expose the unit's storage devices. Read more at Pine64 wiki by following this link . Download is found following this link . When you connect your jumpdriven device it will create a new route on your system and this may change your network routes - resulting in no internet connection. Unless you need to use a telnet shell on the device you can safely remove the route - it is not needed for flashing the device. To restore your network connection - remove the route using the ip utility $ sudo ip route del 172.16.42.0/24 Pinephone data rescue If an update seemingly bricked your device you can use jumpdrive to rescue data. Load the jumpdrive and connect to your computer. Then use your file manager to navigate the jumpdrive and copy the desired data onto your computer. Then flash a new image and you are good to go. Unstable mountpoints If you are getting frequent mount/unmount of the device - check your connection points - especially when using the convergence device. Flashing your pinephone Flashing from an SD-card is prone to failure. The less error prone method is using the jumpdrive. System used for this excercise is a cheap yepo laptop [fh@a116h ~]$ inxi -Sxxx System: Host: a116h Kernel: 5.9.11-2-MANJARO x86_64 bits: 64 compiler: gcc v: 10.2.0 Desktop: Xfce 4.14.3 tk: Gtk 3.24.23 info: xfce4-panel wm: xfwm4 dm: LightDM 1.30.0 Distro: Manjaro Linux I have no idea if it was/is my sd-card(s) or a limitation of the jumpdrive but I was only able to make it work using a smaller SD-card than the 8GB cards used to test images. So if you cannot get jumpdrive to work - use a small card - 64MB is enough - I got a 2GB card to work. Remove the back cover and the battery and insert the jumpdrive in the upper slot. Attach the battery - and power on the phone - it will almost immediately display the jumpdrive running image. [details=\"DETAILS jumpdrive screen ...\"] [/details] Attach your device to your computer using the red cable. After a few seconds your system will display two new block devices - it could look like this [details=\"DETAILS jumpdrive devices ...\"] [/details] and you can verify using the terminal $ lsblk -o NAME,SIZE,FSTYPE,VENDOR,MODEL NAME SIZE FSTYPE VENDOR MODEL sda 238,5G ATA BORY_R500_256G \u251c\u2500sda1 100M vfat \u2514\u2500sda2 16G ext4 sdb 29,1G JumpDriv e_eMMC \u251c\u2500sdb1 213,6M vfat \u2514\u2500sdb2 28,9G ext4 sdc 1,8G JumpDriv e_microSD \u2514\u2500sdc1 49M vfat In the example sdb is the eMMC of the device and sdc is the jumpdrive. Use dd - ensure your get the $IMAGE and $JUMPDRIVE right sudo dd if=$IMAGE of=$JUMPDRIVE status=progress bs=4k conv=noerror,fdatasync oflag=dsync 5089054720 bytes (5,1 GB, 4,7 GiB) copied, 1113 s, 4,6 MB/s 1243648+0 records in 1243648+0 records out 5093982208 bytes (5,1 GB, 4,7 GiB) copied, 1115,44 s, 4,6 MB/s Or use your image writer application select the unpacked image and write it to the jumpdrive eMMC as shown below. [details=\"DETAILS mintstick flashing jumpdrive ...\"] [/details] When flashing is done - ensure the data is synced - use the eject button of the file manager. [details=\"DETAILS mintstick flashing done ...\"] [/details] Remove the cable, battery and jumpdrive. Attach battery, power the device and load the flashed system - the operation effectively resets your phone's eMMC - no settings survive. Dowload locations ~~ osdn - manjaro-arm ~~ ~~ manjaro pinephone plasma nightlies ~~ pine64 - jumpdrive wiki jumpdrive - download Updating your pinephone device You will get notifications - almost daily - with updates. You can of course use the notification to install the updates - but it does not always work that great. On your desktop using Manjaro - you sometimes have to decide whether to replace or remove a package during update - and the automated installer cannot make those decisions. I have found that updating the phone using the terminal is better. Setup your preferred mirror using pacman-mirrors and update using pacman e.g. sudo pacman-mirrors --continent && sudo pacman -Syyu Convergence unit This is a great tool - not only for pinephone but also other devices. I am making use of it connection the device to my LAN using cable, charging and using a wireless Logitec K400 keyboard. My initial results connection external monitor didn't work well with Plasma Mobile - I will have to see how it works with Phosh. Old possibly obsolete thoughts This topic was created November 2020 - please take this into consideration when reading below. Phosh vs. Plasma mobile vs. Lomiri My personal opinion is to keep my phone simple - I don't use if for social network, mail or anything other than as a phone. I occationally use the browser but that's all. So with that in mind - if the basic functionality phone calls in and out and sms works - my needs are satisfied. The Manjaro Pinephone comes with Phosh beta 1. If you are in the queue or recently received your pinephone - don't experiment with getting it up and running using Phosh beta1 - jump right to flashing the phone with the latest beta4. I started my adventure by flashing Plasma and I think KDE is really great with the Mobile version. I don't get along very well with KDE so I turned to Lomiri which is based on UBports which is a fork of Ubuntu Touch - with the thought that I have had hands on an Ubuntu Phone some years ago - and it is decent - device rotation functions very well and functionality is OK. I then turned to Phosh - which the system was initially loaded with - flashed it and it works very well. It has a familiar touch - look and feel - and it just keeps getting better - the latest swipe to close apps - really nice. Plasma Mobile Currently the Plasma Mobile image has a small peculiarity - but I found a comment elsewhere describing how to fix it - thank you @jjdekroon. When you switch on the mobile broadband - the DNS resolver is not set accordingly. I guess it has something to do with how the OS prioritize network - I mean there is no need to use the mobile broadband DNS while connected to WiFi - it would create unnecessary traffic. Enter the following command in the terminal after disabling WiFi [quote=\"jjdekroon, post:2, topic:56001\"] sudo ofonoctl wan --connect --append-dns [/quote] It will switch back once you re-enable wifi PinePhone Tips and Tricks Experience and lessons learned","title":"Pine Phone Community Edition"},{"location":"manjaro/pine64/pinephone-community-edition/#stability","text":"The pinephone hardware itself is tried and tested hardware - rock solid. The images is WIP and you should never expect it to work flawless. Don't complain but use the relevant bugtracker or forum threads to ask for help and be specific on how to reproduce the issue. The convergence unit is an invaluable tool as it makes it possible to attach external keyboard and thus making terminal usage much - much easier. Remember - the pinephone is an ARM based computer - and the terminal behaviour is comparable to your desktop system. pacman and pacman-mirrors works as you are used to.","title":"Stability"},{"location":"manjaro/pine64/pinephone-community-edition/#be-cautious","text":"The nano-to-micro sim adapter in the package is not a superfluous accessory. The sim reader is for micro sim - so if you have a nano sim - you will need it. The sim reader is the lower of the two slot - the upper slot is SD-card reader. The pictograms showing sim/sd-card can be misunderstood - this will short you sim and cause irreparable damage to it. Because the nano sim is smaller than an SD card you will most likely bend the third leg in the reader - with a high probability of causing damage to the PCB and subsequently your SD-card. So be sure to insert the cards in their appropriate slots. lower slot is micro sim slot upper slot is SD-card slot So by now you will all know - I melted my sim and learned to take apart the pinephone and replace the pcb with a new undamaged counterpart.","title":"Be cautious"},{"location":"manjaro/pine64/pinephone-community-edition/#pinephone-boot-order","text":"Pinephone boots from USB or SD if present - otherwise the eMMC. Due to the high number of writes rumors are SD-cards don't last very long. Note: While the device won't boot using grub - an USB with a boot loader seems to halt the system start. Remove the USB from the convergence unit and restart the device. The benefit of the device boot order is obvious - you can try out other images without actually flashing your phone - but don't expect your SD-card to last for ever.","title":"Pinephone boot order"},{"location":"manjaro/pine64/pinephone-community-edition/#testing-images","text":"Download the xz compressed image to your computer (links below) and unpack the image ~/Downloads $ ls Manjaro-ARM-plasma-mobile-dev-pinephone-201124.img.xz ~/Downloads $ unxz Manjaro-ARM-plasma-mobile-dev-pinephone-201124.img.xz ~/Downloads $ ls Manjaro-ARM-plasma-mobile-dev-pinephone-201124.img Then use your favorite image writing tool - mine is mintstick - to write the image to the SD-card. You can also use dd but you must ensure all data is written before removing the card from your computer. Ensure you get the $IMAGE and $DEVICE right - replace with actual values from your use-case/system. sudo dd if=$IMAGE of=$DEVICE status=progress bs=4k conv=noerror,fdatasync oflag=dsync 5091217408 bytes (5,1 GB, 4,7 GiB) copied, 1755 s, 2,9 MB/s 1243648+0 records in 1243648+0 records out 5093982208 bytes (5,1 GB, 4,7 GiB) copied, 1757,43 s, 2,9 MB/s When the flashing is done and you have synced/ejected the card - remove back cover and battery. Insert the SD-card in the upper slot - attach the battery and press the power button to load the system from SD-card.","title":"Testing images"},{"location":"manjaro/pine64/pinephone-community-edition/#using-jumpdrive","text":"jumpdrive is a special image designed to expose the unit's storage devices. Read more at Pine64 wiki by following this link . Download is found following this link . When you connect your jumpdriven device it will create a new route on your system and this may change your network routes - resulting in no internet connection. Unless you need to use a telnet shell on the device you can safely remove the route - it is not needed for flashing the device. To restore your network connection - remove the route using the ip utility $ sudo ip route del 172.16.42.0/24","title":"Using jumpdrive"},{"location":"manjaro/pine64/pinephone-community-edition/#pinephone-data-rescue","text":"If an update seemingly bricked your device you can use jumpdrive to rescue data. Load the jumpdrive and connect to your computer. Then use your file manager to navigate the jumpdrive and copy the desired data onto your computer. Then flash a new image and you are good to go.","title":"Pinephone data rescue"},{"location":"manjaro/pine64/pinephone-community-edition/#unstable-mountpoints","text":"If you are getting frequent mount/unmount of the device - check your connection points - especially when using the convergence device.","title":"Unstable mountpoints"},{"location":"manjaro/pine64/pinephone-community-edition/#flashing-your-pinephone","text":"Flashing from an SD-card is prone to failure. The less error prone method is using the jumpdrive. System used for this excercise is a cheap yepo laptop [fh@a116h ~]$ inxi -Sxxx System: Host: a116h Kernel: 5.9.11-2-MANJARO x86_64 bits: 64 compiler: gcc v: 10.2.0 Desktop: Xfce 4.14.3 tk: Gtk 3.24.23 info: xfce4-panel wm: xfwm4 dm: LightDM 1.30.0 Distro: Manjaro Linux I have no idea if it was/is my sd-card(s) or a limitation of the jumpdrive but I was only able to make it work using a smaller SD-card than the 8GB cards used to test images. So if you cannot get jumpdrive to work - use a small card - 64MB is enough - I got a 2GB card to work. Remove the back cover and the battery and insert the jumpdrive in the upper slot. Attach the battery - and power on the phone - it will almost immediately display the jumpdrive running image. [details=\"DETAILS jumpdrive screen ...\"] [/details] Attach your device to your computer using the red cable. After a few seconds your system will display two new block devices - it could look like this [details=\"DETAILS jumpdrive devices ...\"] [/details] and you can verify using the terminal $ lsblk -o NAME,SIZE,FSTYPE,VENDOR,MODEL NAME SIZE FSTYPE VENDOR MODEL sda 238,5G ATA BORY_R500_256G \u251c\u2500sda1 100M vfat \u2514\u2500sda2 16G ext4 sdb 29,1G JumpDriv e_eMMC \u251c\u2500sdb1 213,6M vfat \u2514\u2500sdb2 28,9G ext4 sdc 1,8G JumpDriv e_microSD \u2514\u2500sdc1 49M vfat In the example sdb is the eMMC of the device and sdc is the jumpdrive. Use dd - ensure your get the $IMAGE and $JUMPDRIVE right sudo dd if=$IMAGE of=$JUMPDRIVE status=progress bs=4k conv=noerror,fdatasync oflag=dsync 5089054720 bytes (5,1 GB, 4,7 GiB) copied, 1113 s, 4,6 MB/s 1243648+0 records in 1243648+0 records out 5093982208 bytes (5,1 GB, 4,7 GiB) copied, 1115,44 s, 4,6 MB/s Or use your image writer application select the unpacked image and write it to the jumpdrive eMMC as shown below. [details=\"DETAILS mintstick flashing jumpdrive ...\"] [/details] When flashing is done - ensure the data is synced - use the eject button of the file manager. [details=\"DETAILS mintstick flashing done ...\"] [/details] Remove the cable, battery and jumpdrive. Attach battery, power the device and load the flashed system - the operation effectively resets your phone's eMMC - no settings survive.","title":"Flashing your pinephone"},{"location":"manjaro/pine64/pinephone-community-edition/#dowload-locations","text":"~~ osdn - manjaro-arm ~~ ~~ manjaro pinephone plasma nightlies ~~ pine64 - jumpdrive wiki jumpdrive - download","title":"Dowload locations"},{"location":"manjaro/pine64/pinephone-community-edition/#updating-your-pinephone-device","text":"You will get notifications - almost daily - with updates. You can of course use the notification to install the updates - but it does not always work that great. On your desktop using Manjaro - you sometimes have to decide whether to replace or remove a package during update - and the automated installer cannot make those decisions. I have found that updating the phone using the terminal is better. Setup your preferred mirror using pacman-mirrors and update using pacman e.g. sudo pacman-mirrors --continent && sudo pacman -Syyu","title":"Updating your pinephone device"},{"location":"manjaro/pine64/pinephone-community-edition/#convergence-unit","text":"This is a great tool - not only for pinephone but also other devices. I am making use of it connection the device to my LAN using cable, charging and using a wireless Logitec K400 keyboard. My initial results connection external monitor didn't work well with Plasma Mobile - I will have to see how it works with Phosh.","title":"Convergence unit"},{"location":"manjaro/pine64/pinephone-community-edition/#old-possibly-obsolete-thoughts","text":"This topic was created November 2020 - please take this into consideration when reading below.","title":"Old possibly obsolete thoughts"},{"location":"manjaro/pine64/pinephone-community-edition/#phosh-vs-plasma-mobile-vs-lomiri","text":"My personal opinion is to keep my phone simple - I don't use if for social network, mail or anything other than as a phone. I occationally use the browser but that's all. So with that in mind - if the basic functionality phone calls in and out and sms works - my needs are satisfied. The Manjaro Pinephone comes with Phosh beta 1. If you are in the queue or recently received your pinephone - don't experiment with getting it up and running using Phosh beta1 - jump right to flashing the phone with the latest beta4. I started my adventure by flashing Plasma and I think KDE is really great with the Mobile version. I don't get along very well with KDE so I turned to Lomiri which is based on UBports which is a fork of Ubuntu Touch - with the thought that I have had hands on an Ubuntu Phone some years ago - and it is decent - device rotation functions very well and functionality is OK. I then turned to Phosh - which the system was initially loaded with - flashed it and it works very well. It has a familiar touch - look and feel - and it just keeps getting better - the latest swipe to close apps - really nice.","title":"Phosh vs. Plasma mobile vs. Lomiri"},{"location":"manjaro/pine64/pinephone-community-edition/#plasma-mobile","text":"Currently the Plasma Mobile image has a small peculiarity - but I found a comment elsewhere describing how to fix it - thank you @jjdekroon. When you switch on the mobile broadband - the DNS resolver is not set accordingly. I guess it has something to do with how the OS prioritize network - I mean there is no need to use the mobile broadband DNS while connected to WiFi - it would create unnecessary traffic. Enter the following command in the terminal after disabling WiFi [quote=\"jjdekroon, post:2, topic:56001\"] sudo ofonoctl wan --connect --append-dns [/quote] It will switch back once you re-enable wifi PinePhone Tips and Tricks Experience and lessons learned","title":"Plasma Mobile"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/","text":"Difficulty: \u2605\u2605\u2606\u2606\u2606 NextCloud is an open-source collaboration tool which can be selfhosted. Prerequisites For this you need a server device - e.g. Raspberry Pi 4B using WiFi https://forum.manjaro.org/search?q=raspberry%20pi%20wifi This document was written using a Raspberry PI 4B 4GB using a 16GB microSD. To install NextCloud you need to prepare the following components. Apache or Nginx PHP Sqlite or MariaDB The most widely used setup is called LAMP and is an acronym for L inux, A packe, M ariaDB/MYSQL, P HP/Perl/Python. Refer to the following document to setup your LAMP stack and return here when ready as this document assumes you have the phpMyAdmin webapp available on the system. https://forum.manjaro.org/t/howto-install-apache-mariadb-mysql-php-lamp/13000 Important Always ensure your system is up-to-date before adding new packages sudo pacman -Syu NextCloud requires any one of these locales to be enabled and generated en_US.UTF-8 fr_FR.UTF-8 es_ES.UTF-8 de_DE.UTF-8 ru_RU.UTF-8 pt_BR.UTF-8 it_IT.UTF-8 ja_JP.UTF-8 zh_CN.UTF-8 Ensure you have at least en_US.UTF-8 locale enabled and generated. echo en_US.UTF-8 | sudo tee -a /etc/locale.gen Generate locale sudo locale-gen Installing NextCloud This document will focus on the Web installer provided as a NextCloud community project nonetheless you have the option to use the nextcloud package from the repo along with the extensive documentation at https://wiki.archlinux.org/title/Nextcloud NextCloud Web installer The Web installer https://download.nextcloud.com/server/installer/setup-nextcloud.php is a php script you download and place in the root of the web service. If you followed the LAMP stack your http root lives at /srv/http . Open a terminal and navigate to the http root folder cd /srv/http Use curl to fetch the script sudo curl -O https://download.nextcloud.com/server/installer/setup-nextcloud.php Best practice is to go over the content and ensure it is legit less setup-nextcloud.php Setup Wiard Before you continue the setup process - install required php packages. sudo pacman -S php-gd php-imagick php-intl Depending on your actual requirements and the NextCloud features you want to make use of you will need to install other packages. A reference list can be viewed by visiting the Arch Community Repo package https://archlinux.org/packages/community/any/nextcloud/ The NextCloud developers recommend the use of MariaDB/MYSQL - but you can use sqlite for test and development. If you choose to use sqlite - you will need the php-sqlite package as well sudo pacman -Syu php-sqlite When you have installed the packages edit your system's php.ini sudo micro /etc/php/php.ini Search and locate extension=bcmath or scroll down to the extensions list and enable [...] extension=bcmath extension=bz2 extension=exif extension=gd extension=iconv extension=imagick extension=intl extension=pdo_mysql extension=pdo_sqlite Search and locate memory_limit [...] memory_limit = 512M [...] Search and locate date.timezone , uncomment and set it to your timezone e.g. date.timezone = Europe/Copenhagen Save the file and close it then restart your http service sudo systemctl restart httpd Ensure the http user is set as owner of the /srv/http folder and content. sudo chown http:http /srv/http -R Load the installer in your browser by navigating to your server's ip or name http://172.30.30.128/setup-nextcloud.php When you click the Next button dependencies are verified and if they are found click Next to install in a subfolder named nextcloud . Replace nextcloud with a . if you want NextCloud in the root of the webserver. Be patient - after a while you will be greeted with a Success message - click Next . Setting up database This document is only intended to wet your feet wet so SQLite is just fine but for production you should use MariaDB. For productdion use you should refer to the NextCloud documentation To create a database for your nextcloud app we will use phpMyAdmin. Navigate your browser to the web server's phpmyadmin url http://ip.x.y.z/phpmyadmin Login using your mariadb root user and the password created earlier. Click the User accounts tab, then Add user account Click the button next Generate password labelled Generate Copy the password from the textbox and paste it somewhere convenient Tick the box next to Create database with same name and grant all privileges Scroll to the bottom and click Go Go back to the NextCloud database setup page Fill in your desired administrative username Create a strong password Click the Storage & Database dropdown and select MySQL/MariaDB Fill in database user nextcloud Fill in database passwd - copy/paste the passwd created above Fill in the database name nextcloud Don't change the host Click Install - have patience The script may redirect you to a non-existing page on nextcloud.com - ignore that Navigate to your own nextcloud address http://ip.x.y.z/nextcloud You are almost done The rest is up to you - please remember to ensure your MariaDB engine is configured as recommended at NextCloud documetnation Crossposted at Manjaro Forum","title":"Install NextCloud on Raspberry Pi"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/#prerequisites","text":"For this you need a server device - e.g. Raspberry Pi 4B using WiFi https://forum.manjaro.org/search?q=raspberry%20pi%20wifi This document was written using a Raspberry PI 4B 4GB using a 16GB microSD. To install NextCloud you need to prepare the following components. Apache or Nginx PHP Sqlite or MariaDB The most widely used setup is called LAMP and is an acronym for L inux, A packe, M ariaDB/MYSQL, P HP/Perl/Python. Refer to the following document to setup your LAMP stack and return here when ready as this document assumes you have the phpMyAdmin webapp available on the system. https://forum.manjaro.org/t/howto-install-apache-mariadb-mysql-php-lamp/13000","title":"Prerequisites"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/#important","text":"Always ensure your system is up-to-date before adding new packages sudo pacman -Syu NextCloud requires any one of these locales to be enabled and generated en_US.UTF-8 fr_FR.UTF-8 es_ES.UTF-8 de_DE.UTF-8 ru_RU.UTF-8 pt_BR.UTF-8 it_IT.UTF-8 ja_JP.UTF-8 zh_CN.UTF-8 Ensure you have at least en_US.UTF-8 locale enabled and generated. echo en_US.UTF-8 | sudo tee -a /etc/locale.gen Generate locale sudo locale-gen","title":"Important"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/#installing-nextcloud","text":"This document will focus on the Web installer provided as a NextCloud community project nonetheless you have the option to use the nextcloud package from the repo along with the extensive documentation at https://wiki.archlinux.org/title/Nextcloud","title":"Installing NextCloud"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/#nextcloud-web-installer","text":"The Web installer https://download.nextcloud.com/server/installer/setup-nextcloud.php is a php script you download and place in the root of the web service. If you followed the LAMP stack your http root lives at /srv/http . Open a terminal and navigate to the http root folder cd /srv/http Use curl to fetch the script sudo curl -O https://download.nextcloud.com/server/installer/setup-nextcloud.php Best practice is to go over the content and ensure it is legit less setup-nextcloud.php","title":"NextCloud Web installer"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/#setup-wiard","text":"Before you continue the setup process - install required php packages. sudo pacman -S php-gd php-imagick php-intl Depending on your actual requirements and the NextCloud features you want to make use of you will need to install other packages. A reference list can be viewed by visiting the Arch Community Repo package https://archlinux.org/packages/community/any/nextcloud/ The NextCloud developers recommend the use of MariaDB/MYSQL - but you can use sqlite for test and development. If you choose to use sqlite - you will need the php-sqlite package as well sudo pacman -Syu php-sqlite When you have installed the packages edit your system's php.ini sudo micro /etc/php/php.ini Search and locate extension=bcmath or scroll down to the extensions list and enable [...] extension=bcmath extension=bz2 extension=exif extension=gd extension=iconv extension=imagick extension=intl extension=pdo_mysql extension=pdo_sqlite Search and locate memory_limit [...] memory_limit = 512M [...] Search and locate date.timezone , uncomment and set it to your timezone e.g. date.timezone = Europe/Copenhagen Save the file and close it then restart your http service sudo systemctl restart httpd Ensure the http user is set as owner of the /srv/http folder and content. sudo chown http:http /srv/http -R Load the installer in your browser by navigating to your server's ip or name http://172.30.30.128/setup-nextcloud.php When you click the Next button dependencies are verified and if they are found click Next to install in a subfolder named nextcloud . Replace nextcloud with a . if you want NextCloud in the root of the webserver. Be patient - after a while you will be greeted with a Success message - click Next .","title":"Setup Wiard"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/#setting-up-database","text":"This document is only intended to wet your feet wet so SQLite is just fine but for production you should use MariaDB. For productdion use you should refer to the NextCloud documentation To create a database for your nextcloud app we will use phpMyAdmin. Navigate your browser to the web server's phpmyadmin url http://ip.x.y.z/phpmyadmin Login using your mariadb root user and the password created earlier. Click the User accounts tab, then Add user account Click the button next Generate password labelled Generate Copy the password from the textbox and paste it somewhere convenient Tick the box next to Create database with same name and grant all privileges Scroll to the bottom and click Go Go back to the NextCloud database setup page Fill in your desired administrative username Create a strong password Click the Storage & Database dropdown and select MySQL/MariaDB Fill in database user nextcloud Fill in database passwd - copy/paste the passwd created above Fill in the database name nextcloud Don't change the host Click Install - have patience The script may redirect you to a non-existing page on nextcloud.com - ignore that Navigate to your own nextcloud address http://ip.x.y.z/nextcloud","title":"Setting up database"},{"location":"manjaro/raspberry-pi/raspberry-pi-install-nextcloud/#you-are-almost-done","text":"The rest is up to you - please remember to ensure your MariaDB engine is configured as recommended at NextCloud documetnation Crossposted at Manjaro Forum","title":"You are almost done"},{"location":"manjaro/raspberry-pi/raspberry-pi-notes/","text":"Notes Raspberry Pi 3B LED # Turn off Power LED dtparam=pwr_led_trigger=none dtparam=pwr_led_activelow=off # Turn off Activity LED dtparam=act_led_trigger=none dtparam=act_led_activelow=off # Turn off Ethernet ACT LED dtparam=eth_led0=14 # Turn off Ethernet LNK LED dtparam=eth_led1=14 Raspberry Pi 4B LED # Turn off Power LED dtparam=pwr_led_trigger=none dtparam=pwr_led_activelow=off # Turn off Activity LED dtparam=act_led_trigger=none dtparam=act_led_activelow=off # Turn off Ethernet ACT LED dtparam=eth_led0=4 # Turn off Ethernet LNK LED dtparam=eth_led1=4","title":"Raspberry Pi notes"},{"location":"manjaro/raspberry-pi/raspberry-pi-notes/#notes","text":"","title":"Notes"},{"location":"manjaro/raspberry-pi/raspberry-pi-notes/#raspberry-pi-3b-led","text":"# Turn off Power LED dtparam=pwr_led_trigger=none dtparam=pwr_led_activelow=off # Turn off Activity LED dtparam=act_led_trigger=none dtparam=act_led_activelow=off # Turn off Ethernet ACT LED dtparam=eth_led0=14 # Turn off Ethernet LNK LED dtparam=eth_led1=14","title":"Raspberry Pi 3B LED"},{"location":"manjaro/raspberry-pi/raspberry-pi-notes/#raspberry-pi-4b-led","text":"# Turn off Power LED dtparam=pwr_led_trigger=none dtparam=pwr_led_activelow=off # Turn off Activity LED dtparam=act_led_trigger=none dtparam=act_led_activelow=off # Turn off Ethernet ACT LED dtparam=eth_led0=4 # Turn off Ethernet LNK LED dtparam=eth_led1=4","title":"Raspberry Pi 4B LED"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/","text":"Share your Pi NextCloud When you have setup a NextCloud instance on your Pi - next step is sharing it with your family and friends. This topic is not on installing Pi or NextCloud or the internal configuration but the steps to take to share it using a public domain name. This topic stems from the Self hosted cloud service topic and I thought - maybe a little write-up on the steps to share an instance using a domain-name. Sure - you can do this using the public IP address of your internet connection - but several questions rise How many of your family and friends can remember your IP? And what if it changes? What is the bare minimal I need to do? What do I need to know? What must I prepare for? Registration This is where you need a registrar. A registrar is an entity supplying usage rights for internet domain names - e.g. pacbang-linux.org or nix.dk . One thing to remember - you don't buy a domain name - you buy the right to use it for period - usually a year - and the fee is paid up-front. If - subsequently - you don't pay - you loose that usage right. Many registrars allow for for multiple years upfront - some times at a discounted rate. Important There is three contact levels for a given domain - ensure you are the owner contact - because this is where some shady resellers cheat - especially when you request who-is privacy. There is a lot of registrars and not all are equally easy to work with - sometimes you only realize it when you want to transfer your domain to another registrar and the pain begins. The owner contact The pay-the-bills contact The technical contact I know - there is a lot of registrars - so you may know some I don't or you may prefer one over mine - so this is to discuss why one registrar should be chosen over another, good vs. bad etc. - the registrar I have chosen is a well-known registrar with decades of spotless operation. Joker registrar Joker is a swiss based registrar with the privacy and security Switzerland is known for. As I am former self-employed IT consultant working with nearly every aspect of IT operation, hosting, DNS, maintenance and domain reseller - joker.com has by been among the best registrars to work with (I still have reseller account - albeit not using it anymore). Joker's service portfolio has grown over the years - including both a free who-is privacy and an extended privacy at a nominal cost - and besides the yearly domain fee - everything else is free as in free coffee. The also offer free mail-forward using spam- and malware filters and a dynamic DNS service if you ISP is rotating your public IP. Domain name You may have an idea - but is it available? You can search Joker's database to get an idea of what is available. The registration is straight forward and easy to complete. Joker DNS management While there is several possibilities for setting up the DNS - with joker you leave it at the A record. But as many users - if you tell them the web address - will be prepending the domain with www - it is best practice to have a CNAME record pointing to your root domain When logged into your joker account If not already there click My Joker -> Domains -> DNS Click Add New Record a. Set Type field to A b. leave Name(Subdomain) empty c. enter your public IP in IP address c. click Add Repeat above - this time with CNAME a. In Type - select CNAME b. In Name - enter www c. In Alias - enter your domain name without www d. Click Add Repeat for any email you want to add a. Set Type to Email b. Set the leftmost part of the email address c. Set an existing mailbox to receive the mail d. Click Add If you do not have a dedicated public IP - even the DHCP assigned addresses rarely change - you may need to use their Dynamic DNS service (which I have no experience with). When you are done - Click Save changes at the page bottom. DNS records created have a TTL (time to live) at 86400s - so waiting for a change to propagate can be a pain. Clicking options for the A-record - then the Edit icon - you can set TTL to e.g. 600s which is 10m. Remember to Save changes - otherwise the changes will not be saved. Setting up your router The last step is configuring your router. As there is a lot of different interfaces I cannot possibly know them all. But the requirements is identical Assign a static IP address on your LAN to your NextCloud box (you may already have done so - if - skip to next bullet) Open your routers configuration interface and login Locate the configuration section/page called Portforwarding Create a rule from WAN to LAN and allow incoming traffic port 80 -> nextcloud IP port 443 -> nextcloud IP Save the changes and restart your router. Test access Important Security considerations Within minutes of opening your router - botnets will begin scanning your system for vulnerabilities The bots will very quickly know it is a nextcloud instance and begin hammering your login The bots will also try to access known nextcloud extension packages which are known to be exploitable Keep your nextcloud up-to-date Regularly check your logs Employ a fail-2-ban mechanism A term used for blocking an IP for a period of time when it repeatedly fail to login I don\u2019t know if NextCloud has something built-in. Testing your setup Depending on your router - you may not be able to connect directly to your routers WAN address - in which case you can test the access using e.g. your phone to connect to it (disable wireless on your phone - forcing it to use broadband). Another option is connecting to the internet using a VPN - then access your domain - but bear in mind that you will need to disconnect from VPN to be able to access your router\u2019s configuration interface - if you need to troubleshoot the rules. If you can connect :partying_face: Conclusion That is about it - welcome to the world of server admins.","title":"Sharing Pi NextClound"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#share-your-pi-nextcloud","text":"When you have setup a NextCloud instance on your Pi - next step is sharing it with your family and friends. This topic is not on installing Pi or NextCloud or the internal configuration but the steps to take to share it using a public domain name. This topic stems from the Self hosted cloud service topic and I thought - maybe a little write-up on the steps to share an instance using a domain-name. Sure - you can do this using the public IP address of your internet connection - but several questions rise How many of your family and friends can remember your IP? And what if it changes? What is the bare minimal I need to do? What do I need to know? What must I prepare for?","title":"Share your Pi NextCloud"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#registration","text":"This is where you need a registrar. A registrar is an entity supplying usage rights for internet domain names - e.g. pacbang-linux.org or nix.dk . One thing to remember - you don't buy a domain name - you buy the right to use it for period - usually a year - and the fee is paid up-front. If - subsequently - you don't pay - you loose that usage right. Many registrars allow for for multiple years upfront - some times at a discounted rate.","title":"Registration"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#important","text":"There is three contact levels for a given domain - ensure you are the owner contact - because this is where some shady resellers cheat - especially when you request who-is privacy. There is a lot of registrars and not all are equally easy to work with - sometimes you only realize it when you want to transfer your domain to another registrar and the pain begins. The owner contact The pay-the-bills contact The technical contact I know - there is a lot of registrars - so you may know some I don't or you may prefer one over mine - so this is to discuss why one registrar should be chosen over another, good vs. bad etc. - the registrar I have chosen is a well-known registrar with decades of spotless operation.","title":"Important"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#joker-registrar","text":"Joker is a swiss based registrar with the privacy and security Switzerland is known for. As I am former self-employed IT consultant working with nearly every aspect of IT operation, hosting, DNS, maintenance and domain reseller - joker.com has by been among the best registrars to work with (I still have reseller account - albeit not using it anymore). Joker's service portfolio has grown over the years - including both a free who-is privacy and an extended privacy at a nominal cost - and besides the yearly domain fee - everything else is free as in free coffee. The also offer free mail-forward using spam- and malware filters and a dynamic DNS service if you ISP is rotating your public IP.","title":"Joker registrar"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#domain-name","text":"You may have an idea - but is it available? You can search Joker's database to get an idea of what is available. The registration is straight forward and easy to complete.","title":"Domain name"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#joker-dns-management","text":"While there is several possibilities for setting up the DNS - with joker you leave it at the A record. But as many users - if you tell them the web address - will be prepending the domain with www - it is best practice to have a CNAME record pointing to your root domain When logged into your joker account If not already there click My Joker -> Domains -> DNS Click Add New Record a. Set Type field to A b. leave Name(Subdomain) empty c. enter your public IP in IP address c. click Add Repeat above - this time with CNAME a. In Type - select CNAME b. In Name - enter www c. In Alias - enter your domain name without www d. Click Add Repeat for any email you want to add a. Set Type to Email b. Set the leftmost part of the email address c. Set an existing mailbox to receive the mail d. Click Add If you do not have a dedicated public IP - even the DHCP assigned addresses rarely change - you may need to use their Dynamic DNS service (which I have no experience with). When you are done - Click Save changes at the page bottom. DNS records created have a TTL (time to live) at 86400s - so waiting for a change to propagate can be a pain. Clicking options for the A-record - then the Edit icon - you can set TTL to e.g. 600s which is 10m. Remember to Save changes - otherwise the changes will not be saved.","title":"Joker DNS management"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#setting-up-your-router","text":"The last step is configuring your router. As there is a lot of different interfaces I cannot possibly know them all. But the requirements is identical Assign a static IP address on your LAN to your NextCloud box (you may already have done so - if - skip to next bullet) Open your routers configuration interface and login Locate the configuration section/page called Portforwarding Create a rule from WAN to LAN and allow incoming traffic port 80 -> nextcloud IP port 443 -> nextcloud IP Save the changes and restart your router. Test access Important Security considerations Within minutes of opening your router - botnets will begin scanning your system for vulnerabilities The bots will very quickly know it is a nextcloud instance and begin hammering your login The bots will also try to access known nextcloud extension packages which are known to be exploitable Keep your nextcloud up-to-date Regularly check your logs Employ a fail-2-ban mechanism A term used for blocking an IP for a period of time when it repeatedly fail to login I don\u2019t know if NextCloud has something built-in.","title":"Setting up your router"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#testing-your-setup","text":"Depending on your router - you may not be able to connect directly to your routers WAN address - in which case you can test the access using e.g. your phone to connect to it (disable wireless on your phone - forcing it to use broadband). Another option is connecting to the internet using a VPN - then access your domain - but bear in mind that you will need to disconnect from VPN to be able to access your router\u2019s configuration interface - if you need to troubleshoot the rules. If you can connect :partying_face:","title":"Testing your setup"},{"location":"manjaro/raspberry-pi/raspberry-pi-selfhosted-nextcloud/#conclusion","text":"That is about it - welcome to the world of server admins.","title":"Conclusion"},{"location":"manjaro/raspberry-pi/raspberry-pi-ubuntu-server/","text":"Using rpi-imager When using rpi-imager to prepare an sd-card with Ubuntu Server it is not clear how to finalize the setup. After some triall'n'error I found the following. Boot the image and wait a few minutes until the system settles - the green led is an excellent indicator. When the system has settled either attach a monitor and keyboard or use nmap to locate the device nmap -p 22 --open ip.x.y.z/24 The default login is ubuntu:ubuntu - you will immediately be required to change password, follow the prompts.","title":"Ubuntu Server on RPi"},{"location":"manjaro/raspberry-pi/raspberry-pi-ubuntu-server/#using-rpi-imager","text":"When using rpi-imager to prepare an sd-card with Ubuntu Server it is not clear how to finalize the setup. After some triall'n'error I found the following. Boot the image and wait a few minutes until the system settles - the green led is an excellent indicator. When the system has settled either attach a monitor and keyboard or use nmap to locate the device nmap -p 22 --open ip.x.y.z/24 The default login is ubuntu:ubuntu - you will immediately be required to change password, follow the prompts.","title":"Using rpi-imager"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/","text":"Raspberry Pi with no monitor The document describes how to install a Raspberry Pi using Manjaro. The end result will be GUI accesible by VNC over SSH. The installation and configuration will be done entriely using SSH in a vritual terminal. Preparation RPi4 Powersupply Network connection using a cable and a network switch 8GB SD card A cardreader Download the minimal Manjaro Arm image - locate the latest version using manjaro.org Unpack the compressed image using unxz unxz -d Manjaro-ARM-minimal-rpi4-$YY.$MM.img.xz As root Write the unpacked image to SD card dd if=Manjaro-ARM-minimal-rpi4-$YY.$MM.img of=$DEVICE status=progress bs=4k conv=noerror,fdatasync oflag=dsync Insert the SD card in your PI and connnect network cable and power. When the PI has booted locate the pi using network utility like arp-scan. As root run the command arp-scan --local Or you can use nmap to only look for host with port 22 active nmap -p22 --open 192.168.x.0/24 If you only have one pi on the network it should be fairly easy to locate the IP address in the output e.g. ... 192.168.x.y dc:a6:32:xx:yy:yy Raspberry Pi Trading Ltd ... When you have located the device use ssh in terminal to connect to the pi ssh root@192.168.x.y When you are connected the OEM installer script will launch. Follow the prompts and let the device restart and when restarted use ssh to reconnect - this time using the username and password you created Update the system Run pacman-mirrors and update the system sudo pacman-mirrors --continent && sudo pacman -Syyu Next thing is to install some GUI packages to be used when connecting using VNC. Xorg and drivers This is a section I am unsure of. I have probably overdone the package selection but it is tested and it works sudo pacman -Syu xorg-server xorg-server-common xorg-xinit LXDE sudo pacman -Syu lxde epdfview accountsservice gnome-keyring gnome-icon-theme perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils Network utilities including VNC sudo pacman -Syu tigervnc netctl ifplugd iw wpa_supplicant dialog network-manager-applet networkmanager-openvpn Setup and connect to VNC Setup VNC on the Pi and connect as per this linked topic","title":"Raspberry Pi VNC over SSH"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/#raspberry-pi-with-no-monitor","text":"The document describes how to install a Raspberry Pi using Manjaro. The end result will be GUI accesible by VNC over SSH. The installation and configuration will be done entriely using SSH in a vritual terminal.","title":"Raspberry Pi with no monitor"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/#preparation","text":"RPi4 Powersupply Network connection using a cable and a network switch 8GB SD card A cardreader Download the minimal Manjaro Arm image - locate the latest version using manjaro.org Unpack the compressed image using unxz unxz -d Manjaro-ARM-minimal-rpi4-$YY.$MM.img.xz As root Write the unpacked image to SD card dd if=Manjaro-ARM-minimal-rpi4-$YY.$MM.img of=$DEVICE status=progress bs=4k conv=noerror,fdatasync oflag=dsync Insert the SD card in your PI and connnect network cable and power. When the PI has booted locate the pi using network utility like arp-scan. As root run the command arp-scan --local Or you can use nmap to only look for host with port 22 active nmap -p22 --open 192.168.x.0/24 If you only have one pi on the network it should be fairly easy to locate the IP address in the output e.g. ... 192.168.x.y dc:a6:32:xx:yy:yy Raspberry Pi Trading Ltd ... When you have located the device use ssh in terminal to connect to the pi ssh root@192.168.x.y When you are connected the OEM installer script will launch. Follow the prompts and let the device restart and when restarted use ssh to reconnect - this time using the username and password you created","title":"Preparation"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/#update-the-system","text":"Run pacman-mirrors and update the system sudo pacman-mirrors --continent && sudo pacman -Syyu Next thing is to install some GUI packages to be used when connecting using VNC.","title":"Update the system"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/#xorg-and-drivers","text":"This is a section I am unsure of. I have probably overdone the package selection but it is tested and it works sudo pacman -Syu xorg-server xorg-server-common xorg-xinit","title":"Xorg and drivers"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/#lxde","text":"sudo pacman -Syu lxde epdfview accountsservice gnome-keyring gnome-icon-theme perl-file-mimeinfo xdg-user-dirs xdg-user-dirs-gtk xdg-utils","title":"LXDE"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/#network-utilities-including-vnc","text":"sudo pacman -Syu tigervnc netctl ifplugd iw wpa_supplicant dialog network-manager-applet networkmanager-openvpn","title":"Network utilities including VNC"},{"location":"manjaro/raspberry-pi/raspberry-pi-vnc-over-ssh/#setup-and-connect-to-vnc","text":"Setup VNC on the Pi and connect as per this linked topic","title":"Setup and connect to VNC"},{"location":"manjaro/raspberry-pi/raspberry-pi-zero-w-prepare-wireless-connection/","text":"RaspberryPi OS This will likely work with most systemd based Linux distribution using systemd-networkd Watch out for verify interface with desktop dhcp will do headless Prepare the SD card using RPI imager - mount the resulting root partition on the SD card. Raspberry Pi Documentation Edit the file as root $MOUNTPOINT/etc/wpa_supplicant/wpa_supplicant.conf Append the following and save the file .... network={ ssid=\"apname\" psk=\"pskvalue or cleartext passphrase\" } Edit the file as root $MOUNTPOINT/etc/network/interfaces Append the following and save the file .... allow-hotplug wlan0 iface wlan0 inet dhcp wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf Source Raspberry Pi wpa_cli","title":"Pi Zero W - prepare wireless connection"},{"location":"manjaro/raspberry-pi/raspberry-pi-zero-w-prepare-wireless-connection/#raspberrypi-os","text":"This will likely work with most systemd based Linux distribution using systemd-networkd Watch out for verify interface with desktop dhcp will do headless Prepare the SD card using RPI imager - mount the resulting root partition on the SD card. Raspberry Pi Documentation Edit the file as root $MOUNTPOINT/etc/wpa_supplicant/wpa_supplicant.conf Append the following and save the file .... network={ ssid=\"apname\" psk=\"pskvalue or cleartext passphrase\" } Edit the file as root $MOUNTPOINT/etc/network/interfaces Append the following and save the file .... allow-hotplug wlan0 iface wlan0 inet dhcp wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf Source Raspberry Pi wpa_cli","title":"RaspberryPi OS"},{"location":"manjaro/samba/samba-arm-wireless-file-service/","text":"Difficulty: \u2605\u2605\u2605\u2605\u2606 Wireless Raspberry Pi file server Goal The exercise is to use use Samba to share different content for different audiences using an Arch Linux based OS. Which one you choose is up to you - for this writeup I am using Manjaro ARM minimal. The bar is set high as the installation and configuration is done from scratch using a SSH terminal session to the target system. It will also require understanding of the Access Control List in a GNU/Linux system as well as networking concepts. The final setup will provide the following features Users and groups * user:admin group:admin home:admin * user:hans group:users,office (no-shell, no-home) * user:grete group:users,admin (no-shell, no-home) Shares * public share * authenticated users can edit files * guests can read files * document share * stored on local root partition accessible to authenticated users * files may be edited by users belonging to the admin group * office users can only read the documents * music library (administrated by the dedicated admin) * stored on external partition - in this case an USB stick Prerequisite Reference Arch Wiki on Samba Arch (based) Workstation The following packages micro , smb-client , gvfs and gvfs-smb The package rpi-imager which you either install from the Manjaro repo or build from AUR A cardreader to be able to write the image to a micro sd-card Raspberry Pi 4 Micro sd-card Do a full system sync adding the packages to your workstation (remember to reboot if your kernel is updated) sudo pacman -Syu micro smb-client gvfs gvfs-smb base-devel git --needed If you are using Manjaro - install rpi-imager from the repo sudo pacman -S rpi-imager If using EndeavourOS or Arch you must build the rpi-imager from AUR git clone https://aur.archlinux.org/rpi-imager cd rpi-imager makepkg -is Plug your sd-card in the card reader attached to your workstation The RPI imager is simple to use. Upon selection of source and storage the app downloads the image, writes to sd-card and verifies the image - ready to use. Just launch the app - navigate to locate the Manjaro ARM minimal and write it to your sd-card. Create the wifi-hack.sh script and use it to configure your PI's WiFi. The script takes 6 arguments <blockdev> <ssid> <passphrase> <cidr> <gateway> <dns> . The following is an example - amend the arguments for your use case sudo hack-wifi.sh /dev/mmcblk0 my-ssid 192.168.1.90/24 192.168.1.1 192.168.1.1 Move the sdcard to your pi and power up. Wait for the device to settle - the green activity led becomes quiet - more important - allow the device to connect to your wifi. We will switch back and forth and forth between ssh and workstation - and we will be referencing the pi's smb service quite a lot. So to avoid having to type the IP address repeatedly we will create an alias for the configured IP and append to your workstation's hosts file. For this writeup I have chosen rpi echo \"192.168.1.90 rpi\" | sudo tee -a /etc/hosts Connect to the pi using the either the address or the alias ssh root@rpi The oem installer script will prompt you for a hostname - be smart and use the alias you just created. After completion of the script the device reboot. Reconnect to the device using the newly configured user. ssh username@pi Configure the mirrorlist and do a full sync while adding samba , firewalld , micro . sudo pacman-mirrors --continent && sudo pacman -Syyu samba micro firewalld Then enable firewalld and configure use firewall-cmd to configure the service for the home zone sudo systemctl enable --now firewalld sudo firewall-cmd --set-default-zone=home sudo firewall-cmd --permanent --add-service={samba,ssh} --zone=home After sync has completed reboot your rpi and reopen the ssh connection sudo reboot data tree On the pi we will store data in a designated tree starting from our system root ( / ) mkdir -p /data/office mkdir -p /data/media/music mkdir -p /data/public Visualised using tree # tree /data /data \u251c\u2500\u2500 media \u2502 \u2514\u2500\u2500 music \u251c\u2500\u2500 office \u2514\u2500\u2500 public Permissions office The office folder's permission should be editable by group with no access for other - including guests. chmod go+w,o-rx /data/office media The content of /data/media/music is stored on an external USB device, so initially there is no data. The device may or may not be attached, we will handle that later as this pose a challenge. The media folder has suitable permissions - no need to change. public The public folder is writable by group and readable for other chmod g+w /data/public The office group doesn't exist - so let's create it and assign the group to the documents folder. groupadd office chgrp office /data/office For the public folder we decided that authenticated users are allowed to write - guests are not. The default users group is perfect for this. chgrp users /data/public If you list the content of the data folder vs. the bind mounted folders you will note the permissions reflect the permissions set on the data folder. # ls -l /data drwxr-xr-x 3 admin admin 4096 Aug 10 01:29 media drwxr-xr-x 2 admin office 4096 Oct 16 10:40 office drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public ```` Listing `/srv/samba` and `/srv/samba/data` folder ls -l /srv/samba drwxr-xr-x 5 root admin 4096 Oct 16 10:40 data drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public ls -l /srv/samba/data drwxr-xr-x 3 admin admin 4096 Aug 10 01:29 media drwxr-xr-x 2 admin office 4096 Oct 16 10:40 office drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public ### data protection To ensure we do not accidental enable folder traversel outside the shares we will use **bind** mounts. Mounting using **bind** is a simple and efficient method of making data from one folder available from another folder on the same system. The function is similar to symlink but you cannot create folder traversal using dots. We will create some corresponding folders in **/srv** and bind our data there. mkdir -p /srv/samba/data mkdir -p /srv/samba/public Open the file /etc/fstab with micro micro /etc/fstab Append the following lines /data /srv/samba/data none bind 0 0 /data/public /srv/samba/public none bind 0 0 Now execute a reload and mount everything systemctl daemon-reload mount -a When we list the **/srv/samba** we see how our changes to the data folders is reflected in share tree ls -l /srv/samba drwxr-xr-x 5 root admin 4096 Oct 16 10:40 data drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public ls -l /srv/samba/data drwxr-xr-x 3 admin admin 4096 Aug 10 01:29 media drwxr-xr-x 2 admin office 4096 Oct 16 10:40 office drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public And the tree /srv/samba \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 media \u2502 \u2502 \u2514\u2500\u2500 music \u2502 \u251c\u2500\u2500 office \u2502 \u2514\u2500\u2500 public \u2514\u2500\u2500 public ## Basic samba configuration In your shell session switch to root session - so we don't have to prepend everything with sudo. su -l root Locate the samba configuration folder on your pi cd /etc/samba Samba is always configured from scratch - there is no default config, it must be created before you can start the service. The micro editor is terminal editor with support for copy/paste and other well know editor shortcuts. In the samba configuration folder start micro and create the required configuration **smb.conf** micro smb.conf We start by defining two sections **global** configuration and **public** share configuration [global] workgroup = WORKGROUP server string = Samba File Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2 # Think ransomware - you don't wannacry [public] path = /srv/samba/public public = yes writable = yes printable = no [data] path = /srv/samba/data public = no writable = yes printable = no Run the command `testparm` to ensure your smb.conf is free from spelling errors then start the service. testparm -s If you are curios about smb.conf - try this testparm -s -v > ~/smb-defaults.txt | micro ### public share Verify the public share by opening the file manager on your workstation. Use **Ctrl+L** and input `smb://ip.x.y.z/public` then press **Enter** Login using the anonymous method. Try creating new file - you should expect access denied. Then go back to your shell and create an empty text file in public folder. touch /data/public/test.txt Go back to your file manager press **F5** to reveal the new file. All good - now unmount the public share from the file manager and reopen the share - this time login using the username and credentials from your ssh session - this time edit the file and save it. Did you get access denied once more? Good - this is expected behavior as there is no users in the samba trust database. Unmount the public share using the eject button in the file manager. ## user - samba vs. system **It is very important to remember** - a system user is not a samba user - a samba user requires a system user If you change your user password you either remember two passwords or change using `smbpasswd` for your username. To enable passwd sync maintenance from samba to system - add this to the global section of `smb.conf` [global] .... obey pam restrictions = yes unix password sync = yes passwd program = /usr/bin/passwd %u passwd chat = New UNIX password %n\\n ReType new UNIX password %n\\n passwd: all authentication tokens updated successfully pam password change = yes .... Any changes to smb.conf requires the service to be restarted and as a precaution always test the config before restarting. Using this command will prevent samba from restarting if the testparm command fails testparm && systemctl restart smb ### anonymous user **Anonymous users is a security risk.** You have no control over the contenton your share. This is bad - very, very bad - think ransomware - you don't *wannacry* :sob: If you - despite all warnings - must create a public share with no restrictions refer to [Samba Usage][3] on Arch Wiki. ### authenticated user Remember the leading sentence for this section - **a system user is not a samba user**. Since our service should allow authenticated users to create content in the public folder - let us start easy with your ssh username. smbpasswd -a your-user In your file manager mount the share again - this time using your ssh user and the samba password. Open the empty file - enter some text and save it. Try creating some new content on the public share. This time you are authenticated and thus allowed to make changes. Remove your test content from the share and unmount. ### creating users - add to samba Our server is a file server only and as such - besides the admin - users has no use for home folder and they don't need shell access. Our challenge includes and administrator and two distinct authenticated users with access to the documents folder. * *users* group can read/write public content * *office* group can read documents * *admin* group can read/write all content As we configured samba using **unix password sync = yes** samba will sync the password back to the system. #### creating users A designated administrator of shared content. The user has system login permissions and a home folder useradd --create-home --user-group --groups office,users --shell /bin/bash admin smbpasswd -a admin A user named *hans* in group *office* with no shell, no home and no personal group useradd --no-create-home --no-user-group --groups office -s /bin/nologin hans smbpasswd -a hans Let's create the office user - name *grete* with no shell, no home, no personal group but a supplementary group *office* useradd --no-create-home --no-user-group --groups admin --shell /bin/nologin grete smbpasswd -a grete ### admin user permissions When you list the content of the `/data` folder, `root` is listed as owner - but we have our dedicated admin. Let's change the group for */data* root to admin - allowing admin to create new folders chgrp admin /data Next we change the owner of content inside */data/* - you did remove the test files - right? Otherwise the owner will change for those as well. chown admin /data/* -R ## the data share Edit your samba configuration and add the following section [data] path = /srv/samba/data public = no writable = yes printable = no guest ok = no Test the config testparm -s restart the service systemctl restart smb On your workstation open a terminal and run smbclient -L rpi -U admin Password for [WORKGROUP\\admin]: Sharename Type Comment --------- ---- ------- public Disk data Disk IPC$ IPC IPC Service (Manjaro Samba Server) SMB1 disabled -- no workgroup available ## the media share The media share resides on a removable device and we want the device to be mounted all times. The problem with removable devices is - they are removable - which is a challenge to be solved. We will face this challenge using systemd units. We need the UUID of the partition we want to mount - so attach the device to the Raspberry Pi and list the available block devices lsblk -A lsblk -A NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 1 28,8G 0 disk \u2514\u2500sda1 8:1 1 28,8G 0 part mmcblk0 179:0 0 14,6G 0 disk \u251c\u2500mmcblk0p1 179:1 0 457,8M 0 part /boot \u2514\u2500mmcblk0p2 179:2 0 14,1G 0 part /srv/samba/public /srv/samba/data / The partition is /dev/sda1 - let's get the UUID and pipe it to the unit file. lsblk -no UUID /dev/sda1 > /etc/systemd/system/data-media-music.mount systemd mount unit naming convention is to use the mountpoint as filename replacing **/** with **-**. In our case we have placed the music files in the folder **/data/media/music** so this is where we mount the partition. Open the unit file using micro micro /etc/systemd/system/data-media-music.mount Alter the content to match below - arrange for you UUID which is unique for my system to end the line *What=/dev/disk/by-uuid/*. (do not add spaces before or after the equal sign **=** and observe the casing of properties) [Unit] Description=USB stick with music files [Mount] What=/dev/disk/by-uuid/some-uuid-from-yoursystem Where=/data/media/music Type= Options=defaults.rw.noatime [Install] WantedBy=multi-user.target Now we create unit which takes care of mount the partition when it is needed. The same rule on filename applies - but the extension is *.automount* micro /etc/systemd/system/data-media-music.automount The content of the automount is as follow [Unit] Description=USB stick with music files ConditionPathExists=/data/media/music [Automount] Where=/data/media/music TimeoutIdleSec=300 [Install] WantedBy=multi-user.target All that is left now is to enable the automount unit systemctl enable --now data-media-music.automount To share the music folder on a common sharepoint - edit your smb.conf and add the following section [music] path = /srv/samba/data/media/music public = yes printable = no guest ok = yes Test your configuration testparm -s Restart the service systemctl restart smb ``` Done You have setup your raspberry pi to run a samba service and succesfully shared a public and a private folder. Also posted at Manjaro Forum","title":"ARM wireless Samba file service based on Arch"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#wireless-raspberry-pi-file-server","text":"","title":"Wireless Raspberry Pi file server"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#goal","text":"The exercise is to use use Samba to share different content for different audiences using an Arch Linux based OS. Which one you choose is up to you - for this writeup I am using Manjaro ARM minimal. The bar is set high as the installation and configuration is done from scratch using a SSH terminal session to the target system. It will also require understanding of the Access Control List in a GNU/Linux system as well as networking concepts. The final setup will provide the following features Users and groups * user:admin group:admin home:admin * user:hans group:users,office (no-shell, no-home) * user:grete group:users,admin (no-shell, no-home) Shares * public share * authenticated users can edit files * guests can read files * document share * stored on local root partition accessible to authenticated users * files may be edited by users belonging to the admin group * office users can only read the documents * music library (administrated by the dedicated admin) * stored on external partition - in this case an USB stick","title":"Goal"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#prerequisite","text":"Reference Arch Wiki on Samba Arch (based) Workstation The following packages micro , smb-client , gvfs and gvfs-smb The package rpi-imager which you either install from the Manjaro repo or build from AUR A cardreader to be able to write the image to a micro sd-card Raspberry Pi 4 Micro sd-card Do a full system sync adding the packages to your workstation (remember to reboot if your kernel is updated) sudo pacman -Syu micro smb-client gvfs gvfs-smb base-devel git --needed If you are using Manjaro - install rpi-imager from the repo sudo pacman -S rpi-imager If using EndeavourOS or Arch you must build the rpi-imager from AUR git clone https://aur.archlinux.org/rpi-imager cd rpi-imager makepkg -is Plug your sd-card in the card reader attached to your workstation The RPI imager is simple to use. Upon selection of source and storage the app downloads the image, writes to sd-card and verifies the image - ready to use. Just launch the app - navigate to locate the Manjaro ARM minimal and write it to your sd-card. Create the wifi-hack.sh script and use it to configure your PI's WiFi. The script takes 6 arguments <blockdev> <ssid> <passphrase> <cidr> <gateway> <dns> . The following is an example - amend the arguments for your use case sudo hack-wifi.sh /dev/mmcblk0 my-ssid 192.168.1.90/24 192.168.1.1 192.168.1.1 Move the sdcard to your pi and power up. Wait for the device to settle - the green activity led becomes quiet - more important - allow the device to connect to your wifi. We will switch back and forth and forth between ssh and workstation - and we will be referencing the pi's smb service quite a lot. So to avoid having to type the IP address repeatedly we will create an alias for the configured IP and append to your workstation's hosts file. For this writeup I have chosen rpi echo \"192.168.1.90 rpi\" | sudo tee -a /etc/hosts Connect to the pi using the either the address or the alias ssh root@rpi The oem installer script will prompt you for a hostname - be smart and use the alias you just created. After completion of the script the device reboot. Reconnect to the device using the newly configured user. ssh username@pi Configure the mirrorlist and do a full sync while adding samba , firewalld , micro . sudo pacman-mirrors --continent && sudo pacman -Syyu samba micro firewalld Then enable firewalld and configure use firewall-cmd to configure the service for the home zone sudo systemctl enable --now firewalld sudo firewall-cmd --set-default-zone=home sudo firewall-cmd --permanent --add-service={samba,ssh} --zone=home After sync has completed reboot your rpi and reopen the ssh connection sudo reboot","title":"Prerequisite"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#data-tree","text":"On the pi we will store data in a designated tree starting from our system root ( / ) mkdir -p /data/office mkdir -p /data/media/music mkdir -p /data/public Visualised using tree # tree /data /data \u251c\u2500\u2500 media \u2502 \u2514\u2500\u2500 music \u251c\u2500\u2500 office \u2514\u2500\u2500 public","title":"data tree"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#permissions","text":"","title":"Permissions"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#office","text":"The office folder's permission should be editable by group with no access for other - including guests. chmod go+w,o-rx /data/office","title":"office"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#media","text":"The content of /data/media/music is stored on an external USB device, so initially there is no data. The device may or may not be attached, we will handle that later as this pose a challenge. The media folder has suitable permissions - no need to change.","title":"media"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#public","text":"The public folder is writable by group and readable for other chmod g+w /data/public The office group doesn't exist - so let's create it and assign the group to the documents folder. groupadd office chgrp office /data/office For the public folder we decided that authenticated users are allowed to write - guests are not. The default users group is perfect for this. chgrp users /data/public If you list the content of the data folder vs. the bind mounted folders you will note the permissions reflect the permissions set on the data folder. # ls -l /data drwxr-xr-x 3 admin admin 4096 Aug 10 01:29 media drwxr-xr-x 2 admin office 4096 Oct 16 10:40 office drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public ```` Listing `/srv/samba` and `/srv/samba/data` folder","title":"public"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#ls-l-srvsamba","text":"drwxr-xr-x 5 root admin 4096 Oct 16 10:40 data drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public","title":"ls -l /srv/samba"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#ls-l-srvsambadata","text":"drwxr-xr-x 3 admin admin 4096 Aug 10 01:29 media drwxr-xr-x 2 admin office 4096 Oct 16 10:40 office drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public ### data protection To ensure we do not accidental enable folder traversel outside the shares we will use **bind** mounts. Mounting using **bind** is a simple and efficient method of making data from one folder available from another folder on the same system. The function is similar to symlink but you cannot create folder traversal using dots. We will create some corresponding folders in **/srv** and bind our data there. mkdir -p /srv/samba/data mkdir -p /srv/samba/public Open the file /etc/fstab with micro micro /etc/fstab Append the following lines /data /srv/samba/data none bind 0 0 /data/public /srv/samba/public none bind 0 0 Now execute a reload and mount everything systemctl daemon-reload mount -a When we list the **/srv/samba** we see how our changes to the data folders is reflected in share tree","title":"ls -l /srv/samba/data"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#ls-l-srvsamba_1","text":"drwxr-xr-x 5 root admin 4096 Oct 16 10:40 data drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public","title":"ls -l /srv/samba"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#ls-l-srvsambadata_1","text":"drwxr-xr-x 3 admin admin 4096 Aug 10 01:29 media drwxr-xr-x 2 admin office 4096 Oct 16 10:40 office drwxrwxr-x 2 admin users 4096 Oct 16 09:48 public And the tree /srv/samba \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 media \u2502 \u2502 \u2514\u2500\u2500 music \u2502 \u251c\u2500\u2500 office \u2502 \u2514\u2500\u2500 public \u2514\u2500\u2500 public ## Basic samba configuration In your shell session switch to root session - so we don't have to prepend everything with sudo. su -l root Locate the samba configuration folder on your pi cd /etc/samba Samba is always configured from scratch - there is no default config, it must be created before you can start the service. The micro editor is terminal editor with support for copy/paste and other well know editor shortcuts. In the samba configuration folder start micro and create the required configuration **smb.conf** micro smb.conf We start by defining two sections **global** configuration and **public** share configuration [global] workgroup = WORKGROUP server string = Samba File Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2 # Think ransomware - you don't wannacry [public] path = /srv/samba/public public = yes writable = yes printable = no [data] path = /srv/samba/data public = no writable = yes printable = no Run the command `testparm` to ensure your smb.conf is free from spelling errors then start the service. testparm -s If you are curios about smb.conf - try this testparm -s -v > ~/smb-defaults.txt | micro ### public share Verify the public share by opening the file manager on your workstation. Use **Ctrl+L** and input `smb://ip.x.y.z/public` then press **Enter** Login using the anonymous method. Try creating new file - you should expect access denied. Then go back to your shell and create an empty text file in public folder. touch /data/public/test.txt Go back to your file manager press **F5** to reveal the new file. All good - now unmount the public share from the file manager and reopen the share - this time login using the username and credentials from your ssh session - this time edit the file and save it. Did you get access denied once more? Good - this is expected behavior as there is no users in the samba trust database. Unmount the public share using the eject button in the file manager. ## user - samba vs. system **It is very important to remember** - a system user is not a samba user - a samba user requires a system user If you change your user password you either remember two passwords or change using `smbpasswd` for your username. To enable passwd sync maintenance from samba to system - add this to the global section of `smb.conf` [global] .... obey pam restrictions = yes unix password sync = yes passwd program = /usr/bin/passwd %u passwd chat = New UNIX password %n\\n ReType new UNIX password %n\\n passwd: all authentication tokens updated successfully pam password change = yes .... Any changes to smb.conf requires the service to be restarted and as a precaution always test the config before restarting. Using this command will prevent samba from restarting if the testparm command fails testparm && systemctl restart smb ### anonymous user **Anonymous users is a security risk.** You have no control over the contenton your share. This is bad - very, very bad - think ransomware - you don't *wannacry* :sob: If you - despite all warnings - must create a public share with no restrictions refer to [Samba Usage][3] on Arch Wiki. ### authenticated user Remember the leading sentence for this section - **a system user is not a samba user**. Since our service should allow authenticated users to create content in the public folder - let us start easy with your ssh username. smbpasswd -a your-user In your file manager mount the share again - this time using your ssh user and the samba password. Open the empty file - enter some text and save it. Try creating some new content on the public share. This time you are authenticated and thus allowed to make changes. Remove your test content from the share and unmount. ### creating users - add to samba Our server is a file server only and as such - besides the admin - users has no use for home folder and they don't need shell access. Our challenge includes and administrator and two distinct authenticated users with access to the documents folder. * *users* group can read/write public content * *office* group can read documents * *admin* group can read/write all content As we configured samba using **unix password sync = yes** samba will sync the password back to the system. #### creating users A designated administrator of shared content. The user has system login permissions and a home folder useradd --create-home --user-group --groups office,users --shell /bin/bash admin smbpasswd -a admin A user named *hans* in group *office* with no shell, no home and no personal group useradd --no-create-home --no-user-group --groups office -s /bin/nologin hans smbpasswd -a hans Let's create the office user - name *grete* with no shell, no home, no personal group but a supplementary group *office* useradd --no-create-home --no-user-group --groups admin --shell /bin/nologin grete smbpasswd -a grete ### admin user permissions When you list the content of the `/data` folder, `root` is listed as owner - but we have our dedicated admin. Let's change the group for */data* root to admin - allowing admin to create new folders chgrp admin /data Next we change the owner of content inside */data/* - you did remove the test files - right? Otherwise the owner will change for those as well. chown admin /data/* -R ## the data share Edit your samba configuration and add the following section [data] path = /srv/samba/data public = no writable = yes printable = no guest ok = no Test the config testparm -s restart the service systemctl restart smb On your workstation open a terminal and run smbclient -L rpi -U admin Password for [WORKGROUP\\admin]: Sharename Type Comment --------- ---- ------- public Disk data Disk IPC$ IPC IPC Service (Manjaro Samba Server) SMB1 disabled -- no workgroup available ## the media share The media share resides on a removable device and we want the device to be mounted all times. The problem with removable devices is - they are removable - which is a challenge to be solved. We will face this challenge using systemd units. We need the UUID of the partition we want to mount - so attach the device to the Raspberry Pi and list the available block devices","title":"ls -l /srv/samba/data"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#lsblk-a","text":"lsblk -A NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 1 28,8G 0 disk \u2514\u2500sda1 8:1 1 28,8G 0 part mmcblk0 179:0 0 14,6G 0 disk \u251c\u2500mmcblk0p1 179:1 0 457,8M 0 part /boot \u2514\u2500mmcblk0p2 179:2 0 14,1G 0 part /srv/samba/public /srv/samba/data / The partition is /dev/sda1 - let's get the UUID and pipe it to the unit file. lsblk -no UUID /dev/sda1 > /etc/systemd/system/data-media-music.mount systemd mount unit naming convention is to use the mountpoint as filename replacing **/** with **-**. In our case we have placed the music files in the folder **/data/media/music** so this is where we mount the partition. Open the unit file using micro micro /etc/systemd/system/data-media-music.mount Alter the content to match below - arrange for you UUID which is unique for my system to end the line *What=/dev/disk/by-uuid/*. (do not add spaces before or after the equal sign **=** and observe the casing of properties) [Unit] Description=USB stick with music files [Mount] What=/dev/disk/by-uuid/some-uuid-from-yoursystem Where=/data/media/music","title":"lsblk -A"},{"location":"manjaro/samba/samba-arm-wireless-file-service/#type","text":"Options=defaults.rw.noatime [Install] WantedBy=multi-user.target Now we create unit which takes care of mount the partition when it is needed. The same rule on filename applies - but the extension is *.automount* micro /etc/systemd/system/data-media-music.automount The content of the automount is as follow [Unit] Description=USB stick with music files ConditionPathExists=/data/media/music [Automount] Where=/data/media/music TimeoutIdleSec=300 [Install] WantedBy=multi-user.target All that is left now is to enable the automount unit systemctl enable --now data-media-music.automount To share the music folder on a common sharepoint - edit your smb.conf and add the following section [music] path = /srv/samba/data/media/music public = yes printable = no guest ok = yes Test your configuration testparm -s Restart the service systemctl restart smb ```","title":"Type="},{"location":"manjaro/samba/samba-arm-wireless-file-service/#done","text":"You have setup your raspberry pi to run a samba service and succesfully shared a public and a private folder. Also posted at Manjaro Forum","title":"Done"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/","text":"Difficulty: \u2605\u2605\u2606\u2606\u2606 What is SAMBA Samba is the standard Windows interoperability suite of programs for Linux and Unix. Content [Occasional sharing][100] [Samba Client][110] [GVFS][120] [System Automount][130] [User Mount][140] [User Automount][150] [User Service][151] [Manjaro Samba Server][160] [Troubleshooting][170] [References][180] What can you learn from this? This document from my notepad is intended as a help to setup simple client connection to home NAS and simple file sharing from your Manjaro desktop to other computers in your home network . If you are looking for domain specific setup and integration to Microsoft AD you must refer to the official samba documentation [[1]] . Occasional sharing Python http.server If you only occasionally need to serve files - you can do so using the default Python installation. Copy the files to you want to share to ~/Public then open a terminal in the folder and run two commands. The first displays your IP address [utility script [2]] ~/Public $ check-network 192.168.30.20 The second run the http service exposing the content of your ~/Public folder ~/Public $ python -m http.server -d ~/Public 8080 Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ... Then share the IP and port. The person(s) can fetch the file(s) using their browser and navigating to - the slash at the end is important (otherwise the browser runs a search using the configured searchengine) http://$IPADDRESS:8080/ When you are finished sharing, close the terminal or press Ctrl c to stop sharing. Simple http servers Packages such as darkhttpd and caddy provides webservers to service static files and can be installed from the repo. The caddy package also provides a SSL/TLS enabled server. Samba Client For simple client connection to shares provided by a NAS or maybe your router only a few packages are needed. The package smbclient provides the tools necessary for accessing samba fileshares. There is several packages which builds upon the client and makes it easier to connect and automount a share from a file manager. Packages such as gvfs-smb and smb4k extends the file manager with seamless mount of Samba shares. Ensure the packages are up-to-date by running below command in a terminal sudo pacman -Syu smbclient gvfs gvfs-smb --needed smbclient Before attempting a connection either reboot your system or manually load the kernel module sudo modprobe cifs Also a configuration file /etc/samba/smb.conf must be present. The client doesn't require any content - just the presence and can thus be created by the touch utility. sudo mkdir /etc/samba sudo touch /etc/samba/smb.conf GVFS Open your file manager and enter the server name or IP address in location bar. If the location bar is not visible it is often activated using the hot key-combo Ctrl L . Input the server name and share using the protocol format smb://server-name/share Some file managers (e.g. dolphin) can better deduct if credentials are required if the username is supplied like this smb://username@server-name/share When you are challenged for credentials input those to access the content. Do not save your credentials just yet. Later on you will return here to store the credentials in your keyring. This method is using gvfs which creates the mountpoint in the /run tree and therefore the mount will not persist across reboot. You can inspect the file structure by opening the folder matching the uid for your user. If you have a mounted share you can run ls on the gvfs folder - it will yield an output similar to below example $ ls /run/user/$UID/gvfs 'smb-share:server=nas.net.nix.dk,share=data' System Automount systemd units When mounting one or more network shares on boot one need to take into account when the network is up and connected - otherwise the system will hang for 90s for each share. This can be done using fstab or using systemd units [[ systemd unit ][3]] [[ sample units ][4]] . User Mount As demonstrated, a file manager can utilize gvfs to create a user mounted samba share, and this knowledge can used in creating some automation. As shown the gio mountpoint takes the following form where $UID , $HOST and $SHARE represents the variable factors /run/user/$UID/gvfs/'smb-share:server=$HOST,share=$SHARE' We will use the gio smb mount script to mount the share. Use the template provided in the topic to create your own script. When you have the script in place and working come back here. The script asks for username, workgroup and password when you run it and that is fine for the occasional mount but you will likely want to automount the share when you log onto your system. User Automount The script can be executed at login in a number of ways - but remember - the script's success depends on the credentials being available in your keyring. Adding the script to your environment's autostart configuration Manually creating a desktop launcher in ~/.config/autorun This topic will propose a somewhat different method by means of a systemd user service which will be used to execute our script upon login. :spiral_notepad: To be able to automount the share you can Either * Stored the credentials in your keyring when challenged by the file manager. Or * Store the credentials in the mount script mentioned above The user service Create the folder ~/.config/systemd/user and create a service file named e.g. gio-smb-share-name.service - use the same name as the script you are calling - thus making the dependency obvious and simplify future maintenance. mkdir -p ~/.config/systemd/user touch ~/.config/systemd/user/gio-smb-share-name.service Open the file in your favorite editor and paste below content. [Unit] Description=GIO mount smb share-name [Service] Type=oneshot ExecStart=/home/%u/.local/bin/gio-smb-share-name.sh ExecStop=/home/%u/.local/bin/gio-smb-share-name.sh -u RemainAfterExit=true [Install] WantedBy=multi-user.target Watch your SMBLinks folder and start the service systemctl --user start gio-smb-share-name.service Note the symlink is created. Stop the service to watch the symlink disappear systemctl --user stop gio-smb-share-name.service When everything works - start and enable the user service systemctl --user enable --now gio-smb-share-name.service Manjaro Samba Server :warning: 1. Sharing data will open ports to the network . 2. Only run a Samba file service on a trusted secure network or zone . 3. Ensure firewalld is set up to only allow share traffic when connected to a trusted and secure network or zone. 4. Never run a samba file server on a public network. 5. Avoid NT1 aka SMB1 - it is unsafe and exploited by numerous ransomware projets. Secure your service if you are using another firewall service (e.g. ufw) either setup that service to allow samba and skip this step or stop and disable the service before continuing. Install the package firewalld then enable and start the service. sudo pacman -Syu firewalld sudo systemctl enable --now firewalld firewalld has some predefined zones which we will use for this purpose to define trusted and untrusted network. If a network is not defined in any zones it is treated as public which means visible on the network and no open ports home public When you are connected to what you deem a trusted and secure network run the following command nmcli device show | grep IP4.ROUTE IP4.ROUTE[1]: dst = 192.168.1.0/24, nh = 0.0.0.0, mt = 100 IP4.ROUTE[2]: dst = 0.0.0.0/0, nh = 192.168.1.1, mt = 100 In this example note the first destination network; 192.168.1.0/24 . This it a common network used by many home routers. Your result may be different - adjust accordingly. Before you begin - list the default services permanently enabled for the zones sudo firewall-cmd --permanent --zone=\"home\" --list-services sudo firewall-cmd --permanent --zone=\"public\" --list-services Next step is to to tell the firewall this network is trusted - replace the variable with your network (note it is possible to have more than one trusted network - eg. home and work) sudo firewall-cmd --permanent --zone=\"home\" --add-source=\"$NETWORK\" Example using above sudo firewall-cmd --permanent --zone=\"home\" --add-source=\"192.168.1.0/24\" Next we define the policy for the samba service sudo firewall-cmd --permanent --zone=\"home\" --add-service=\"samba\" With the security in place proceed to installing and configuring Samba Install samba package Install the samba package and ensure your system is fully updated in the process. sudo pacman -Syu samba Basic Server configuration Create the configuration file /etc/samba/smb.conf - the folder may need to be created beforehand. sudo mkdir -p /etc/samba sudo touch /etc/samba/smb.conf Edit the file - using superuser privilige - insert below content and save the file (need superuser). If you are connecting an existing network of servers change the WORKGROUP to match the existing network. [global] workgroup = MANJARO server string = Manjaro Samba Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2 max protocol = SMB3 [public] path = /srv/samba/share-name public = yes writable = yes printable = no Test your config sudo testparm /etc/samba/smb.conf Create share and set permissions To share e.g. removable devices you need to mount the devices. This is best done using using systemd mount and if removable create both mount and automount unit. https://forum.manjaro.org/t/root-tip-use-systemd-to-mount-any-device/1185 Create the shared folder sudo mkdir -p /srv/samba/share-name Set permissions to any and all sudo chmod -R ugo+rw /srv/samba/share-name Start the services sudo systemctl enable --now smb nmb Troubleshooting Did you remember to add users to the service? Samba users can be added independently from system users by using smbpasswd -a $USERNAME Samba documentation on https://www.samba.org/samba/docs/current/man-html/smbpasswd.8.html Access Control Lists aka ACL Missing r/w access due to permissions. In essence, it was similar to this issue . Simple solution is to remove your share and create it again. And no need to change tdbsam to smbpasswd . -- Credit @openminded AppArmor when serving samba shares Some eitions of Manjaro comes with AppArmor enabled (snap support) which may lead to issues when samba is updated. In such case you can use the following quick fix sudo aa-complain /etc/apparmor.d/usr.sbin.smbd Now proceed to reading documentation on AppArmor especially the section on editing AppArmor profiles for a better and more long-term solution. -- Credit @openminded On [date=2022-09-03 timezone=\"Europe/Copenhagen\"] @0xbeaf contributed this comment on another topic and has been added here to complement this section. Changes to how samba does rpc seems to be the main culprit. Since it is using multiple new executable files to delegate its jobs, new profiles and overrides for apparmor needs to be added. I had to add override rules for usr.sbin.smbd , samba-dcerpcd , samba-rpcd and samba-rpcd-classic . To get rid of all DENIED error messages in apparmor log, I had to add one more entity to profile rules. E.g. to whitelist the path /tank/anbaar , I added the following to all above-mentioned profiles in /etc/apparmor.d/local : ini /tank/anbaar lrwk, /tank/anbaar/ lrwk, /tank/anbaar/** lrwk, * Additionally, /usr/share/samba and /var/cache/samba had to be whitelisted for samba-rpcd so avahi service could properly work with a macOS machine so that it could automatically find and mount the TimeMachine share-points!!! Helpful links: https://ubuntu.com/server/docs/security-apparmor https://gitlab.com/apparmor/apparmor/-/wikis/AppArmor_Core_Policy_Reference https://bugs.archlinux.org/task/74614 https://gitlab.com/apparmor/apparmor/-/merge_requests/871 Client Samba client requires the file /etc/samba/smb.conf even if it is empty. sudo mkdir -p /etc/samba sudo touch /etc/samba/smb.conf Browse available shares It is not possible to browse shares by using the service name SMB1 has been removed for security reasons. This also removed the possibliity to browse a server for avaliable shares. The removal enhances the resistance against ransomware and other malware propagating over the network. $ smbclient -L {host|ip} -U% Sharename Type Comment --------- ---- ------- public Disk IPC$ IPC IPC Service (Manjaro Samba Server) SMB1 disabled -- no workgroup available Netbios requests has been disabled due to the vulnerabilities thus highly improving restance against ransomware abusing the service to spread itself. Always connect to the share directly smbclient //{host|ip}/public Using a file manager you may need to add username to the request e.g. smb://username@service/sharename and provide the password. Only then you will be able to see what other shares the service provides. Initial share lookup If you find browsing the network from your filemanager is not possible issues it may be helpful to add the following content - replace the WORKGROUP if necessary [global] workgroup = WORKGROUP You may get messages like Failed to retrieve share list from server: No such file or directory The specified location is not mounted Samba protocol version Upstream Samba disabled SMB1 due to a vulnerability exploited by a widespread ransomware. Yet many ISP provided routers has not been upgraded and you may have difficulties connecting the router's samba service using a default samba client. To gain access to such share you need to add a samba configuration which sole purpose is to enable the deprecated samba version. Add the following line in the [global] section of the configuration file [global] client min protocol = NT1 Arch Wiki WINS host names Manual Mountiing The options uid and gid corresponds to the local (e.g. client) user / user group to have read/write access on the given path. Note: If the uid and gid being used does not match the user of the server, the forceuid and forcegid options may be helpful. However note permissions assigned to a file when forceuid or forcegid are in effect may not reflect the the real (server) permissions. See the File And Directory Ownership And Permissions section in mount.cifs(8) \u00a7 FILE AND DIRECTORY OWNERSHIP AND PERMISSIONS for more information. To mount a Windows share without authentication, use \"username=*\" . Warning: Using uid and/or gid as mount options may cause I/O errors, it is recommended to set/check correct File permissions and attributes instead. -- Arch Wiki More reading My notepad [[0]] Samba website [[1]] LAN IP utility script [[2]] Using systemd mount units [[3]] Sample mount units [[4]] Samba on Arch Wiki [[5]] Sample Samba configuration with comments [[6]] Microsoft's documentation [[7]] GIO mount SMB utility script [[8]] AppArmor Arch Linux Wiki [[13]]","title":"Basic Samba Setup and Troubleshooting"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#what-is-samba","text":"Samba is the standard Windows interoperability suite of programs for Linux and Unix.","title":"What is SAMBA"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#content","text":"[Occasional sharing][100] [Samba Client][110] [GVFS][120] [System Automount][130] [User Mount][140] [User Automount][150] [User Service][151] [Manjaro Samba Server][160] [Troubleshooting][170] [References][180]","title":"Content"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#what-can-you-learn-from-this","text":"This document from my notepad is intended as a help to setup simple client connection to home NAS and simple file sharing from your Manjaro desktop to other computers in your home network . If you are looking for domain specific setup and integration to Microsoft AD you must refer to the official samba documentation [[1]] .","title":"What can you learn from this?"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#occasional-sharing","text":"","title":"Occasional sharing"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#python-httpserver","text":"If you only occasionally need to serve files - you can do so using the default Python installation. Copy the files to you want to share to ~/Public then open a terminal in the folder and run two commands. The first displays your IP address [utility script [2]] ~/Public $ check-network 192.168.30.20 The second run the http service exposing the content of your ~/Public folder ~/Public $ python -m http.server -d ~/Public 8080 Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ... Then share the IP and port. The person(s) can fetch the file(s) using their browser and navigating to - the slash at the end is important (otherwise the browser runs a search using the configured searchengine) http://$IPADDRESS:8080/ When you are finished sharing, close the terminal or press Ctrl c to stop sharing.","title":"Python http.server"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#simple-http-servers","text":"Packages such as darkhttpd and caddy provides webservers to service static files and can be installed from the repo. The caddy package also provides a SSL/TLS enabled server.","title":"Simple http servers"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#samba-client","text":"For simple client connection to shares provided by a NAS or maybe your router only a few packages are needed. The package smbclient provides the tools necessary for accessing samba fileshares. There is several packages which builds upon the client and makes it easier to connect and automount a share from a file manager. Packages such as gvfs-smb and smb4k extends the file manager with seamless mount of Samba shares. Ensure the packages are up-to-date by running below command in a terminal sudo pacman -Syu smbclient gvfs gvfs-smb --needed","title":"Samba Client"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#smbclient","text":"Before attempting a connection either reboot your system or manually load the kernel module sudo modprobe cifs Also a configuration file /etc/samba/smb.conf must be present. The client doesn't require any content - just the presence and can thus be created by the touch utility. sudo mkdir /etc/samba sudo touch /etc/samba/smb.conf","title":"smbclient"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#gvfs","text":"Open your file manager and enter the server name or IP address in location bar. If the location bar is not visible it is often activated using the hot key-combo Ctrl L . Input the server name and share using the protocol format smb://server-name/share Some file managers (e.g. dolphin) can better deduct if credentials are required if the username is supplied like this smb://username@server-name/share When you are challenged for credentials input those to access the content. Do not save your credentials just yet. Later on you will return here to store the credentials in your keyring. This method is using gvfs which creates the mountpoint in the /run tree and therefore the mount will not persist across reboot. You can inspect the file structure by opening the folder matching the uid for your user. If you have a mounted share you can run ls on the gvfs folder - it will yield an output similar to below example $ ls /run/user/$UID/gvfs 'smb-share:server=nas.net.nix.dk,share=data'","title":"GVFS"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#system-automount","text":"","title":"System Automount"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#systemd-units","text":"When mounting one or more network shares on boot one need to take into account when the network is up and connected - otherwise the system will hang for 90s for each share. This can be done using fstab or using systemd units [[ systemd unit ][3]] [[ sample units ][4]] .","title":"systemd units"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#user-mount","text":"As demonstrated, a file manager can utilize gvfs to create a user mounted samba share, and this knowledge can used in creating some automation. As shown the gio mountpoint takes the following form where $UID , $HOST and $SHARE represents the variable factors /run/user/$UID/gvfs/'smb-share:server=$HOST,share=$SHARE' We will use the gio smb mount script to mount the share. Use the template provided in the topic to create your own script. When you have the script in place and working come back here. The script asks for username, workgroup and password when you run it and that is fine for the occasional mount but you will likely want to automount the share when you log onto your system.","title":"User Mount"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#user-automount","text":"The script can be executed at login in a number of ways - but remember - the script's success depends on the credentials being available in your keyring. Adding the script to your environment's autostart configuration Manually creating a desktop launcher in ~/.config/autorun This topic will propose a somewhat different method by means of a systemd user service which will be used to execute our script upon login. :spiral_notepad: To be able to automount the share you can Either * Stored the credentials in your keyring when challenged by the file manager. Or * Store the credentials in the mount script mentioned above","title":"User Automount"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#the-user-service","text":"Create the folder ~/.config/systemd/user and create a service file named e.g. gio-smb-share-name.service - use the same name as the script you are calling - thus making the dependency obvious and simplify future maintenance. mkdir -p ~/.config/systemd/user touch ~/.config/systemd/user/gio-smb-share-name.service Open the file in your favorite editor and paste below content. [Unit] Description=GIO mount smb share-name [Service] Type=oneshot ExecStart=/home/%u/.local/bin/gio-smb-share-name.sh ExecStop=/home/%u/.local/bin/gio-smb-share-name.sh -u RemainAfterExit=true [Install] WantedBy=multi-user.target Watch your SMBLinks folder and start the service systemctl --user start gio-smb-share-name.service Note the symlink is created. Stop the service to watch the symlink disappear systemctl --user stop gio-smb-share-name.service When everything works - start and enable the user service systemctl --user enable --now gio-smb-share-name.service","title":"The user service"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#manjaro-samba-server","text":":warning: 1. Sharing data will open ports to the network . 2. Only run a Samba file service on a trusted secure network or zone . 3. Ensure firewalld is set up to only allow share traffic when connected to a trusted and secure network or zone. 4. Never run a samba file server on a public network. 5. Avoid NT1 aka SMB1 - it is unsafe and exploited by numerous ransomware projets.","title":"Manjaro Samba Server"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#secure-your-service","text":"if you are using another firewall service (e.g. ufw) either setup that service to allow samba and skip this step or stop and disable the service before continuing. Install the package firewalld then enable and start the service. sudo pacman -Syu firewalld sudo systemctl enable --now firewalld firewalld has some predefined zones which we will use for this purpose to define trusted and untrusted network. If a network is not defined in any zones it is treated as public which means visible on the network and no open ports home public When you are connected to what you deem a trusted and secure network run the following command nmcli device show | grep IP4.ROUTE IP4.ROUTE[1]: dst = 192.168.1.0/24, nh = 0.0.0.0, mt = 100 IP4.ROUTE[2]: dst = 0.0.0.0/0, nh = 192.168.1.1, mt = 100 In this example note the first destination network; 192.168.1.0/24 . This it a common network used by many home routers. Your result may be different - adjust accordingly. Before you begin - list the default services permanently enabled for the zones sudo firewall-cmd --permanent --zone=\"home\" --list-services sudo firewall-cmd --permanent --zone=\"public\" --list-services Next step is to to tell the firewall this network is trusted - replace the variable with your network (note it is possible to have more than one trusted network - eg. home and work) sudo firewall-cmd --permanent --zone=\"home\" --add-source=\"$NETWORK\" Example using above sudo firewall-cmd --permanent --zone=\"home\" --add-source=\"192.168.1.0/24\" Next we define the policy for the samba service sudo firewall-cmd --permanent --zone=\"home\" --add-service=\"samba\" With the security in place proceed to installing and configuring Samba","title":"Secure your service"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#install-samba-package","text":"Install the samba package and ensure your system is fully updated in the process. sudo pacman -Syu samba","title":"Install samba package"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#basic-server-configuration","text":"Create the configuration file /etc/samba/smb.conf - the folder may need to be created beforehand. sudo mkdir -p /etc/samba sudo touch /etc/samba/smb.conf Edit the file - using superuser privilige - insert below content and save the file (need superuser). If you are connecting an existing network of servers change the WORKGROUP to match the existing network. [global] workgroup = MANJARO server string = Manjaro Samba Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2 max protocol = SMB3 [public] path = /srv/samba/share-name public = yes writable = yes printable = no","title":"Basic Server configuration"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#test-your-config","text":"sudo testparm /etc/samba/smb.conf","title":"Test your config"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#create-share-and-set-permissions","text":"To share e.g. removable devices you need to mount the devices. This is best done using using systemd mount and if removable create both mount and automount unit. https://forum.manjaro.org/t/root-tip-use-systemd-to-mount-any-device/1185 Create the shared folder sudo mkdir -p /srv/samba/share-name Set permissions to any and all sudo chmod -R ugo+rw /srv/samba/share-name","title":"Create share and set permissions"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#start-the-services","text":"sudo systemctl enable --now smb nmb","title":"Start the services"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#troubleshooting","text":"Did you remember to add users to the service? Samba users can be added independently from system users by using smbpasswd -a $USERNAME Samba documentation on https://www.samba.org/samba/docs/current/man-html/smbpasswd.8.html","title":"Troubleshooting"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#access-control-lists-aka-acl","text":"Missing r/w access due to permissions. In essence, it was similar to this issue . Simple solution is to remove your share and create it again. And no need to change tdbsam to smbpasswd . -- Credit @openminded","title":"Access Control Lists aka ACL"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#apparmor-when-serving-samba-shares","text":"Some eitions of Manjaro comes with AppArmor enabled (snap support) which may lead to issues when samba is updated. In such case you can use the following quick fix sudo aa-complain /etc/apparmor.d/usr.sbin.smbd Now proceed to reading documentation on AppArmor especially the section on editing AppArmor profiles for a better and more long-term solution. -- Credit @openminded On [date=2022-09-03 timezone=\"Europe/Copenhagen\"] @0xbeaf contributed this comment on another topic and has been added here to complement this section. Changes to how samba does rpc seems to be the main culprit. Since it is using multiple new executable files to delegate its jobs, new profiles and overrides for apparmor needs to be added. I had to add override rules for usr.sbin.smbd , samba-dcerpcd , samba-rpcd and samba-rpcd-classic . To get rid of all DENIED error messages in apparmor log, I had to add one more entity to profile rules. E.g. to whitelist the path /tank/anbaar , I added the following to all above-mentioned profiles in /etc/apparmor.d/local : ini /tank/anbaar lrwk, /tank/anbaar/ lrwk, /tank/anbaar/** lrwk, * Additionally, /usr/share/samba and /var/cache/samba had to be whitelisted for samba-rpcd so avahi service could properly work with a macOS machine so that it could automatically find and mount the TimeMachine share-points!!! Helpful links: https://ubuntu.com/server/docs/security-apparmor https://gitlab.com/apparmor/apparmor/-/wikis/AppArmor_Core_Policy_Reference https://bugs.archlinux.org/task/74614 https://gitlab.com/apparmor/apparmor/-/merge_requests/871","title":"AppArmor when serving samba shares"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#client","text":"Samba client requires the file /etc/samba/smb.conf even if it is empty. sudo mkdir -p /etc/samba sudo touch /etc/samba/smb.conf","title":"Client"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#browse-available-shares","text":"It is not possible to browse shares by using the service name SMB1 has been removed for security reasons. This also removed the possibliity to browse a server for avaliable shares. The removal enhances the resistance against ransomware and other malware propagating over the network. $ smbclient -L {host|ip} -U% Sharename Type Comment --------- ---- ------- public Disk IPC$ IPC IPC Service (Manjaro Samba Server) SMB1 disabled -- no workgroup available Netbios requests has been disabled due to the vulnerabilities thus highly improving restance against ransomware abusing the service to spread itself. Always connect to the share directly smbclient //{host|ip}/public Using a file manager you may need to add username to the request e.g. smb://username@service/sharename and provide the password. Only then you will be able to see what other shares the service provides.","title":"Browse available shares"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#initial-share-lookup","text":"If you find browsing the network from your filemanager is not possible issues it may be helpful to add the following content - replace the WORKGROUP if necessary [global] workgroup = WORKGROUP You may get messages like Failed to retrieve share list from server: No such file or directory The specified location is not mounted","title":"Initial share lookup"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#samba-protocol-version","text":"Upstream Samba disabled SMB1 due to a vulnerability exploited by a widespread ransomware. Yet many ISP provided routers has not been upgraded and you may have difficulties connecting the router's samba service using a default samba client. To gain access to such share you need to add a samba configuration which sole purpose is to enable the deprecated samba version. Add the following line in the [global] section of the configuration file [global] client min protocol = NT1","title":"Samba protocol version"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#arch-wiki","text":"WINS host names Manual Mountiing The options uid and gid corresponds to the local (e.g. client) user / user group to have read/write access on the given path. Note: If the uid and gid being used does not match the user of the server, the forceuid and forcegid options may be helpful. However note permissions assigned to a file when forceuid or forcegid are in effect may not reflect the the real (server) permissions. See the File And Directory Ownership And Permissions section in mount.cifs(8) \u00a7 FILE AND DIRECTORY OWNERSHIP AND PERMISSIONS for more information. To mount a Windows share without authentication, use \"username=*\" . Warning: Using uid and/or gid as mount options may cause I/O errors, it is recommended to set/check correct File permissions and attributes instead. -- Arch Wiki","title":"Arch Wiki"},{"location":"manjaro/samba/samba-basic-setup-and-troubleshooting/#more-reading","text":"My notepad [[0]] Samba website [[1]] LAN IP utility script [[2]] Using systemd mount units [[3]] Sample mount units [[4]] Samba on Arch Wiki [[5]] Sample Samba configuration with comments [[6]] Microsoft's documentation [[7]] GIO mount SMB utility script [[8]] AppArmor Arch Linux Wiki [[13]]","title":"More reading"},{"location":"manjaro/samba/samba-from-scratch/","text":"Difficulty: \u2605\u2605\u2605\u2605\u2606 Samba File Server From Scratch Goal The exercise is to setup Samba to share different content for different audiences using an Arch Linux based OS. The bar is set high as the configuration is done from scratch using a SSH terminal session to the target system. It will also require understanding of the Access Control List in a GNU/Linux system as well as networking concepts. The final setup will provide the following features Users and groups * user:admin group:admin home:admin * user:hans group:users,office (no-shell, no-home) * user:grete group:users,admin (no-shell, no-home) Shares * public share * authenticated users can edit files * guests can read files * document share * stored on local root partition accessible to authenticated users * files may be edited by users belonging to the admin group * office users can only read the documents * music library (administrated by the dedicated admin) * stored on external partition - in this case an USB stick Prerequisite A minmal Arch Linux based server - with a valid network configuration accessible using SSH. The Samba documentation at Arch Wiki . On your workstation add a hosts entry to simplify connection - I use a Raspberry Pi named rpi so throughout this document uses rpi as a reference to the Samba server. If you don't know the IP of your device - you can find it using nmap to scan network for devices exposing an open port 22 nmap -p 22 --open ip.x.y.z/24 Depending on your network and your device IP and name - adapt the following to your usecase echo \"ip.x.y.z rpi\" | sudo tee -a /etc/hosts Preparation Create a new ssh session to your server system. ssh username@rpi Run a full system update and install the following packages samba , firewalld and micro sudo pacman -Syu samba firewalld micro Enable firewalld and configure the service for the home zone sudo systemctl enable --now firewalld sudo firewall-cmd --set-default-zone=home sudo firewall-cmd --permanent --add-service={samba,ssh} --zone=home Restart the system and reopen the ssh connection reboot data tree On the server we will store data in a designated tree starting from our system root ( / ) mkdir -p /data/office mkdir -p /data/media/music mkdir -p /data/public Visualised using tree # tree /data /data \u251c\u2500\u2500 media \u2502 \u2514\u2500\u2500 music \u251c\u2500\u2500 office \u2514\u2500\u2500 public Permissions office The office folder's permission should be editable by group with no access for other - including guests. chmod go+w,o-rx /data/office media The content of /data/media/music is stored on an external USB device, so initially there is no data. The device may or may not be attached, we will handle that later as this pose a challenge. The media folder has suitable permissions - no need to change. public The public folder is writable by group and readable for other chmod g+w /data/public The office group doesn't exist - so let's create it and assign the group to the documents folder. groupadd office chgrp office /data/office For the public folder we decided that authenticated users are allowed to write - guests are not. The default users group is perfect for this. chgrp users /data/public If you list the content of the data folder - you. # ls -l /data drwxr-xr-x 3 root root 4096 Aug 10 01:29 media drwxr-xr-x 2 root office 4096 Oct 16 10:40 office drwxrwxr-x 2 root users 4096 Oct 16 09:48 public ```` ### data protection To ensure we do not accidental enable folder traversel outside the shares we will use **bind** mounts. Mounting using **bind** is a simple and efficient method of making data from one folder available from another folder on the same system. The function is similar to symlink but you cannot create folder traversal using dots. We will create some corresponding folders in **/srv** and bind our data there. mkdir -p /srv/samba/data mkdir -p /srv/samba/public Open the file /etc/fstab with micro micro /etc/fstab Append the following lines /data /srv/samba/data none bind 0 0 /data/public /srv/samba/public none bind 0 0 Now execute a reload and mount everything systemctl daemon-reload mount -a When we list the **/srv/samba** we see how our changes to the data folders is reflected in share tree ls -l /srv/samba drwxr-xr-x 5 root root 4096 Oct 16 10:40 data drwxrwxr-x 2 root users 4096 Oct 16 09:48 public ls -l /srv/samba/data drwxr-xr-x 3 root root 4096 Aug 10 01:29 media drwxr-xr-x 2 root office 4096 Oct 16 10:40 office drwxrwxr-x 2 root users 4096 Oct 16 09:48 public And the tree /srv/samba \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 media \u2502 \u2502 \u2514\u2500\u2500 music \u2502 \u251c\u2500\u2500 office \u2502 \u2514\u2500\u2500 public \u2514\u2500\u2500 public ## Basic samba configuration In your shell session switch to root session - so we don't have to prepend everything with sudo. su -l root Locate the samba configuration folder on your pi cd /etc/samba Samba is always configured from scratch - there is no default config, it must be created before you can start the service. The micro editor is terminal editor with support for copy/paste and other well known editor shortcuts. In the samba configuration folder start micro and create the required configuration **smb.conf** micro smb.conf We start by defining two sections **global** configuration and **public** share configuration [global] workgroup = WORKGROUP server string = Samba File Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2_02 # Think ransomware - you don't wannacry [public] path = /srv/samba/public public = yes writable = yes printable = no Run the command `testparm` to ensure your smb.conf is free from spelling errors then start the service. testparm -s If you are curios about smb.conf - try this testparm -s -v > ~/smb-defaults.txt | micro ### public share Verify the public share by opening the file manager on your workstation. Use **Ctrl+L** and input `smb://ip.x.y.z/public` then press **Enter** Login using the anonymous method. Try creating new file - you should expect access denied. Then go back to your shell and create an empty text file in public folder. touch /data/public/test.txt Go back to your file manager press **F5** to reveal the new file. All good - now unmount the public share from the file manager and reopen the share - this time login using the username and credentials from your ssh session - this time edit the file and save it. Did you get access denied once more? Good - this is expected behavior as there is no users in the samba trust database. Unmount the public share using the eject button in the file manager. ## user - samba vs. system **It is very important to remember** - a system user is not a samba user - a samba user requires a system user If you change your user password you either remember two passwords or change using `smbpasswd` for your username. To enable passwd sync maintenance from samba to system - add this to the global section of `smb.conf` [global] .... obey pam restrictions = yes unix password sync = yes passwd program = /usr/bin/passwd %u passwd chat = New UNIX password %n\\n ReType new UNIX password %n\\n passwd: all authentication tokens updated successfully pam password change = yes .... Any changes to smb.conf requires the service to be restarted and as a precaution always test the config before restarting. Using this command will prevent samba from restarting if the testparm command fails testparm && systemctl restart smb ### anonymous user **Anonymous users is a security risk.** You have no control over the content on your share. This is bad - very, very bad - think ransomware - you don't *wannacry* :sob: If you - despite all warnings - must create a public share with no restrictions refer to [Samba Usage][2] on Arch Wiki. ### authenticated user Remember the leading sentence for this section - **a system user is not a samba user**. Since our service should allow authenticated users to create content in the public folder - let us start easy with your ssh username. smbpasswd -a your-user In your file manager mount the share again - this time using your ssh user and the samba password. Open the empty file - enter some text and save it. Try creating some new content on the public share. This time you are authenticated and thus allowed to make changes. Remove your test content from the share and unmount. ### creating users - add to samba Our server is a file server only and as such - besides the admin - users has no use for home folder and they don't need shell access. Our challenge includes and administrator and two distinct authenticated users with access to the documents folder. * *users* group can read/write public content * *office* group can read documents * *admin* group can read/write all content As we configured samba using **unix password sync = yes** samba will sync the password back to the system. #### creating users A designated administrator of shared content. The user has system login permissions and a home folder useradd --create-home --user-group --groups office,users --shell /bin/bash admin smbpasswd -a admin A user named *hans* in group *office* with no shell, no home and no personal group useradd --no-create-home --no-user-group --groups office -s /bin/nologin hans smbpasswd -a hans Let's create the office user - name *grete* with no shell, no home, no personal group but a supplementary group *office* useradd --no-create-home --no-user-group --groups admin --shell /bin/nologin grete smbpasswd -a grete ### admin user permissions When you list the content of the `/data` folder, `root` is listed as owner - but we have our dedicated admin. Let's change the group for */data* root to admin - allowing admin to create new folders chgrp admin /data Next we change the owner of content inside */data/* - you did remove the test files - right? Otherwise the owner will change for those as well. chown admin /data/* -R ## the data share Edit your samba configuration and add the following section [data] path = /srv/samba/data public = no writable = yes printable = no guest ok = no Test the config testparm -s restart the service systemctl restart smb On your workstation open a terminal and run smbclient -L rpi -U admin Password for [WORKGROUP\\admin]: Sharename Type Comment --------- ---- ------- public Disk data Disk IPC$ IPC IPC Service (Samba File Server) SMB1 disabled -- no workgroup available ## the media share The media share resides on a removable device and we want the device to be mounted all times. The problem with removable devices is - they are removable - which is a challenge to be solved. We will face this challenge using systemd units. We need the UUID of the partition we want to mount - so attach the device to the Raspberry Pi and list the available block devices lsblk -A lsblk -A NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 1 28,8G 0 disk \u2514\u2500sda1 8:1 1 28,8G 0 part mmcblk0 179:0 0 14,6G 0 disk \u251c\u2500mmcblk0p1 179:1 0 457,8M 0 part /boot \u2514\u2500mmcblk0p2 179:2 0 14,1G 0 part /srv/samba/public /srv/samba/data / The partition is /dev/sda1 - let's get the UUID and pipe it to the unit file. lsblk -no UUID /dev/sda1 > /etc/systemd/system/data-media-music.mount systemd mount unit naming convention is to use the mountpoint as filename replacing **/** with **-**. In our case we have placed the music files in the folder **/data/media/music** so this is where we mount the partition. Open the unit file using micro micro /etc/systemd/system/data-media-music.mount Alter the content to match below - arrange for you UUID which is unique for my system to end the line *What=/dev/disk/by-uuid/*. (do not add spaces before or after the equal sign **=** and observe the casing of properties) [Unit] Description=USB stick with music files [Mount] What=/dev/disk/by-uuid/some-uuid-from-yoursystem Where=/data/media/music Type= Options=defaults.rw.noatime [Install] WantedBy=multi-user.target Now we create unit which takes care of mount the partition when it is needed. The same rule on filename applies - but the extension is *.automount* micro /etc/systemd/system/data-media-music.automount The content of the automount is as follow [Unit] Description=USB stick with music files ConditionPathExists=/data/media/music [Automount] Where=/data/media/music TimeoutIdleSec=300 [Install] WantedBy=multi-user.target All that is left now is to enable the automount unit systemctl enable --now data-media-music.automount To share the music folder on a common sharepoint - edit your smb.conf and add the following section [music] path = /srv/samba/data/media/music public = yes printable = no guest ok = yes Test your configuration testparm -s Restart the service systemctl restart smb ``` Posted at * https://forum.endeavouros.com/t/samba-server-from-scratch/33322 * https://forum.manjaro.org/t/root-tip-how-to-samba-server-from-scratch/125550","title":"Samba From Scratch"},{"location":"manjaro/samba/samba-from-scratch/#samba-file-server-from-scratch","text":"","title":"Samba File Server From Scratch"},{"location":"manjaro/samba/samba-from-scratch/#goal","text":"The exercise is to setup Samba to share different content for different audiences using an Arch Linux based OS. The bar is set high as the configuration is done from scratch using a SSH terminal session to the target system. It will also require understanding of the Access Control List in a GNU/Linux system as well as networking concepts. The final setup will provide the following features Users and groups * user:admin group:admin home:admin * user:hans group:users,office (no-shell, no-home) * user:grete group:users,admin (no-shell, no-home) Shares * public share * authenticated users can edit files * guests can read files * document share * stored on local root partition accessible to authenticated users * files may be edited by users belonging to the admin group * office users can only read the documents * music library (administrated by the dedicated admin) * stored on external partition - in this case an USB stick","title":"Goal"},{"location":"manjaro/samba/samba-from-scratch/#prerequisite","text":"A minmal Arch Linux based server - with a valid network configuration accessible using SSH. The Samba documentation at Arch Wiki . On your workstation add a hosts entry to simplify connection - I use a Raspberry Pi named rpi so throughout this document uses rpi as a reference to the Samba server. If you don't know the IP of your device - you can find it using nmap to scan network for devices exposing an open port 22 nmap -p 22 --open ip.x.y.z/24 Depending on your network and your device IP and name - adapt the following to your usecase echo \"ip.x.y.z rpi\" | sudo tee -a /etc/hosts","title":"Prerequisite"},{"location":"manjaro/samba/samba-from-scratch/#preparation","text":"Create a new ssh session to your server system. ssh username@rpi Run a full system update and install the following packages samba , firewalld and micro sudo pacman -Syu samba firewalld micro Enable firewalld and configure the service for the home zone sudo systemctl enable --now firewalld sudo firewall-cmd --set-default-zone=home sudo firewall-cmd --permanent --add-service={samba,ssh} --zone=home Restart the system and reopen the ssh connection reboot","title":"Preparation"},{"location":"manjaro/samba/samba-from-scratch/#data-tree","text":"On the server we will store data in a designated tree starting from our system root ( / ) mkdir -p /data/office mkdir -p /data/media/music mkdir -p /data/public Visualised using tree # tree /data /data \u251c\u2500\u2500 media \u2502 \u2514\u2500\u2500 music \u251c\u2500\u2500 office \u2514\u2500\u2500 public","title":"data tree"},{"location":"manjaro/samba/samba-from-scratch/#permissions","text":"","title":"Permissions"},{"location":"manjaro/samba/samba-from-scratch/#office","text":"The office folder's permission should be editable by group with no access for other - including guests. chmod go+w,o-rx /data/office","title":"office"},{"location":"manjaro/samba/samba-from-scratch/#media","text":"The content of /data/media/music is stored on an external USB device, so initially there is no data. The device may or may not be attached, we will handle that later as this pose a challenge. The media folder has suitable permissions - no need to change.","title":"media"},{"location":"manjaro/samba/samba-from-scratch/#public","text":"The public folder is writable by group and readable for other chmod g+w /data/public The office group doesn't exist - so let's create it and assign the group to the documents folder. groupadd office chgrp office /data/office For the public folder we decided that authenticated users are allowed to write - guests are not. The default users group is perfect for this. chgrp users /data/public If you list the content of the data folder - you. # ls -l /data drwxr-xr-x 3 root root 4096 Aug 10 01:29 media drwxr-xr-x 2 root office 4096 Oct 16 10:40 office drwxrwxr-x 2 root users 4096 Oct 16 09:48 public ```` ### data protection To ensure we do not accidental enable folder traversel outside the shares we will use **bind** mounts. Mounting using **bind** is a simple and efficient method of making data from one folder available from another folder on the same system. The function is similar to symlink but you cannot create folder traversal using dots. We will create some corresponding folders in **/srv** and bind our data there. mkdir -p /srv/samba/data mkdir -p /srv/samba/public Open the file /etc/fstab with micro micro /etc/fstab Append the following lines /data /srv/samba/data none bind 0 0 /data/public /srv/samba/public none bind 0 0 Now execute a reload and mount everything systemctl daemon-reload mount -a When we list the **/srv/samba** we see how our changes to the data folders is reflected in share tree","title":"public"},{"location":"manjaro/samba/samba-from-scratch/#ls-l-srvsamba","text":"drwxr-xr-x 5 root root 4096 Oct 16 10:40 data drwxrwxr-x 2 root users 4096 Oct 16 09:48 public","title":"ls -l /srv/samba"},{"location":"manjaro/samba/samba-from-scratch/#ls-l-srvsambadata","text":"drwxr-xr-x 3 root root 4096 Aug 10 01:29 media drwxr-xr-x 2 root office 4096 Oct 16 10:40 office drwxrwxr-x 2 root users 4096 Oct 16 09:48 public And the tree /srv/samba \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 media \u2502 \u2502 \u2514\u2500\u2500 music \u2502 \u251c\u2500\u2500 office \u2502 \u2514\u2500\u2500 public \u2514\u2500\u2500 public ## Basic samba configuration In your shell session switch to root session - so we don't have to prepend everything with sudo. su -l root Locate the samba configuration folder on your pi cd /etc/samba Samba is always configured from scratch - there is no default config, it must be created before you can start the service. The micro editor is terminal editor with support for copy/paste and other well known editor shortcuts. In the samba configuration folder start micro and create the required configuration **smb.conf** micro smb.conf We start by defining two sections **global** configuration and **public** share configuration [global] workgroup = WORKGROUP server string = Samba File Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2_02 # Think ransomware - you don't wannacry [public] path = /srv/samba/public public = yes writable = yes printable = no Run the command `testparm` to ensure your smb.conf is free from spelling errors then start the service. testparm -s If you are curios about smb.conf - try this testparm -s -v > ~/smb-defaults.txt | micro ### public share Verify the public share by opening the file manager on your workstation. Use **Ctrl+L** and input `smb://ip.x.y.z/public` then press **Enter** Login using the anonymous method. Try creating new file - you should expect access denied. Then go back to your shell and create an empty text file in public folder. touch /data/public/test.txt Go back to your file manager press **F5** to reveal the new file. All good - now unmount the public share from the file manager and reopen the share - this time login using the username and credentials from your ssh session - this time edit the file and save it. Did you get access denied once more? Good - this is expected behavior as there is no users in the samba trust database. Unmount the public share using the eject button in the file manager. ## user - samba vs. system **It is very important to remember** - a system user is not a samba user - a samba user requires a system user If you change your user password you either remember two passwords or change using `smbpasswd` for your username. To enable passwd sync maintenance from samba to system - add this to the global section of `smb.conf` [global] .... obey pam restrictions = yes unix password sync = yes passwd program = /usr/bin/passwd %u passwd chat = New UNIX password %n\\n ReType new UNIX password %n\\n passwd: all authentication tokens updated successfully pam password change = yes .... Any changes to smb.conf requires the service to be restarted and as a precaution always test the config before restarting. Using this command will prevent samba from restarting if the testparm command fails testparm && systemctl restart smb ### anonymous user **Anonymous users is a security risk.** You have no control over the content on your share. This is bad - very, very bad - think ransomware - you don't *wannacry* :sob: If you - despite all warnings - must create a public share with no restrictions refer to [Samba Usage][2] on Arch Wiki. ### authenticated user Remember the leading sentence for this section - **a system user is not a samba user**. Since our service should allow authenticated users to create content in the public folder - let us start easy with your ssh username. smbpasswd -a your-user In your file manager mount the share again - this time using your ssh user and the samba password. Open the empty file - enter some text and save it. Try creating some new content on the public share. This time you are authenticated and thus allowed to make changes. Remove your test content from the share and unmount. ### creating users - add to samba Our server is a file server only and as such - besides the admin - users has no use for home folder and they don't need shell access. Our challenge includes and administrator and two distinct authenticated users with access to the documents folder. * *users* group can read/write public content * *office* group can read documents * *admin* group can read/write all content As we configured samba using **unix password sync = yes** samba will sync the password back to the system. #### creating users A designated administrator of shared content. The user has system login permissions and a home folder useradd --create-home --user-group --groups office,users --shell /bin/bash admin smbpasswd -a admin A user named *hans* in group *office* with no shell, no home and no personal group useradd --no-create-home --no-user-group --groups office -s /bin/nologin hans smbpasswd -a hans Let's create the office user - name *grete* with no shell, no home, no personal group but a supplementary group *office* useradd --no-create-home --no-user-group --groups admin --shell /bin/nologin grete smbpasswd -a grete ### admin user permissions When you list the content of the `/data` folder, `root` is listed as owner - but we have our dedicated admin. Let's change the group for */data* root to admin - allowing admin to create new folders chgrp admin /data Next we change the owner of content inside */data/* - you did remove the test files - right? Otherwise the owner will change for those as well. chown admin /data/* -R ## the data share Edit your samba configuration and add the following section [data] path = /srv/samba/data public = no writable = yes printable = no guest ok = no Test the config testparm -s restart the service systemctl restart smb On your workstation open a terminal and run smbclient -L rpi -U admin Password for [WORKGROUP\\admin]: Sharename Type Comment --------- ---- ------- public Disk data Disk IPC$ IPC IPC Service (Samba File Server) SMB1 disabled -- no workgroup available ## the media share The media share resides on a removable device and we want the device to be mounted all times. The problem with removable devices is - they are removable - which is a challenge to be solved. We will face this challenge using systemd units. We need the UUID of the partition we want to mount - so attach the device to the Raspberry Pi and list the available block devices","title":"ls -l /srv/samba/data"},{"location":"manjaro/samba/samba-from-scratch/#lsblk-a","text":"lsblk -A NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 1 28,8G 0 disk \u2514\u2500sda1 8:1 1 28,8G 0 part mmcblk0 179:0 0 14,6G 0 disk \u251c\u2500mmcblk0p1 179:1 0 457,8M 0 part /boot \u2514\u2500mmcblk0p2 179:2 0 14,1G 0 part /srv/samba/public /srv/samba/data / The partition is /dev/sda1 - let's get the UUID and pipe it to the unit file. lsblk -no UUID /dev/sda1 > /etc/systemd/system/data-media-music.mount systemd mount unit naming convention is to use the mountpoint as filename replacing **/** with **-**. In our case we have placed the music files in the folder **/data/media/music** so this is where we mount the partition. Open the unit file using micro micro /etc/systemd/system/data-media-music.mount Alter the content to match below - arrange for you UUID which is unique for my system to end the line *What=/dev/disk/by-uuid/*. (do not add spaces before or after the equal sign **=** and observe the casing of properties) [Unit] Description=USB stick with music files [Mount] What=/dev/disk/by-uuid/some-uuid-from-yoursystem Where=/data/media/music","title":"lsblk -A"},{"location":"manjaro/samba/samba-from-scratch/#type","text":"Options=defaults.rw.noatime [Install] WantedBy=multi-user.target Now we create unit which takes care of mount the partition when it is needed. The same rule on filename applies - but the extension is *.automount* micro /etc/systemd/system/data-media-music.automount The content of the automount is as follow [Unit] Description=USB stick with music files ConditionPathExists=/data/media/music [Automount] Where=/data/media/music TimeoutIdleSec=300 [Install] WantedBy=multi-user.target All that is left now is to enable the automount unit systemctl enable --now data-media-music.automount To share the music folder on a common sharepoint - edit your smb.conf and add the following section [music] path = /srv/samba/data/media/music public = yes printable = no guest ok = yes Test your configuration testparm -s Restart the service systemctl restart smb ``` Posted at * https://forum.endeavouros.com/t/samba-server-from-scratch/33322 * https://forum.manjaro.org/t/root-tip-how-to-samba-server-from-scratch/125550","title":"Type="},{"location":"manjaro/samba/samba-minimal-configuration/","text":"Minimal configuration for Manjaro Samba share Install samba package Ensure the samba package is installed and the system is fully updated. sudo pacman -Syu samba Basic configuration Create the config file /etc/samba/smb.conf sudo nano /etc/samba/smb.conf Insert the following and save the file [global] workgroup = Manjaro server string = Samba Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password [public] path = /srv/samba public = yes writable = yes printable = no Test your config sudo testparm /etc/samba/smb.conf Create share and set permissions Create the shared folder sudo mkdir -p /srv/samba Set permissions to any and all sudo chmod ugo+rwx /srv/samba -R Start the services sudo systemctl enable --now smb nmb Accessing the share Linux client Ensure you have the smbclient package installed. Open your file manager and enter the servername or IP address in a filemanager's location bar using the smb protocol smb://servername Windows client Access the share using the filemanager and input the servername in this format - it is of course possible to use the IP address as well. \\\\servername More reading Samba on Arch Wiki Sample Samba configuration with comments smb.conf on samba.org","title":"Minimal SMB configuration"},{"location":"manjaro/samba/samba-minimal-configuration/#minimal-configuration-for-manjaro-samba-share","text":"","title":"Minimal configuration for Manjaro Samba share"},{"location":"manjaro/samba/samba-minimal-configuration/#install-samba-package","text":"Ensure the samba package is installed and the system is fully updated. sudo pacman -Syu samba","title":"Install samba package"},{"location":"manjaro/samba/samba-minimal-configuration/#basic-configuration","text":"Create the config file /etc/samba/smb.conf sudo nano /etc/samba/smb.conf Insert the following and save the file [global] workgroup = Manjaro server string = Samba Server server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password [public] path = /srv/samba public = yes writable = yes printable = no","title":"Basic configuration"},{"location":"manjaro/samba/samba-minimal-configuration/#test-your-config","text":"sudo testparm /etc/samba/smb.conf","title":"Test your config"},{"location":"manjaro/samba/samba-minimal-configuration/#create-share-and-set-permissions","text":"Create the shared folder sudo mkdir -p /srv/samba Set permissions to any and all sudo chmod ugo+rwx /srv/samba -R","title":"Create share and set permissions"},{"location":"manjaro/samba/samba-minimal-configuration/#start-the-services","text":"sudo systemctl enable --now smb nmb","title":"Start the services"},{"location":"manjaro/samba/samba-minimal-configuration/#accessing-the-share","text":"","title":"Accessing the share"},{"location":"manjaro/samba/samba-minimal-configuration/#linux-client","text":"Ensure you have the smbclient package installed. Open your file manager and enter the servername or IP address in a filemanager's location bar using the smb protocol smb://servername","title":"Linux client"},{"location":"manjaro/samba/samba-minimal-configuration/#windows-client","text":"Access the share using the filemanager and input the servername in this format - it is of course possible to use the IP address as well. \\\\servername","title":"Windows client"},{"location":"manjaro/samba/samba-minimal-configuration/#more-reading","text":"Samba on Arch Wiki Sample Samba configuration with comments smb.conf on samba.org","title":"More reading"},{"location":"manjaro/samba/samba-protocols-overview/","text":"Protocol availability client min protocol \u2013 This setting controls the minimum protocol version that the client will attempt to use. client max protocol \u2013 The value of the parameter (a string) is the highest protocol level that will be supported by the client. Available values SMB2: Re-implementation of the SMB protocol. Used by Windows Vista and later versions of Windows. SMB2 has sub protocols available: SMB2_02: The earliest SMB2 version. SMB2_10: Windows 7 SMB2 version. (By default SMB2 selects the SMB2_10 variant.) SMB2_22: Early Windows 8 SMB2 version. SMB2_24: Windows 8 beta SMB2 version. SMB3: The same as SMB2. Used by Windows 8. SMB3 has sub protocols available. SMB3_00: Windows 8 SMB3 version. (mostly the same as SMB2_24) SMB3_02: Windows 8.1 SMB3 version. SMB3_10: early Windows 10 technical preview SMB3 version. SMB3_11: Windows 10 technical preview SMB3 version (maybe final). By default SMB3 selects the SMB3_11 variant. !!!! This combination provides the optimal function !!!! client min version = SMB2 !!!! client max version = SMB 3 Due to the exploitation by ransomware SMBv1 has been disabled on a Linux or Unix samba server to avoid security issues. If you have a very old system - e.g. a router or a NAS which is no longer accessible NT1 can be assigned as protocol version.","title":"SMB protocols overview"},{"location":"manjaro/samba/samba-protocols-overview/#protocol-availability","text":"client min protocol \u2013 This setting controls the minimum protocol version that the client will attempt to use. client max protocol \u2013 The value of the parameter (a string) is the highest protocol level that will be supported by the client.","title":"Protocol availability"},{"location":"manjaro/samba/samba-protocols-overview/#available-values","text":"SMB2: Re-implementation of the SMB protocol. Used by Windows Vista and later versions of Windows. SMB2 has sub protocols available: SMB2_02: The earliest SMB2 version. SMB2_10: Windows 7 SMB2 version. (By default SMB2 selects the SMB2_10 variant.) SMB2_22: Early Windows 8 SMB2 version. SMB2_24: Windows 8 beta SMB2 version. SMB3: The same as SMB2. Used by Windows 8. SMB3 has sub protocols available. SMB3_00: Windows 8 SMB3 version. (mostly the same as SMB2_24) SMB3_02: Windows 8.1 SMB3 version. SMB3_10: early Windows 10 technical preview SMB3 version. SMB3_11: Windows 10 technical preview SMB3 version (maybe final). By default SMB3 selects the SMB3_11 variant. !!!! This combination provides the optimal function !!!! client min version = SMB2 !!!! client max version = SMB 3 Due to the exploitation by ransomware SMBv1 has been disabled on a Linux or Unix samba server to avoid security issues. If you have a very old system - e.g. a router or a NAS which is no longer accessible NT1 can be assigned as protocol version.","title":"Available values"},{"location":"manjaro/samba/samba-quick-setup-public-read-write-shares/","text":"Linux, Samba and NTFS !! The following is highly insecure as it allows any and all devices on the network - including ransomware - to access and write/rewrite your data - so be warned. Documenting how to handle NTFS formatted devices shared using Samba Mounting NTFS formatted devices On a designated server - open a terminal and switch to root context su -l root Create the following folders mkdir -p /srv/samba/ntfs /srv/samba/public Using the long listing format - list the content of /srv/samba - pay attention to the folder permissions # ls -l /srv/samba drwxr-xr-x 2 root root 4096 Feb 4 07:14 ntfs drwxr-xr-x 2 root root 4096 Feb 5 07:55 public Create a mount unit - mounting your ntfs formatted device in /srv/samba/ntfs (this is a documenthere so simply copy and paste into the terminal and press enter - use the nice copy button to right of the textbox) You must modify the first line to use the correct path for your device MYDEVICE_UUID=$(lsblk -no uuid /dev/sda1) cat << EOF > /etc/systemd/system/srv-samba-ntfs.mount [Unit] Description=Old Win Device [Mount] What=/dev/disk/by-uuid/$MYDEVICE_UUID Where=/srv/samba/ntfs Type=ntfs Options=defaults,rw,noatime [Install] WantedBy=multi-user.target EOF Start and enable the unit systemctl enable --now srv-samba-ntfs.mount Once again - using the long listing format - list the content of /srv/samba - pay attention to the ntfs folder permissions # ls -l /srv/samba total 8 drwxrwxrwx 1 root root 4096 Feb 4 08:18 ntfs drwxr-xr-x 2 root root 4096 Feb 5 07:55 public What we learned from this little exercise it that ntfs - just like vfat, exfat, fat32 et al. is a permissionless filesystem and when mounted any and all users on the system may write to the device with no regard whatsoever to the ownership and permissison on the mountpoint. Samba and NTFS On the designated server - install samba and avahi packages pacman -Syu samba avahi --needed Create the samba configuration file as follows (this is a documenthere so simply copy and paste into the terminal and press enter - use the nice copy button to right of the textbox). cat << EOF > /etc/samba/smb.conf [global] workgroup = MANJARO server string = Manjaro Samba Service server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2_02 obey pam restrictions = yes unix password sync = yes passwd program = /usr/bin/passwd %u passwd chat = *New*UNIX*password* %n\\n *ReType*new*UNIX*password* %n\\n *passwd:*all*authentication*tokens*updated*successfully* pam password change = yes [public] path = /srv/samba/public public = yes writable = yes printable = no [ntfs] path = /srv/samba/ntfs public = yes writable = yes printable = no EOF Then enable and start the services systemctl enable --now smb avahi-daemon Client access to Samba server On your client install the packages smbclient and avahi sudo pacman -Syu smbclient avahi --needed Start the avahi service sudo systemctl enable --now avahi-daemon Open your file manager -> Open the path navigator using Ctrl + L and input the address of your samba service. smb://ip.x.y.z Open the ntfs folder and create a new document Accessing Samba share from Windows That's all folks You didn't think it could be that simple did you?","title":"Samba Quick Setup public read-write shares"},{"location":"manjaro/samba/samba-quick-setup-public-read-write-shares/#linux-samba-and-ntfs","text":"!! The following is highly insecure as it allows any and all devices on the network - including ransomware - to access and write/rewrite your data - so be warned. Documenting how to handle NTFS formatted devices shared using Samba","title":"Linux, Samba and NTFS"},{"location":"manjaro/samba/samba-quick-setup-public-read-write-shares/#mounting-ntfs-formatted-devices","text":"On a designated server - open a terminal and switch to root context su -l root Create the following folders mkdir -p /srv/samba/ntfs /srv/samba/public Using the long listing format - list the content of /srv/samba - pay attention to the folder permissions # ls -l /srv/samba drwxr-xr-x 2 root root 4096 Feb 4 07:14 ntfs drwxr-xr-x 2 root root 4096 Feb 5 07:55 public Create a mount unit - mounting your ntfs formatted device in /srv/samba/ntfs (this is a documenthere so simply copy and paste into the terminal and press enter - use the nice copy button to right of the textbox) You must modify the first line to use the correct path for your device MYDEVICE_UUID=$(lsblk -no uuid /dev/sda1) cat << EOF > /etc/systemd/system/srv-samba-ntfs.mount [Unit] Description=Old Win Device [Mount] What=/dev/disk/by-uuid/$MYDEVICE_UUID Where=/srv/samba/ntfs Type=ntfs Options=defaults,rw,noatime [Install] WantedBy=multi-user.target EOF Start and enable the unit systemctl enable --now srv-samba-ntfs.mount Once again - using the long listing format - list the content of /srv/samba - pay attention to the ntfs folder permissions # ls -l /srv/samba total 8 drwxrwxrwx 1 root root 4096 Feb 4 08:18 ntfs drwxr-xr-x 2 root root 4096 Feb 5 07:55 public What we learned from this little exercise it that ntfs - just like vfat, exfat, fat32 et al. is a permissionless filesystem and when mounted any and all users on the system may write to the device with no regard whatsoever to the ownership and permissison on the mountpoint.","title":"Mounting NTFS formatted devices"},{"location":"manjaro/samba/samba-quick-setup-public-read-write-shares/#samba-and-ntfs","text":"On the designated server - install samba and avahi packages pacman -Syu samba avahi --needed Create the samba configuration file as follows (this is a documenthere so simply copy and paste into the terminal and press enter - use the nice copy button to right of the textbox). cat << EOF > /etc/samba/smb.conf [global] workgroup = MANJARO server string = Manjaro Samba Service server role = standalone server log file = /var/log/samba/log.%m max log size = 50 guest account = nobody map to guest = Bad Password min protocol = SMB2_02 obey pam restrictions = yes unix password sync = yes passwd program = /usr/bin/passwd %u passwd chat = *New*UNIX*password* %n\\n *ReType*new*UNIX*password* %n\\n *passwd:*all*authentication*tokens*updated*successfully* pam password change = yes [public] path = /srv/samba/public public = yes writable = yes printable = no [ntfs] path = /srv/samba/ntfs public = yes writable = yes printable = no EOF Then enable and start the services systemctl enable --now smb avahi-daemon","title":"Samba and NTFS"},{"location":"manjaro/samba/samba-quick-setup-public-read-write-shares/#client-access-to-samba-server","text":"On your client install the packages smbclient and avahi sudo pacman -Syu smbclient avahi --needed Start the avahi service sudo systemctl enable --now avahi-daemon Open your file manager -> Open the path navigator using Ctrl + L and input the address of your samba service. smb://ip.x.y.z Open the ntfs folder and create a new document","title":"Client access to Samba server"},{"location":"manjaro/samba/samba-quick-setup-public-read-write-shares/#accessing-samba-share-from-windows","text":"","title":"Accessing Samba share from Windows"},{"location":"manjaro/samba/samba-quick-setup-public-read-write-shares/#thats-all-folks","text":"You didn't think it could be that simple did you?","title":"That's all folks"},{"location":"manjaro/scripts/script-arm-image-wifi-hack/","text":"Difficulty: \u2605\u2605\u2606\u2606\u2606 Preconfigure ARM WiFi The utility script preconfigures the sd-card to connect to WiFi at first boot. After you have written the installer image to your sd-card, run this script to configure a connection to your wifi Save the script on your system as e.g. wifi-hack.sh . The script takes 3 mandatory arguments but you can opt to create a static configuration add 3 more arguments. <blockdev> <ssid> <passphrase> [ <cidr> <gateway> <dns> ] With 3 arguments the wlan is setup using DHCP - with 6 arguments the wlan is configured for static addressing. Sample command line - adapt the configuration to your use case and ensure no conflicts using the IP address sudo bash wifi-hack.sh /dev/mmcblk0 my-ssid my-passphrase 192.168.1.10/24 192.168.1.1 192.168.1.1 #!/usr/bin/env bash # # Script to preconfigure ARM installer for WiFi connection # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # root.nix.dk # set -e scriptname=$0 tmproot=\"/tmp/root\" usage(){ # <blockdev> <ssid> <passphrase> [ <cidr> <gateway> <dns> ] echo \"Usage: sudo ${scriptname} <blockdev> <ssid> <passphrase> [ <cidr> <gateway> <dns> ]\" exit 1 } # run as root if ! [[ $(whoami) == \"root\" ]] ; then echo \"Run script as root using su or sudo\" exit 1 fi # check if arg1 is block device if ! [[ -b $\"$1\" ]]; then echo \"'$1' is not a block devicce\" exit 1 fi # mount partition echo Mount sd-card root partition mkdir -p \"${tmproot}\" mount \"$1\"p2 \"${tmproot}\" # create wlan0 network # if we have 3 arguments - use dhcp if [[ $# -eq 3 ]] ; then cat << EOF >> \"${tmproot}/etc/systemd/network/wlan0.network\" [Match] Name=wlan0 [Network] DHCP=yes EOF # if we have 6 arguments - static ip elif [[ $# -eq 6 ]]; then cat << EOF >> \"${tmproot}/etc/systemd/network/wlan0.network\" [Match] Name=wlan0 [Network] Address=$4 Gateway=$5 DNS=$6 EOF # argument count must be either 3 or 6 else usage fi # create wpa_supplicant.conf wpa_passphrase \"$2\" \"$3\" > \"${tmproot}/etc/wpa_supplicant/wpa_supplicant-wlan0.conf\" # create symlink for wlan0 service ln -sf \"/usr/lib/systemd/system/wpa_supplicant0.service\" \\ \"${tmproot}/etc/systemd/system/multi-user.target.wants/wpa_supplicant@wlan0.service\" # unmount and clean up echo Unmounting umount ${tmproot} echo Cleaning up rmdir ${tmproot} echo Done Posted at * https://forum.manjaro.org/t/root-tip-how-to-utility-script-preconfigure-arm-installer-for-wifi/124240 * https://forum.endeavouros.com/t/hacking-arm-image-for-wifi-config/32888","title":"Arch ARM image WiFi hack"},{"location":"manjaro/scripts/script-arm-image-wifi-hack/#preconfigure-arm-wifi","text":"The utility script preconfigures the sd-card to connect to WiFi at first boot. After you have written the installer image to your sd-card, run this script to configure a connection to your wifi Save the script on your system as e.g. wifi-hack.sh . The script takes 3 mandatory arguments but you can opt to create a static configuration add 3 more arguments. <blockdev> <ssid> <passphrase> [ <cidr> <gateway> <dns> ] With 3 arguments the wlan is setup using DHCP - with 6 arguments the wlan is configured for static addressing. Sample command line - adapt the configuration to your use case and ensure no conflicts using the IP address sudo bash wifi-hack.sh /dev/mmcblk0 my-ssid my-passphrase 192.168.1.10/24 192.168.1.1 192.168.1.1 #!/usr/bin/env bash # # Script to preconfigure ARM installer for WiFi connection # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # root.nix.dk # set -e scriptname=$0 tmproot=\"/tmp/root\" usage(){ # <blockdev> <ssid> <passphrase> [ <cidr> <gateway> <dns> ] echo \"Usage: sudo ${scriptname} <blockdev> <ssid> <passphrase> [ <cidr> <gateway> <dns> ]\" exit 1 } # run as root if ! [[ $(whoami) == \"root\" ]] ; then echo \"Run script as root using su or sudo\" exit 1 fi # check if arg1 is block device if ! [[ -b $\"$1\" ]]; then echo \"'$1' is not a block devicce\" exit 1 fi # mount partition echo Mount sd-card root partition mkdir -p \"${tmproot}\" mount \"$1\"p2 \"${tmproot}\" # create wlan0 network # if we have 3 arguments - use dhcp if [[ $# -eq 3 ]] ; then cat << EOF >> \"${tmproot}/etc/systemd/network/wlan0.network\" [Match] Name=wlan0 [Network] DHCP=yes EOF # if we have 6 arguments - static ip elif [[ $# -eq 6 ]]; then cat << EOF >> \"${tmproot}/etc/systemd/network/wlan0.network\" [Match] Name=wlan0 [Network] Address=$4 Gateway=$5 DNS=$6 EOF # argument count must be either 3 or 6 else usage fi # create wpa_supplicant.conf wpa_passphrase \"$2\" \"$3\" > \"${tmproot}/etc/wpa_supplicant/wpa_supplicant-wlan0.conf\" # create symlink for wlan0 service ln -sf \"/usr/lib/systemd/system/wpa_supplicant0.service\" \\ \"${tmproot}/etc/systemd/system/multi-user.target.wants/wpa_supplicant@wlan0.service\" # unmount and clean up echo Unmounting umount ${tmproot} echo Cleaning up rmdir ${tmproot} echo Done Posted at * https://forum.manjaro.org/t/root-tip-how-to-utility-script-preconfigure-arm-installer-for-wifi/124240 * https://forum.endeavouros.com/t/hacking-arm-image-for-wifi-config/32888","title":"Preconfigure ARM WiFi"},{"location":"manjaro/scripts/script-battery-charge-notifier/","text":"A recent topic caused me to add the following script to my toolbox. The script is configurable and uses an interval and lower/upper threshold for battery. The script utilizes libnotify to send a system message when outside the limits - thus ensuring you don't forget to plug or unplug your laptop charger. Script Create the local bin folder mkdir ~/.local/bin Create a new file and make it executable touch ~/.local/bin/charge-notify.sh && chmod +x ~/.local/bin/charge-notify.sh Edit the file with kate or another editor xdg-open ~/.local/bin/charge-notify.sh Paste below content and save #! /bin/bash # # Script to notify when battery is outside levels - time to plug charger. # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>.# # # Source: https://linoxide.com/remind-unplug-charging-laptop-arch-linux # # https://forum.manjaro.org/t/set-up-an-alarm-notification-when-battery-reaches-full-charge/92331 # # @linux-aarhus - root.nix.dk # # 2021-11-27 # 2021-11-28 revised - checks not updating # - fix variable check on all levels # set -eu # dependency check if ! [[ \"$(which notify-send)\" =~ (notify-send) ]]; then echo \"Please install libnotify to use this script.\\n\" echo \" sudo pacman -S libnotify\" exit 1 fi if ! [[ \"$(which acpi)\" =~ (acpi) ]]; then echo \"Please install acpi to use this script.\\n\" echo \" sudo pacman -S acpi\" exit 1 fi # check interval (seconds) INTERVAL=30 # example battery levels # these leves are not based on scientific evidence # you are required to adjust as appropriate for your device MIN_BAT=10 # low water mark MAX_BAT=60 # high water mark get_plugged_state(){ echo $(cat /sys/bus/acpi/drivers/battery/*/power_supply/BAT?/status) } get_bat_percent(){ echo $(acpi|grep -Po \"[0-9]+(?=%)\") } # primary loop while true ; do if [ $(get_bat_percent) -le ${MIN_BAT} ]; then # Battery under low limit if [[ $(get_plugged_state) = \"Discharging\" ]]; then # plugged notify-send \"Battery below ${MIN_BAT}. Time to plug adapter\" fi fi if [ $(get_bat_percent) -ge ${MAX_BAT} ]; then # Battery over high limit if [[ $(get_plugged_state) = \"Charging\" ]]; then # plugged notify-send \"Battery above ${MAX_BAT}. Time to unplug adapter\" fi fi sleep ${INTERVAL} # Repeat every $INTERVAL seconds done Usage The battery levels are example levels. Edit the battery levels according to your system and preference. If in doubt please see below comments and do your own research. Launch the script using the systems autorun feature - each system does it differently :slight_smile: https://forum.manjaro.org/t/root-tip-charger-notifier-battery-state/92337","title":"Battery Charge Notifier"},{"location":"manjaro/scripts/script-battery-charge-notifier/#script","text":"Create the local bin folder mkdir ~/.local/bin Create a new file and make it executable touch ~/.local/bin/charge-notify.sh && chmod +x ~/.local/bin/charge-notify.sh Edit the file with kate or another editor xdg-open ~/.local/bin/charge-notify.sh Paste below content and save #! /bin/bash # # Script to notify when battery is outside levels - time to plug charger. # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>.# # # Source: https://linoxide.com/remind-unplug-charging-laptop-arch-linux # # https://forum.manjaro.org/t/set-up-an-alarm-notification-when-battery-reaches-full-charge/92331 # # @linux-aarhus - root.nix.dk # # 2021-11-27 # 2021-11-28 revised - checks not updating # - fix variable check on all levels # set -eu # dependency check if ! [[ \"$(which notify-send)\" =~ (notify-send) ]]; then echo \"Please install libnotify to use this script.\\n\" echo \" sudo pacman -S libnotify\" exit 1 fi if ! [[ \"$(which acpi)\" =~ (acpi) ]]; then echo \"Please install acpi to use this script.\\n\" echo \" sudo pacman -S acpi\" exit 1 fi # check interval (seconds) INTERVAL=30 # example battery levels # these leves are not based on scientific evidence # you are required to adjust as appropriate for your device MIN_BAT=10 # low water mark MAX_BAT=60 # high water mark get_plugged_state(){ echo $(cat /sys/bus/acpi/drivers/battery/*/power_supply/BAT?/status) } get_bat_percent(){ echo $(acpi|grep -Po \"[0-9]+(?=%)\") } # primary loop while true ; do if [ $(get_bat_percent) -le ${MIN_BAT} ]; then # Battery under low limit if [[ $(get_plugged_state) = \"Discharging\" ]]; then # plugged notify-send \"Battery below ${MIN_BAT}. Time to plug adapter\" fi fi if [ $(get_bat_percent) -ge ${MAX_BAT} ]; then # Battery over high limit if [[ $(get_plugged_state) = \"Charging\" ]]; then # plugged notify-send \"Battery above ${MAX_BAT}. Time to unplug adapter\" fi fi sleep ${INTERVAL} # Repeat every $INTERVAL seconds done","title":"Script"},{"location":"manjaro/scripts/script-battery-charge-notifier/#usage","text":"The battery levels are example levels. Edit the battery levels according to your system and preference. If in doubt please see below comments and do your own research. Launch the script using the systems autorun feature - each system does it differently :slight_smile: https://forum.manjaro.org/t/root-tip-charger-notifier-battery-state/92337","title":"Usage"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/","text":"!! ## AUR != Manjaro stable branch Test if you are AUR ready by running below snippet in a terminal if [[ $(pacman-mirrors -G) == 'stable' ]]; then echo 'AUR is a no-go'; else echo 'OK - go ahead'; fi The Arch way Every AUR build script page has a notification subscription -> in upper right box. This is a simple as it gets - when the script is updated you get a mail notification. But Pamac can do that? And you are correct - it can. Even so it has proven countless times this is a bad idea. An otherwise successful sync breaks due invalid AUR database You run into issues when a package and dependencies is demoted from repo to AUR Duplicate package names - where version in AUR is higher than official repo. [[Example 1][1]] [[Example 2][2]] That just a couple of stumbling points the last couple of months. So do yourself a favour and revert Pamac -> Preferences -> Third Party -> Check for updates to the default - which is disabled. Another fairly simple solutions is to run a script after login The check-aur.sh script The script requires yay to be installed sudo pacman -Syu yay !!! Due to a - @2023-05-09 - fair amount of open bugs with yay you may choose to use paru instead. Create a script - check-aur.sh - place it in ~/.local/bin and make it executable with content Notify script #!/usr/bin/env bash # # AUR buildscript update checker # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # 2022-12-20 # @linux-aarhus (c) root.nix.dk # 2023-05-09: added not on yay bugs # due to a fair amount of open bugs for yay https://github.com/Jguer/yay/issues # it may be due dilligence to change to paru # paru supports the same arguments as yay # simply change yay to paru in the script AurHelper=\"yay\" #check if yay is available if ! command -v ${AurHelper} > /dev/null; then echo \":: ${AurHelper} not found... please install\" exit 1 fi #check if libnotify is available if ! [[ \"$(which notify-send)\" =~ (notify-send) ]]; then echo \":: libnotify not found... (sudo pacman -S libnotify\" exit 1 fi aur_changed=$(${AurHelper} -Quaq) if ! [[ -z ${aur_changed} ]]; then if ! stty &>/dev/null; then notify-send -u normal \"Notification of AUR changes\" \"$aur_changed\" exit fi printf \"${aur_changed}\" fi Make the script executable chmod +x ~/.local/bin/check-aur.sh The script will do check if yay is installed - if not exit execute {paru|yay} -Quaq and store the response in a variable if there is any content in the response if run by a service use the system notification daemon to pop a notification if run from command line output to console autorun after login To run it one time after login create a user service file First create the service folder structure mkdir -p ~/.config/systemd/user Then create a file ~/.config/systemd/user/check-aur.service - paste the following content [Unit] Description=Check for changes to AUR my buildscrpts # wait for network After=syslog.target network.target default.target [Service] Type=simple ExecStartPre=/bin/sleep 30 ExecStart=/home/%u/.local/bin/check-aur.sh [Install] WantedBy=default.target Start the user service - do not use sudo systemctl --user enable check-aur.service After login the service will activate and do the following wait 30 seconds run the check-aur.sh script execute the script and exit oh-no no updates - what shall I make of my time If you are not satisfied with the popup shortly after login create a timer Do not flood AUR with useless traffic Create a complementary timer ~/.config/systemd/user/check-aur.timer with content - example is 4 hours [Unit] Description=Schedule AUR change checks [Timer] OnStartupSec=10m OnUnitActiveSec=4h [Install] WantedBy=timers.target The timer will do this wait until 10m after boot activate the check-aur.service re-activate the service every 4 hours while system is up When using a timer - you need to disable the service - otherwise the timer refuse to activate it. systemctl --user disable --now check-aur.service Then activate the timer systemctl --user enable --now check-aur.timer When you are notified When you use this notifier and you are notified - simply use your favorite AUR helper to rebuild the packages. Pamac works from command line too pamac build <scriptname> Rebuild all from the command line pamac build $(check-aur.sh) Rewritten notify script with IgnoredPkgs This example is from my system. I am using the dotnet-core-bin custom script to install dotnet 6 - because the the project I work on must have long term support. My issue is that the above script keeps informing me the package has been updated to dotnet 7 - which I - for the time being - do not need. So I rewrote the script be able to handle an array of ignored packages. One added benefit was the aquired bash array knowledge - never too old to learn - right? !!! Due to a - @2023-05-09 - fair amount of open bugs with yay I have added support for paru which - when available - will be preferred over yay. #!/usr/bin/env bash # # AUR buildscript update checker - optional ignore specific packages # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # 2023-04-15 # @linux-aarhus (c) root.nix.dk # Revision log # 2023-05-09: Added paru as supported helper - paru will be preferred over yay # : Rewrite comparison to arrays and fix missing content with libnotify # 2023-05-10: shellcheck validated # # # Ignore specific packages # e.g. IgnorePkgs=('pkg1' 'pkg2') IgnorePkgs=('dotnet-host-bin' 'dotnet-targeting-pack-bin' 'aspnet-targeting-pack-bin' 'aspnet-runtime-bin' 'dotnet-runtime-bin' 'dotnet-sdk-bin' 'netstandard-targeting-pack-bin') # to skip search set AurHelper to yay or paru AurHelper=\"paru\" if [[ -z ${AurHelper} ]]; then #check if paru is available if command -v paru > /dev/null; then AurHelper=\"paru\" fi if [[ -z ${AurHelper} ]]; then #check if yay is available if command -v yay > /dev/null; then AurHelper=\"yay\" fi fi if [[ -z ${AurHelper} ]]; then echo \"=> No AurHelper found\" echo \"=> supported helpers:\" echo \" --> yay: sudo pacman -S yay\" echo \" --> paru: pamac build paru-bin\" exit 1 fi fi #check if libnotify is available if ! [[ \"$(which notify-send)\" =~ (notify-send) ]]; then echo \":: libnotify not found... (sudo pacman -S libnotify)\" exit 1 fi # get changed scripts aur=$(${AurHelper} -Quaq) # setup arrays IFS=$'\\n' ignored=(\"$(sort <<<\"${IgnorePkgs[*]}\")\"); unset IFS IFS=$'\\n' changed=(\"$(sort <<<\"${aur[*]}\")\"); unset IFS # create a filtered array filtered=$(comm -13 <(printf \"%s\\n\" \"${ignored[@]}\") <(printf \"%s\\n\" \"${changed[@]}\")) # create the notification notification=$(for f in \"${filtered[@]}\"; do echo \"${f}\"; done) # display notification if the filtered array is not empty if [[ -n \"${notification}\" ]]; then if ! stty &>/dev/null; then notify-send -u normal \"Notification of AUR changes\" \"${notification}\" else echo \"${notification}\" fi fi","title":"Check AUR buildscript changes"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#the-arch-way","text":"Every AUR build script page has a notification subscription -> in upper right box. This is a simple as it gets - when the script is updated you get a mail notification.","title":"The Arch way"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#but-pamac-can-do-that","text":"And you are correct - it can. Even so it has proven countless times this is a bad idea. An otherwise successful sync breaks due invalid AUR database You run into issues when a package and dependencies is demoted from repo to AUR Duplicate package names - where version in AUR is higher than official repo. [[Example 1][1]] [[Example 2][2]] That just a couple of stumbling points the last couple of months. So do yourself a favour and revert Pamac -> Preferences -> Third Party -> Check for updates to the default - which is disabled. Another fairly simple solutions is to run a script after login","title":"But Pamac can do that?"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#the-check-aursh-script","text":"The script requires yay to be installed sudo pacman -Syu yay !!! Due to a - @2023-05-09 - fair amount of open bugs with yay you may choose to use paru instead. Create a script - check-aur.sh - place it in ~/.local/bin and make it executable with content","title":"The check-aur.sh script"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#notify-script","text":"#!/usr/bin/env bash # # AUR buildscript update checker # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # 2022-12-20 # @linux-aarhus (c) root.nix.dk # 2023-05-09: added not on yay bugs # due to a fair amount of open bugs for yay https://github.com/Jguer/yay/issues # it may be due dilligence to change to paru # paru supports the same arguments as yay # simply change yay to paru in the script AurHelper=\"yay\" #check if yay is available if ! command -v ${AurHelper} > /dev/null; then echo \":: ${AurHelper} not found... please install\" exit 1 fi #check if libnotify is available if ! [[ \"$(which notify-send)\" =~ (notify-send) ]]; then echo \":: libnotify not found... (sudo pacman -S libnotify\" exit 1 fi aur_changed=$(${AurHelper} -Quaq) if ! [[ -z ${aur_changed} ]]; then if ! stty &>/dev/null; then notify-send -u normal \"Notification of AUR changes\" \"$aur_changed\" exit fi printf \"${aur_changed}\" fi Make the script executable chmod +x ~/.local/bin/check-aur.sh The script will do check if yay is installed - if not exit execute {paru|yay} -Quaq and store the response in a variable if there is any content in the response if run by a service use the system notification daemon to pop a notification if run from command line output to console","title":"Notify script"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#autorun-after-login","text":"To run it one time after login create a user service file First create the service folder structure mkdir -p ~/.config/systemd/user Then create a file ~/.config/systemd/user/check-aur.service - paste the following content [Unit] Description=Check for changes to AUR my buildscrpts # wait for network After=syslog.target network.target default.target [Service] Type=simple ExecStartPre=/bin/sleep 30 ExecStart=/home/%u/.local/bin/check-aur.sh [Install] WantedBy=default.target Start the user service - do not use sudo systemctl --user enable check-aur.service After login the service will activate and do the following wait 30 seconds run the check-aur.sh script execute the script and exit","title":"autorun after login"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#oh-no-no-updates-what-shall-i-make-of-my-time","text":"If you are not satisfied with the popup shortly after login create a timer Do not flood AUR with useless traffic Create a complementary timer ~/.config/systemd/user/check-aur.timer with content - example is 4 hours [Unit] Description=Schedule AUR change checks [Timer] OnStartupSec=10m OnUnitActiveSec=4h [Install] WantedBy=timers.target The timer will do this wait until 10m after boot activate the check-aur.service re-activate the service every 4 hours while system is up When using a timer - you need to disable the service - otherwise the timer refuse to activate it. systemctl --user disable --now check-aur.service Then activate the timer systemctl --user enable --now check-aur.timer","title":"oh-no no updates - what shall I make of my time"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#when-you-are-notified","text":"When you use this notifier and you are notified - simply use your favorite AUR helper to rebuild the packages. Pamac works from command line too pamac build <scriptname> Rebuild all from the command line pamac build $(check-aur.sh)","title":"When you are notified"},{"location":"manjaro/scripts/script-check-aur-buildscript-changes/#rewritten-notify-script-with-ignoredpkgs","text":"This example is from my system. I am using the dotnet-core-bin custom script to install dotnet 6 - because the the project I work on must have long term support. My issue is that the above script keeps informing me the package has been updated to dotnet 7 - which I - for the time being - do not need. So I rewrote the script be able to handle an array of ignored packages. One added benefit was the aquired bash array knowledge - never too old to learn - right? !!! Due to a - @2023-05-09 - fair amount of open bugs with yay I have added support for paru which - when available - will be preferred over yay. #!/usr/bin/env bash # # AUR buildscript update checker - optional ignore specific packages # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # 2023-04-15 # @linux-aarhus (c) root.nix.dk # Revision log # 2023-05-09: Added paru as supported helper - paru will be preferred over yay # : Rewrite comparison to arrays and fix missing content with libnotify # 2023-05-10: shellcheck validated # # # Ignore specific packages # e.g. IgnorePkgs=('pkg1' 'pkg2') IgnorePkgs=('dotnet-host-bin' 'dotnet-targeting-pack-bin' 'aspnet-targeting-pack-bin' 'aspnet-runtime-bin' 'dotnet-runtime-bin' 'dotnet-sdk-bin' 'netstandard-targeting-pack-bin') # to skip search set AurHelper to yay or paru AurHelper=\"paru\" if [[ -z ${AurHelper} ]]; then #check if paru is available if command -v paru > /dev/null; then AurHelper=\"paru\" fi if [[ -z ${AurHelper} ]]; then #check if yay is available if command -v yay > /dev/null; then AurHelper=\"yay\" fi fi if [[ -z ${AurHelper} ]]; then echo \"=> No AurHelper found\" echo \"=> supported helpers:\" echo \" --> yay: sudo pacman -S yay\" echo \" --> paru: pamac build paru-bin\" exit 1 fi fi #check if libnotify is available if ! [[ \"$(which notify-send)\" =~ (notify-send) ]]; then echo \":: libnotify not found... (sudo pacman -S libnotify)\" exit 1 fi # get changed scripts aur=$(${AurHelper} -Quaq) # setup arrays IFS=$'\\n' ignored=(\"$(sort <<<\"${IgnorePkgs[*]}\")\"); unset IFS IFS=$'\\n' changed=(\"$(sort <<<\"${aur[*]}\")\"); unset IFS # create a filtered array filtered=$(comm -13 <(printf \"%s\\n\" \"${ignored[@]}\") <(printf \"%s\\n\" \"${changed[@]}\")) # create the notification notification=$(for f in \"${filtered[@]}\"; do echo \"${f}\"; done) # display notification if the filtered array is not empty if [[ -n \"${notification}\" ]]; then if ! stty &>/dev/null; then notify-send -u normal \"Notification of AUR changes\" \"${notification}\" else echo \"${notification}\" fi fi","title":"Rewritten notify script with IgnoredPkgs"},{"location":"manjaro/scripts/script-check-if-update-may-require-reboot/","text":"Sv\u00e6rhedsgrad: \u2605\u2605\u2606\u2606\u2606 Beskrivelse Ved visse system opdateringer vil det v\u00e6re n\u00f8dvendigt at genstarte systemet for at sikre problemfri funktion. Pakker som indholder cpu mikrocode , kerne , drivere , xorg og systemd er oplagte emner. Nedenfor er en liste over pakker som kan kr\u00e6ve en system genstart. Hvis du har andre pakker du ved vil kr\u00e6ve genstart kan du tilf\u00f8je dem til script variablen $reboot ucode cryptsetup linux nvidia mesa systemd wayland xf86-video xorg Utility script Scriptet bruger checkupdates og yay (for fremmede pakker) hvis den er installeret. En regex (regular expression) validerer om en system genstart skal foresl\u00e5es. #!/usr/bin/env bash reboot=\"(ucode|cryptsetup|linux|nvidia|mesa|systemd|wayland|xf86-video|xorg)\" if [[ $(which yay) =~ (yay) ]]; then updates=$(checkupdates; yay -Qua) else updates=$(checkupdates) fi echo \"$updates\" if [[ $updates =~ $reboot ]]; then echo \"Updating possibly requires system restart ...\" fi Anvendelse Scriptet skal ikke betrages som nogen autoritet - det tjener blot det form\u00e5l at foresl\u00e5 - f\u00f8r du installerer opdateringer - om en system genstart kan v\u00e6re en n\u00f8dvendighed. Tak til Inspiration fra @Kresimir og EndeavourOS forum [[1]] [[2]] og det endelige script [[3]] Publiceret p\u00e5 Manjaro Form","title":"Kontroller om genstart er n\u00f8dvendig f\u00f8r du opdaterer"},{"location":"manjaro/scripts/script-check-if-update-may-require-reboot/#beskrivelse","text":"Ved visse system opdateringer vil det v\u00e6re n\u00f8dvendigt at genstarte systemet for at sikre problemfri funktion. Pakker som indholder cpu mikrocode , kerne , drivere , xorg og systemd er oplagte emner. Nedenfor er en liste over pakker som kan kr\u00e6ve en system genstart. Hvis du har andre pakker du ved vil kr\u00e6ve genstart kan du tilf\u00f8je dem til script variablen $reboot ucode cryptsetup linux nvidia mesa systemd wayland xf86-video xorg","title":"Beskrivelse"},{"location":"manjaro/scripts/script-check-if-update-may-require-reboot/#utility-script","text":"Scriptet bruger checkupdates og yay (for fremmede pakker) hvis den er installeret. En regex (regular expression) validerer om en system genstart skal foresl\u00e5es. #!/usr/bin/env bash reboot=\"(ucode|cryptsetup|linux|nvidia|mesa|systemd|wayland|xf86-video|xorg)\" if [[ $(which yay) =~ (yay) ]]; then updates=$(checkupdates; yay -Qua) else updates=$(checkupdates) fi echo \"$updates\" if [[ $updates =~ $reboot ]]; then echo \"Updating possibly requires system restart ...\" fi","title":"Utility script"},{"location":"manjaro/scripts/script-check-if-update-may-require-reboot/#anvendelse","text":"Scriptet skal ikke betrages som nogen autoritet - det tjener blot det form\u00e5l at foresl\u00e5 - f\u00f8r du installerer opdateringer - om en system genstart kan v\u00e6re en n\u00f8dvendighed.","title":"Anvendelse"},{"location":"manjaro/scripts/script-check-if-update-may-require-reboot/#tak-til","text":"Inspiration fra @Kresimir og EndeavourOS forum [[1]] [[2]] og det endelige script [[3]] Publiceret p\u00e5 Manjaro Form","title":"Tak til"},{"location":"manjaro/scripts/script-get-lan-ip-address/","text":"This is a utility script to display your local network address. Intended use case is anywhere you need an unambigious reference to your current LAN IPv4 whether this is another script or just to make sure. Add a file to your ~/.local/bin folder, name it check-network , make it executable mkdir -p ~/.local/bin touch ~/.local/bin/check-network chmod +x ~/.local/bin/check-network Edit the file and paste below content - be aware that the ttf_icons() does not display correct. The function looks like this in Sublime Text. The font used is the package ttf-font-icons available in the Manjaro repo. #! /bin/bash # # Script for displaying local network address in polybar, tint2, conky etc. # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # @linux-aarhus - root.nix.dk # # for icons install the package ttf-font-icons from the repo # ttf_icons(){ # set icons if font is available if [ -f '/usr/share/fonts/TTF/icons.ttf' ]; then wlan='\uf012' lan='\uf0e8' offline='\uf127' fi } lanip() { # parse output from ip a show $nic echo $(ip a show $1 | grep 'inet ' | head -n 4 | awk '{print $2}' | cut -d'/' -f1) } ttf_icons # find active interface nic=$(ip a | grep ' state UP' | cut -d' ' -f2 | cut -d':' -f1) if [[ ${nic} != \"\" ]]; then # print IP address if [[ ${nic} == e* ]]; then echo ${lan} $(lanip ${nic}) else echo ${wlan} $(lanip ${nic}) fi else # print offline echo ${offline} n/a fi This has been posted on Manjaro Forum too.","title":"Get LAN IP address"},{"location":"manjaro/scripts/script-mount-samba-share-as-user/","text":"Difficulty: \u2605\u2606\u2606\u2606\u2606 Utility to mount samba share as user While gvfs is an acronym for Gnome Virtual File System it's usage is not depending on Gnome. It comes with very few dependencies and even Manjaro Plasma has the gvfs package installed and as such this will work on any Linux. The Linux mount utility does not allow for a user to mount a samba share and this results in Manjaro users setting up fstab to automount the share. Such automounts may cease working due to upstream changes e.g. when the SMB1 protocol was renamed to NT1 thus causing old shares to stop working. This script relies on the packages gvfs-smb which will pull the necessary smb-client dependency. The following command will do the trick. If you want the dependencies to be explicitly installed add gvfs and smbclient to the command. The --needed argument will skip syncing packages already present. sudo pacman -Syu gvfs-smb --needed Create a new script in ~/.local/bin and name it gio-mount-myshare.sh . mkdir -p ~/.local/bin touch ~/.local/bin/gio-mount-myshare.sh Paste below content and modify the variables to use your samba server and share name. The symlinks folder defaults to ~/SMBLinks and this can of course be changed as you see fit. Running the script will attempt mounting the share. If credentials are needed you will be challenged. Enter the correct credentials to continue. To unmount a mounted share run with -u argument. To avoid entering credentials at runtime you can fill in the credentials inside the script - they will then be fed to the mount option using a file in a hidden configuration folder .credentials . #! /bin/bash # # Script for mounting and unmounting a configured samba share # Customized the variables as needed # - Symlinks are located in designated folder (default: $HOME/SMBLinks) # - Symlink can be named (default: $SHARENAME) # - Using `-u` argument will unmount and remove the symlink # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # @linux-aarhus - root.nix.dk # # MODIFY THESE VARIABLES # your samba server's hostname or IP address HOST=\"my-server\" # the share name on the server SHARENAME=\"my-share\" # symlink name LINKNAME=\"$SHARENAME\" # symlink is placed in this folder SYMLINKS=\"$HOME/SMBLinks\" # credentials USERNAME= WORKGROUP= PASSWD= # /END MODIFY SCRIPTNAME=$(basename \"$0\") VERSION=\"0.2\" # check argument $1 if [[ \"$1\" == \"-u\" ]]; then # remove symlink rm -f \"$SYMLINKS/$LINKNAME\" # unmount share gio mount -u \"smb://$HOST/$SHARENAME\" exit elif [[ $1 != \"\" ]]; then echo \":: $SCRIPTNAME v$VERSION\" echo \"==> invalid argument: $1\" echo \"Usage: \" echo \" mount SMB : $SCRIPTNAME\" echo \" umount SMB: $SCRIPTNAME -u\" exit 1 fi # Create credentials folder mkdir -p $HOME/.credentials chmod 700 $HOME/.credentials # ---------------------------------------------------------------- # mount command if ! [[ -z \"${USERNAME}\" ]]; then # create credentials file fname=\"$HOME/.credentials/$USERNAME-$HOST-$SHARENAME\" printf ${USERNAME}'\\n'${WORKGROUP}'\\n'${PASSWD}'\\n' > $fname chmod 600 $fname # mount and feed the credentials to the mount command gio mount \"smb://$HOST/$SHARENAME\" < $fname else # mount (if credentials are required you will be prompted gio mount \"smb://$HOST/$SHARENAME\" fi # ---------------------------------------------------------------- # easy reference to gio mount point ENDPOINT=/run/user/$UID/gvfs/''smb-share:server=$HOST,share=$SHARENAME'' # crete the subfolder if ! [ -d \"$SYMLINKS\" ]; then mkdir -p \"$SYMLINKS\" fi # use --force argument to suppress warning if link exist ln -sf \"$ENDPOINT\" \"$SYMLINKS/$LINKNAME\" You can complement this with a systemd user service to automate things even more. Create the folder mkdir -p ~/.local/systemd/user Create the service file touch ~/.local/systemd/user/gio-mount-myshare.service Edit the service file with your favorite text editor and paste below content [Unit] Description=GIO mount smb share-name [Service] Type=oneshot ExecStart=/home/%u/.local/bin/gio-mount-myshare.sh ExecStop=/home/%u/.local/bin/gio-mount-myshare.sh -u RemainAfterExit=true [Install] WantedBy=multi-user.target Enable and start the service systemctl --user enable gio-mount-myshare.service To simplify maintenance you can move the script to the service folder and change the ExecStart and ExecStop paths in the service file to /home/%u/.local/systemd/user/ . Posted at Manjaro Forum [root tip] [How To] [Utility script] GIO mount samba share","title":"Mount samba share as user"},{"location":"manjaro/scripts/script-mount-samba-share-as-user/#utility-to-mount-samba-share-as-user","text":"While gvfs is an acronym for Gnome Virtual File System it's usage is not depending on Gnome. It comes with very few dependencies and even Manjaro Plasma has the gvfs package installed and as such this will work on any Linux. The Linux mount utility does not allow for a user to mount a samba share and this results in Manjaro users setting up fstab to automount the share. Such automounts may cease working due to upstream changes e.g. when the SMB1 protocol was renamed to NT1 thus causing old shares to stop working. This script relies on the packages gvfs-smb which will pull the necessary smb-client dependency. The following command will do the trick. If you want the dependencies to be explicitly installed add gvfs and smbclient to the command. The --needed argument will skip syncing packages already present. sudo pacman -Syu gvfs-smb --needed Create a new script in ~/.local/bin and name it gio-mount-myshare.sh . mkdir -p ~/.local/bin touch ~/.local/bin/gio-mount-myshare.sh Paste below content and modify the variables to use your samba server and share name. The symlinks folder defaults to ~/SMBLinks and this can of course be changed as you see fit. Running the script will attempt mounting the share. If credentials are needed you will be challenged. Enter the correct credentials to continue. To unmount a mounted share run with -u argument. To avoid entering credentials at runtime you can fill in the credentials inside the script - they will then be fed to the mount option using a file in a hidden configuration folder .credentials . #! /bin/bash # # Script for mounting and unmounting a configured samba share # Customized the variables as needed # - Symlinks are located in designated folder (default: $HOME/SMBLinks) # - Symlink can be named (default: $SHARENAME) # - Using `-u` argument will unmount and remove the symlink # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # @linux-aarhus - root.nix.dk # # MODIFY THESE VARIABLES # your samba server's hostname or IP address HOST=\"my-server\" # the share name on the server SHARENAME=\"my-share\" # symlink name LINKNAME=\"$SHARENAME\" # symlink is placed in this folder SYMLINKS=\"$HOME/SMBLinks\" # credentials USERNAME= WORKGROUP= PASSWD= # /END MODIFY SCRIPTNAME=$(basename \"$0\") VERSION=\"0.2\" # check argument $1 if [[ \"$1\" == \"-u\" ]]; then # remove symlink rm -f \"$SYMLINKS/$LINKNAME\" # unmount share gio mount -u \"smb://$HOST/$SHARENAME\" exit elif [[ $1 != \"\" ]]; then echo \":: $SCRIPTNAME v$VERSION\" echo \"==> invalid argument: $1\" echo \"Usage: \" echo \" mount SMB : $SCRIPTNAME\" echo \" umount SMB: $SCRIPTNAME -u\" exit 1 fi # Create credentials folder mkdir -p $HOME/.credentials chmod 700 $HOME/.credentials # ---------------------------------------------------------------- # mount command if ! [[ -z \"${USERNAME}\" ]]; then # create credentials file fname=\"$HOME/.credentials/$USERNAME-$HOST-$SHARENAME\" printf ${USERNAME}'\\n'${WORKGROUP}'\\n'${PASSWD}'\\n' > $fname chmod 600 $fname # mount and feed the credentials to the mount command gio mount \"smb://$HOST/$SHARENAME\" < $fname else # mount (if credentials are required you will be prompted gio mount \"smb://$HOST/$SHARENAME\" fi # ---------------------------------------------------------------- # easy reference to gio mount point ENDPOINT=/run/user/$UID/gvfs/''smb-share:server=$HOST,share=$SHARENAME'' # crete the subfolder if ! [ -d \"$SYMLINKS\" ]; then mkdir -p \"$SYMLINKS\" fi # use --force argument to suppress warning if link exist ln -sf \"$ENDPOINT\" \"$SYMLINKS/$LINKNAME\" You can complement this with a systemd user service to automate things even more. Create the folder mkdir -p ~/.local/systemd/user Create the service file touch ~/.local/systemd/user/gio-mount-myshare.service Edit the service file with your favorite text editor and paste below content [Unit] Description=GIO mount smb share-name [Service] Type=oneshot ExecStart=/home/%u/.local/bin/gio-mount-myshare.sh ExecStop=/home/%u/.local/bin/gio-mount-myshare.sh -u RemainAfterExit=true [Install] WantedBy=multi-user.target Enable and start the service systemctl --user enable gio-mount-myshare.service To simplify maintenance you can move the script to the service folder and change the ExecStart and ExecStop paths in the service file to /home/%u/.local/systemd/user/ . Posted at Manjaro Forum [root tip] [How To] [Utility script] GIO mount samba share","title":"Utility to mount samba share as user"},{"location":"manjaro/scripts/script-package-and-configuration-backup/","text":"Arch based distribution utility script Difficulty: \u2605\u2606\u2606\u2606\u2606 Use the script to backup important config. create list of explicit installed packages backup common configuration to archive Use case - transfer common configuration and package list to other systems #! /bin/bash # # Script for backing up configuration and package lists # # This program is free software: you can redistribute it and/or modify # it under the terms of the Affero GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # @linux-aarhus - root.nix.dk # # Modify as necessary filelist=('.bash_profile' '.bashrc' '.netrc' '.profile' '.zshrc') # example folderlist=('.config' '.local' '.gnupg' '.mozilla' '.ssh' '.thunderbird') folderlist=('.config' '.local') archive_file=\"dotconf.tar.gz\" repo_pkg_file=\"repo-pkglist.txt\" cust_pkg_file=\"cust-pkglist.txt\" # /Modification SCRIPTNAME=$(basename \"$0\") VERSION=\"0.1\" if [[ -z $1 ]]; then echo \":: $SCRIPTNAME v$VERSION\" echo \"==> missing argument: PATH\" echo \"Usage:\" echo \" $SCRIPTNAME /path/to/backup\" echo \" Path to store output\" echo \" e.g. $SCRIPTNAME /home/$USER/backup\" echo \"\" exit fi set -e if ! [[ -d $1 ]]; then mkdir -p $1 fi conf_archive=\"$1/$archive_file\" repo_pkg_list=\"$1/$repo_pkg_file\" cust_pkg_list=\"$1/$cust_pkg_file\" # create an archive of common hidden files and folders if [[ -e \"$conf_archive\" ]]; then # remove archive if exist rm -f \"$conf_archive\" fi todo=\"\" for file in ${filelist[@]}; do if [[ -f $file ]]; then todo+=\"${file} \" fi done for folder in ${folderlist[@]}; do if [[ -d ${folder} ]]; then todo+=\"${folder} \" fi done tar -zcvf \"$conf_archive\" $todo # list packages from official repo pacman -Qqen > \"$repo_pkg_list\" # list foreign packages (custom e.g. AUR) pacman -Qqem > \"$cust_pkg_list\" echo \" ==> Packagelists created\" echo \" --> $repo_pkg_list\" echo \" --> $cust_pkg_list\" echo \" ==> Config archive created\" echo \" --> $conf_archive\" echo \" ==> To install packages from lists\" echo \" --> sudo pacman -Syu --needed - < $repo_pkg_file\" echo \" ==> To restore the configuration files run\" echo \" --> tar -zxcf $archive_file\" echo \"\" Crossposted at * https://forum.manjaro.org/t/root-tip-utililty-script-backup-configuration-and-package-list/104953 * https://forum.endeavouros.com/t/how-do-you-save-all-your-installed-pacages-so-you-can-easily-reinstall-them-all-on-a-fresh-install-of-the-os/27908/6","title":"Packagelist and Configuration backup"},{"location":"manjaro/scripts/script-package-and-configuration-backup/#arch-based-distribution-utility-script","text":"Difficulty: \u2605\u2606\u2606\u2606\u2606 Use the script to backup important config. create list of explicit installed packages backup common configuration to archive Use case - transfer common configuration and package list to other systems #! /bin/bash # # Script for backing up configuration and package lists # # This program is free software: you can redistribute it and/or modify # it under the terms of the Affero GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # @linux-aarhus - root.nix.dk # # Modify as necessary filelist=('.bash_profile' '.bashrc' '.netrc' '.profile' '.zshrc') # example folderlist=('.config' '.local' '.gnupg' '.mozilla' '.ssh' '.thunderbird') folderlist=('.config' '.local') archive_file=\"dotconf.tar.gz\" repo_pkg_file=\"repo-pkglist.txt\" cust_pkg_file=\"cust-pkglist.txt\" # /Modification SCRIPTNAME=$(basename \"$0\") VERSION=\"0.1\" if [[ -z $1 ]]; then echo \":: $SCRIPTNAME v$VERSION\" echo \"==> missing argument: PATH\" echo \"Usage:\" echo \" $SCRIPTNAME /path/to/backup\" echo \" Path to store output\" echo \" e.g. $SCRIPTNAME /home/$USER/backup\" echo \"\" exit fi set -e if ! [[ -d $1 ]]; then mkdir -p $1 fi conf_archive=\"$1/$archive_file\" repo_pkg_list=\"$1/$repo_pkg_file\" cust_pkg_list=\"$1/$cust_pkg_file\" # create an archive of common hidden files and folders if [[ -e \"$conf_archive\" ]]; then # remove archive if exist rm -f \"$conf_archive\" fi todo=\"\" for file in ${filelist[@]}; do if [[ -f $file ]]; then todo+=\"${file} \" fi done for folder in ${folderlist[@]}; do if [[ -d ${folder} ]]; then todo+=\"${folder} \" fi done tar -zcvf \"$conf_archive\" $todo # list packages from official repo pacman -Qqen > \"$repo_pkg_list\" # list foreign packages (custom e.g. AUR) pacman -Qqem > \"$cust_pkg_list\" echo \" ==> Packagelists created\" echo \" --> $repo_pkg_list\" echo \" --> $cust_pkg_list\" echo \" ==> Config archive created\" echo \" --> $conf_archive\" echo \" ==> To install packages from lists\" echo \" --> sudo pacman -Syu --needed - < $repo_pkg_file\" echo \" ==> To restore the configuration files run\" echo \" --> tar -zxcf $archive_file\" echo \"\" Crossposted at * https://forum.manjaro.org/t/root-tip-utililty-script-backup-configuration-and-package-list/104953 * https://forum.endeavouros.com/t/how-do-you-save-all-your-installed-pacages-so-you-can-easily-reinstall-them-all-on-a-fresh-install-of-the-os/27908/6","title":"Arch based distribution utility script"},{"location":"manjaro/scripts/script-set-default-browser/","text":"Setting web browser script How do I set the default browser on Linux - more specifically Arch based Manjaro and EndeavourOS? Why does by apps not respect my chosen browser? How often have we heard such question? I just came across an issue where my development environment did not open the expected browser. This occurs when the mime settings is out of sync with each other. To get my system to behave I put together this tiny script. #!/bin/bash # # Setting default browser using xdg utils # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # 2021-11-20 # @linux-aarhus (c) root.nix.dk # https://root.nix.dk/en/utility-scripts/set-browser-script # print_usage(){ echo \"Usage:\" echo \" Supply browser desktop file as the first argument\" echo \" e.g. set-browser.sh firefox.desktop\" echo \"\" } show_available_browsers(){ echo \"Available browsers (installed)\" echo \"---\" # funny thing with cut when splitting a path # one would expect the column to be number 4 but it is 5 # as string starts with `/` and therefore first column is empty grep -rl 'internet' /usr/share/applications | cut -d'/' -f5 echo \"---\" } set_browser() { # set scheme handlers xdg-mime default \"$1\" x-scheme-handler/https xdg-mime default \"$1\" x-scheme-handler/http # set default browser xdg-settings set default-web-browser $1 echo \"Default browser set using $1\" } # check if argument is supplied if [[ \"$1\" == \"\" ]]; then print_usage show_available_browsers exit 1 fi # check if desktop file if [[ \"$1\" =~ \".desktop\" ]]; then # check if the file exist if [[ -f \"/usr/share/applications/$1\" ]]; then set_browser \"$1\" else echo \"$1 - file not found\" show_available_browsers exit 1 fi else echo \"$1 is not a .desktop file\" show_available_browsers exit 1 fi","title":"Set Browser Script"},{"location":"manjaro/scripts/script-set-default-browser/#setting-web-browser-script","text":"How do I set the default browser on Linux - more specifically Arch based Manjaro and EndeavourOS? Why does by apps not respect my chosen browser? How often have we heard such question? I just came across an issue where my development environment did not open the expected browser. This occurs when the mime settings is out of sync with each other. To get my system to behave I put together this tiny script. #!/bin/bash # # Setting default browser using xdg utils # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # 2021-11-20 # @linux-aarhus (c) root.nix.dk # https://root.nix.dk/en/utility-scripts/set-browser-script # print_usage(){ echo \"Usage:\" echo \" Supply browser desktop file as the first argument\" echo \" e.g. set-browser.sh firefox.desktop\" echo \"\" } show_available_browsers(){ echo \"Available browsers (installed)\" echo \"---\" # funny thing with cut when splitting a path # one would expect the column to be number 4 but it is 5 # as string starts with `/` and therefore first column is empty grep -rl 'internet' /usr/share/applications | cut -d'/' -f5 echo \"---\" } set_browser() { # set scheme handlers xdg-mime default \"$1\" x-scheme-handler/https xdg-mime default \"$1\" x-scheme-handler/http # set default browser xdg-settings set default-web-browser $1 echo \"Default browser set using $1\" } # check if argument is supplied if [[ \"$1\" == \"\" ]]; then print_usage show_available_browsers exit 1 fi # check if desktop file if [[ \"$1\" =~ \".desktop\" ]]; then # check if the file exist if [[ -f \"/usr/share/applications/$1\" ]]; then set_browser \"$1\" else echo \"$1 - file not found\" show_available_browsers exit 1 fi else echo \"$1 is not a .desktop file\" show_available_browsers exit 1 fi","title":"Setting web browser script"},{"location":"manjaro/scripts/script-template-freerdp/","text":"This is a utility script to display your local network address. Intended use case is anywhere you need an unambigious reference to your current LAN IPv4 whether this is another script or just to make sure. Add a file to your ~/.local/bin folder, name it check-network , make it executable mkdir -p ~/.local/bin touch ~/.local/bin/check-network chmod +x ~/.local/bin/check-network Edit the file and paste below content - be aware that the ttf_icons() does not display correct. The function looks like this in Sublime Text. The font used is the package ttf-font-icons available in the Manjaro repo. #! /bin/bash # # Script for displaying local network address in polybar, tint2, conky etc. # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>. # # @linux-aarhus - root.nix.dk # # for icons install the package ttf-font-icons from the repo # ttf_icons(){ # set icons if font is available if [ -f '/usr/share/fonts/TTF/icons.ttf' ]; then wlan='\uf012' lan='\uf0e8' offline='\uf127' fi } lanip() { # parse output from ip a show $nic echo $(ip a show $1 | grep 'inet ' | head -n 4 | awk '{print $2}' | cut -d'/' -f1) } ttf_icons # find active interface nic=$(ip a | grep ' state UP' | cut -d' ' -f2 | cut -d':' -f1) if [[ ${nic} != \"\" ]]; then # print IP address if [[ ${nic} == e* ]]; then echo ${lan} $(lanip ${nic}) else echo ${wlan} $(lanip ${nic}) fi else # print offline echo ${offline} n/a fi This has been posted on Manjaro Forum too.","title":"Get LAN IP address"},{"location":"manjaro/scripts/script-usb-partion-format/","text":"Difficulty: \u2605\u2605\u2606\u2606\u2606 Description The scripts partitions and formats any USB device using exFAT filesystem. To avoid accidental format of non removable devices a couple of safeguards exist. The script will check if the supplied device is valid then it checks if the device is in fact a removable device. If any of these checks fail the script aborts. The script will ask for user confirmation twice and default to abort on Enter Use case Re-purpose the USB stick if you have flashed an ISO to it. Why? Because writing an ISO using dd writes an ISO9660 filesystem to a small part of the USB - the rest is inaccessible. Instructions Create the folder ~/.local/bin mkdir -p ~/.local/bin Create a new file e.g. format-usb.sh touch ~/.local/bin/format-usb.sh Make the file executable chmod +x ~/.local/bin/format-usb.sh Open the file with your favorite editor e.g. kate kate ~/.local/bin/format-usb.sh Copy below content into the file and save it. TIP : Use the copy to clipboard box in the upper right corner of below text box #!/usr/bin/env bash # # Utility ccript to repurpose a removable device using exfat filesystem # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>.# # # @linux-aarhus - root.nix.dk # # format removable USB device to exfat with name 'USB STICK' LABEL='USB STICK' SCRIPTNAME=$(basename \"$0\") VERSION=\"0.2\" # don't run as root if [[ $(whoami) == \"root\" ]] ; then echo \"Please run as user. Script will ask for root later.\" exit 1 fi # ensure a device is given if [[ -z \"$1\" ]]; then echo \"No device specified ...\" echo \"Usage: ${SCRIPTNAME} /dev/sdy\" exit fi # get the last part of device path device=\"$(echo $1 | cut -d'/' -f3)\" echo \"Checking device on => $device\" # create list of available devices devices=\"$(lsblk -o NAME | egrep '^sd')\" # check if device is valid - abort if not if ! [[ $devices =~ (^|[[:space:]])$device($|[[:space:]]) ]]; then echo \"$1 not found\" echo \"Aborting\" exit 1 fi # check if device is removable - abort if not [[ $(echo $(lsblk -no RM \"$1\" | head -n 1)) = '0' ]] && \\ echo \"Non removable device detected!\" && \\ echo \"Aborting\" && \\ exit 1 # Ask for confirmation read -r -p \"Confirm reformat of '$1' [y/N] \" resp if [[ \"$resp\" =~ ^([yY][eE][sS]|[yY])$ ]]; then # Repeat confirmation question read -r -p \"Irrevocably format '$1' [y/N] \" resp2 if [[ \"$resp2\" =~ ^([yY][eE][sS]|[yY])$ ]]; then # will do echo \"Formatting $1 ...\" # use gdisk to create new partition table # and a single Microsoft basic data partition type printf 'o\\ny\\nn\\n\\n\\n\\n0700\\nw\\ny\\n' | sudo gdisk \"$1\" > /dev/null sudo mkexfatfs -n \"${LABEL}\" \"$1\"1 > /dev/null # done echo \"Done\" exit fi echo \"Formatting aborted\" else echo \"Formatting aborted\" fi Usage Remove your USB if attached and list devices lsblk Insert your USB device and list the devices lsblk The new device in the list is your USB device e.g. /dev/sdy - format the device using the script format-usb.sh /dev/sdy Note What this script does can be done in numerous ways with numerous tools. The list contains validation is taken from this stackoverflow topic Revisions 2021-01-11 06:44:00 Europe/Copenhagen Added label to format Cosmetic fix -> send output to /dev/null 2020-09-02 17:54:00 Europe/Copenhagen Fix typo in device check","title":"USB partition script"},{"location":"manjaro/scripts/script-usb-partion-format/#description","text":"The scripts partitions and formats any USB device using exFAT filesystem. To avoid accidental format of non removable devices a couple of safeguards exist. The script will check if the supplied device is valid then it checks if the device is in fact a removable device. If any of these checks fail the script aborts. The script will ask for user confirmation twice and default to abort on Enter","title":"Description"},{"location":"manjaro/scripts/script-usb-partion-format/#use-case","text":"Re-purpose the USB stick if you have flashed an ISO to it. Why? Because writing an ISO using dd writes an ISO9660 filesystem to a small part of the USB - the rest is inaccessible.","title":"Use case"},{"location":"manjaro/scripts/script-usb-partion-format/#instructions","text":"Create the folder ~/.local/bin mkdir -p ~/.local/bin Create a new file e.g. format-usb.sh touch ~/.local/bin/format-usb.sh Make the file executable chmod +x ~/.local/bin/format-usb.sh Open the file with your favorite editor e.g. kate kate ~/.local/bin/format-usb.sh Copy below content into the file and save it. TIP : Use the copy to clipboard box in the upper right corner of below text box #!/usr/bin/env bash # # Utility ccript to repurpose a removable device using exfat filesystem # # This program is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 3 of the License, or # (at your option) any later version. # # This program is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with this program. If not, see <https://www.gnu.org/licenses/>.# # # @linux-aarhus - root.nix.dk # # format removable USB device to exfat with name 'USB STICK' LABEL='USB STICK' SCRIPTNAME=$(basename \"$0\") VERSION=\"0.2\" # don't run as root if [[ $(whoami) == \"root\" ]] ; then echo \"Please run as user. Script will ask for root later.\" exit 1 fi # ensure a device is given if [[ -z \"$1\" ]]; then echo \"No device specified ...\" echo \"Usage: ${SCRIPTNAME} /dev/sdy\" exit fi # get the last part of device path device=\"$(echo $1 | cut -d'/' -f3)\" echo \"Checking device on => $device\" # create list of available devices devices=\"$(lsblk -o NAME | egrep '^sd')\" # check if device is valid - abort if not if ! [[ $devices =~ (^|[[:space:]])$device($|[[:space:]]) ]]; then echo \"$1 not found\" echo \"Aborting\" exit 1 fi # check if device is removable - abort if not [[ $(echo $(lsblk -no RM \"$1\" | head -n 1)) = '0' ]] && \\ echo \"Non removable device detected!\" && \\ echo \"Aborting\" && \\ exit 1 # Ask for confirmation read -r -p \"Confirm reformat of '$1' [y/N] \" resp if [[ \"$resp\" =~ ^([yY][eE][sS]|[yY])$ ]]; then # Repeat confirmation question read -r -p \"Irrevocably format '$1' [y/N] \" resp2 if [[ \"$resp2\" =~ ^([yY][eE][sS]|[yY])$ ]]; then # will do echo \"Formatting $1 ...\" # use gdisk to create new partition table # and a single Microsoft basic data partition type printf 'o\\ny\\nn\\n\\n\\n\\n0700\\nw\\ny\\n' | sudo gdisk \"$1\" > /dev/null sudo mkexfatfs -n \"${LABEL}\" \"$1\"1 > /dev/null # done echo \"Done\" exit fi echo \"Formatting aborted\" else echo \"Formatting aborted\" fi","title":"Instructions"},{"location":"manjaro/scripts/script-usb-partion-format/#usage","text":"Remove your USB if attached and list devices lsblk Insert your USB device and list the devices lsblk The new device in the list is your USB device e.g. /dev/sdy - format the device using the script format-usb.sh /dev/sdy","title":"Usage"},{"location":"manjaro/scripts/script-usb-partion-format/#note","text":"What this script does can be done in numerous ways with numerous tools. The list contains validation is taken from this stackoverflow topic","title":"Note"},{"location":"manjaro/scripts/script-usb-partion-format/#revisions","text":"2021-01-11 06:44:00 Europe/Copenhagen Added label to format Cosmetic fix -> send output to /dev/null 2020-09-02 17:54:00 Europe/Copenhagen Fix typo in device check","title":"Revisions"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/","text":"About Secure Boot Secure Boot is a mechanism for verifying operating system integrity The mechanism was pionereed by Microsoft and is now a defacto standard Configuring Secure Boot requires access to the system's firmware The firmware access requirement prevent OOB support of Secure Boot Background This How-To is based on the question asked with Enable Secure Boot For Existing Manjaro Usung Repo Only and can be seen as a complement to Encrypted Manjaro Linux Using Verified Boot . I decided to work on the theory - and brush up on new sbctl options and configuration. To be able to comply with corporate security - this is a proof-of-concept - how to make Manjaro and Windows co-exist with Secure Boot enabled. Precaution Make sure your system\u2019s firmware is up-to-date - if in doubt check with the vendor\u2019s website. Your system may require a signed driver blob stored in the firmware - in such case contact your vendor through their official support channels - and verify if you void your warranty or brick your system. You are the system admin THE PROOF OF CONCEPT IS PROVIDED \u201cAS IS\u201d AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS DOCUMENT INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OF THIS PROOF OF CONCEPT. Target System The test system is Clevo N141wu with a single NVMe storage device and the steps I am going to list works with the mentioned laptop. I downloaded and installed a Windows 10 - and subsequently added Manjaro using GRUB for dual-boot using a single Linux 6.12 kernel. Although this project did not test Windows 11, there is no reason to believe the process would be any different than the one applied herein. If you are trying to implement this with another layout - you must adapt the process. Other systems tested (removed existing key database) Thinkpad X13 AMD Gen.4 Tuxedo InfinitiBookPro 14 Gen.8 Proof of Concept This is a practical implementation using sbctl on Manjaro Linux. See -> https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot#Assisted_process_with_sbctl The PoC assumes the system has been kept up-to-date both operating systems. Sync the package sbctl from the official repo sudo pacman -S sbctl After this you have an excellent opportunity to familiarize yourself with sbctl usage sbctl --help sbctl bundle --help sbctl create-keys --help sbctl enroll-keys --help sbctl generate-bundles --help Kernel Cmdline Extract the GRUB_CMDLINE_LINUX_DEFAULT from /etc/default/grub and save the content in a new file /etc/kernel/cmdline . The content - using a default Manjaro installation - would look like root=UUID=<uuid> rw quiet splash apparmor=1 security=apparmor udev.log_priority=3 When you created the file - create a new bundle using sbctl . Define Bundle A bundle is the set of files used to start your system. To create a bundle definition you run sbctl bundle <args> providing the mountpoint of the $esp, paths to the files to bundle and full path to the unified efi loader. --amducode '/boot/amd-ucode.img' includes ucode for AMD --intelucode '/boot/intel-ucode.img' includes ucode for Intel Example for an AMD system sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.12-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.12-x86_64' \\ --save '/boot/efi/main.efi' As can be deduced - it is fairly easy to create extra bundles with e.g. a fallback image - just don't do it (See Storage Consideration below). Create Signing Keys A key is required to sign the bundle - so create the key sudo sbctl create-keys Generate Bundle and Sign When you have created the keys - generate the bundle and sign sudo sbctl generate-bundles --sign Configure Setup Mode Restart your system and enter the firmware setup systemctl reboot --firmware-setup In the system firmware you need to locate the Secure Boot section, then configure Secure Boot for Setup Mode . How you do this is specific for your firmware - you may need to experiment. Enroll Keys When you are confident the system's Secure Boot is in Setup Mode, boot into your Manjaro system - and enroll your key into Secure Boot key storage, remember to include Microsoft keys sudo sbctl enroll-keys --microsoft The command ensures the firmware Setup Mode is reverted to production mode. It is not automagically protected - for that you need to set an administrative password. Firmware boot entry To be able to use your firmware's boot override it is necesary to create a firmware boot entry. For our PoC the command look like this To avoid confusing the default Manjaro entry; label the entry Manjaro Verified Boot sudo efibootmgr --loader main.efi --create --disk /dev/nvme0n1 --part 1 --label 'Manjaro Verified Boot' --unicode Storage Consideration The $esp (efi system partition) with default Microsoft Windows 10 installation is 100M, and this is leaving little room to wiggle, as a single efi image takes 42M, thus leaving 29M remaining space. [nix-n14xwu ~]# ls -l -h /boot/efi total 42M drwx------ 5 root root 1,0K 21 feb 12:59 EFI drwx------ 2 root root 1,0K 21 feb 13:35 loader -rwx------ 1 root root 42M 21 feb 12:42 main.efi drwx------ 2 root root 1,0K 21 feb 11:37 'System Volume Information' Maintenance The bundle is a static configuration - it will not change automagically - e.g. triggered by a hook. The kernel maintenance within a release e.g. 6.12 is not an issue as the name has not changed. When you decide to switch kernel e.g. from 6.12 to 6.14 - the name changes and you need to maintain your bundle. Generate new Bundle This can be done by recreating your bundle configuration using sbctl sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.14-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.14-x86_64' \\ --save '/boot/efi/main.efi' Manually update bundle The bundle configuration is stored in /var/lib/sbctl/bundles.json so you can manually change the filenames but then you have no error checking if you misspell a filename - thus it is not recommended - instead use the bundle command. Generate bundle Generate the bundle and sign it sudo sbctl generate-bundles --sign Protect Your Firmware It is strongly suggested to lock your computers firmware with an administrative password - otherwise it is easy to circumvent the boot measures applied. The firmware will now be enabled and your system may now be compliant with your corporate policies stating Secure Boot must be enabled. Before you rejoice too much - ask your Corporate IT department. About Secure Boot Secure Boot is a mechanism for verifying operating system integrity The mechanism was pionereed by Microsoft and is now a defacto standard Configuring Secure Boot requires access to the system's firmware The firmware access requirement prevent OOB support of Secure Boot Background This How-To is based on the question asked with Enable Secure Boot For Existing Manjaro Usung Repo Only and can be seen as a complement to Encrypted Manjaro Linux Using Verified Boot . I decided to work on the theory - and brush up on new sbctl options and configuration. To be able to comply with corporate security - this is a proof-of-concept - how to make Manjaro and Windows co-exist with Secure Boot enabled. Target System The test system is Clevo N141wu with a single NVMe storage device and the steps I am going to list works with the mentioned laptop. I downloaded and installed a Windows 10 - and subsequently added Manjaro using GRUB for dual-boot using a single Linux 6.12 kernel. Although this project did not test Windows 11, there is no reason to believe the process would be any different than the one applied herein. If you are trying to implement this with another layout - you must adapt the process. Proof of Concept This is a practical implementation using sbctl on Manjaro Linux. See -> https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot#Assisted_process_with_sbctl The PoC assumes the system has been kept up-to-date both operating systems. Sync the package sbctl from the official repo sudo pacman -S sbctl After this you have an excellent opportunity to familiarize yourself with sbctl usage sbctl --help sbctl bundle --help sbctl create-keys --help sbctl enroll-keys --help sbctl generate-bundles --help Kernel Cmdline Extract the GRUB_CMDLINE_LINUX_DEFAULT from /etc/default/grub and save the content in a new file /etc/kernel/cmdline . The content - using a default Manjaro installation - would look like root=UUID=<uuid> rw quiet splash apparmor=1 security=apparmor udev.log_priority=3 When you created the file - create a new bundle using sbctl . Define Bundle A bundle is the set of files used to start your system. To create a bundle definition you run sbctl bundle <args> providing the mountpoint of the $esp, paths to the files to bundle and full path to the unified efi loader. --amducode '/boot/amd-ucode.img' includes ucode for AMD --intelucode '/boot/intel-ucode.img' includes ucode for Intel Example for an AMD system sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.12-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.12-x86_64' \\ --save '/boot/efi/main.efi' As can be deduced - it is fairly easy to create extra bundles with e.g. a fallback image - just don't do it (See Storage Consideration below). Create Signing Keys A key is required to sign the bundle - so create the key sudo sbctl create-keys Generate Bundle and Sign When you have created the keys - generate the bundle and sign sudo sbctl generate-bundles --sign Configure Setup Mode Restart your system and enter the firmware setup systemctl reboot --firmware-setup In the system firmware you need to locate the Secure Boot section, then configure Secure Boot for Setup Mode . How you do this is specific for your firmware - you may need to experiment. Enroll Keys When you are confident the system's Secure Boot is in Setup Mode, boot into your Manjaro system - and enroll your key into Secure Boot key storage, remember to include Microsoft keys sudo sbctl enroll-keys --microsoft The command ensures the firmware Setup Mode is reverted to production mode. It is not automagically protected - for that you need to set an administrative password. Firmware boot entry To be able to use your firmware's boot override it is necesary to create a firmware boot entry. For our PoC the command look like this To avoid confusing the default Manjaro entry; label the entry Manjaro Verified Boot sudo efibootmgr --loader main.efi --create --disk /dev/nvme0n1 --part 1 --label 'Manjaro Verified Boot' --unicode Storage Consideration The $esp (efi system partition) with default Microsoft Windows 10 installation is 100M, and this is leaving little room to wiggle, as a single efi image takes 42M, thus leaving 29M remaining space. [nix-n14xwu ~]# ls -l -h /boot/efi total 42M drwx------ 5 root root 1,0K 21 feb 12:59 EFI drwx------ 2 root root 1,0K 21 feb 13:35 loader -rwx------ 1 root root 42M 21 feb 12:42 main.efi drwx------ 2 root root 1,0K 21 feb 11:37 'System Volume Information' Maintenance The bundle is a static configuration - it will not change automagically - e.g. triggered by a hook. The kernel maintenance within a release e.g. 6.12 is not an issue as the name has not changed. When you decide to switch kernel e.g. from 6.12 to 6.14 - the name changes and you need to maintain your bundle. Generate new Bundle This can be done by recreating your bundle configuration using sbctl sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.14-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.14-x86_64' \\ --save '/boot/efi/main.efi' Manually update bundle The bundle configuration is stored in /var/lib/sbctl/bundles.json so you can manually change the filenames but then you have no error checking if you misspell a filename - thus it is not recommended - instead use the bundle command. Generate bundle Generate the bundle and sign it sudo sbctl generate-bundles --sign Protect Your Firmware It is strongly suggested to lock your computers firmware with an administrative password - otherwise it is easy to circumvent the boot measures applied. The firmware will now be enabled and your system may now be compliant with your corporate policies stating Secure Boot must be enabled. Before you rejoice too much - ask your Corporate IT department. Crossposted at Enable Secure Boot For Existing Manjaro Usung Repo Only","title":"Manjaro and Windows - Secure Boot - repo only"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#about-secure-boot","text":"Secure Boot is a mechanism for verifying operating system integrity The mechanism was pionereed by Microsoft and is now a defacto standard Configuring Secure Boot requires access to the system's firmware The firmware access requirement prevent OOB support of Secure Boot","title":"About Secure Boot"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#background","text":"This How-To is based on the question asked with Enable Secure Boot For Existing Manjaro Usung Repo Only and can be seen as a complement to Encrypted Manjaro Linux Using Verified Boot . I decided to work on the theory - and brush up on new sbctl options and configuration. To be able to comply with corporate security - this is a proof-of-concept - how to make Manjaro and Windows co-exist with Secure Boot enabled.","title":"Background"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#precaution","text":"Make sure your system\u2019s firmware is up-to-date - if in doubt check with the vendor\u2019s website. Your system may require a signed driver blob stored in the firmware - in such case contact your vendor through their official support channels - and verify if you void your warranty or brick your system. You are the system admin THE PROOF OF CONCEPT IS PROVIDED \u201cAS IS\u201d AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS DOCUMENT INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OF THIS PROOF OF CONCEPT.","title":"Precaution"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#target-system","text":"The test system is Clevo N141wu with a single NVMe storage device and the steps I am going to list works with the mentioned laptop. I downloaded and installed a Windows 10 - and subsequently added Manjaro using GRUB for dual-boot using a single Linux 6.12 kernel. Although this project did not test Windows 11, there is no reason to believe the process would be any different than the one applied herein. If you are trying to implement this with another layout - you must adapt the process. Other systems tested (removed existing key database) Thinkpad X13 AMD Gen.4 Tuxedo InfinitiBookPro 14 Gen.8","title":"Target System"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#proof-of-concept","text":"This is a practical implementation using sbctl on Manjaro Linux. See -> https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot#Assisted_process_with_sbctl The PoC assumes the system has been kept up-to-date both operating systems. Sync the package sbctl from the official repo sudo pacman -S sbctl After this you have an excellent opportunity to familiarize yourself with sbctl usage sbctl --help sbctl bundle --help sbctl create-keys --help sbctl enroll-keys --help sbctl generate-bundles --help","title":"Proof of Concept"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#kernel-cmdline","text":"Extract the GRUB_CMDLINE_LINUX_DEFAULT from /etc/default/grub and save the content in a new file /etc/kernel/cmdline . The content - using a default Manjaro installation - would look like root=UUID=<uuid> rw quiet splash apparmor=1 security=apparmor udev.log_priority=3 When you created the file - create a new bundle using sbctl .","title":"Kernel Cmdline"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#define-bundle","text":"A bundle is the set of files used to start your system. To create a bundle definition you run sbctl bundle <args> providing the mountpoint of the $esp, paths to the files to bundle and full path to the unified efi loader. --amducode '/boot/amd-ucode.img' includes ucode for AMD --intelucode '/boot/intel-ucode.img' includes ucode for Intel Example for an AMD system sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.12-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.12-x86_64' \\ --save '/boot/efi/main.efi' As can be deduced - it is fairly easy to create extra bundles with e.g. a fallback image - just don't do it (See Storage Consideration below).","title":"Define Bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#create-signing-keys","text":"A key is required to sign the bundle - so create the key sudo sbctl create-keys","title":"Create Signing Keys"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#generate-bundle-and-sign","text":"When you have created the keys - generate the bundle and sign sudo sbctl generate-bundles --sign","title":"Generate Bundle and Sign"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#configure-setup-mode","text":"Restart your system and enter the firmware setup systemctl reboot --firmware-setup In the system firmware you need to locate the Secure Boot section, then configure Secure Boot for Setup Mode . How you do this is specific for your firmware - you may need to experiment.","title":"Configure Setup Mode"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#enroll-keys","text":"When you are confident the system's Secure Boot is in Setup Mode, boot into your Manjaro system - and enroll your key into Secure Boot key storage, remember to include Microsoft keys sudo sbctl enroll-keys --microsoft The command ensures the firmware Setup Mode is reverted to production mode. It is not automagically protected - for that you need to set an administrative password.","title":"Enroll Keys"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#firmware-boot-entry","text":"To be able to use your firmware's boot override it is necesary to create a firmware boot entry. For our PoC the command look like this To avoid confusing the default Manjaro entry; label the entry Manjaro Verified Boot sudo efibootmgr --loader main.efi --create --disk /dev/nvme0n1 --part 1 --label 'Manjaro Verified Boot' --unicode","title":"Firmware boot entry"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#storage-consideration","text":"The $esp (efi system partition) with default Microsoft Windows 10 installation is 100M, and this is leaving little room to wiggle, as a single efi image takes 42M, thus leaving 29M remaining space. [nix-n14xwu ~]# ls -l -h /boot/efi total 42M drwx------ 5 root root 1,0K 21 feb 12:59 EFI drwx------ 2 root root 1,0K 21 feb 13:35 loader -rwx------ 1 root root 42M 21 feb 12:42 main.efi drwx------ 2 root root 1,0K 21 feb 11:37 'System Volume Information'","title":"Storage Consideration"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#maintenance","text":"The bundle is a static configuration - it will not change automagically - e.g. triggered by a hook. The kernel maintenance within a release e.g. 6.12 is not an issue as the name has not changed. When you decide to switch kernel e.g. from 6.12 to 6.14 - the name changes and you need to maintain your bundle.","title":"Maintenance"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#generate-new-bundle","text":"This can be done by recreating your bundle configuration using sbctl sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.14-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.14-x86_64' \\ --save '/boot/efi/main.efi'","title":"Generate new Bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#manually-update-bundle","text":"The bundle configuration is stored in /var/lib/sbctl/bundles.json so you can manually change the filenames but then you have no error checking if you misspell a filename - thus it is not recommended - instead use the bundle command.","title":"Manually update bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#generate-bundle","text":"Generate the bundle and sign it sudo sbctl generate-bundles --sign","title":"Generate bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#protect-your-firmware","text":"It is strongly suggested to lock your computers firmware with an administrative password - otherwise it is easy to circumvent the boot measures applied. The firmware will now be enabled and your system may now be compliant with your corporate policies stating Secure Boot must be enabled. Before you rejoice too much - ask your Corporate IT department.","title":"Protect Your Firmware"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#about-secure-boot_1","text":"Secure Boot is a mechanism for verifying operating system integrity The mechanism was pionereed by Microsoft and is now a defacto standard Configuring Secure Boot requires access to the system's firmware The firmware access requirement prevent OOB support of Secure Boot","title":"About Secure Boot"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#background_1","text":"This How-To is based on the question asked with Enable Secure Boot For Existing Manjaro Usung Repo Only and can be seen as a complement to Encrypted Manjaro Linux Using Verified Boot . I decided to work on the theory - and brush up on new sbctl options and configuration. To be able to comply with corporate security - this is a proof-of-concept - how to make Manjaro and Windows co-exist with Secure Boot enabled.","title":"Background"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#target-system_1","text":"The test system is Clevo N141wu with a single NVMe storage device and the steps I am going to list works with the mentioned laptop. I downloaded and installed a Windows 10 - and subsequently added Manjaro using GRUB for dual-boot using a single Linux 6.12 kernel. Although this project did not test Windows 11, there is no reason to believe the process would be any different than the one applied herein. If you are trying to implement this with another layout - you must adapt the process.","title":"Target System"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#proof-of-concept_1","text":"This is a practical implementation using sbctl on Manjaro Linux. See -> https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot#Assisted_process_with_sbctl The PoC assumes the system has been kept up-to-date both operating systems. Sync the package sbctl from the official repo sudo pacman -S sbctl After this you have an excellent opportunity to familiarize yourself with sbctl usage sbctl --help sbctl bundle --help sbctl create-keys --help sbctl enroll-keys --help sbctl generate-bundles --help","title":"Proof of Concept"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#kernel-cmdline_1","text":"Extract the GRUB_CMDLINE_LINUX_DEFAULT from /etc/default/grub and save the content in a new file /etc/kernel/cmdline . The content - using a default Manjaro installation - would look like root=UUID=<uuid> rw quiet splash apparmor=1 security=apparmor udev.log_priority=3 When you created the file - create a new bundle using sbctl .","title":"Kernel Cmdline"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#define-bundle_1","text":"A bundle is the set of files used to start your system. To create a bundle definition you run sbctl bundle <args> providing the mountpoint of the $esp, paths to the files to bundle and full path to the unified efi loader. --amducode '/boot/amd-ucode.img' includes ucode for AMD --intelucode '/boot/intel-ucode.img' includes ucode for Intel Example for an AMD system sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.12-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.12-x86_64' \\ --save '/boot/efi/main.efi' As can be deduced - it is fairly easy to create extra bundles with e.g. a fallback image - just don't do it (See Storage Consideration below).","title":"Define Bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#create-signing-keys_1","text":"A key is required to sign the bundle - so create the key sudo sbctl create-keys","title":"Create Signing Keys"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#generate-bundle-and-sign_1","text":"When you have created the keys - generate the bundle and sign sudo sbctl generate-bundles --sign","title":"Generate Bundle and Sign"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#configure-setup-mode_1","text":"Restart your system and enter the firmware setup systemctl reboot --firmware-setup In the system firmware you need to locate the Secure Boot section, then configure Secure Boot for Setup Mode . How you do this is specific for your firmware - you may need to experiment.","title":"Configure Setup Mode"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#enroll-keys_1","text":"When you are confident the system's Secure Boot is in Setup Mode, boot into your Manjaro system - and enroll your key into Secure Boot key storage, remember to include Microsoft keys sudo sbctl enroll-keys --microsoft The command ensures the firmware Setup Mode is reverted to production mode. It is not automagically protected - for that you need to set an administrative password.","title":"Enroll Keys"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#firmware-boot-entry_1","text":"To be able to use your firmware's boot override it is necesary to create a firmware boot entry. For our PoC the command look like this To avoid confusing the default Manjaro entry; label the entry Manjaro Verified Boot sudo efibootmgr --loader main.efi --create --disk /dev/nvme0n1 --part 1 --label 'Manjaro Verified Boot' --unicode","title":"Firmware boot entry"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#storage-consideration_1","text":"The $esp (efi system partition) with default Microsoft Windows 10 installation is 100M, and this is leaving little room to wiggle, as a single efi image takes 42M, thus leaving 29M remaining space. [nix-n14xwu ~]# ls -l -h /boot/efi total 42M drwx------ 5 root root 1,0K 21 feb 12:59 EFI drwx------ 2 root root 1,0K 21 feb 13:35 loader -rwx------ 1 root root 42M 21 feb 12:42 main.efi drwx------ 2 root root 1,0K 21 feb 11:37 'System Volume Information'","title":"Storage Consideration"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#maintenance_1","text":"The bundle is a static configuration - it will not change automagically - e.g. triggered by a hook. The kernel maintenance within a release e.g. 6.12 is not an issue as the name has not changed. When you decide to switch kernel e.g. from 6.12 to 6.14 - the name changes and you need to maintain your bundle.","title":"Maintenance"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#generate-new-bundle_1","text":"This can be done by recreating your bundle configuration using sbctl sudo sbctl bundle --esp '/boot/efi' \\ --amducode '/boot/amd-ucode.img' \\ --cmdline '/etc/kernel/cmdline' \\ --initramfs '/boot/initramfs-6.14-x86_64.img' \\ --kernel-img '/boot/vmlinuz-6.14-x86_64' \\ --save '/boot/efi/main.efi'","title":"Generate new Bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#manually-update-bundle_1","text":"The bundle configuration is stored in /var/lib/sbctl/bundles.json so you can manually change the filenames but then you have no error checking if you misspell a filename - thus it is not recommended - instead use the bundle command.","title":"Manually update bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#generate-bundle_1","text":"Generate the bundle and sign it sudo sbctl generate-bundles --sign","title":"Generate bundle"},{"location":"manjaro/secure-boot/secure-boot-manjaro-using-repo-only/#protect-your-firmware_1","text":"It is strongly suggested to lock your computers firmware with an administrative password - otherwise it is easy to circumvent the boot measures applied. The firmware will now be enabled and your system may now be compliant with your corporate policies stating Secure Boot must be enabled. Before you rejoice too much - ask your Corporate IT department. Crossposted at Enable Secure Boot For Existing Manjaro Usung Repo Only","title":"Protect Your Firmware"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/","text":"Disk device recognition Arch uses systemd and udev (see Arch Wiki ) to load devices at boot time. The loading order of devices is arbitrary and therefore you cannot predict which device will be available at a given path. But as explained on the Arch wiki static device names do exist and so you can assign specific mountpoint(s) to your device(s) and thus ensure e.g. scripts will work as expected. What to learn Overview of system mount units Structure and Content of a mount unit Mount at boot (immediate mount) Mount at demand (mount on first access) Conclusion 1. What is systemd mount units The systemd manual has the following somewhat contradicting statement Mount units may either be configured via unit files, or via /etc/fstab (see fstab(5) for details). Mounts listed in /etc/fstab will be converted into native units dynamically at boot and when the configuration of the system manager is reloaded. In general, configuring mount points through /etc/fstab is the preferred approach . See systemd-fstab-generator(8) for details about the conversion.- system.d.mount.5.html#FSTAB (Emphasized by me) Logic As mounts listed in fstab will be converted into native units dynamically at boot - logically we create the units ahead so the system don't have to bother with converting fstab - the contradiction in above statement is fstab is the preferred approach . What? Why would would it be preferable to use a configuration which must be parsed and converted when you can create native units? I use mount units because * They are easy to create * They provide clear logic of - What - Where - When - Why - How * Simple auto mount defines Using automount units to mount a device using systemd is a simple secure approach. The top arguments for using mount units you don't have to edit your fstab you don't have to create the mountpoint(s) beforehand you have a clear overview - which you will se later This article will use an USB device which may or may not be available at boot time and when you plug it you want it to be mounted on a special path - it could be dedicated backup disk. The basics of this guide can also be used to mount any extra devices available in your system, or remote shares e.g. WEBDAV, SMB, FTP and NFS. You can find link to a topic containing sample mount units at the end of this article. 2. Structure and Content of a mount unit There is no rules as to where you can mount the device. Just remember a few things Structure Recognizable Don't use /run is a volatile structure recreated at boot Don't use /mnt it's primary use is temporary mount By structure I mean organizing a directory tree - I usually recommend create a data folder on root and populate the tree with your devices and locations like below. By recognizable I mean naming your mount point with a logical description of the content - but don't use dashes anywhere in the mount point - see explanation below. If you really need a double word in your data tree - use a low dash ( _ ). You should also avoid local accented characters (e.g. danish \u00e6 \u00f8 \u00e5 \u00c6 \u00d8 \u00c5) Immediate branches are your devices - and network share mounts in a branch named for the type of fileservice e.g. NFS and SMB. $ tree /data -L 2 /data \u251c\u2500\u2500 backup \u251c\u2500\u2500 build \u251c\u2500\u2500 nfs \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 music \u2502 \u251c\u2500\u2500 photo \u2502 \u251c\u2500\u2500 video \u2502 \u2514\u2500\u2500 web \u251c\u2500\u2500 private \u251c\u2500\u2500 projects \u251c\u2500\u2500 smb \u2502 \u2514\u2500\u2500 web \u2514\u2500\u2500 virtualbox Naming the mount units uses a mandatory convention. Lets say you have a disk for backup and the disk mounts to /data/backup then the filename becomes. data-backup.mount NOTE : Dashes in the file name represents the directory separator - so don't use dashes anywhere in the mount point . Create a file as root $ sudo touch /etc/systemd/system/data-backup.mount Open the file with your favorite CLI editor or a gvfs compliant editor (xed or gedit) $ xed admin:/etc/systemd/system/data-backup.mount Template Insert the following template into the file - and modify the description - continuing our backup disk example [Unit] Description=Mount Backup disk (/data/backup) [Mount] What= Where= #Type= #Options= #TimeoutSec=seconds [Install] WantedBy=multi-user.target Mount The section [Mount] is the same data as you see in your fstab - except the What which must the full path to the device. The nature of systemd makes it impossible to rely on the traditional path /dev/sda1 - so we will use /dev/disk/by-uuid/ . What To get the device uuid you can use lsblk command and the -no UUID to retrieve the uuid you need for the mount. (substitute sdy1 with your actual device and partition) $ lsblk -no UUID /dev/sdy1 67f922cd-a61f-4d5e-84c0-ac8335a7ce67 Then insert the UUID into the file What=/dev/disk/by-uuid/67f922cd-a61f-4d5e-84c0-ac8335a7ce67 Where Next type in the path where you want the device mounted. Normally we would create the path beforehand as this is required for fstab - but not with systemd. If the path do not exist it will be created. :information_source: default permissions is 755 owned by root If your actual device is an existing device and the owner:group UID:GID do not match your device will be mounted read-only. Where=/data/backup Caveat using dashes in a folder-name Don't use a dash - in your path because a dash refer to a new branch on the folder tree and this will break the naming of the mount/automount file Invalid /data/home-backup Valid /data/home_backup Valid /data/home\\x2dbackup To get the correct name for your mount/automount filename when you use dashes in your folder-naming $ systemd-escape -p --suffix=mount \"/data/home-backup\" data/home\\x2dbackup.mount Type The Type is optional for disk devices - but from the viewpoint - the more information we provide - less work for the system. You can retrieve the file system the same way as the UUID. $ lsblk -no FSTYPE /dev/sdy1 ext4 Insert the filesystem type Type=ext4 Other types like NFS, SMB and FTP requires Type to be set. Options The Options is optional for disk devices. As with fstab it takes a comma separated list of options for the filesystem mounted. Other types like NFS, SMB and FTP requires Options to be set. Options=defaults,rw,noatime Save the file 3. Mount on boot This works just like your fstab - if the device is not available - the system will use the default 90 seconds for the device to be available. The behavior can be changed by setting TimeoutSec= to a value matching the device actual mount time or use an additional automount unit. First reload the systemd daemon $ sudo systemctl daemon-reload Note the state of the mount $ systemctl show -p ActiveState -p SubState --value data-backup.mount Mount the device $ sudo systemctl start data-backup.mount Now you can verify the service $ systemctl show -p ActiveState -p SubState --value data-backup.mount Note that the folder was created by systemd - list the content of the mount NOTE: note permissions changed to partition content $ ls -la /data/backup If the device is an internal device always available you can enable the mount and your device will be mounted during boot. sudo systemctl enable data-backup.mount If - on the other hand - this is an USB device - which is not available at boot time - do not enable the the mount unit but proceed to create an .automount unit for your USB device. Check permissions If this is a newly formatted device or a reused device - it is wise to check the permissions. If you get issues with the device being mounted read-only - depending on filesystem - it may be due to the permissions stored on the device. If the device is using a Linux file system you can change permissions when it is mounted. To change the permissions on your games partition mounted at /data/games sudo chmod ugo+rw /data/games -R If your device is a shared device dual booting Windows and Linux and formatted using NTFS and it mounts read-only - reboot your system into Windows and disable features like Fastboot, hibernation, sleep and hybrid sleep as these will taint the filesystem and cause Linux to mount it read-only. 4. Mount on demand An automount unit is a special unit which takes care of activating the corresponding mount unit when the mount path is accessed. The difference for mount and automount is when it is mounted. To demonstrate the automount - first unmount the data-mount $ sudo systemctl stop data-backup.mount Verify the content of the mount point - it should now be empty. $ ls -la /data/backup Now we proceed to create an automount for the mount. Create a file - it must be named using the same rule as the mount but with the extension of .automount $ sudo touch /etc/systemd/system/data-backup.automount NOTE: the automount service will fail if the device path is mounted Automount define Edit the file and insert the following content and save it. [Unit] Description=Automount backup partition [Automount] Where=/data/backup TimeoutIdleSec=10 [Install] WantedBy=multi-user.target Test automount Now enable and start the automount for data-backup $ sudo systemctl enable --now data-backup.automount You know you unmounted the device - don't mount it - just access the /data/backup folder from terminal or a file manager - you will find systemd mounts it behind the scenes. 5. Conclusion This approach is a safer way than editing your fstab. Worst case the device is not mounted - if you make a mistake in fstab - the system breaks. You can mount all kind of devices - NFS, SMB, FTP, WEBDAV, SFTP, SSH - using this recipe.","title":"systemd - mount units"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#disk-device-recognition","text":"Arch uses systemd and udev (see Arch Wiki ) to load devices at boot time. The loading order of devices is arbitrary and therefore you cannot predict which device will be available at a given path. But as explained on the Arch wiki static device names do exist and so you can assign specific mountpoint(s) to your device(s) and thus ensure e.g. scripts will work as expected.","title":"Disk device recognition"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#what-to-learn","text":"Overview of system mount units Structure and Content of a mount unit Mount at boot (immediate mount) Mount at demand (mount on first access) Conclusion","title":"What to learn"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#1-what-is-systemd-mount-units","text":"The systemd manual has the following somewhat contradicting statement Mount units may either be configured via unit files, or via /etc/fstab (see fstab(5) for details). Mounts listed in /etc/fstab will be converted into native units dynamically at boot and when the configuration of the system manager is reloaded. In general, configuring mount points through /etc/fstab is the preferred approach . See systemd-fstab-generator(8) for details about the conversion.- system.d.mount.5.html#FSTAB (Emphasized by me)","title":"1. What is systemd mount units"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#logic","text":"As mounts listed in fstab will be converted into native units dynamically at boot - logically we create the units ahead so the system don't have to bother with converting fstab - the contradiction in above statement is fstab is the preferred approach . What? Why would would it be preferable to use a configuration which must be parsed and converted when you can create native units? I use mount units because * They are easy to create * They provide clear logic of - What - Where - When - Why - How * Simple auto mount defines","title":"Logic"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#_1","text":"Using automount units to mount a device using systemd is a simple secure approach. The top arguments for using mount units you don't have to edit your fstab you don't have to create the mountpoint(s) beforehand you have a clear overview - which you will se later This article will use an USB device which may or may not be available at boot time and when you plug it you want it to be mounted on a special path - it could be dedicated backup disk. The basics of this guide can also be used to mount any extra devices available in your system, or remote shares e.g. WEBDAV, SMB, FTP and NFS. You can find link to a topic containing sample mount units at the end of this article.","title":""},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#2-structure-and-content-of-a-mount-unit","text":"There is no rules as to where you can mount the device. Just remember a few things Structure Recognizable Don't use /run is a volatile structure recreated at boot Don't use /mnt it's primary use is temporary mount By structure I mean organizing a directory tree - I usually recommend create a data folder on root and populate the tree with your devices and locations like below. By recognizable I mean naming your mount point with a logical description of the content - but don't use dashes anywhere in the mount point - see explanation below. If you really need a double word in your data tree - use a low dash ( _ ). You should also avoid local accented characters (e.g. danish \u00e6 \u00f8 \u00e5 \u00c6 \u00d8 \u00c5) Immediate branches are your devices - and network share mounts in a branch named for the type of fileservice e.g. NFS and SMB. $ tree /data -L 2 /data \u251c\u2500\u2500 backup \u251c\u2500\u2500 build \u251c\u2500\u2500 nfs \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 music \u2502 \u251c\u2500\u2500 photo \u2502 \u251c\u2500\u2500 video \u2502 \u2514\u2500\u2500 web \u251c\u2500\u2500 private \u251c\u2500\u2500 projects \u251c\u2500\u2500 smb \u2502 \u2514\u2500\u2500 web \u2514\u2500\u2500 virtualbox Naming the mount units uses a mandatory convention. Lets say you have a disk for backup and the disk mounts to /data/backup then the filename becomes. data-backup.mount NOTE : Dashes in the file name represents the directory separator - so don't use dashes anywhere in the mount point . Create a file as root $ sudo touch /etc/systemd/system/data-backup.mount Open the file with your favorite CLI editor or a gvfs compliant editor (xed or gedit) $ xed admin:/etc/systemd/system/data-backup.mount","title":"2. Structure and Content of a mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#template","text":"Insert the following template into the file - and modify the description - continuing our backup disk example [Unit] Description=Mount Backup disk (/data/backup) [Mount] What= Where= #Type= #Options= #TimeoutSec=seconds [Install] WantedBy=multi-user.target","title":"Template"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#mount","text":"The section [Mount] is the same data as you see in your fstab - except the What which must the full path to the device. The nature of systemd makes it impossible to rely on the traditional path /dev/sda1 - so we will use /dev/disk/by-uuid/ .","title":"Mount"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#what","text":"To get the device uuid you can use lsblk command and the -no UUID to retrieve the uuid you need for the mount. (substitute sdy1 with your actual device and partition) $ lsblk -no UUID /dev/sdy1 67f922cd-a61f-4d5e-84c0-ac8335a7ce67 Then insert the UUID into the file What=/dev/disk/by-uuid/67f922cd-a61f-4d5e-84c0-ac8335a7ce67","title":"What"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#where","text":"Next type in the path where you want the device mounted. Normally we would create the path beforehand as this is required for fstab - but not with systemd. If the path do not exist it will be created. :information_source: default permissions is 755 owned by root If your actual device is an existing device and the owner:group UID:GID do not match your device will be mounted read-only. Where=/data/backup Caveat using dashes in a folder-name Don't use a dash - in your path because a dash refer to a new branch on the folder tree and this will break the naming of the mount/automount file Invalid /data/home-backup Valid /data/home_backup Valid /data/home\\x2dbackup To get the correct name for your mount/automount filename when you use dashes in your folder-naming $ systemd-escape -p --suffix=mount \"/data/home-backup\" data/home\\x2dbackup.mount","title":"Where"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#type","text":"The Type is optional for disk devices - but from the viewpoint - the more information we provide - less work for the system. You can retrieve the file system the same way as the UUID. $ lsblk -no FSTYPE /dev/sdy1 ext4 Insert the filesystem type Type=ext4 Other types like NFS, SMB and FTP requires Type to be set.","title":"Type"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#options","text":"The Options is optional for disk devices. As with fstab it takes a comma separated list of options for the filesystem mounted. Other types like NFS, SMB and FTP requires Options to be set. Options=defaults,rw,noatime Save the file","title":"Options"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#3-mount-on-boot","text":"This works just like your fstab - if the device is not available - the system will use the default 90 seconds for the device to be available. The behavior can be changed by setting TimeoutSec= to a value matching the device actual mount time or use an additional automount unit. First reload the systemd daemon $ sudo systemctl daemon-reload Note the state of the mount $ systemctl show -p ActiveState -p SubState --value data-backup.mount Mount the device $ sudo systemctl start data-backup.mount Now you can verify the service $ systemctl show -p ActiveState -p SubState --value data-backup.mount Note that the folder was created by systemd - list the content of the mount NOTE: note permissions changed to partition content $ ls -la /data/backup If the device is an internal device always available you can enable the mount and your device will be mounted during boot. sudo systemctl enable data-backup.mount If - on the other hand - this is an USB device - which is not available at boot time - do not enable the the mount unit but proceed to create an .automount unit for your USB device.","title":"3. Mount on boot"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#check-permissions","text":"If this is a newly formatted device or a reused device - it is wise to check the permissions. If you get issues with the device being mounted read-only - depending on filesystem - it may be due to the permissions stored on the device. If the device is using a Linux file system you can change permissions when it is mounted. To change the permissions on your games partition mounted at /data/games sudo chmod ugo+rw /data/games -R If your device is a shared device dual booting Windows and Linux and formatted using NTFS and it mounts read-only - reboot your system into Windows and disable features like Fastboot, hibernation, sleep and hybrid sleep as these will taint the filesystem and cause Linux to mount it read-only.","title":"Check permissions"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#4-mount-on-demand","text":"An automount unit is a special unit which takes care of activating the corresponding mount unit when the mount path is accessed. The difference for mount and automount is when it is mounted. To demonstrate the automount - first unmount the data-mount $ sudo systemctl stop data-backup.mount Verify the content of the mount point - it should now be empty. $ ls -la /data/backup Now we proceed to create an automount for the mount. Create a file - it must be named using the same rule as the mount but with the extension of .automount $ sudo touch /etc/systemd/system/data-backup.automount NOTE: the automount service will fail if the device path is mounted","title":"4. Mount on demand"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#automount-define","text":"Edit the file and insert the following content and save it. [Unit] Description=Automount backup partition [Automount] Where=/data/backup TimeoutIdleSec=10 [Install] WantedBy=multi-user.target","title":"Automount define"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#test-automount","text":"Now enable and start the automount for data-backup $ sudo systemctl enable --now data-backup.automount You know you unmounted the device - don't mount it - just access the /data/backup folder from terminal or a file manager - you will find systemd mounts it behind the scenes.","title":"Test automount"},{"location":"manjaro/systemd/systemd-mount-unit-configuration/#5-conclusion","text":"This approach is a safer way than editing your fstab. Worst case the device is not mounted - if you make a mistake in fstab - the system breaks. You can mount all kind of devices - NFS, SMB, FTP, WEBDAV, SFTP, SSH - using this recipe.","title":"5. Conclusion"},{"location":"manjaro/systemd/systemd-mount-unit-ftp-sample/","text":"MOUNT unit for FTP server Using curlftpfs . It is also possible to store the username and password in a safe location readable only by root. You can put the user and password in a .netrc file in the home directory of the user that executes CurlFtpFS. It can have 600 permission. It's still clear text but at least is not accessible by all. The format is: machine ftp.host.com login myuser password mypass See [curlftpfs on archlinux wiki][3]. Replace the $VARIABLES with the actual values for your use case. Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount FTP server (ftp.server.tld) using curlftpfs Wants=network-online.service [Mount] What=curlftpfs#ftp.server.tld Where=$YOUR_MOUNT_PATH Type=fuse Options=rw,nosuid,uid=$UID,gid=$GID,allow_other,user=$FTPUSER:$FTPPASS [Install] WantedBy=remote-fs.target WantedBy=multi-user.target automount unit Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Automount ftp server ftp.server.tld [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=300 [Install] WantedBy=multi-user.target","title":"FTP mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-ftp-sample/#mount-unit-for-ftp-server","text":"Using curlftpfs . It is also possible to store the username and password in a safe location readable only by root. You can put the user and password in a .netrc file in the home directory of the user that executes CurlFtpFS. It can have 600 permission. It's still clear text but at least is not accessible by all. The format is: machine ftp.host.com login myuser password mypass See [curlftpfs on archlinux wiki][3]. Replace the $VARIABLES with the actual values for your use case. Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount FTP server (ftp.server.tld) using curlftpfs Wants=network-online.service [Mount] What=curlftpfs#ftp.server.tld Where=$YOUR_MOUNT_PATH Type=fuse Options=rw,nosuid,uid=$UID,gid=$GID,allow_other,user=$FTPUSER:$FTPPASS [Install] WantedBy=remote-fs.target WantedBy=multi-user.target","title":"MOUNT unit for FTP server"},{"location":"manjaro/systemd/systemd-mount-unit-ftp-sample/#automount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Automount ftp server ftp.server.tld [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=300 [Install] WantedBy=multi-user.target","title":"automount unit"},{"location":"manjaro/systemd/systemd-mount-unit-nfs-sample/","text":"NFS network share mount unit Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount NAS Video share using NFS [Mount] What=$YOUR_SERVER:/$YOUR_SHARE Where=$YOUR_MOUNT_PATH Type=nfs Options=_netdev,auto [Install] WantedBy=multi-user.target automount unit Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Automount video share usuing NFS [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=10 [Install] WantedBy=multi-user.target","title":"NFS mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-nfs-sample/#nfs-network-share","text":"","title":"NFS network share"},{"location":"manjaro/systemd/systemd-mount-unit-nfs-sample/#mount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount NAS Video share using NFS [Mount] What=$YOUR_SERVER:/$YOUR_SHARE Where=$YOUR_MOUNT_PATH Type=nfs Options=_netdev,auto [Install] WantedBy=multi-user.target","title":"mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-nfs-sample/#automount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Automount video share usuing NFS [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=10 [Install] WantedBy=multi-user.target","title":"automount unit"},{"location":"manjaro/systemd/systemd-mount-unit-partition-sample/","text":"Disk PARTITION [Type] and [Options] are optional for disk devices. To reduce unnecessary writings to SSD devices the noatime option is recommended. mount unit Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount build partition [Mount] What=/dev/disk/by-uuid/$UUID Where=$YOUR_MOUNT_PATH Type=ext4 Options=rw,noatime [Install] WantedBy=multi-user.target","title":"Partition mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-partition-sample/#disk-partition","text":"[Type] and [Options] are optional for disk devices. To reduce unnecessary writings to SSD devices the noatime option is recommended.","title":"Disk PARTITION"},{"location":"manjaro/systemd/systemd-mount-unit-partition-sample/#mount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount build partition [Mount] What=/dev/disk/by-uuid/$UUID Where=$YOUR_MOUNT_PATH Type=ext4 Options=rw,noatime [Install] WantedBy=multi-user.target","title":"mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-removable-sample/","text":"USB device partition [Type] and [Options] are optional for disk devices. To reduce unnecessary writings to SSD devices the noatime option is recommended. mount unit Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount USB backup device partition [Mount] What=/dev/disk/by-uuid/$UUID Where=$YOUR_MOUNT_PATH Type=ext4 Options=rw,noatime [Install] WantedBy=multi-user.target USB partition automount unit Name the file according to $YOUR_MOUNT_PATH.autommount [Unit] Description=Automount USB backup partition [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=10 [Install] WantedBy=multi-user.target","title":"USB device"},{"location":"manjaro/systemd/systemd-mount-unit-removable-sample/#usb-device-partition","text":"[Type] and [Options] are optional for disk devices. To reduce unnecessary writings to SSD devices the noatime option is recommended.","title":"USB device partition"},{"location":"manjaro/systemd/systemd-mount-unit-removable-sample/#mount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount USB backup device partition [Mount] What=/dev/disk/by-uuid/$UUID Where=$YOUR_MOUNT_PATH Type=ext4 Options=rw,noatime [Install] WantedBy=multi-user.target","title":"mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-removable-sample/#usb-partition-automount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.autommount [Unit] Description=Automount USB backup partition [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=10 [Install] WantedBy=multi-user.target","title":"USB partition automount unit"},{"location":"manjaro/systemd/systemd-mount-unit-samba-sample/","text":"SMB network share The package smbclient is enough. The credentials can be stored in location readable only by root. Replace the $VARIABLES with the values for your system NOTE: According to the archlinux wiki the uid and gid can cause I/O errors. Warning: Using uid and/or gid as mount options may cause I/O errors, it is recommended to set/check correct File permissions and attributes instead. - https://wiki.archlinux.org/index.php/Samba#Manual_mounting More information on Samba can be found on the archlinux wiki SMB credentials Create a file /etc/smb.cred or in user's home with content user=$SMBUSER password=$SMBPASS workgroup=$WORKGROUP Make the file readonly to owner sudo chmod 600 /etc/smb.cred SMB version If needed you add a version to the options string e.g. vers=NT1 mount unit Name the file according to $YOUR_MOUNT_PATH.mount [Unit][Unit] Description=NAS SMB video share [Mount] What=//$YOUR_SERVER/$YOUR_SHARE Where=$YOUR_MOUNT_PATH Type=cifs Options=credentials=/etc/smb.cred,_netdev,iocharset=utf8,rw,file_mode=0777,dir_mode=0777 TimeoutSec=30 [Install] WantedBy=multi-user.target automount unit Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Automount video share using SMB [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=10 [Install] WantedBy=multi-user.target","title":"SMB mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-samba-sample/#smb-network-share","text":"The package smbclient is enough. The credentials can be stored in location readable only by root. Replace the $VARIABLES with the values for your system NOTE: According to the archlinux wiki the uid and gid can cause I/O errors. Warning: Using uid and/or gid as mount options may cause I/O errors, it is recommended to set/check correct File permissions and attributes instead. - https://wiki.archlinux.org/index.php/Samba#Manual_mounting More information on Samba can be found on the archlinux wiki","title":"SMB network share"},{"location":"manjaro/systemd/systemd-mount-unit-samba-sample/#smb-credentials","text":"Create a file /etc/smb.cred or in user's home with content user=$SMBUSER password=$SMBPASS workgroup=$WORKGROUP Make the file readonly to owner sudo chmod 600 /etc/smb.cred","title":"SMB credentials"},{"location":"manjaro/systemd/systemd-mount-unit-samba-sample/#smb-version","text":"If needed you add a version to the options string e.g. vers=NT1","title":"SMB version"},{"location":"manjaro/systemd/systemd-mount-unit-samba-sample/#mount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.mount [Unit][Unit] Description=NAS SMB video share [Mount] What=//$YOUR_SERVER/$YOUR_SHARE Where=$YOUR_MOUNT_PATH Type=cifs Options=credentials=/etc/smb.cred,_netdev,iocharset=utf8,rw,file_mode=0777,dir_mode=0777 TimeoutSec=30 [Install] WantedBy=multi-user.target","title":"mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-samba-sample/#automount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Automount video share using SMB [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=10 [Install] WantedBy=multi-user.target","title":"automount unit"},{"location":"manjaro/systemd/systemd-mount-unit-webdav-sample/","text":"WEBDAV See the Arch wiki on webdav . Install davfs2 using a custom AUR buildscript Edit the file /etc/davfs2/secrets and append your webdav service and credentials http(s)://address:<port>/path davusername \"davpassword\" Or create a user file at ~/.davfs2/secrets for user specific mounts mount unit Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount WebDAV Service on server https://host:port/path Wants=network-online.service [Mount] What=http(s)://address:<port>/path Where=$YOUR_MOUNT_PATH Options=rw,_netdev Type=davfs TimeoutSec=15 [Install] WantedBy=remote-fs.target WantedBy=multi-user.target automount unit Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Mount WebDAV Service [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=300 [Install] WantedBy=multi-user.target","title":"WEBDAV mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-webdav-sample/#webdav","text":"See the Arch wiki on webdav . Install davfs2 using a custom AUR buildscript Edit the file /etc/davfs2/secrets and append your webdav service and credentials http(s)://address:<port>/path davusername \"davpassword\" Or create a user file at ~/.davfs2/secrets for user specific mounts","title":"WEBDAV"},{"location":"manjaro/systemd/systemd-mount-unit-webdav-sample/#mount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.mount [Unit] Description=Mount WebDAV Service on server https://host:port/path Wants=network-online.service [Mount] What=http(s)://address:<port>/path Where=$YOUR_MOUNT_PATH Options=rw,_netdev Type=davfs TimeoutSec=15 [Install] WantedBy=remote-fs.target WantedBy=multi-user.target","title":"mount unit"},{"location":"manjaro/systemd/systemd-mount-unit-webdav-sample/#automount-unit","text":"Name the file according to $YOUR_MOUNT_PATH.automount [Unit] Description=Mount WebDAV Service [Automount] Where=$YOUR_MOUNT_PATH TimeoutIdleSec=300 [Install] WantedBy=multi-user.target","title":"automount unit"},{"location":"manjaro/systemd/systemd-unit-documentation/","text":"Especially the %i is interesting in terms of user instantiated mount units https://www.freedesktop.org/software/systemd/man/systemd.unit.html And another idea https://askubuntu.com/questions/1021643/how-to-specify-a-password-when-mounting-a-smb-share-with-gio https://unix.stackexchange.com/questions/296148/how-to-remount-a-systemd-mount-unit-with-different-options","title":"Systemd unit manual"},{"location":"manjaro/troubleshooting/troubleshoot-boot-to-shell/","text":"Boot your system to the grub menu. ESC Edit the menu entry with E Add at the line starting with linux this: init=/bin/bash Type the function key to boot. Now at the bash session remount the root filesystem writeable: mount -n -o remount,rw / Now you have root .... careful now Surely dangerous, remember though - you must have physical access to the machine to do things like this.","title":"kernel init"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/","text":"Locale error message When you get errors like these examples - it is not obvious what causes it $ rofi (process:1628): Rofi-WARNING **: 07:34:43.942: Failed to set locale. $ sterminal couldn't read from shell: Input/output error child exited with status 1 tmux: invalid LC_ALL, LC_CTYPE or LANG Check your settings !!! Obviously you need to replace the locale with something relevant for your system. !!! I have written this using my system's locale - en_DK for messages and da_DK for the rest of the system. Check locale settings $ localectl System Locale: LANG=en_DK.UTF-8 LC_NUMERIC=da_DK.UTF-8 LC_TIME=da_DK.UTF-8 LC_MONETARY=da_DK.UTF-8 LC_PAPER=da_DK.UTF-8 LC_NAME=da_DK.UTF-8 LC_ADDRESS=da_DK.UTF-8 LC_TELEPHONE=da_DK.UTF-8 LC_MEASUREMENT=da_DK.UTF-8 LC_IDENTIFICATION=da_DK.UTF-8 VC Keymap: dk-latin1 X11 Layout: dk X11 Model: pc105 Check installed locales $ locale -a C en_DK.utf8 en_US.utf8 POSIX The installed locales does not match the settings listed by localectl - as you can see the da_DK part is missing. Fix locale error It is recommended to use the utf8 version unless you have compelling reasons to select otherwise. Method 1 Edit /etc/locale.gen and ensure that all in-use locales has been uncommented. For fallback messages enable en_US as well $ sudo nano /etc/locale.gen ... #cy_GB ISO-8859-14 da_DK.UTF-8 UTF-8 #da_DK ISO-8859-1 .... #en_CA ISO-8859-1 en_DK.UTF-8 UTF-8 #en_DK ISO-8859-1 ... #en_SG ISO-8859-1 en_US.UTF-8 UTF-8 #en_US ISO-8859-1 ... Method 2 Based on the comment by @nam1962 (see [[2]]). Check if the locale you want to use is available in the locale list ( /etc/locale.gen ) $ cat /etc/locale.gen | grep 'da_DK' #da_DK.UTF-8 UTF-8 #da_DK ISO-8859-1 Use sed command To enable a locale (uncommenting the line) $ sudo sed -i '/en_DK.UTF-8/s/^#//g' /etc/locale.gen $ sudo sed -i '/en_US.UTF-8/s/^#//g' /etc/locale.gen To disable a locale (aka commenting the locale) $ sudo sed -i '/en_DK.UTF-8/s/^/#/g' /etc/locale.gen Rebuild locales $ sudo locale-gen Generating locales... da_DK.UTF-8... done en_DK.UTF-8... done en_US.UTF-8... done Generation complete. Recheck your locales $ locale -a C da_DK.utf8 en_DK.utf8 en_US.utf8 POSIX Verify it works \u279c ~ rofi -r Rofi is unsure what to show. Please specify the mode you want to show. rofi -show {mode} The following modi are enabled: * window * run * ssh The following can be enabled: * windowcd * drun * combi * keys To activate a mode, add it to the list of modi in the modi setting. Now it is fixed Enjoy","title":"Locale error messages"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#locale-error-message","text":"When you get errors like these examples - it is not obvious what causes it $ rofi (process:1628): Rofi-WARNING **: 07:34:43.942: Failed to set locale. $ sterminal couldn't read from shell: Input/output error child exited with status 1 tmux: invalid LC_ALL, LC_CTYPE or LANG","title":"Locale error message"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#check-your-settings","text":"!!! Obviously you need to replace the locale with something relevant for your system. !!! I have written this using my system's locale - en_DK for messages and da_DK for the rest of the system. Check locale settings $ localectl System Locale: LANG=en_DK.UTF-8 LC_NUMERIC=da_DK.UTF-8 LC_TIME=da_DK.UTF-8 LC_MONETARY=da_DK.UTF-8 LC_PAPER=da_DK.UTF-8 LC_NAME=da_DK.UTF-8 LC_ADDRESS=da_DK.UTF-8 LC_TELEPHONE=da_DK.UTF-8 LC_MEASUREMENT=da_DK.UTF-8 LC_IDENTIFICATION=da_DK.UTF-8 VC Keymap: dk-latin1 X11 Layout: dk X11 Model: pc105 Check installed locales $ locale -a C en_DK.utf8 en_US.utf8 POSIX The installed locales does not match the settings listed by localectl - as you can see the da_DK part is missing.","title":"Check your settings"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#fix-locale-error","text":"It is recommended to use the utf8 version unless you have compelling reasons to select otherwise.","title":"Fix locale error"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#method-1","text":"Edit /etc/locale.gen and ensure that all in-use locales has been uncommented. For fallback messages enable en_US as well $ sudo nano /etc/locale.gen ... #cy_GB ISO-8859-14 da_DK.UTF-8 UTF-8 #da_DK ISO-8859-1 .... #en_CA ISO-8859-1 en_DK.UTF-8 UTF-8 #en_DK ISO-8859-1 ... #en_SG ISO-8859-1 en_US.UTF-8 UTF-8 #en_US ISO-8859-1 ...","title":"Method 1"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#method-2","text":"Based on the comment by @nam1962 (see [[2]]). Check if the locale you want to use is available in the locale list ( /etc/locale.gen ) $ cat /etc/locale.gen | grep 'da_DK' #da_DK.UTF-8 UTF-8 #da_DK ISO-8859-1 Use sed command To enable a locale (uncommenting the line) $ sudo sed -i '/en_DK.UTF-8/s/^#//g' /etc/locale.gen $ sudo sed -i '/en_US.UTF-8/s/^#//g' /etc/locale.gen To disable a locale (aka commenting the locale) $ sudo sed -i '/en_DK.UTF-8/s/^/#/g' /etc/locale.gen","title":"Method 2"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#rebuild-locales","text":"$ sudo locale-gen Generating locales... da_DK.UTF-8... done en_DK.UTF-8... done en_US.UTF-8... done Generation complete.","title":"Rebuild locales"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#recheck-your-locales","text":"$ locale -a C da_DK.utf8 en_DK.utf8 en_US.utf8 POSIX","title":"Recheck your locales"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#verify-it-works","text":"\u279c ~ rofi -r Rofi is unsure what to show. Please specify the mode you want to show. rofi -show {mode} The following modi are enabled: * window * run * ssh The following can be enabled: * windowcd * drun * combi * keys To activate a mode, add it to the list of modi in the modi setting.","title":"Verify it works"},{"location":"manjaro/troubleshooting/troubleshoot-locale-error-messages/#now-it-is-fixed","text":"Enjoy","title":"Now it is fixed"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/","text":"Original posted by @FadeMind on Manjaro forum Issue Some files are signed with developers GPG sign. Without validation of source tarbals, build package fails. For automatically downloading and adding new keys to LOCAL GPG database follow once this guide. Install GnuPG sudo pacman -S gnupg pinentry --needed --noconfirm Enable following services sockets as normal user: systemctl --user enable gpg-agent.socket systemctl --user start gpg-agent.socket systemctl --user enable dirmngr.socket systemctl --user start dirmngr.socket Files and content $HOME/.gnupg/dirmngr.conf keyserver hkps://pgp.mit.edu keyserver hkps://hkps.pool.sks-keyservers.net keyserver hkp://keyserver.ubuntu.com:80 $HOME/.gnupg/gpg.conf keyserver hkps://pgp.mit.edu keyserver hkps://hkps.pool.sks-keyservers.net keyserver hkp://keyserver.ubuntu.com:80 keyserver-options auto-key-retrieve require-cross-certification keyring /etc/pacman.d/gnupg/pubring.gpg use-agent $HOME/.gnupg/gpg-agent.conf NOTICE: If You are in NON-KDE use pinentry-qt or pinentry-gtk-2 . default-cache-ttl 300 max-cache-ttl 999999 pinentry-program /usr/bin/pinentry-qt ### uncomment GTK2 or kwallet variant instead of QT if you needed. # pinentry-program /usr/bin/pinentry-gtk-2 # pinentry-program /usr/bin/pinentry-kwallet pinentry-kwallet is part of kwalletcli from AUR You need build and install (via yay/pacaur tool) if you want store passwords in kwallet. Reload GPG Agent gpg-connect-agent reloadagent /bye","title":"Retrieve missing GPG using makepkg"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#issue","text":"Some files are signed with developers GPG sign. Without validation of source tarbals, build package fails. For automatically downloading and adding new keys to LOCAL GPG database follow once this guide.","title":"Issue"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#install-gnupg","text":"sudo pacman -S gnupg pinentry --needed --noconfirm","title":"Install GnuPG"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#enable-following-services-sockets-as-normal-user","text":"systemctl --user enable gpg-agent.socket systemctl --user start gpg-agent.socket systemctl --user enable dirmngr.socket systemctl --user start dirmngr.socket","title":"Enable following services sockets as normal user:"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#files-and-content","text":"","title":"Files and content"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#homegnupgdirmngrconf","text":"keyserver hkps://pgp.mit.edu keyserver hkps://hkps.pool.sks-keyservers.net keyserver hkp://keyserver.ubuntu.com:80","title":"$HOME/.gnupg/dirmngr.conf"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#homegnupggpgconf","text":"keyserver hkps://pgp.mit.edu keyserver hkps://hkps.pool.sks-keyservers.net keyserver hkp://keyserver.ubuntu.com:80 keyserver-options auto-key-retrieve require-cross-certification keyring /etc/pacman.d/gnupg/pubring.gpg use-agent","title":"$HOME/.gnupg/gpg.conf"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#homegnupggpg-agentconf","text":"NOTICE: If You are in NON-KDE use pinentry-qt or pinentry-gtk-2 . default-cache-ttl 300 max-cache-ttl 999999 pinentry-program /usr/bin/pinentry-qt ### uncomment GTK2 or kwallet variant instead of QT if you needed. # pinentry-program /usr/bin/pinentry-gtk-2 # pinentry-program /usr/bin/pinentry-kwallet pinentry-kwallet is part of kwalletcli from AUR You need build and install (via yay/pacaur tool) if you want store passwords in kwallet.","title":"$HOME/.gnupg/gpg-agent.conf"},{"location":"manjaro/troubleshooting/troubleshoot-makepkg-missing-gpg-keys/#reload-gpg-agent","text":"gpg-connect-agent reloadagent /bye","title":"Reload GPG Agent"},{"location":"manjaro/troubleshooting/troubleshoot-manjaro-windows-dual-boot/","text":"Symptom After installation system boots directly to Windows. Manjaro can be booted using the system's firmware boot-override. Possible cause This could be due to Windows being installed using legacy boot on GPT. When Manjaro is booted from USB on a EFI enabled system it will boot in EFI mode and install in EFI mode. Most firmware which provides both Legacy boot (CSM or Compatibility Mode) and EFI will try Legacy before EFI and therefore Manjaro is only bootable when selected from the firmware boot override. In theory - it should be possible to change system boot from EFI to Legacy, by manipulating the partition table. Possible solution !! The following is untested - it is speculative but based on my knowledge of GPT partition table - no warrent you will succeed - manipulating the filesystem partition have the potential of being destructive - beware - there be dragons! $ lsblk -lno NAME,PARTTYPENAME,MOUNTPOINT To change from EFI to Legacy, by changing the EFI partition type from 0xEF00 to 0x0700 and run the grub installer for Legacy boot. This does not require booting from a live ISO - boot using your system's boot override to select Manjaro. Just in case the solution does not work - be sure to have a working bootable USB stick at hand to be able to revert the changes. Login and open a terminal - first un-mount the EFI partition # umount /boot/efi Then edit your fstab and comment the line mounting your EFI partition # nano /etc/fstab Locate the line reading UUID=x-y _ where _x-y is a placeholder the UUID on the system in question UUID=x-y /boot/efi vfat umask=0077 0 2 And add a # in the beginning of the line #UUID=x-y /boot/efi vfat umask=0077 0 2 Press F2 y to save the file Then run a partition tool and change the partition type for the EFI partition. Depending on your system you need to replace $DEVICE with your actual device name # cgdisk /dev/$DEVICE First verify if a legacy boot partition exist - it is usually located at the beginning of the disk as type BIOS boot partition. The size is usually very small 1M sometimes 16M. If it is not present you need to create it. While often located within the first MB's of the device this is not mandatory. What is mandatory is the partition type 0xEF02 and it must be unformatted. If you have available 1024KiB space at the beginning of the disk you can create within that space select the empty space press Enter on [ New ] press Enter twice enter the hex number EF02 and press Enter Select the EFI partition press Enter [ Type ] enter the hex number 0700 and press Enter press w to write the change enter the word yes in all lowercase and press Enter press q to exit Run grub installer for legacy boot - target the primary device /dev/$DEVICE # grub-install --target=i386-pc --recheck --boot-directory=/boot /dev/$DEVICE Reboot the system","title":"Troubleshooting Manjaro Windows dual-boot"},{"location":"manjaro/troubleshooting/troubleshoot-manjaro-windows-dual-boot/#symptom","text":"After installation system boots directly to Windows. Manjaro can be booted using the system's firmware boot-override.","title":"Symptom"},{"location":"manjaro/troubleshooting/troubleshoot-manjaro-windows-dual-boot/#possible-cause","text":"This could be due to Windows being installed using legacy boot on GPT. When Manjaro is booted from USB on a EFI enabled system it will boot in EFI mode and install in EFI mode. Most firmware which provides both Legacy boot (CSM or Compatibility Mode) and EFI will try Legacy before EFI and therefore Manjaro is only bootable when selected from the firmware boot override. In theory - it should be possible to change system boot from EFI to Legacy, by manipulating the partition table.","title":"Possible cause"},{"location":"manjaro/troubleshooting/troubleshoot-manjaro-windows-dual-boot/#possible-solution","text":"!! The following is untested - it is speculative but based on my knowledge of GPT partition table - no warrent you will succeed - manipulating the filesystem partition have the potential of being destructive - beware - there be dragons! $ lsblk -lno NAME,PARTTYPENAME,MOUNTPOINT To change from EFI to Legacy, by changing the EFI partition type from 0xEF00 to 0x0700 and run the grub installer for Legacy boot. This does not require booting from a live ISO - boot using your system's boot override to select Manjaro. Just in case the solution does not work - be sure to have a working bootable USB stick at hand to be able to revert the changes. Login and open a terminal - first un-mount the EFI partition # umount /boot/efi Then edit your fstab and comment the line mounting your EFI partition # nano /etc/fstab Locate the line reading UUID=x-y _ where _x-y is a placeholder the UUID on the system in question UUID=x-y /boot/efi vfat umask=0077 0 2 And add a # in the beginning of the line #UUID=x-y /boot/efi vfat umask=0077 0 2 Press F2 y to save the file Then run a partition tool and change the partition type for the EFI partition. Depending on your system you need to replace $DEVICE with your actual device name # cgdisk /dev/$DEVICE First verify if a legacy boot partition exist - it is usually located at the beginning of the disk as type BIOS boot partition. The size is usually very small 1M sometimes 16M. If it is not present you need to create it. While often located within the first MB's of the device this is not mandatory. What is mandatory is the partition type 0xEF02 and it must be unformatted. If you have available 1024KiB space at the beginning of the disk you can create within that space select the empty space press Enter on [ New ] press Enter twice enter the hex number EF02 and press Enter Select the EFI partition press Enter [ Type ] enter the hex number 0700 and press Enter press w to write the change enter the word yes in all lowercase and press Enter press q to exit Run grub installer for legacy boot - target the primary device /dev/$DEVICE # grub-install --target=i386-pc --recheck --boot-directory=/boot /dev/$DEVICE Reboot the system","title":"Possible solution"},{"location":"manjaro/troubleshooting/troubleshoot-system-missing-firmware/","text":"UEFI firmware implementations Some systems has a nasty habit of losing access to the firmware after your Linux installation. A couple of examples Acer Community: Laptop lost firmware access Acer Community: Dual boot laptop lost firmware access Manjaro Community: Brandnew Acer laptop lost firmware access Manjaro Community: Acer laptop lost firmware access Manjaro Community: Fujitsu Siemens laptop lost firmware access Manjaro Community: Suddenly cannot enter bios, Boot Menu (Dell Inspiron 3511) This document is a work-in-progress ... The cause It is not clear what makes this happen - a lot is pointing to bad implementations of the UEFI specification - in some cases the firmware is hardcoded to load $esp/EFI/boot/bootx64.efi [[wiki1]] Your system will usually be able to boot your installed Linux - only the firmware is not displaying correctly. Usually you should be able to load the firmware on next reboot by using $ systemctl reboot --firmware-setup The cure The first attempt to cure would be to reinstall grub - for an EFI system it goes like this ESP=$(lsblk -no MOUNTPOINT | grep -e 'efi') sudo grub-install --trage=x86_64-efi --efi-directory=$ESP bootloader-id=Manjaro --recheck sudo grub-mkconfig -o /boot/grub/grub.cfg sudo mkinitcpio -P Next step is to check with LVFS if your firmware can be updated using Linux Use https://fwupd.org to get familiar with the Linux Vendor Firmware Service. You can also search the database to verify if your system is supported. There is no one-size-fits-all answer - the following is a list compiled from Manjaro Forum and the first being from Arch Wiki. Read the Arch Wiki on UEFI and GRUB [[wiki2]] [[wiki3]] [[wiki4]] I am listing the possibilities from least to most intrusive action. Use the most basic approach Switch user to root su - - provide the root password when requisted Copy the grub or systemd-boot efi stub to the $esp/EFI/BOOT/BOOTX64.EFI Try booting to the firmware using the aforementioned command Removing the newly installed efistub Boot your Linux system Remove the grub efi loader - usually in a subfolder named for your distribution - e.g. $esp/EFI/Manjaro/grubx64.efi - rename the file or move it to another location Try booting to the firmware Remove everything from the $esp mount point This requires having some kind of boot media readily available to be able to do some system rescue. This has proven to work on at least 2 occasions and requires you to have some experience using chroot to resque the system Using GRUB console to boot a removable media This requires having some kind of boot media readily available and more intimate knowledge of the GRUB shell It also requires the availability of either a Windows installation media or a dedicated rescue media like Hirens BootCD","title":"Troubleshooting missing firmware access"},{"location":"manjaro/troubleshooting/troubleshoot-system-missing-firmware/#uefi-firmware-implementations","text":"Some systems has a nasty habit of losing access to the firmware after your Linux installation. A couple of examples Acer Community: Laptop lost firmware access Acer Community: Dual boot laptop lost firmware access Manjaro Community: Brandnew Acer laptop lost firmware access Manjaro Community: Acer laptop lost firmware access Manjaro Community: Fujitsu Siemens laptop lost firmware access Manjaro Community: Suddenly cannot enter bios, Boot Menu (Dell Inspiron 3511) This document is a work-in-progress ...","title":"UEFI firmware implementations"},{"location":"manjaro/troubleshooting/troubleshoot-system-missing-firmware/#the-cause","text":"It is not clear what makes this happen - a lot is pointing to bad implementations of the UEFI specification - in some cases the firmware is hardcoded to load $esp/EFI/boot/bootx64.efi [[wiki1]] Your system will usually be able to boot your installed Linux - only the firmware is not displaying correctly. Usually you should be able to load the firmware on next reboot by using $ systemctl reboot --firmware-setup","title":"The cause"},{"location":"manjaro/troubleshooting/troubleshoot-system-missing-firmware/#the-cure","text":"The first attempt to cure would be to reinstall grub - for an EFI system it goes like this ESP=$(lsblk -no MOUNTPOINT | grep -e 'efi') sudo grub-install --trage=x86_64-efi --efi-directory=$ESP bootloader-id=Manjaro --recheck sudo grub-mkconfig -o /boot/grub/grub.cfg sudo mkinitcpio -P Next step is to check with LVFS if your firmware can be updated using Linux Use https://fwupd.org to get familiar with the Linux Vendor Firmware Service. You can also search the database to verify if your system is supported. There is no one-size-fits-all answer - the following is a list compiled from Manjaro Forum and the first being from Arch Wiki. Read the Arch Wiki on UEFI and GRUB [[wiki2]] [[wiki3]] [[wiki4]] I am listing the possibilities from least to most intrusive action. Use the most basic approach Switch user to root su - - provide the root password when requisted Copy the grub or systemd-boot efi stub to the $esp/EFI/BOOT/BOOTX64.EFI Try booting to the firmware using the aforementioned command Removing the newly installed efistub Boot your Linux system Remove the grub efi loader - usually in a subfolder named for your distribution - e.g. $esp/EFI/Manjaro/grubx64.efi - rename the file or move it to another location Try booting to the firmware Remove everything from the $esp mount point This requires having some kind of boot media readily available to be able to do some system rescue. This has proven to work on at least 2 occasions and requires you to have some experience using chroot to resque the system Using GRUB console to boot a removable media This requires having some kind of boot media readily available and more intimate knowledge of the GRUB shell It also requires the availability of either a Windows installation media or a dedicated rescue media like Hirens BootCD","title":"The cure"},{"location":"manjaro/troubleshooting/troubleshoot-using-reisub/","text":"Original post by @\u0111abby Manjaro Forum Difficulty: \u2605\u2605\u2606\u2606\u2606 REISUB (also known as the magic SysRq key ) is a mnemonic for: Rise up R eboot E ven I f S ystem U tterly B roken R aising E lephants I s S o U tterly B oring and is a gentle way of rebooting your system by doing Switch the keyboard from R aw mode, used by programs such as X11 and SVGALib , to XLATE (translate) mode. Send an E nd signal (SIGTERM) to all processes, except the boot process, allowing all processes to end gracefully. Send an I nstant kill (SIGKILL) to all processes, except the boot process, forcing all processes to end. S ync all mounted filesystems, allowing them to write all data to disk. U nmount and remount all mounted filesystems in read-only mode. Re B oot the system In fact, the only data you lose is since your last [auto]save as the system is shut down gracefully. Before you read any further, ensure all your work is saved! How to invoke the REISUB procedure? First we have to unlock the SysRq key so: Add to your grub GRUB_CMDLINE_LINUX_DEFAULT the sysrq_always_enabled=1 variable. Execute echo kernel.sysrq=1 | sudo tee --append /etc/sysctl.d/99-sysctl.conf Reboot normally if you had to add one of these parameters and come back here to read the rest of the blurb... There is a special Sys tem R* e q**uest key on most keyboards called SysRq on all English language and most international keyboards. Stamp (or Stampa on old Olivetti keyboards) S-Abf on full-size keyboards it's called by pressing Alt + SysRq on most laptop keyboards it's called by pressing Fn + Alt + PrtSc On some keyboards, please also try Alt + PrtSc if the SysRq key is missing or Alt Gr + SysRq if none of the above Alt combinations work . Once you've located your SysRq key, please keep the Alt key pressed . Test Now lightly tap these keys waiting between 1 second (fast, new machines) and 6 seconds (older or resource-starved machines\u00b9) in-between keypresses : R E I S U B If you actually followed the above instructions, your system just rebooted gracefully and you did not damage your HDD (if you still have one) by forcing it into PARK mode forcefully nor was your EXT4 or NTFS transaction journal rolled back. For even more info, [Read the Fine Manual ][6] If a REISUB just restarts your DE just do a REISUO after the REISUB. Read the REISUB section above and then you'll know what this means: R E I S U O will turn your machine off instead of rebooting it... Sometimes (If only the UI is frozen), you can still switch to one of the TTYs by pressing Ctrl + Alt + F2 or F3 , ... and gently tap the power button there. To do the same from within your Desktop Environment (DE) this has to be set up beforehand! So to ensure that your power button effectively shuts down your computer instead of going to sleep / Hibernate / ... in the future , follow these steps for your DE: In Gnome: Execute the following command: gsettings set org.gnome.settings-daemon.plugins.power button-power 'shutdown' In KDE: Go to System Settings Type energy Click Energy Saving in all of the On AC Power , On Battery and On Battery tabs, set the check-mark on Button events handling and the Even when an external monitor is connected When power button pressed to Shut Down Click Apply In XFCE: Go to the Applications menu or System settings Clock Power Manager From When Power Button is pressed: select Shutdown .","title":"REISUB / REISUO"},{"location":"manjaro/troubleshooting/troubleshoot-using-reisub/#test","text":"Now lightly tap these keys waiting between 1 second (fast, new machines) and 6 seconds (older or resource-starved machines\u00b9) in-between keypresses : R E I S U B If you actually followed the above instructions, your system just rebooted gracefully and you did not damage your HDD (if you still have one) by forcing it into PARK mode forcefully nor was your EXT4 or NTFS transaction journal rolled back. For even more info, [Read the Fine Manual ][6] If a REISUB just restarts your DE just do a REISUO after the REISUB. Read the REISUB section above and then you'll know what this means: R E I S U O will turn your machine off instead of rebooting it... Sometimes (If only the UI is frozen), you can still switch to one of the TTYs by pressing Ctrl + Alt + F2 or F3 , ... and gently tap the power button there. To do the same from within your Desktop Environment (DE) this has to be set up beforehand! So to ensure that your power button effectively shuts down your computer instead of going to sleep / Hibernate / ... in the future , follow these steps for your DE: In Gnome: Execute the following command: gsettings set org.gnome.settings-daemon.plugins.power button-power 'shutdown' In KDE: Go to System Settings Type energy Click Energy Saving in all of the On AC Power , On Battery and On Battery tabs, set the check-mark on Button events handling and the Even when an external monitor is connected When power button pressed to Shut Down Click Apply In XFCE: Go to the Applications menu or System settings Clock Power Manager From When Power Button is pressed: select Shutdown .","title":"Test"},{"location":"manjaro/virtual/libvirt-install-windows-11/","text":"Install Win11 using libvirt Create a new virtual machine Select a Windows 11 ISO file Accept the defaults clicking Next until you reach the final screen Tick the box Customize configuration before install and click Finish In the Overview pane - set vm firmware to BIOS and click Apply Click the button Begin Installation Installer Before starting the installer press Shift F10 to launch the Windows Cmd utility then launch regedit . Expand HKEY_LOCAL_MACHINE\\SYSTEM\\Setup Add new key named LabConfig Add new DWORD value with name BypassTPMCheck and change the value to 1. Add new DWORD value with name BypassRAMCheck and change the value to 1. Add new DWORD value with name BypassSecureBootCheck and change the value to 1. Close the registry editor and exit the shell, then continue the installer Bypass network check During last stage the installer will insist in network access. This can be disabled using the Cmd utility Shift F10 enter OOBE\\BYPASSNRO and press Enter close the Cmd utility back in the setup window click I don't have internet","title":"virt-manager - Windows 11"},{"location":"manjaro/virtual/libvirt-install-windows-11/#install-win11-using-libvirt","text":"Create a new virtual machine Select a Windows 11 ISO file Accept the defaults clicking Next until you reach the final screen Tick the box Customize configuration before install and click Finish In the Overview pane - set vm firmware to BIOS and click Apply Click the button Begin Installation","title":"Install Win11 using libvirt"},{"location":"manjaro/virtual/libvirt-install-windows-11/#installer","text":"Before starting the installer press Shift F10 to launch the Windows Cmd utility then launch regedit . Expand HKEY_LOCAL_MACHINE\\SYSTEM\\Setup Add new key named LabConfig Add new DWORD value with name BypassTPMCheck and change the value to 1. Add new DWORD value with name BypassRAMCheck and change the value to 1. Add new DWORD value with name BypassSecureBootCheck and change the value to 1. Close the registry editor and exit the shell, then continue the installer","title":"Installer"},{"location":"manjaro/virtual/libvirt-install-windows-11/#bypass-network-check","text":"During last stage the installer will insist in network access. This can be disabled using the Cmd utility Shift F10 enter OOBE\\BYPASSNRO and press Enter close the Cmd utility back in the setup window click I don't have internet","title":"Bypass network check"},{"location":"manjaro/virtual/virtualbox-headless-windows/","text":"Running a headless Windows using VirtualBox and systemd What I had in mind was a powerhouse - to run a Windows 10 with Visual Studio and SQL server - as a virtual machine - a development project I have. I want to power on the system and after boot - ideally - the Windows system would be available using RDP. After some speculations I decided to look at my pile of hardware - I got a few servers collecting dust - but they are noisy as a highway at rush hour. But I got a tower from when my daughter was teenager. Its an older i7 on an Intel board - maybe it will do. System: Host: tower Kernel: 5.5.13-1-MANJARO x86_64 bits: 64 Console: tty 0 Distro: Manjaro Linux Memory: RAM: total: 15.63 GiB used: 566.3 MiB (3.5%) Array-1: capacity: 32 GiB note: est. slots: 4 EC: None Device-1: CHAN A DIMM 0 size: 8 GiB speed: 1067 MT/s Device-2: CHAN A DIMM 1 size: No Module Installed Device-3: CHAN B DIMM 0 size: No Module Installed Device-4: CHAN C DIMM 0 size: 8 GiB speed: 1067 MT/s CPU: Topology: Quad Core model: Intel Core i7 950 bits: 64 type: MT MCP L2 cache: 8192 KiB Speed: 1825 MHz min/max: 1596/3060 MHz Core speeds (MHz): 1: 2389 2: 2278 3: 2029 4: 1993 5: 1621 6: 1916 7: 1962 8: 1696 I have a virtual machine with Visual Studio and SQL installed but that is on another system - what would be the easiest way to directly transfer the VM 127G? NFS of course. I added an extra 250G SSD for VM storage to the system and enabled/started the ssh daemon so I could continue using terminal. Added the necessary setup - using my own guide to NFS (my memory is muscle memory - I haven't setup that much NFS). I then transferred the VM to the new system. Installed the virtualbox packages - build the oracle extension pack (necessary for VRDE). VirtualBox looks for machines in the user's ~/VirtualBox\\ VMs folder so I made a symlink from the VM storage location into my user home ln -s /data/virtualbox ~/VirtualBox\\ VMs VirtualBox CLI is - according to Oracle - the only method exposing all possible VM manipulation you think of. VirtualBox cannot start a virtual machine if it don't know of it - so I needed to register the VM VBoxManage registervm /home/$USER/VirtualBox\\ VMs/vstudio/vstudio.vbox To be able to access the VM remotely - I need to enable VRDE (virtualbox-ext-oracle contains this functionality). VBoxManager modifyvm vstudio --vrde on Verify VBoxManage showvminfo vstudio | grep VRDE Start the VM VBoxManage startvm vstudio --type headless On my workstation I already have remmina and freerdp packages - so to verify have set it up - launching remmina and connecting to my tower IP - and login to the Windows 10 system. VBoxManager controlvm --savestate Now auto starting the VM should be a piece of cake - but everything I can think of is scripted and it requires a login - and I would very much like to avoid that. After more thinking - well - others must have had this idea too - and there is. I found a very old post on using systemd to load a virtual machine on boot . If was incredibly simple - and honestly - I doubted it would work - because the VM is stored in my users home - but to my pleasant surprise - it works :slight_smile: The topic mentioned the requirement of the user owning the machine and responsible for starting it should be member of vboxusers group. [Unit] Description=VBox Virtual Machine %i Service Requires=systemd-modules-load.service After=systemd-modules-load.service [Service] User=user Group=vboxusers ExecStart=/usr/bin/VBoxHeadless -s %i ExecStop=/usr/bin/VBoxManage controlvm %i savestate [Install] WantedBy=multi-user.target I discovered VBoxHeadless and that you can enable VRDE when using VBoxHeadless to start the VM. Saved the file as vboxvmservice@.service Enable a vm specific service sudo systemctl enable vboxvmservice@vstudio.service Start the service sudo systemctl start vboxvmservice@vstudio.service I also discovered that the defaults for such systemd service may timeout and the service shutdown before the VBoxManage command could finalize the saving of state - making Windows start in trouble shooting mode. Adding a TimeoutStopSec=60 to the Service definition solved the issue. If you experience Windows Repair issues because it takes longer to save the state of the VM - increase the value. It is also possible to use acpipowerbutton instead of savestate . Be careful with that if you don't have an up-to-date installation of the guest-iso inside the VM. If not the acpipowerbutton is not reliable. So now I power on the ~server~ computer - wait until it is up - then I connect to my visual studio virtual machine and I have released my workstation of that burden. And I can shut it down without damaging my windows installation.","title":"Headless Windows on VirtualBox"},{"location":"manjaro/virtual/virtualbox-headless-windows/#running-a-headless-windows-using-virtualbox-and-systemd","text":"What I had in mind was a powerhouse - to run a Windows 10 with Visual Studio and SQL server - as a virtual machine - a development project I have. I want to power on the system and after boot - ideally - the Windows system would be available using RDP. After some speculations I decided to look at my pile of hardware - I got a few servers collecting dust - but they are noisy as a highway at rush hour. But I got a tower from when my daughter was teenager. Its an older i7 on an Intel board - maybe it will do. System: Host: tower Kernel: 5.5.13-1-MANJARO x86_64 bits: 64 Console: tty 0 Distro: Manjaro Linux Memory: RAM: total: 15.63 GiB used: 566.3 MiB (3.5%) Array-1: capacity: 32 GiB note: est. slots: 4 EC: None Device-1: CHAN A DIMM 0 size: 8 GiB speed: 1067 MT/s Device-2: CHAN A DIMM 1 size: No Module Installed Device-3: CHAN B DIMM 0 size: No Module Installed Device-4: CHAN C DIMM 0 size: 8 GiB speed: 1067 MT/s CPU: Topology: Quad Core model: Intel Core i7 950 bits: 64 type: MT MCP L2 cache: 8192 KiB Speed: 1825 MHz min/max: 1596/3060 MHz Core speeds (MHz): 1: 2389 2: 2278 3: 2029 4: 1993 5: 1621 6: 1916 7: 1962 8: 1696 I have a virtual machine with Visual Studio and SQL installed but that is on another system - what would be the easiest way to directly transfer the VM 127G? NFS of course. I added an extra 250G SSD for VM storage to the system and enabled/started the ssh daemon so I could continue using terminal. Added the necessary setup - using my own guide to NFS (my memory is muscle memory - I haven't setup that much NFS). I then transferred the VM to the new system. Installed the virtualbox packages - build the oracle extension pack (necessary for VRDE). VirtualBox looks for machines in the user's ~/VirtualBox\\ VMs folder so I made a symlink from the VM storage location into my user home ln -s /data/virtualbox ~/VirtualBox\\ VMs VirtualBox CLI is - according to Oracle - the only method exposing all possible VM manipulation you think of. VirtualBox cannot start a virtual machine if it don't know of it - so I needed to register the VM VBoxManage registervm /home/$USER/VirtualBox\\ VMs/vstudio/vstudio.vbox To be able to access the VM remotely - I need to enable VRDE (virtualbox-ext-oracle contains this functionality). VBoxManager modifyvm vstudio --vrde on Verify VBoxManage showvminfo vstudio | grep VRDE Start the VM VBoxManage startvm vstudio --type headless On my workstation I already have remmina and freerdp packages - so to verify have set it up - launching remmina and connecting to my tower IP - and login to the Windows 10 system. VBoxManager controlvm --savestate Now auto starting the VM should be a piece of cake - but everything I can think of is scripted and it requires a login - and I would very much like to avoid that. After more thinking - well - others must have had this idea too - and there is. I found a very old post on using systemd to load a virtual machine on boot . If was incredibly simple - and honestly - I doubted it would work - because the VM is stored in my users home - but to my pleasant surprise - it works :slight_smile: The topic mentioned the requirement of the user owning the machine and responsible for starting it should be member of vboxusers group. [Unit] Description=VBox Virtual Machine %i Service Requires=systemd-modules-load.service After=systemd-modules-load.service [Service] User=user Group=vboxusers ExecStart=/usr/bin/VBoxHeadless -s %i ExecStop=/usr/bin/VBoxManage controlvm %i savestate [Install] WantedBy=multi-user.target I discovered VBoxHeadless and that you can enable VRDE when using VBoxHeadless to start the VM. Saved the file as vboxvmservice@.service Enable a vm specific service sudo systemctl enable vboxvmservice@vstudio.service Start the service sudo systemctl start vboxvmservice@vstudio.service I also discovered that the defaults for such systemd service may timeout and the service shutdown before the VBoxManage command could finalize the saving of state - making Windows start in trouble shooting mode. Adding a TimeoutStopSec=60 to the Service definition solved the issue. If you experience Windows Repair issues because it takes longer to save the state of the VM - increase the value. It is also possible to use acpipowerbutton instead of savestate . Be careful with that if you don't have an up-to-date installation of the guest-iso inside the VM. If not the acpipowerbutton is not reliable. So now I power on the ~server~ computer - wait until it is up - then I connect to my visual studio virtual machine and I have released my workstation of that burden. And I can shut it down without damaging my windows installation.","title":"Running a headless Windows using VirtualBox and systemd"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/","text":"The obvious workaround is - if you can choose -the choose Linux, Debian, Arch Linux, Manjaro, Ubuntu, Linux Mint .. the shelf is big. Workaround 1 [[1]] When prompted to create a Microsoft account, enter the current date as your date of birth. This will cause the creation of a Microsoft account to be rejected because the US COPPA (Children's Online Privacy Protection Act) prohibits children from creating accounts. Microsoft is unlikely to be able to disable this workaround for legal reasons. Although an error message appears during setup, the option to create a local account is offered, writes Bolko. Workaround 2 (for Windows 11 Home) [[1]] During the OOBE phase of setup, press the key combination Ctrl + Shift + F3 during the account creation step to enter audit mode. Then type the following command into the command prompt: slui.exe /upk changepk.exe /ProductKey By switching from Home to Generic-Pro, there should now be a new option to join a domain, which allows you to create a local account. Later, after installing Windows 11, you can change the product key back to Home, but the local account will remain. Workaround 3 [[1]] An autounattend.xml response file is used to create a local account. I discussed such files in the article Windows 11 24H2: Security issue caused by unattend.xml. Workaround 4 [[1]] During the OOBE phase, when creating the user account, you can press the key combination Shift + F10 and enter the following command in the command prompt. WinJS.Application.restart(\"ms-cxh://localonly\") Workaround 5 [[2]] During OOBE Disconnect your internet connection Shift F10 reg edd HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\OOBE /v BypassRRO /t REG_DWORD /d 1 /f shutdown /r /t 0 Workaround 6 [[2]] During OOBE Shift F10 net user \"User Name\" /add net localgroup \"Adminitrators\" \"User Name\" /add cd OOBE msoobe && shutdown -r Workaround 7 Keep an earlier version of the Windows installation ISO around - upgrade to the latest version. Source Windows 11 setup: Microsoft will block the creation of local accounts in the future (borncity.com) More workarounds appear to get around Microsoft's local account restrictions (notebookcheck.net)","title":"Install with local account"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#workaround-1-1","text":"When prompted to create a Microsoft account, enter the current date as your date of birth. This will cause the creation of a Microsoft account to be rejected because the US COPPA (Children's Online Privacy Protection Act) prohibits children from creating accounts. Microsoft is unlikely to be able to disable this workaround for legal reasons. Although an error message appears during setup, the option to create a local account is offered, writes Bolko.","title":"Workaround 1 [[1]]"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#workaround-2-for-windows-11-home-1","text":"During the OOBE phase of setup, press the key combination Ctrl + Shift + F3 during the account creation step to enter audit mode. Then type the following command into the command prompt: slui.exe /upk changepk.exe /ProductKey By switching from Home to Generic-Pro, there should now be a new option to join a domain, which allows you to create a local account. Later, after installing Windows 11, you can change the product key back to Home, but the local account will remain.","title":"Workaround 2 (for Windows 11 Home) [[1]]"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#workaround-3-1","text":"An autounattend.xml response file is used to create a local account. I discussed such files in the article Windows 11 24H2: Security issue caused by unattend.xml.","title":"Workaround 3 [[1]]"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#workaround-4-1","text":"During the OOBE phase, when creating the user account, you can press the key combination Shift + F10 and enter the following command in the command prompt. WinJS.Application.restart(\"ms-cxh://localonly\")","title":"Workaround 4 [[1]]"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#workaround-5-2","text":"During OOBE Disconnect your internet connection Shift F10 reg edd HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\OOBE /v BypassRRO /t REG_DWORD /d 1 /f shutdown /r /t 0","title":"Workaround 5 [[2]]"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#workaround-6-2","text":"During OOBE Shift F10 net user \"User Name\" /add net localgroup \"Adminitrators\" \"User Name\" /add cd OOBE msoobe && shutdown -r","title":"Workaround 6 [[2]]"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#workaround-7","text":"Keep an earlier version of the Windows installation ISO around - upgrade to the latest version.","title":"Workaround 7"},{"location":"ms-windows/ms-windows-avoid-ms-account-on-installation/#source","text":"Windows 11 setup: Microsoft will block the creation of local accounts in the future (borncity.com) More workarounds appear to get around Microsoft's local account restrictions (notebookcheck.net)","title":"Source"},{"location":"ms-windows/ms-windows-create-a-windows-usb/","text":"Creating a bootable USB from a Windows ISO The reason for needing this could be e.g. reinstalling Windows but it could also be to update your system firmware - because the vendor only provided Windows binaries - you need a Windows system. To update you system firmware you can use a Windows PE environment like Hiren's BootCD Hirens BootCD If you want to reinstall Windows after your Manjaro adventure get a Windows ISO from Microsoft Only the manual approach described below was viable - until af few years ago when the github user slacka forked the WinUSB project. Thanks to his work the Linux community have an app to do abstract the CLI work. Very receently a new tool has become available - the ventoy project - which makes the task even easier. Topics covered ventoy bootable USB WoeUSB Manual using CLI 1. ventoy [date=2020-05-09 time=12:35:00 timezone=\"Europe/Copenhagen\"] The ventoy utility is a great tool for booting a Windows ISO without having to jump through the hoops in this guide. Install the ventoy package from repo sudo pacman -S ventoy Locate your USB stick lsblk Replace sdy below with your device sudo ventoy -i /dev/sdy Using a file manager Using your file manager and drag your Windows ISO onto you USB and wait - patience is the keyword - patience. When the copy operation is done - use the eject button in your file manager - and wait - wait until the device disappears from your file manager. :exclamation: If you don't wait - data corruption will occur - and you don't want that. Using terminal Using the device name from above mount the first partition to a temporary mount point sudo mount /dev/sdy1 /mnt Copy the ISO file to the USB - assuming the ISO is in your Downloads folder cp ~/Downloads/<windows.iso> /mnt && sync When the command finishes you can unmount the device sudo umount /mnt :exclamation: If you don't wait - data corruption will occur - and you don't want that. 2. WoeUSB Use the package woeusb available from AUR pamac build woeusb Tip from @codesardine in a comment Before launching the app open a terminal and execute sudo modprobe -nv loop Then launch the app and get your ISO done. TIP: The process is unpacking files from the ISO and copying them to the USB The latest Windows ISO files contains a file larger than 4G - so choose NTFS as file system. 3. Manual using CLI Remove all removable devices (USB), open a terminal and list known disk devices lsblk -la Insert your USB stick and list your devices one more time lsblk -la Make a note of the extra device listed. If you only have one disk then it probably will be /dev/sdb . Please do double check the device id In the terminal clear the disk of any partition info, using this command (replace sdy with device letter from above). sudo dd if=/dev/zero of=/dev/sdy bs=1M count=10 oflag=sync Then use fdisk to create the filesystem needed for the Windows ISO (replace X with device letter from above). sudo fdisk /dev/sdy The commands in fdisk is as follows [date=2019-11-01 time=17:43:00 timezone=\"Europe/Copenhagen\"] The partitioning may need rework due to single file inside Windows ISO is larger than 4G. o - create a new empty DOS partition table n - add a new partition Enter - accept default partition type primary Enter - accept default partition number 1 Enter - accept default first sector 2048 Enter - accept default last sector t - change partition type c - select W95 FAT32 (LBA) a - set bootable flag for partition 1 w - write changes to disk Newer versions of Windows 10 ISO contains a file bigger than 4G. Format the device using exfat or ntfs (replace sdy with device letter from above) to overcome the size limitation of FAT32. sudo mkfs.ntfs /dev/sdX1 Create a folder to mount your ISO mkdir ~/winiso Mount your ISO sudo mount -o loop /path/to/windows/iso/filename.iso ~/winiso Create a folder to mount your USB mkdir ~/winusb Mount the partition (replace sdy with device letter from above) sudo mount /dev/sdy1 ~/winusb Copy all files from ISO to USB cd ~/winiso cp -r * ~/winusb The copy operation is going to take a long time depending on your USB port speed and your USB device. When the copy is done ensure all data is flushed to the device using the sync command sync When all data is flushed to the device you will be returned to the prompt. Next thing is to move out of the winiso folder cd Then unmount the devices sudo umount ~/winiso ~/winusb Remove the folders rm -rf ~/winiso ~/winusb You should now be able to boot to your Windows install media. Revision Added ventoy Newer Windows media includes a wim file larger than 4GB format to exfat or ntfs to be able to use with WoeUSB Fixed recursive flag on cleanup command","title":"Create a Windows USB"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#creating-a-bootable-usb-from-a-windows-iso","text":"The reason for needing this could be e.g. reinstalling Windows but it could also be to update your system firmware - because the vendor only provided Windows binaries - you need a Windows system. To update you system firmware you can use a Windows PE environment like Hiren's BootCD Hirens BootCD If you want to reinstall Windows after your Manjaro adventure get a Windows ISO from Microsoft Only the manual approach described below was viable - until af few years ago when the github user slacka forked the WinUSB project. Thanks to his work the Linux community have an app to do abstract the CLI work. Very receently a new tool has become available - the ventoy project - which makes the task even easier.","title":"Creating a bootable USB from a Windows ISO"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#topics-covered","text":"ventoy bootable USB WoeUSB Manual using CLI","title":"Topics covered"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#1-ventoy","text":"[date=2020-05-09 time=12:35:00 timezone=\"Europe/Copenhagen\"] The ventoy utility is a great tool for booting a Windows ISO without having to jump through the hoops in this guide. Install the ventoy package from repo sudo pacman -S ventoy Locate your USB stick lsblk Replace sdy below with your device sudo ventoy -i /dev/sdy","title":"1. ventoy"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#using-a-file-manager","text":"Using your file manager and drag your Windows ISO onto you USB and wait - patience is the keyword - patience. When the copy operation is done - use the eject button in your file manager - and wait - wait until the device disappears from your file manager. :exclamation: If you don't wait - data corruption will occur - and you don't want that.","title":"Using a file manager"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#using-terminal","text":"Using the device name from above mount the first partition to a temporary mount point sudo mount /dev/sdy1 /mnt Copy the ISO file to the USB - assuming the ISO is in your Downloads folder cp ~/Downloads/<windows.iso> /mnt && sync When the command finishes you can unmount the device sudo umount /mnt :exclamation: If you don't wait - data corruption will occur - and you don't want that.","title":"Using terminal"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#2-woeusb","text":"Use the package woeusb available from AUR pamac build woeusb Tip from @codesardine in a comment Before launching the app open a terminal and execute sudo modprobe -nv loop Then launch the app and get your ISO done. TIP: The process is unpacking files from the ISO and copying them to the USB The latest Windows ISO files contains a file larger than 4G - so choose NTFS as file system.","title":"2. WoeUSB"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#3-manual-using-cli","text":"Remove all removable devices (USB), open a terminal and list known disk devices lsblk -la Insert your USB stick and list your devices one more time lsblk -la Make a note of the extra device listed. If you only have one disk then it probably will be /dev/sdb . Please do double check the device id In the terminal clear the disk of any partition info, using this command (replace sdy with device letter from above). sudo dd if=/dev/zero of=/dev/sdy bs=1M count=10 oflag=sync Then use fdisk to create the filesystem needed for the Windows ISO (replace X with device letter from above). sudo fdisk /dev/sdy The commands in fdisk is as follows [date=2019-11-01 time=17:43:00 timezone=\"Europe/Copenhagen\"] The partitioning may need rework due to single file inside Windows ISO is larger than 4G. o - create a new empty DOS partition table n - add a new partition Enter - accept default partition type primary Enter - accept default partition number 1 Enter - accept default first sector 2048 Enter - accept default last sector t - change partition type c - select W95 FAT32 (LBA) a - set bootable flag for partition 1 w - write changes to disk Newer versions of Windows 10 ISO contains a file bigger than 4G. Format the device using exfat or ntfs (replace sdy with device letter from above) to overcome the size limitation of FAT32. sudo mkfs.ntfs /dev/sdX1 Create a folder to mount your ISO mkdir ~/winiso Mount your ISO sudo mount -o loop /path/to/windows/iso/filename.iso ~/winiso Create a folder to mount your USB mkdir ~/winusb Mount the partition (replace sdy with device letter from above) sudo mount /dev/sdy1 ~/winusb Copy all files from ISO to USB cd ~/winiso cp -r * ~/winusb The copy operation is going to take a long time depending on your USB port speed and your USB device. When the copy is done ensure all data is flushed to the device using the sync command sync When all data is flushed to the device you will be returned to the prompt. Next thing is to move out of the winiso folder cd Then unmount the devices sudo umount ~/winiso ~/winusb Remove the folders rm -rf ~/winiso ~/winusb You should now be able to boot to your Windows install media.","title":"3. Manual using CLI"},{"location":"ms-windows/ms-windows-create-a-windows-usb/#revision","text":"Added ventoy Newer Windows media includes a wim file larger than 4GB format to exfat or ntfs to be able to use with WoeUSB Fixed recursive flag on cleanup command","title":"Revision"},{"location":"ms-windows/ms-windows-killing-process/","text":"Killing processes Listing processes PS C:\\> tasklist Find process - by name PS C:\\> tasklist | findstr /C:cmd Stop process by id PS C:\\> stop-process -Id 7628 Stop process by name PS C:\\> Stop-Process -name XYZ","title":"Killing process in MS Windows"},{"location":"ms-windows/ms-windows-killing-process/#killing-processes","text":"Listing processes PS C:\\> tasklist Find process - by name PS C:\\> tasklist | findstr /C:cmd Stop process by id PS C:\\> stop-process -Id 7628 Stop process by name PS C:\\> Stop-Process -name XYZ","title":"Killing processes"},{"location":"ms-windows/ms-windows-visual-studio-iis-express-configuration/","text":"LAN access Elevated prompt netsh http add urlacl url=http://ipadress:port/ user=everyone netsh http add urlacl url=http://hostname:port/ user=everyone netsh http add urlacl url=http://hostname.domain.tld:port/ user=everyone Edit iis applicationhost.config for project sln\\.vs\\sln\\config\\applicationhost.config <site name=\"siteName\" id=\"6\"> <application path=\"/\" applicationPool=\"Clr4IntegratedAppPool\"> <virtualDirectory path=\"/\" physicalPath=\"physicalPath\" /> </application> <bindings> <binding protocol=\"http\" bindingInformation=\"*:port:localhost\" /> <binding protocol=\"https\" bindingInformation=\"*:port:localhost\" /> <binding protocol=\"http\" bindingInformation=\"*:port:hostname\" /> <binding protocol=\"https\" bindingInformation=\"*:port:hostname\" /> <binding protocol=\"http\" bindingInformation=\"*:port:hostname.domain.tld\" /> <binding protocol=\"https\" bindingInformation=\"*:port:hostname.domain.tld\" /> <binding protocol=\"http\" bindingInformation=\"*:port:ip\" /> <binding protocol=\"https\" bindingInformation=\"*:port:ip\" /> </bindings> </site>","title":"Visual Studio IISExpress"},{"location":"ms-windows/ms-windows-visual-studio-iis-express-configuration/#lan-access","text":"Elevated prompt netsh http add urlacl url=http://ipadress:port/ user=everyone netsh http add urlacl url=http://hostname:port/ user=everyone netsh http add urlacl url=http://hostname.domain.tld:port/ user=everyone Edit iis applicationhost.config for project sln\\.vs\\sln\\config\\applicationhost.config <site name=\"siteName\" id=\"6\"> <application path=\"/\" applicationPool=\"Clr4IntegratedAppPool\"> <virtualDirectory path=\"/\" physicalPath=\"physicalPath\" /> </application> <bindings> <binding protocol=\"http\" bindingInformation=\"*:port:localhost\" /> <binding protocol=\"https\" bindingInformation=\"*:port:localhost\" /> <binding protocol=\"http\" bindingInformation=\"*:port:hostname\" /> <binding protocol=\"https\" bindingInformation=\"*:port:hostname\" /> <binding protocol=\"http\" bindingInformation=\"*:port:hostname.domain.tld\" /> <binding protocol=\"https\" bindingInformation=\"*:port:hostname.domain.tld\" /> <binding protocol=\"http\" bindingInformation=\"*:port:ip\" /> <binding protocol=\"https\" bindingInformation=\"*:port:ip\" /> </bindings> </site>","title":"LAN access"},{"location":"notes/essay-linux-is-not-windows/","text":"This work is copyright 2006-24-05 and belongs to Dominic Humphries. It may be redistributed under a Creative Commons License . The URL http://linux.oneandoneis2.org/LNW.htm must supplied in attribution. In the following article, the author refer to the GNU/Linux OS and various Free & Open-Source Software (FOSS) projects under the catch-all name of \"Linux\". It scans better. Linux != Windows or Linux is Not Windows If you've been pointed at this page, then the chances are you're a relatively new Linux user who's having some problems making the switch from Windows to Linux. This causes many problems for many people, hence this article was written. Many individual issues arise from this single problem, so the page is broken down into multiple problem areas. Problem #1: Linux isn't exactly the same as Windows. You'd be amazed how many people make this complaint. They come to Linux, expecting to find essentially a free, open-source version of Windows. Quite often, this is what they've been told to expect by over-zealous Linux users. However, it's a paradoxical hope. The specific reasons why people try Linux vary wildly, but the overall reason boils down to one thing: They hope Linux will be better than Windows. Common yardsticks for measuring success are cost, choice, performance, and security. There are many others. But every Windows user who tries Linux, does so because they hope it will be better than what they've got. Therein lies the problem. It is logically impossible for any thing to be better than any other thing whilst remaining completely identical to it. A perfect copy may be equal, but it can never surpass. So when you gave Linux a try in hopes that it would be better, you were inescapably hoping that it would be different. Too many people ignore this fact, and hold up every difference between the two OSes as a Linux failure. As a simple example, consider driver upgrades: one typically upgrades a hardware driver on Windows by going to the manufacturer's website and downloading the new driver; whereas in Linux you upgrade the kernel. This means that a single Linux download & upgrade will give you the newest drivers available for your machine, whereas in Windows you would have to surf to multiple sites and download all the upgrades individually. It's a very different process, but it's certainly not a bad one. But many people complain because it's not what they're used to. Or, as an example you're more likely to relate to, consider Firefox: One of the biggest open-source success stories. A web browser that took the world by storm. Did it achieve this success by being a perfect imitation of IE, the then-most-popular browser? No. It was successful because it was better than IE, and it was better because it was different. It had tabbed browsing, live bookmarks, built-in searchbar, PNG support, adblock extensions, and other wonderful things. The \"Find\" functionality appeared in a toolbar at the bottom and looked for matches as you typed, turning red when you had no match. IE had no tabs, no RSS functionality, searchbars only via third-party extensions, and a find dialogue that required a click on \"OK\" to start looking and a click on \"OK\" to clear the \"Not found\" error message. A clear and inarguable demonstration of an open-source application achieving success by being better, and being better by being different. Had FF been an IE clone, it would have vanished into obscurity. And had Linux been a Windows clone, the same would have happened. So the solution to problem #1: Remember that where Linux is familiar and the same as what you're used to, it isn't new & improved. Welcome the places where things are different, because only here does it have a chance to shine. Problem #2: Linux is too different from Windows The next issue arises when people do expect Linux to be different, but find that some differences are just too radical for their liking. Probably the biggest example of this is the sheer amount of choice available to Linux users. Whereas an out-of-the-box-Windows user has the Classic or XP desktop with Wordpad, Internet Explorer, and Outlook Express installed, an out-of-the-box-Linux user has hundreds of distros to choose from, then Gnome or KDE or Fluxbox or whatever, with vi or emacs or kate, Konqueror or Opera or Firefox or Mozilla, and so on and so forth. A Windows user isn't used to making so many choices just to get up & running. Exasperated \"Does there have to be so much choice?\" posts are very common. Does Linux really have to be so different from Windows? After all, they're both operating systems. They both do the same job: Power your computer & give you something to run applications on. Surely they should be more or less identical? Look at it this way: Step outside and take a look at all the different vehicles driving along the road. These are all vehicles designed with more or less the same purpose: To get you from A to B via the roads. Note the variety in designs. But, you may be thinking, car differences are really quite minor: they all have a steering wheel, foot-pedal controls, a gear stick, a handbrake, windows & doors, a petrol tank. . . If you can drive one car, you can drive any car! Quite true. But did you not see that some people weren't driving cars, but were riding motorbikes instead. . ? Switching from one version of Windows to another is like switching from one car to another. Win95 to Win98, I honestly couldn't tell the difference. Win98 to WinXP, it was a bigger change but really nothing major. But switching from Windows to Linux is like switching from a car to a motorbike. They may both be OSes/road vehicles. They may both use the same hardware/roads. They may both provide an environment for you to run applications/transport you from A to B. But they use fundamentally different approaches to do so. Windows/cars are not safe from viruses/theft unless you install an antivirus/lock the doors. Linux/motorbikes don't have viruses/doors, so are perfectly safe without you having to install an antivirus/lock any doors. Or look at it the other way round: Linux/cars were designed from the ground up for multiple users/passengers. Windows/motorbikes were designed for one user/passenger. Every Windows user/motorbike driver is used to being in full control of his computer/vehicle at all times. A Linux user/car passenger is used to only being in control of his computer/vehicle when logged in as root/sitting in the driver's seat. Two different approaches to fulfilling the same goal. They differ in fundamental ways. They have different strengths and weaknesses: A car is the clear winner at transporting a family & a lot of cargo from A to B: More seats & more storage space. A motorbike is the clear winner at getting one person from A to B: Less affected by congestion and uses less fuel. There are many things that don't change when you switch between cars and motorbikes: You still have to put petrol in the tank, you still have to drive on the same roads, you still have to obey the traffic lights and Stop signs, you still have to indicate before turning, you still have to obey the same speed limits. But there are also many things that do change: Car drivers don't have to wear crash helmets, motorbike drivers don't have to put on a seatbelt. Car drivers have to turn the steering wheel to get around a corner, motorbike drivers have to lean over. Car drivers accelerate by pushing a foot-pedal, motorbike drivers accelerate by twisting a hand control. A motorbike driver who tries to corner a car by leaning over is going to run into problems very quickly. And Windows users who try to use their existing skills and habits generally also find themselves having many issues. In fact, Windows \"Power Users\" frequently have more problems with Linux than people with little or no computer experience, for this very reason. Typically, the most vehement \"Linux is not ready for the desktop yet\" arguments come from ingrained Windows users who reason that if they couldn't make the switch, a less-experienced user has no chance. But this is the exact opposite of the truth. So, to avoid problem #2: Don't assume that being a knowledgeable Windows user means you're a knowledgeable Linux user: When you first start with Linux, you are a novice. Problem #3: Culture shock Subproblem #3a: There is a culture Windows users are more or less in a customer-supplier relationship: They pay for software, for warranties, for support, and so on. They expect software to have a certain level of usability. They are therefore used to having rights with their software: They have paid for technical support and have every right to demand that they receive it. They are also used to dealing with entities rather than people: Their contracts are with a company, not with a person. Linux users are in more of a community. They don't have to buy the software, they don't have to pay for technical support. They download software for free & use Instant Messaging and web-based forums to get help. They deal with people, not corporations. A Windows user will not endear himself by bringing his habitual attitudes over to Linux, to put it mildly. The biggest cause of friction tends to be in the online interactions: A \"3a\" user new to Linux asks for help with a problem he's having. When he doesn't get that help at what he considers an acceptable rate, he starts complaining and demanding more help. Because that's what he's used to doing with paid-for tech support. The problem is that this isn't paid-for support. This is a bunch of volunteers who are willing to help people with problems out of the goodness of their hearts. The new user has no right to demand anything from them, any more than somebody collecting for charity can demand larger donations from contributors. In much the same way, a Windows user is used to using commercial software. Companies don't release software until it's reliable, functional, and user-friendly enough. So this is what a Windows user tends to expect from software: It starts at version 1.0. Linux software, however, tends to get released almost as soon as it's written: It starts at version 0.1. This way, people who really need the functionality can get it ASAP; interested developers can get involved in helping improve the code; and the community as a whole stays aware of what's going on. If a \"3a\" user runs into trouble with Linux, he'll complain: The software hasn't met his standards, and he thinks he has a right to expect that standard. His mood won't be improved when he gets sarcastic replies like \"I'd demand a refund if I were you\" So, to avoid problem #3a: Simply remember that you haven't paid the developer who wrote the software or the people online who provide the tech support. They don't owe you anything. Subproblem #3b: New vs. Old Linux pretty much started out life as a hacker's hobby. It grew as it attracted more hobbyist hackers. It was quite some time before anybody but a geek stood a chance of getting a useable Linux installation working easily. Linux started out \"By geeks, for geeks.\" And even today, the majority of established Linux users are self-confessed geeks. And that's a pretty good thing: If you've got a problem with hardware or software, having a large number of geeks available to work on the solution is a definite plus. But Linux has grown up quite a bit since its early days. There are distros that almost anybody can install, even distros that live on CDs and detect all your hardware for you without any intervention. It's become attractive to non-hobbyist users who are just interested in it because it's virus-free and cheap to upgrade. It's not uncommon for there to be friction between the two camps. It's important to bear in mind, however, that there's no real malice on either side: It's lack of understanding that causes the problems. Firstly, you get the hard-core geeks who still assume that everybody using Linux is a fellow geek. This means they expect a high level of knowledge, and often leads to accusations of arrogance, elitism, and rudeness. And in truth, sometimes that's what it is. But quite often, it's not: It's elitist to say \"Everybody ought to know this\". It's not elitist to say \"Everybody knows this\" - quite the opposite. Secondly, you get the new users who're trying to make the switch after a lifetime of using commercial OSes. These users are used to software that anybody can sit down & use, out-of-the-box. The issues arise because group 1 is made up of people who enjoy being able to tear their OS apart and rebuild it the way they like it, while group 2 tends to be indifferent to the way the OS works, so long as it does work. A parallel situation that can emphasize the problems is Lego. Picture the following: New: I wanted a new toy car, and everybody's raving about how great Lego cars can be. So I bought some Lego, but when I got home, I just had a load of bricks and cogs and stuff in the box. Where's my car?? Old: You have to build the car out of the bricks. That's the whole point of Lego. New: What?? I don't know how to build a car. I'm not a mechanic. How am I supposed to know how to put it all together?? Old: There's a leaflet that came in the box. It tells you exactly how to put the bricks together to get a toy car. You don't need to know how, you just need to follow the instructions. New: Okay, I found the instructions. It's going to take me hours! Why can't they just sell it as a toy car, instead of making you have to build it?? Old: Because not everybody wants to make a toy car with Lego. It can be made into anything we like. That's the whole point. New: I still don't see why they can't supply it as a car so people who want a car have got one, and other people can take it apart if they want to. Anyway, I finally got it put together, but some bits come off occasionally. What do I do about this? Can I glue it? Old: It's Lego. It's designed to come apart. That's the whole point. New: But I don't want it to come apart. I just want a toy car! Old: Then why on Earth did you buy a box of Lego?? It's clear to just about anybody that Lego is not really aimed at people who just want a toy car. You don't get conversations like the above in real life. The whole point of Lego is that you have fun building it and you can make anything you like with it. If you've no interest in building anything, Lego's not for you. This is quite obvious. As far as the long-time Linux user is concerned, the same holds true for Linux: It's an open-source, fully-customizeable set of software. That's the whole point. If you don't want to hack the components a bit, why bother to use it? But there's been a lot of effort lately to make Linux more suitable for the non-hackers, a situation that's not a million miles away from selling pre-assembled Lego kits, in order to make it appeal to a wider audience. Hence you get conversations that aren't far away from the ones above: Newcomers complain about the existence of what the established users consider to be fundamental features, and resent having the read a manual to get something working. But complaining that there are too many distros; or that software has too many configuration options; or that it doesn't work perfectly out-of-the-box; is like complaining that Lego can be made into too many models, and not liking the fact that it can be broken down into bricks and built into many other things. So, to avoid problem #3b: Just remember that what Linux seems to be now is not what Linux was in the past. The largest and most necessary part of the Linux community, the hackers and the developers, like Linux because they can fit it together the way they like; they don't like it in spite of having to do all the assembly before they can use it. Problem #4: Designed for the designer In the car industry, you'll very rarely find that the person who designed the engine also designed the car interior: It calls for totally different skills. Nobody wants an engine that only looks like it can go fast, and nobody wants an interior that works superbly but is cramped and ugly. And in the same way, in the software industry, the user interface (UI) is not usually created by the people who wrote the software. In the Linux world, however, this is not so much the case: Projects frequently start out as one man's toy. He does everything himself, and therefore the interface has no need of any kind of \"user friendly\" features: The user knows everything there is to know about the software, he doesn't need help. Vi is a good example of software deliberately created for a user who already knows how it works: It's not unheard of for new users to reboot their computers because they couldn't figure out how else to get out of vi. However, there is an important difference between a FOSS programmer and most commercial software writers: The software a FOSS programmer creates is software that he intends to use. So whilst the end result might not be as 'comfortable' for the novice user, they can draw some comfort in knowing that the software is designed by somebody who knows what the end-users needs are: He too is an end-user. This is very different from commercial software writers, who are making software for other people to use: They are not knowledgeable end-users. So whilst vi has an interface that is hideously unfriendly to new users, it is still in use today because it is such a superb interface once you know how it works. Firefox was created by people who regularly browse the Web. The Gimp was built by people who use it to manipulate graphics files. And so on. So Linux interfaces are frequently a bit of a minefield for the novice: Despite its popularity, vi should never be considered by a new user who just wants to quickly make a few changes to a file. And if you're using software early in its lifecycle, a polished, user-friendly interface is something you're likely to find only in the \"ToDo\" list: Functionality comes first. Nobody designs a killer interface and then tries to add functionality bit by bit. They create functionality, and then improve the interface bit by bit. So to avoid #4 issues: Look for software that's specifically aimed at being easy for new users to use, or accept that some software that has a steeper learning curve than you're used to. To complain that vi isn't friendly enough for new users is to be laughed at for missing the point. Problem #5: The myth of \"user-friendly\" This is a big one. It's a very big term in the computing world, \"user-friendly\". It's even the name of a particularly good webcomic. But it's a bad term. The basic concept is good: That software be designed with the needs of the user in mind. But it's always addressed as a single concept, which it isn't. If you spend your entire life processing text files, your ideal software will be fast and powerful, enabling you to do the maximum amount of work for the minimum amount of effort. Simple keyboard shortcuts and mouseless operation will be of vital importance. But if you very rarely edit text files, and you just want to write an occasional letter, the last thing you want is to struggle with learning keyboard shortcuts. Well-organized menus and clear icons in toolbars will be your ideal. Clearly, software designed around the needs of the first user will not be suitable for the second, and vice versa. So how can any software be called \"user-friendly\", if we all have different needs? The simple answer: User-friendly is a misnomer, and one that makes a complex situation seem simple. What does \"user-friendly\" really mean? Well, in the context in which it is used, \"user friendly\" software means \"Software that can be used to a reasonable level of competence by a user with no previous experience of the software.\" This has the unfortunate effect of making lousy-but-familiar interfaces fall into the category of \"user-friendly\". Subproblem #5a: Familiar is friendly So it is that in most \"user-friendly\" text editors & word processors, you Cut and Paste by using Ctrl-X and Ctrl-V. Totally unintuitive, but everybody's used to these combinations, so they count as a \"friendly\" combination. So when somebody comes to vi and finds that it's \"d\" to cut, and \"p\" to paste, it's not considered friendly: It's not what anybody is used to. Is it superior? Well, actually, yes. With the Ctrl-X approach, how do you cut a word from the document you're currently in? (No using the mouse!) From the start of the word, Ctrl-Shift-Right to select the word. Then Ctrl-X to cut it. The vi approach? dw deletes the word. How about cutting five words with a Ctrl-X application? From the start of the words, Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-X And with vi? d5w The vi approach is far more versatile and actually more intuitive: \"X\" and \"V\" are not obvious or memorable \"Cut\" and \"Paste\" commands, whereas \"dw\" to delete a word, and \"p\" to put it back is perfectly straightforward. But \"X\" and \"V\" are what we all know, so whilst vi is clearly superior, it's unfamiliar. Ergo, it is considered unfriendly. On no other basis, pure familiarity makes a Windows-like interface seem friendly. And as we learned in problem #1, Linux is necessarily different to Windows. Inescapably, Linux always appears less \"user-friendly\" than Windows. To avoid #5a problems, all you can really do is try and remember that \"user-friendly\" doesn't mean \"What I'm used to\": Try doing things your usual way, and if it doesn't work, try and work out what a total novice would do. Subproblem #5b: Inefficient is friendly This is a sad but inescapable fact. Paradoxically, the harder you make it to access an application's functionality, the friendlier it can seem to be. This is because friendliness is added to an interface by using simple, visible 'clues' - the more, the better. After all, if a complete novice to computers is put in front of a WYSIWYG word processor and asked to make a bit of text bold, which is more likely: He'll guess that \"Ctrl-B\" is the usual standard He'll look for clues, and try clicking on the \"Edit\" menu. Unsuccessful, he'll try the next likely one along the row of menus: \"Format\". The new menu has a \"Font\" option, which seems promising. And Hey! There's our \"Bold\" option. Success! Next time you do any processing, try doing every job via the menus: No shortcut keys, and no toolbar icons. Menus all the way. You'll find you slow to a crawl, as every task suddenly demands a multitude of keystrokes/mouseclicks. Making software \"user-friendly\" in this fashion is like putting training wheels on a bicycle: It lets you get up & running immediately, without any skill or experience needed. It's perfect for a beginner. But nobody out there thinks that all bicycles should be sold with training wheels: If you were given such a bicycle today, I'll wager the first thing you'd do is remove them for being unnecessary encumbrances: Once you know how to ride a bike, training wheels are unnecessary. And in the same way, a great deal of Linux software is designed without \"training wheels\" - it's designed for users who already have some basic skills in place. After all, nobody's a permanent novice: Ignorance is short-lived, and knowledge is forever. So the software is designed with the majority in mind. This might seem an excuse: After all, MS Word has all the friendly menus, and it has toolbar buttons, and it has shortcut keys. . . Best of all worlds, surely? Friendly and efficient. However, this has to be put into perspective: Firstly, the practicalities: having menus and toolbars and shortcuts and all would mean a lot of coding, and it's not like Linux developers all get paid for their time. Secondly, it still doesn't really take into account serious power-users: Very few professional wordsmiths use MS Word. Ever meet a coder who used MS Word? Compare that to how many use emacs & vi. Why is this? Firstly, because some \"friendly\" behaviour rules out efficient behaviour: See the \"Cut&Copy\" example above. And secondly, because most of Word's functionality is buried in menus that you have to use: Only the most common functionality has those handy little buttons in toolbars at the top. The less-used functions that are still vital for serious users just take too long to access. Something to bear in mind, however, is that \"training wheels\" are often available as \"optional extras\" for Linux software: They might not be obvious, but frequently they're available. Take mplayer. You use it to play a video file by typing mplayer filename in a terminal. You fastforward & rewind using the arrow keys and the PageUp & PageDown keys. This is not overly \"user-friendly\". However, if you instead type gmplayer filename, you'll get the graphical frontend, with all its nice, friendly , familiar buttons. Take ripping a CD to MP3 (or Ogg): Using the command-line, you need to use cdparanoia to rip the files to disc. Then you need an encoder. . . It's a hassle, even if you know exactly how to use the packages (imho). So download & install something like Grip. This is an easy-to-use graphical frontend that uses cdparanoia and encoders behind-the-scenes to make it really easy to rip CDs, and even has CDDB support to name the files automatically for you. The same goes for ripping DVDs: The number of options to pass to transcode is a bit of a nightmare. But using dvd::rip to talk to transcode for you makes the whole thing a simple, GUI-based process which anybody can do. So to avoid #5b issues: Remember that \"training wheels\" tend to be bolt-on extras in Linux, rather than being automatically supplied with the main product. And sometimes, \"training wheels\" just can't be part of the design. Problem #6: Imitation vs. Convergence An argument people often make when they find that Linux isn't the Windows clone they wanted is to insist that this is what Linux has been (or should have been) attempting to be since it was created, and that people who don't recognise this and help to make Linux more Windows-like are in the wrong. They draw on many arguments for this: Linux has gone from Command-Line- to Graphics-based interfaces, a clear attempt to copy Windows Nice theory, but false: The original X windowing system was released in 1984, as the successor to the W windowing system ported to Unix in 1983. Windows 1.0 was released in 1985. Windows didn't really make it big until version 3, released in 1990 - by which time, X windows had for years been at the X11 stage we use today. Linux itself was only started in 1991. So Linux didn't create a GUI to copy Windows: It simply made use of a GUI that existed long before Windows. Windows 3 gave way to Windows 95 - making a huge level of changes to the UI that Microsoft has never equalled since. It had many new & innovative features: Drag & drop functionality; taskbars, and so on. All of which have since been copied by Linux, of course. Actually. . . no. All the above existed prior to Microsoft making use of them. NeXTSTeP in particular was a hugely advanced (for the time) GUI, and it predated Win95 significantly - version 1 released in 1989, and the final version in 1995. Okay, okay, so Microsoft didn't think up the individual features that we think of as the Windows Look-and-Feel. But it still created a Look-and-Feel, and Linux has been trying to imitate that ever since. To debunk this, one must discuss the concept of convergent evolution. This is where two completely different and independent systems evolve over time to become very similar. It happens all the time in biology. For example, sharks and dolphins. Both are (typically) fish-eating marine organisms of about the same size. Both have dorsal fins, pectoral fins, tail fins, and similar, streamlined shapes. However, sharks evolved from fish, while dolphins evolved from a land-based quadrupedal mammal of some sort. The reason they have very similar overall appearances is that they both evolved to be as efficient as possible at living within a marine environment. At no stage did pre-dolphins (the relative newcomers) look at sharks and think \"Wow, look at those fins. They work really well. I'll try and evolve some myself!\" Similarly, it's perfectly true to look at early Linux desktops and see FVWM and TWM and a lot of other simplistic GUIs. And then look at modern Linux desktops, and see Gnome & KDE with their taskbars and menus and eye-candy. And yes, it's true to say that they're a lot more like Windows than they used to be. But then, so is Windows: Windows 3.0 had no taskbar that I remember. And the Start menu? What Start menu? Linux didn't have a desktop anything like modern Windows. Microsoft didn't either. Now they both do. What does this tell us? It tells us that developers in both camps looked for ways of improving the GUI, and because there are only a limited number of solutions to a problem, they often used very similar methods. Similarity does not in any way prove or imply imitation. Remembering that will help you avoid straying into problem #6 territory. Problem #7: That FOSS thing. Oh, this causes problems. Not intrinsically: The software being free and open-source is a wonderful and immensely important part of the whole thing. But understanding just how different FOSS is from proprietary software can be too big an adjustment for some people to make. I've already mentioned some instances of this: People thinking they can demand technical support and the like. But it goes far beyond that. Microsoft's Mission Statement is \"A computer on every desktop\" - with the unspoken rider that each computer should be running Windows. Microsoft and Apple both sell operating systems, and both do their utmost to make sure their products get used by the largest number of people: They're businesses, out to make money. And then there is FOSS. Which, even today, is almost entirely non-commercial. Before you reach for your email client to tell me about Red Hat, Suse, Linspire and all: Yes, I know they \"sell\" Linux. I know they'd all love Linux to be adopted universally, especially their own flavour of it. But don't confuse the suppliers with the manufacturers. The Linux kernel was not created by a company, and is not maintained by people out to make a profit with it. The GNU tools were not created by a company, and are not maintained by people out to make a profit with them. The X11 windowing system. . . well, the most popular implementation is xorg right now, and the \".org\" part should tell you all you need to know. Desktop software: Well, you might be able to make a case for KDE being commercial, since it's Qt-based. But Gnome, Fluxbox, Enlightenment, etc. are all non-profit. There are people out to sell Linux, but they are very much the minority. Increasing the number of end-users of proprietary software leads to a direct financial benefit to the company that makes it. This is simply not the case for FOSS: There is no direct benefit to any FOSS developer in increasing the userbase. Indirect benefits, yes: Personal pride; an increased potential for finding bugs; more likelihood of attracting new developers; possibly a chance of a good job offer; and so on. But Linus Torvalds doesn't make money from increased Linux usage. Richard Stallman doesn't get money from increased GNU usage. All those servers running OpenBSD and OpenSSH don't put a penny into the OpenBSD project's pockets. And so we come to the biggest problem of all when it comes to new users and Linux: They find out they're not wanted. New users come to Linux after spending their lives using an OS where the end-user's needs are paramount, and \"user friendly\" and \"customer focus\" are considered veritable Holy Grails. And they suddenly find themselves using an OS that still relies on 'man' files, the command-line, hand-edited configuration files, and Google. And when they complain, they don't get coddled or promised better things: They get bluntly shown the door. That's an exaggeration, of course. But it is how a lot of potential Linux converts perceived things when they tried and failed to make the switch. In an odd way, FOSS is actually a very selfish development method: People only work on what they want to work on, when they want to work on it. Most people don't see any need to make Linux more attractive to inexperienced end-users: It already does what they want it to do, why should they care if it doesn't work for other people? FOSS has many parallels with the Internet itself: You don't pay the writer of a webpage/the software to download and read/install it. Ubiquitous broadband/User-friendly interfaces are of no great interest to somebody who already has broadband/knows how to use the software. Bloggers/developers don't need to have lots of readers/users to justify blogging/coding. There are lots of people making lots of money off it, but it's not by the old-fashioned \"I own this and you have to pay me if you want some of it\" method that most businesses are so enamoured of; it's by providing services like tech-support/e-commerce. Linux is not interested in market share. Linux does not have customers. Linux does not have shareholders, or a responsibility to the bottom line. Linux was not created to make money. Linux does not have the goal of being the most popular and widespread OS on the planet. All the Linux community wants is to create a really good, fully-featured, free operating system. If that results in Linux becoming a hugely popular OS, then that's great. If that results in Linux having the most intuitive, user-friendly interface ever created, then that's great. If that results in Linux becoming the basis of a multi-billion dollar industry, then that's great. It's great, but it's not the point. The point is to make Linux the best OS that the community is capable of making. Not for other people: For itself. The oh-so-common threats of \"Linux will never take over the desktop unless it does such-and-such\" are simply irrelevant: The Linux community isn't trying to take over the desktop. They really don't care if it gets good enough to make it onto your desktop, so long as it stays good enough to remain on theirs. The highly-vocal MS-haters, pro-Linux zealots, and money-making FOSS purveyors might be loud, but they're still minorities. That's what the Linux community wants: an OS that can be installed by whoever really wants it. So if you're considering switching to Linux, first ask yourself what you really want. If you want an OS that doesn't chauffeur you around, but hands you the keys, puts you in the driver's seat, and expects you to know what to do: Get Linux. You'll have to devote some time to learning how to use it, but once you've done so, you'll have an OS that you can make sit up and dance. If you really just want Windows without the malware and security issues: Read up on good security practices; install a good firewall, malware-detector, and anti-virus; replace IE with a more secure browser; and keep yourself up-to-date with security updates. There are people out there (myself included) who've used Windows since 3.1 days right through to XP without ever being infected with a virus or malware: you can do it too. Don't get Linux: It will fail miserably at being what you want it to be. If you really want the security and performance of a Unix-based OS but with a customer-focussed attitude and an world-renowned interface: Buy an Apple Mac. OS X is great. But don't get Linux: It will not do what you want it to do. It's not just about \"Why should I want Linux?\". It's also about \"Why should Linux want me?\"","title":"Linux is Not Windows"},{"location":"notes/essay-linux-is-not-windows/#linux-windows-or-linux-is-not-windows","text":"If you've been pointed at this page, then the chances are you're a relatively new Linux user who's having some problems making the switch from Windows to Linux. This causes many problems for many people, hence this article was written. Many individual issues arise from this single problem, so the page is broken down into multiple problem areas.","title":"Linux != Windows or Linux is Not Windows"},{"location":"notes/essay-linux-is-not-windows/#problem-1-linux-isnt-exactly-the-same-as-windows","text":"You'd be amazed how many people make this complaint. They come to Linux, expecting to find essentially a free, open-source version of Windows. Quite often, this is what they've been told to expect by over-zealous Linux users. However, it's a paradoxical hope. The specific reasons why people try Linux vary wildly, but the overall reason boils down to one thing: They hope Linux will be better than Windows. Common yardsticks for measuring success are cost, choice, performance, and security. There are many others. But every Windows user who tries Linux, does so because they hope it will be better than what they've got. Therein lies the problem. It is logically impossible for any thing to be better than any other thing whilst remaining completely identical to it. A perfect copy may be equal, but it can never surpass. So when you gave Linux a try in hopes that it would be better, you were inescapably hoping that it would be different. Too many people ignore this fact, and hold up every difference between the two OSes as a Linux failure. As a simple example, consider driver upgrades: one typically upgrades a hardware driver on Windows by going to the manufacturer's website and downloading the new driver; whereas in Linux you upgrade the kernel. This means that a single Linux download & upgrade will give you the newest drivers available for your machine, whereas in Windows you would have to surf to multiple sites and download all the upgrades individually. It's a very different process, but it's certainly not a bad one. But many people complain because it's not what they're used to. Or, as an example you're more likely to relate to, consider Firefox: One of the biggest open-source success stories. A web browser that took the world by storm. Did it achieve this success by being a perfect imitation of IE, the then-most-popular browser? No. It was successful because it was better than IE, and it was better because it was different. It had tabbed browsing, live bookmarks, built-in searchbar, PNG support, adblock extensions, and other wonderful things. The \"Find\" functionality appeared in a toolbar at the bottom and looked for matches as you typed, turning red when you had no match. IE had no tabs, no RSS functionality, searchbars only via third-party extensions, and a find dialogue that required a click on \"OK\" to start looking and a click on \"OK\" to clear the \"Not found\" error message. A clear and inarguable demonstration of an open-source application achieving success by being better, and being better by being different. Had FF been an IE clone, it would have vanished into obscurity. And had Linux been a Windows clone, the same would have happened.","title":"Problem #1: Linux isn't exactly the same as Windows."},{"location":"notes/essay-linux-is-not-windows/#so-the-solution-to-problem-1","text":"Remember that where Linux is familiar and the same as what you're used to, it isn't new & improved. Welcome the places where things are different, because only here does it have a chance to shine.","title":"So the solution to problem #1:"},{"location":"notes/essay-linux-is-not-windows/#problem-2-linux-is-too-different-from-windows","text":"The next issue arises when people do expect Linux to be different, but find that some differences are just too radical for their liking. Probably the biggest example of this is the sheer amount of choice available to Linux users. Whereas an out-of-the-box-Windows user has the Classic or XP desktop with Wordpad, Internet Explorer, and Outlook Express installed, an out-of-the-box-Linux user has hundreds of distros to choose from, then Gnome or KDE or Fluxbox or whatever, with vi or emacs or kate, Konqueror or Opera or Firefox or Mozilla, and so on and so forth. A Windows user isn't used to making so many choices just to get up & running. Exasperated \"Does there have to be so much choice?\" posts are very common. Does Linux really have to be so different from Windows? After all, they're both operating systems. They both do the same job: Power your computer & give you something to run applications on. Surely they should be more or less identical? Look at it this way: Step outside and take a look at all the different vehicles driving along the road. These are all vehicles designed with more or less the same purpose: To get you from A to B via the roads. Note the variety in designs. But, you may be thinking, car differences are really quite minor: they all have a steering wheel, foot-pedal controls, a gear stick, a handbrake, windows & doors, a petrol tank. . . If you can drive one car, you can drive any car! Quite true. But did you not see that some people weren't driving cars, but were riding motorbikes instead. . ? Switching from one version of Windows to another is like switching from one car to another. Win95 to Win98, I honestly couldn't tell the difference. Win98 to WinXP, it was a bigger change but really nothing major. But switching from Windows to Linux is like switching from a car to a motorbike. They may both be OSes/road vehicles. They may both use the same hardware/roads. They may both provide an environment for you to run applications/transport you from A to B. But they use fundamentally different approaches to do so. Windows/cars are not safe from viruses/theft unless you install an antivirus/lock the doors. Linux/motorbikes don't have viruses/doors, so are perfectly safe without you having to install an antivirus/lock any doors. Or look at it the other way round: Linux/cars were designed from the ground up for multiple users/passengers. Windows/motorbikes were designed for one user/passenger. Every Windows user/motorbike driver is used to being in full control of his computer/vehicle at all times. A Linux user/car passenger is used to only being in control of his computer/vehicle when logged in as root/sitting in the driver's seat. Two different approaches to fulfilling the same goal. They differ in fundamental ways. They have different strengths and weaknesses: A car is the clear winner at transporting a family & a lot of cargo from A to B: More seats & more storage space. A motorbike is the clear winner at getting one person from A to B: Less affected by congestion and uses less fuel. There are many things that don't change when you switch between cars and motorbikes: You still have to put petrol in the tank, you still have to drive on the same roads, you still have to obey the traffic lights and Stop signs, you still have to indicate before turning, you still have to obey the same speed limits. But there are also many things that do change: Car drivers don't have to wear crash helmets, motorbike drivers don't have to put on a seatbelt. Car drivers have to turn the steering wheel to get around a corner, motorbike drivers have to lean over. Car drivers accelerate by pushing a foot-pedal, motorbike drivers accelerate by twisting a hand control. A motorbike driver who tries to corner a car by leaning over is going to run into problems very quickly. And Windows users who try to use their existing skills and habits generally also find themselves having many issues. In fact, Windows \"Power Users\" frequently have more problems with Linux than people with little or no computer experience, for this very reason. Typically, the most vehement \"Linux is not ready for the desktop yet\" arguments come from ingrained Windows users who reason that if they couldn't make the switch, a less-experienced user has no chance. But this is the exact opposite of the truth. So, to avoid problem #2: Don't assume that being a knowledgeable Windows user means you're a knowledgeable Linux user: When you first start with Linux, you are a novice.","title":"Problem #2: Linux is too different from Windows"},{"location":"notes/essay-linux-is-not-windows/#problem-3-culture-shock","text":"","title":"Problem #3: Culture shock"},{"location":"notes/essay-linux-is-not-windows/#subproblem-3a-there-is-a-culture","text":"Windows users are more or less in a customer-supplier relationship: They pay for software, for warranties, for support, and so on. They expect software to have a certain level of usability. They are therefore used to having rights with their software: They have paid for technical support and have every right to demand that they receive it. They are also used to dealing with entities rather than people: Their contracts are with a company, not with a person. Linux users are in more of a community. They don't have to buy the software, they don't have to pay for technical support. They download software for free & use Instant Messaging and web-based forums to get help. They deal with people, not corporations. A Windows user will not endear himself by bringing his habitual attitudes over to Linux, to put it mildly. The biggest cause of friction tends to be in the online interactions: A \"3a\" user new to Linux asks for help with a problem he's having. When he doesn't get that help at what he considers an acceptable rate, he starts complaining and demanding more help. Because that's what he's used to doing with paid-for tech support. The problem is that this isn't paid-for support. This is a bunch of volunteers who are willing to help people with problems out of the goodness of their hearts. The new user has no right to demand anything from them, any more than somebody collecting for charity can demand larger donations from contributors. In much the same way, a Windows user is used to using commercial software. Companies don't release software until it's reliable, functional, and user-friendly enough. So this is what a Windows user tends to expect from software: It starts at version 1.0. Linux software, however, tends to get released almost as soon as it's written: It starts at version 0.1. This way, people who really need the functionality can get it ASAP; interested developers can get involved in helping improve the code; and the community as a whole stays aware of what's going on. If a \"3a\" user runs into trouble with Linux, he'll complain: The software hasn't met his standards, and he thinks he has a right to expect that standard. His mood won't be improved when he gets sarcastic replies like \"I'd demand a refund if I were you\" So, to avoid problem #3a: Simply remember that you haven't paid the developer who wrote the software or the people online who provide the tech support. They don't owe you anything.","title":"Subproblem #3a: There is a culture"},{"location":"notes/essay-linux-is-not-windows/#subproblem-3b-new-vs-old","text":"Linux pretty much started out life as a hacker's hobby. It grew as it attracted more hobbyist hackers. It was quite some time before anybody but a geek stood a chance of getting a useable Linux installation working easily. Linux started out \"By geeks, for geeks.\" And even today, the majority of established Linux users are self-confessed geeks. And that's a pretty good thing: If you've got a problem with hardware or software, having a large number of geeks available to work on the solution is a definite plus. But Linux has grown up quite a bit since its early days. There are distros that almost anybody can install, even distros that live on CDs and detect all your hardware for you without any intervention. It's become attractive to non-hobbyist users who are just interested in it because it's virus-free and cheap to upgrade. It's not uncommon for there to be friction between the two camps. It's important to bear in mind, however, that there's no real malice on either side: It's lack of understanding that causes the problems. Firstly, you get the hard-core geeks who still assume that everybody using Linux is a fellow geek. This means they expect a high level of knowledge, and often leads to accusations of arrogance, elitism, and rudeness. And in truth, sometimes that's what it is. But quite often, it's not: It's elitist to say \"Everybody ought to know this\". It's not elitist to say \"Everybody knows this\" - quite the opposite. Secondly, you get the new users who're trying to make the switch after a lifetime of using commercial OSes. These users are used to software that anybody can sit down & use, out-of-the-box. The issues arise because group 1 is made up of people who enjoy being able to tear their OS apart and rebuild it the way they like it, while group 2 tends to be indifferent to the way the OS works, so long as it does work. A parallel situation that can emphasize the problems is Lego. Picture the following: New: I wanted a new toy car, and everybody's raving about how great Lego cars can be. So I bought some Lego, but when I got home, I just had a load of bricks and cogs and stuff in the box. Where's my car?? Old: You have to build the car out of the bricks. That's the whole point of Lego. New: What?? I don't know how to build a car. I'm not a mechanic. How am I supposed to know how to put it all together?? Old: There's a leaflet that came in the box. It tells you exactly how to put the bricks together to get a toy car. You don't need to know how, you just need to follow the instructions. New: Okay, I found the instructions. It's going to take me hours! Why can't they just sell it as a toy car, instead of making you have to build it?? Old: Because not everybody wants to make a toy car with Lego. It can be made into anything we like. That's the whole point. New: I still don't see why they can't supply it as a car so people who want a car have got one, and other people can take it apart if they want to. Anyway, I finally got it put together, but some bits come off occasionally. What do I do about this? Can I glue it? Old: It's Lego. It's designed to come apart. That's the whole point. New: But I don't want it to come apart. I just want a toy car! Old: Then why on Earth did you buy a box of Lego?? It's clear to just about anybody that Lego is not really aimed at people who just want a toy car. You don't get conversations like the above in real life. The whole point of Lego is that you have fun building it and you can make anything you like with it. If you've no interest in building anything, Lego's not for you. This is quite obvious. As far as the long-time Linux user is concerned, the same holds true for Linux: It's an open-source, fully-customizeable set of software. That's the whole point. If you don't want to hack the components a bit, why bother to use it? But there's been a lot of effort lately to make Linux more suitable for the non-hackers, a situation that's not a million miles away from selling pre-assembled Lego kits, in order to make it appeal to a wider audience. Hence you get conversations that aren't far away from the ones above: Newcomers complain about the existence of what the established users consider to be fundamental features, and resent having the read a manual to get something working. But complaining that there are too many distros; or that software has too many configuration options; or that it doesn't work perfectly out-of-the-box; is like complaining that Lego can be made into too many models, and not liking the fact that it can be broken down into bricks and built into many other things. So, to avoid problem #3b: Just remember that what Linux seems to be now is not what Linux was in the past. The largest and most necessary part of the Linux community, the hackers and the developers, like Linux because they can fit it together the way they like; they don't like it in spite of having to do all the assembly before they can use it.","title":"Subproblem #3b: New vs. Old"},{"location":"notes/essay-linux-is-not-windows/#problem-4-designed-for-the-designer","text":"In the car industry, you'll very rarely find that the person who designed the engine also designed the car interior: It calls for totally different skills. Nobody wants an engine that only looks like it can go fast, and nobody wants an interior that works superbly but is cramped and ugly. And in the same way, in the software industry, the user interface (UI) is not usually created by the people who wrote the software. In the Linux world, however, this is not so much the case: Projects frequently start out as one man's toy. He does everything himself, and therefore the interface has no need of any kind of \"user friendly\" features: The user knows everything there is to know about the software, he doesn't need help. Vi is a good example of software deliberately created for a user who already knows how it works: It's not unheard of for new users to reboot their computers because they couldn't figure out how else to get out of vi. However, there is an important difference between a FOSS programmer and most commercial software writers: The software a FOSS programmer creates is software that he intends to use. So whilst the end result might not be as 'comfortable' for the novice user, they can draw some comfort in knowing that the software is designed by somebody who knows what the end-users needs are: He too is an end-user. This is very different from commercial software writers, who are making software for other people to use: They are not knowledgeable end-users. So whilst vi has an interface that is hideously unfriendly to new users, it is still in use today because it is such a superb interface once you know how it works. Firefox was created by people who regularly browse the Web. The Gimp was built by people who use it to manipulate graphics files. And so on. So Linux interfaces are frequently a bit of a minefield for the novice: Despite its popularity, vi should never be considered by a new user who just wants to quickly make a few changes to a file. And if you're using software early in its lifecycle, a polished, user-friendly interface is something you're likely to find only in the \"ToDo\" list: Functionality comes first. Nobody designs a killer interface and then tries to add functionality bit by bit. They create functionality, and then improve the interface bit by bit. So to avoid #4 issues: Look for software that's specifically aimed at being easy for new users to use, or accept that some software that has a steeper learning curve than you're used to. To complain that vi isn't friendly enough for new users is to be laughed at for missing the point.","title":"Problem #4: Designed for the designer"},{"location":"notes/essay-linux-is-not-windows/#problem-5-the-myth-of-user-friendly","text":"This is a big one. It's a very big term in the computing world, \"user-friendly\". It's even the name of a particularly good webcomic. But it's a bad term. The basic concept is good: That software be designed with the needs of the user in mind. But it's always addressed as a single concept, which it isn't. If you spend your entire life processing text files, your ideal software will be fast and powerful, enabling you to do the maximum amount of work for the minimum amount of effort. Simple keyboard shortcuts and mouseless operation will be of vital importance. But if you very rarely edit text files, and you just want to write an occasional letter, the last thing you want is to struggle with learning keyboard shortcuts. Well-organized menus and clear icons in toolbars will be your ideal. Clearly, software designed around the needs of the first user will not be suitable for the second, and vice versa. So how can any software be called \"user-friendly\", if we all have different needs? The simple answer: User-friendly is a misnomer, and one that makes a complex situation seem simple. What does \"user-friendly\" really mean? Well, in the context in which it is used, \"user friendly\" software means \"Software that can be used to a reasonable level of competence by a user with no previous experience of the software.\" This has the unfortunate effect of making lousy-but-familiar interfaces fall into the category of \"user-friendly\".","title":"Problem #5: The myth of \"user-friendly\""},{"location":"notes/essay-linux-is-not-windows/#subproblem-5a-familiar-is-friendly","text":"So it is that in most \"user-friendly\" text editors & word processors, you Cut and Paste by using Ctrl-X and Ctrl-V. Totally unintuitive, but everybody's used to these combinations, so they count as a \"friendly\" combination. So when somebody comes to vi and finds that it's \"d\" to cut, and \"p\" to paste, it's not considered friendly: It's not what anybody is used to. Is it superior? Well, actually, yes. With the Ctrl-X approach, how do you cut a word from the document you're currently in? (No using the mouse!) From the start of the word, Ctrl-Shift-Right to select the word. Then Ctrl-X to cut it. The vi approach? dw deletes the word. How about cutting five words with a Ctrl-X application? From the start of the words, Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-Shift-Right Ctrl-X And with vi? d5w The vi approach is far more versatile and actually more intuitive: \"X\" and \"V\" are not obvious or memorable \"Cut\" and \"Paste\" commands, whereas \"dw\" to delete a word, and \"p\" to put it back is perfectly straightforward. But \"X\" and \"V\" are what we all know, so whilst vi is clearly superior, it's unfamiliar. Ergo, it is considered unfriendly. On no other basis, pure familiarity makes a Windows-like interface seem friendly. And as we learned in problem #1, Linux is necessarily different to Windows. Inescapably, Linux always appears less \"user-friendly\" than Windows. To avoid #5a problems, all you can really do is try and remember that \"user-friendly\" doesn't mean \"What I'm used to\": Try doing things your usual way, and if it doesn't work, try and work out what a total novice would do.","title":"Subproblem #5a: Familiar is friendly"},{"location":"notes/essay-linux-is-not-windows/#subproblem-5b-inefficient-is-friendly","text":"This is a sad but inescapable fact. Paradoxically, the harder you make it to access an application's functionality, the friendlier it can seem to be. This is because friendliness is added to an interface by using simple, visible 'clues' - the more, the better. After all, if a complete novice to computers is put in front of a WYSIWYG word processor and asked to make a bit of text bold, which is more likely: He'll guess that \"Ctrl-B\" is the usual standard He'll look for clues, and try clicking on the \"Edit\" menu. Unsuccessful, he'll try the next likely one along the row of menus: \"Format\". The new menu has a \"Font\" option, which seems promising. And Hey! There's our \"Bold\" option. Success! Next time you do any processing, try doing every job via the menus: No shortcut keys, and no toolbar icons. Menus all the way. You'll find you slow to a crawl, as every task suddenly demands a multitude of keystrokes/mouseclicks. Making software \"user-friendly\" in this fashion is like putting training wheels on a bicycle: It lets you get up & running immediately, without any skill or experience needed. It's perfect for a beginner. But nobody out there thinks that all bicycles should be sold with training wheels: If you were given such a bicycle today, I'll wager the first thing you'd do is remove them for being unnecessary encumbrances: Once you know how to ride a bike, training wheels are unnecessary. And in the same way, a great deal of Linux software is designed without \"training wheels\" - it's designed for users who already have some basic skills in place. After all, nobody's a permanent novice: Ignorance is short-lived, and knowledge is forever. So the software is designed with the majority in mind. This might seem an excuse: After all, MS Word has all the friendly menus, and it has toolbar buttons, and it has shortcut keys. . . Best of all worlds, surely? Friendly and efficient. However, this has to be put into perspective: Firstly, the practicalities: having menus and toolbars and shortcuts and all would mean a lot of coding, and it's not like Linux developers all get paid for their time. Secondly, it still doesn't really take into account serious power-users: Very few professional wordsmiths use MS Word. Ever meet a coder who used MS Word? Compare that to how many use emacs & vi. Why is this? Firstly, because some \"friendly\" behaviour rules out efficient behaviour: See the \"Cut&Copy\" example above. And secondly, because most of Word's functionality is buried in menus that you have to use: Only the most common functionality has those handy little buttons in toolbars at the top. The less-used functions that are still vital for serious users just take too long to access. Something to bear in mind, however, is that \"training wheels\" are often available as \"optional extras\" for Linux software: They might not be obvious, but frequently they're available. Take mplayer. You use it to play a video file by typing mplayer filename in a terminal. You fastforward & rewind using the arrow keys and the PageUp & PageDown keys. This is not overly \"user-friendly\". However, if you instead type gmplayer filename, you'll get the graphical frontend, with all its nice, friendly , familiar buttons. Take ripping a CD to MP3 (or Ogg): Using the command-line, you need to use cdparanoia to rip the files to disc. Then you need an encoder. . . It's a hassle, even if you know exactly how to use the packages (imho). So download & install something like Grip. This is an easy-to-use graphical frontend that uses cdparanoia and encoders behind-the-scenes to make it really easy to rip CDs, and even has CDDB support to name the files automatically for you. The same goes for ripping DVDs: The number of options to pass to transcode is a bit of a nightmare. But using dvd::rip to talk to transcode for you makes the whole thing a simple, GUI-based process which anybody can do. So to avoid #5b issues: Remember that \"training wheels\" tend to be bolt-on extras in Linux, rather than being automatically supplied with the main product. And sometimes, \"training wheels\" just can't be part of the design.","title":"Subproblem #5b: Inefficient is friendly"},{"location":"notes/essay-linux-is-not-windows/#problem-6-imitation-vs-convergence","text":"An argument people often make when they find that Linux isn't the Windows clone they wanted is to insist that this is what Linux has been (or should have been) attempting to be since it was created, and that people who don't recognise this and help to make Linux more Windows-like are in the wrong. They draw on many arguments for this: Linux has gone from Command-Line- to Graphics-based interfaces, a clear attempt to copy Windows Nice theory, but false: The original X windowing system was released in 1984, as the successor to the W windowing system ported to Unix in 1983. Windows 1.0 was released in 1985. Windows didn't really make it big until version 3, released in 1990 - by which time, X windows had for years been at the X11 stage we use today. Linux itself was only started in 1991. So Linux didn't create a GUI to copy Windows: It simply made use of a GUI that existed long before Windows. Windows 3 gave way to Windows 95 - making a huge level of changes to the UI that Microsoft has never equalled since. It had many new & innovative features: Drag & drop functionality; taskbars, and so on. All of which have since been copied by Linux, of course. Actually. . . no. All the above existed prior to Microsoft making use of them. NeXTSTeP in particular was a hugely advanced (for the time) GUI, and it predated Win95 significantly - version 1 released in 1989, and the final version in 1995. Okay, okay, so Microsoft didn't think up the individual features that we think of as the Windows Look-and-Feel. But it still created a Look-and-Feel, and Linux has been trying to imitate that ever since. To debunk this, one must discuss the concept of convergent evolution. This is where two completely different and independent systems evolve over time to become very similar. It happens all the time in biology. For example, sharks and dolphins. Both are (typically) fish-eating marine organisms of about the same size. Both have dorsal fins, pectoral fins, tail fins, and similar, streamlined shapes. However, sharks evolved from fish, while dolphins evolved from a land-based quadrupedal mammal of some sort. The reason they have very similar overall appearances is that they both evolved to be as efficient as possible at living within a marine environment. At no stage did pre-dolphins (the relative newcomers) look at sharks and think \"Wow, look at those fins. They work really well. I'll try and evolve some myself!\" Similarly, it's perfectly true to look at early Linux desktops and see FVWM and TWM and a lot of other simplistic GUIs. And then look at modern Linux desktops, and see Gnome & KDE with their taskbars and menus and eye-candy. And yes, it's true to say that they're a lot more like Windows than they used to be. But then, so is Windows: Windows 3.0 had no taskbar that I remember. And the Start menu? What Start menu? Linux didn't have a desktop anything like modern Windows. Microsoft didn't either. Now they both do. What does this tell us? It tells us that developers in both camps looked for ways of improving the GUI, and because there are only a limited number of solutions to a problem, they often used very similar methods. Similarity does not in any way prove or imply imitation. Remembering that will help you avoid straying into problem #6 territory.","title":"Problem #6: Imitation vs. Convergence"},{"location":"notes/essay-linux-is-not-windows/#problem-7-that-foss-thing","text":"Oh, this causes problems. Not intrinsically: The software being free and open-source is a wonderful and immensely important part of the whole thing. But understanding just how different FOSS is from proprietary software can be too big an adjustment for some people to make. I've already mentioned some instances of this: People thinking they can demand technical support and the like. But it goes far beyond that. Microsoft's Mission Statement is \"A computer on every desktop\" - with the unspoken rider that each computer should be running Windows. Microsoft and Apple both sell operating systems, and both do their utmost to make sure their products get used by the largest number of people: They're businesses, out to make money. And then there is FOSS. Which, even today, is almost entirely non-commercial. Before you reach for your email client to tell me about Red Hat, Suse, Linspire and all: Yes, I know they \"sell\" Linux. I know they'd all love Linux to be adopted universally, especially their own flavour of it. But don't confuse the suppliers with the manufacturers. The Linux kernel was not created by a company, and is not maintained by people out to make a profit with it. The GNU tools were not created by a company, and are not maintained by people out to make a profit with them. The X11 windowing system. . . well, the most popular implementation is xorg right now, and the \".org\" part should tell you all you need to know. Desktop software: Well, you might be able to make a case for KDE being commercial, since it's Qt-based. But Gnome, Fluxbox, Enlightenment, etc. are all non-profit. There are people out to sell Linux, but they are very much the minority. Increasing the number of end-users of proprietary software leads to a direct financial benefit to the company that makes it. This is simply not the case for FOSS: There is no direct benefit to any FOSS developer in increasing the userbase. Indirect benefits, yes: Personal pride; an increased potential for finding bugs; more likelihood of attracting new developers; possibly a chance of a good job offer; and so on. But Linus Torvalds doesn't make money from increased Linux usage. Richard Stallman doesn't get money from increased GNU usage. All those servers running OpenBSD and OpenSSH don't put a penny into the OpenBSD project's pockets. And so we come to the biggest problem of all when it comes to new users and Linux: They find out they're not wanted. New users come to Linux after spending their lives using an OS where the end-user's needs are paramount, and \"user friendly\" and \"customer focus\" are considered veritable Holy Grails. And they suddenly find themselves using an OS that still relies on 'man' files, the command-line, hand-edited configuration files, and Google. And when they complain, they don't get coddled or promised better things: They get bluntly shown the door. That's an exaggeration, of course. But it is how a lot of potential Linux converts perceived things when they tried and failed to make the switch. In an odd way, FOSS is actually a very selfish development method: People only work on what they want to work on, when they want to work on it. Most people don't see any need to make Linux more attractive to inexperienced end-users: It already does what they want it to do, why should they care if it doesn't work for other people? FOSS has many parallels with the Internet itself: You don't pay the writer of a webpage/the software to download and read/install it. Ubiquitous broadband/User-friendly interfaces are of no great interest to somebody who already has broadband/knows how to use the software. Bloggers/developers don't need to have lots of readers/users to justify blogging/coding. There are lots of people making lots of money off it, but it's not by the old-fashioned \"I own this and you have to pay me if you want some of it\" method that most businesses are so enamoured of; it's by providing services like tech-support/e-commerce. Linux is not interested in market share. Linux does not have customers. Linux does not have shareholders, or a responsibility to the bottom line. Linux was not created to make money. Linux does not have the goal of being the most popular and widespread OS on the planet. All the Linux community wants is to create a really good, fully-featured, free operating system. If that results in Linux becoming a hugely popular OS, then that's great. If that results in Linux having the most intuitive, user-friendly interface ever created, then that's great. If that results in Linux becoming the basis of a multi-billion dollar industry, then that's great. It's great, but it's not the point. The point is to make Linux the best OS that the community is capable of making. Not for other people: For itself. The oh-so-common threats of \"Linux will never take over the desktop unless it does such-and-such\" are simply irrelevant: The Linux community isn't trying to take over the desktop. They really don't care if it gets good enough to make it onto your desktop, so long as it stays good enough to remain on theirs. The highly-vocal MS-haters, pro-Linux zealots, and money-making FOSS purveyors might be loud, but they're still minorities. That's what the Linux community wants: an OS that can be installed by whoever really wants it. So if you're considering switching to Linux, first ask yourself what you really want. If you want an OS that doesn't chauffeur you around, but hands you the keys, puts you in the driver's seat, and expects you to know what to do: Get Linux. You'll have to devote some time to learning how to use it, but once you've done so, you'll have an OS that you can make sit up and dance. If you really just want Windows without the malware and security issues: Read up on good security practices; install a good firewall, malware-detector, and anti-virus; replace IE with a more secure browser; and keep yourself up-to-date with security updates. There are people out there (myself included) who've used Windows since 3.1 days right through to XP without ever being infected with a virus or malware: you can do it too. Don't get Linux: It will fail miserably at being what you want it to be. If you really want the security and performance of a Unix-based OS but with a customer-focussed attitude and an world-renowned interface: Buy an Apple Mac. OS X is great. But don't get Linux: It will not do what you want it to do. It's not just about \"Why should I want Linux?\". It's also about \"Why should Linux want me?\"","title":"Problem #7: That FOSS thing."},{"location":"notes/essay-the-perfext-linux-os/","text":"My notes on Linux and software development. I don't think an efficient system exist - unless you build it ground up the Arch way. If you choose any distribution you are presented with an initial layout defined by the philosophy driving the developers. EndeavourOS is one the best Arch derivatives for this purpose. linux experience I have been touching down from time to time on Linux for decades but due to my professional life concentrated around clients with Windows environments - a few with macOS mixed in - and therefore it has been difficult to get a firm grip on Linux. All my touch downs with Linux in the past was very often accompanied by graphic driver issues. My atttempts to learn was often worked against due to lack of resources that could be dedicated to Linux. The incoherent appearance of the confusing mix of gtk and early qt was also turnoff. The early attempts on using linux requiring extensive knowledge of compiling software from source made me turn to OS/2 with were better but with no tools. So I found myself going back to Windows again and again. My earliest experiences was Clark Connect Firewall/Gateway/Proxy and Suse Linux Enterprise edition with SLOX. But again the pain of configuring the hardware - the slow internet connection - my lack of knowledge in C - all stalled my progress. It was only when I learned about Arch around 2011 and learned how to put the Linux puzzle together - how the filesystem holds different pieces - the filesystem concept of everything is a path even devices - where the local system wide configs are stored - how the configs are prioritized from /usr/ -> /etc -> ~/.config and ~/.local - that is were it began to make sense. When the great picture dawning I began looking for an easier way to install arch and my first experience with an Arch derivative was Cinnarch. I really liked Antergos Gnome edition and stayed with Gnome for a long time. Some of you may remember that Arch has not always been as stable as it is now and back in the early Antergos days - Antergos was not that stable either. memory lane I discovered Manjaro back in 2015 and oddly enough given the very early history of Manjaro (which I have not experienced first hand) my Linux experience stabilized - I still don't know why - but it did. Despite my Python knowledge was null and void - I volunteered when a team member asked for help in rewriting the pacman-mirrors code - so I started learning Python - I am by no means an expert - and I willing to admit I rely a lot on research when I code - the topic is always covered - perhaps not in details but generic examples on how to solve a challenge is often invaluable in the learning process. The April fools day - where the team created the prank to drop x86 and concentrate on ARM - I got invited to join the team - I hesitated - I didn't want to be part of prank - and despite my coding skills in deprecated languares I had no desire to be part of a distribution - but I was flattered that a no-one - a blank sheet - like me would be considered so - the flattery worked - I got a manjaro email address. That was a steep learning experience - while I could draw on the core team if I had questions - asking for help is not my strong side - I am a stubborn idiot who takes pride in learning by reading and doing so I decided to figure out everything on my own. So I did figure out how to build the settings packages - how to follow the tracks down through PKGBUILD after PKGBUILD to locate the source - then learn to modify and created new PKGBUILD and then use those to build an ISO and that was done without any documentation - other than reading a collection of undocumented bash scripts - learning how ENVIRONMENT variables work when running scripts - so my know very deep knowledge of inner workings of an Arch based distribution - I have accumulated through the experience of being a member of the Manjaro Team. This resulted in the resurrection of the Manjaro Openbox ISO and builing that has been very, very educational. In 2022 I retired from being a part of maintaining the distribuition. final reflection So an efficient ISO is impossible to build as it will only match the select few who shares your opinion on efficiency. This is the force of Arch - and Arch or an Arch based distribution without to much bias can be used to create your own exeperience - you create your own efficiency and control your workflow down to the sligthest detail. This is also why complete beginners should never - unless ready to do some university style study and dedicate themselves to the process - start with Arch or an Arch derivative. The distro doesn't add features, and the features it does add I don't want Originally posted by Jonathon Fernyhough at Archived Manjaro forum - April 19, 2019 I want Manjaro to add a feature which I want. I can't do it myself but it's really important to what I currently think is important so Manjaro should add it. The developers are lazy because they don't do what I want them to do, but they still find time to add features which other people ask for. That's stupid and lazy. Those features which other people want aren't what I want, so they are a waste of time and completely bloat. I hate bloat. Bloat is extra features that I don't want. Not like the extra features which I do want because they aren't bloat because I want them. Why does Manjaro include stuff which I don't want? Why won't Manjaro include what I want instead of what other people want? Why can't Manjaro be made into what I want, and also what everyone else at the same time wants because they also want what I want (apart from the people who don't want because they are noob and hate privacy)? I keep asking for someone else to do something for me over and over and over again and yet they still haven't done what I want them to. This means Manjaro is terrible and shouldn't be used by anyone, ever. I never liked Manjaro anyway because it's made by script kiddies, but I'm doing this because I want Manjaro to be popular because if it did what I wanted then it would be more popular and more people would want to use it because everyone wants the same thing that I want. It just shows that because you don't do what I want that you don't know what you're doing and I'm never going to recommend Manjaro to anyone. But if you did do just this one thing which I want then Manjaro would be the best.","title":"The perfect Linux OS"},{"location":"notes/essay-the-perfext-linux-os/#my-notes-on-linux-and-software-development","text":"I don't think an efficient system exist - unless you build it ground up the Arch way. If you choose any distribution you are presented with an initial layout defined by the philosophy driving the developers. EndeavourOS is one the best Arch derivatives for this purpose.","title":"My notes on Linux and software development."},{"location":"notes/essay-the-perfext-linux-os/#linux-experience","text":"I have been touching down from time to time on Linux for decades but due to my professional life concentrated around clients with Windows environments - a few with macOS mixed in - and therefore it has been difficult to get a firm grip on Linux. All my touch downs with Linux in the past was very often accompanied by graphic driver issues. My atttempts to learn was often worked against due to lack of resources that could be dedicated to Linux. The incoherent appearance of the confusing mix of gtk and early qt was also turnoff. The early attempts on using linux requiring extensive knowledge of compiling software from source made me turn to OS/2 with were better but with no tools. So I found myself going back to Windows again and again. My earliest experiences was Clark Connect Firewall/Gateway/Proxy and Suse Linux Enterprise edition with SLOX. But again the pain of configuring the hardware - the slow internet connection - my lack of knowledge in C - all stalled my progress. It was only when I learned about Arch around 2011 and learned how to put the Linux puzzle together - how the filesystem holds different pieces - the filesystem concept of everything is a path even devices - where the local system wide configs are stored - how the configs are prioritized from /usr/ -> /etc -> ~/.config and ~/.local - that is were it began to make sense. When the great picture dawning I began looking for an easier way to install arch and my first experience with an Arch derivative was Cinnarch. I really liked Antergos Gnome edition and stayed with Gnome for a long time. Some of you may remember that Arch has not always been as stable as it is now and back in the early Antergos days - Antergos was not that stable either.","title":"linux experience"},{"location":"notes/essay-the-perfext-linux-os/#memory-lane","text":"I discovered Manjaro back in 2015 and oddly enough given the very early history of Manjaro (which I have not experienced first hand) my Linux experience stabilized - I still don't know why - but it did. Despite my Python knowledge was null and void - I volunteered when a team member asked for help in rewriting the pacman-mirrors code - so I started learning Python - I am by no means an expert - and I willing to admit I rely a lot on research when I code - the topic is always covered - perhaps not in details but generic examples on how to solve a challenge is often invaluable in the learning process. The April fools day - where the team created the prank to drop x86 and concentrate on ARM - I got invited to join the team - I hesitated - I didn't want to be part of prank - and despite my coding skills in deprecated languares I had no desire to be part of a distribution - but I was flattered that a no-one - a blank sheet - like me would be considered so - the flattery worked - I got a manjaro email address. That was a steep learning experience - while I could draw on the core team if I had questions - asking for help is not my strong side - I am a stubborn idiot who takes pride in learning by reading and doing so I decided to figure out everything on my own. So I did figure out how to build the settings packages - how to follow the tracks down through PKGBUILD after PKGBUILD to locate the source - then learn to modify and created new PKGBUILD and then use those to build an ISO and that was done without any documentation - other than reading a collection of undocumented bash scripts - learning how ENVIRONMENT variables work when running scripts - so my know very deep knowledge of inner workings of an Arch based distribution - I have accumulated through the experience of being a member of the Manjaro Team. This resulted in the resurrection of the Manjaro Openbox ISO and builing that has been very, very educational. In 2022 I retired from being a part of maintaining the distribuition.","title":"memory lane"},{"location":"notes/essay-the-perfext-linux-os/#final-reflection","text":"So an efficient ISO is impossible to build as it will only match the select few who shares your opinion on efficiency. This is the force of Arch - and Arch or an Arch based distribution without to much bias can be used to create your own exeperience - you create your own efficiency and control your workflow down to the sligthest detail. This is also why complete beginners should never - unless ready to do some university style study and dedicate themselves to the process - start with Arch or an Arch derivative.","title":"final reflection"},{"location":"notes/essay-the-perfext-linux-os/#the-distro-doesnt-add-features-and-the-features-it-does-add-i-dont-want","text":"Originally posted by Jonathon Fernyhough at Archived Manjaro forum - April 19, 2019 I want Manjaro to add a feature which I want. I can't do it myself but it's really important to what I currently think is important so Manjaro should add it. The developers are lazy because they don't do what I want them to do, but they still find time to add features which other people ask for. That's stupid and lazy. Those features which other people want aren't what I want, so they are a waste of time and completely bloat. I hate bloat. Bloat is extra features that I don't want. Not like the extra features which I do want because they aren't bloat because I want them. Why does Manjaro include stuff which I don't want? Why won't Manjaro include what I want instead of what other people want? Why can't Manjaro be made into what I want, and also what everyone else at the same time wants because they also want what I want (apart from the people who don't want because they are noob and hate privacy)? I keep asking for someone else to do something for me over and over and over again and yet they still haven't done what I want them to. This means Manjaro is terrible and shouldn't be used by anyone, ever. I never liked Manjaro anyway because it's made by script kiddies, but I'm doing this because I want Manjaro to be popular because if it did what I wanted then it would be more popular and more people would want to use it because everyone wants the same thing that I want. It just shows that because you don't do what I want that you don't know what you're doing and I'm never going to recommend Manjaro to anyone. But if you did do just this one thing which I want then Manjaro would be the best.","title":"The distro doesn't add features, and the features it does add I don't want"},{"location":"notes/md-raid-notes/","text":"Raid Notes Script This is a test script for setting up md/raid 10far2 #!/bin/bash dev1='/dev/sdd' dev2='/dev/sde' name='test' offset='1M' size='400G' partnum='1' parttype='fd00' if ! [[ $(which sgdisk) =~ (sgdisk) ]]; then echo \"install gptfdisk package\" exit 1 fi echo \"prepare ${dev1}\" sgdisk --zapall ${dev1} echo \"sgdisk --mbrtogpt ${dev1}\" sgdisk --mbrtogpt ${dev1} echo \"sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:\\\"${name}1\\\" ${dev1}\" sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:${name}1 ${dev1} echo \"prepare ${dev2}\" echo \"sgdisk --zapall ${dev2}\" sgdisk --zapall ${dev2} echo \"sgdisk --mbrtogpt ${dev2}\" sgdisk --mbrtogpt ${dev2} echo \"sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:\\\"${name}2\\\" ${dev2}\" sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:${name}2 ${dev2} echo \"create md/raid\" mdadm --create --verbose --level=10 --metadata=1.2 --chunk=512 --raid-devices=2 --layout=f2 /dev/md/${name} ${dev1}${partnum} ${dev2}${partnum} echo \"status ...\" cat /proc/mdstat Note on number of disk in setup Four disk setup mdadm --create --verbose --level=10 --metadata=1.2 --chunk=512 --raid-devices=4 --layout=f2 /dev/md/webdata /dev/sda2 /dev/sdb2 /dev/sdc2 /dev/sdd2 Two disk setup mdadm --create --verbose --level=10 --metadata=1.2 --chunk=512 --raid-devices=2 --layout=f2 /dev/md/${name} /dev/sdc2 /dev/sdd2 To memorize Status raid building cat /proc/mdstat Pipe setup to mdadm.conf mdadm --detail --scan >> /etc/mdadm.conf Assembly mdadm --assemble --scan Formatting raid Calculating the stride and stripe width chunk mdadm --detail /dev/mdX | grep 'Chunk Size' block 4k numdisks = N N for a raid0 array of N N-1 for raid5 N*2 for raid10,far2 array of N*2 stride = chunk / block stripe-width = numdisks * stride Format four disk setup mkfs.ext4 -v -L ${name} -b 4096 -E stride=128,stripe-width=512 /dev/${name} Format two disk setup mkfs.ext4 -v -L ${name} -b 4096 -E stride=128,stripe-width=256 /dev/${name}","title":"MD/RAID notes"},{"location":"notes/md-raid-notes/#raid-notes","text":"","title":"Raid Notes"},{"location":"notes/md-raid-notes/#script","text":"This is a test script for setting up md/raid 10far2 #!/bin/bash dev1='/dev/sdd' dev2='/dev/sde' name='test' offset='1M' size='400G' partnum='1' parttype='fd00' if ! [[ $(which sgdisk) =~ (sgdisk) ]]; then echo \"install gptfdisk package\" exit 1 fi echo \"prepare ${dev1}\" sgdisk --zapall ${dev1} echo \"sgdisk --mbrtogpt ${dev1}\" sgdisk --mbrtogpt ${dev1} echo \"sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:\\\"${name}1\\\" ${dev1}\" sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:${name}1 ${dev1} echo \"prepare ${dev2}\" echo \"sgdisk --zapall ${dev2}\" sgdisk --zapall ${dev2} echo \"sgdisk --mbrtogpt ${dev2}\" sgdisk --mbrtogpt ${dev2} echo \"sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:\\\"${name}2\\\" ${dev2}\" sgdisk --new ${partnum}:+${offset}:+${size} --typecode ${partnum}:${parttype} --change-name ${partnum}:${name}2 ${dev2} echo \"create md/raid\" mdadm --create --verbose --level=10 --metadata=1.2 --chunk=512 --raid-devices=2 --layout=f2 /dev/md/${name} ${dev1}${partnum} ${dev2}${partnum} echo \"status ...\" cat /proc/mdstat","title":"Script"},{"location":"notes/md-raid-notes/#note-on-number-of-disk-in-setup","text":"","title":"Note on number of disk in setup"},{"location":"notes/md-raid-notes/#four-disk-setup","text":"mdadm --create --verbose --level=10 --metadata=1.2 --chunk=512 --raid-devices=4 --layout=f2 /dev/md/webdata /dev/sda2 /dev/sdb2 /dev/sdc2 /dev/sdd2","title":"Four disk setup"},{"location":"notes/md-raid-notes/#two-disk-setup","text":"mdadm --create --verbose --level=10 --metadata=1.2 --chunk=512 --raid-devices=2 --layout=f2 /dev/md/${name} /dev/sdc2 /dev/sdd2","title":"Two disk setup"},{"location":"notes/md-raid-notes/#to-memorize","text":"Status raid building cat /proc/mdstat Pipe setup to mdadm.conf mdadm --detail --scan >> /etc/mdadm.conf Assembly mdadm --assemble --scan","title":"To memorize"},{"location":"notes/md-raid-notes/#formatting-raid","text":"Calculating the stride and stripe width chunk mdadm --detail /dev/mdX | grep 'Chunk Size' block 4k numdisks = N N for a raid0 array of N N-1 for raid5 N*2 for raid10,far2 array of N*2 stride = chunk / block stripe-width = numdisks * stride","title":"Formatting raid"},{"location":"notes/md-raid-notes/#format-four-disk-setup","text":"mkfs.ext4 -v -L ${name} -b 4096 -E stride=128,stripe-width=512 /dev/${name}","title":"Format four disk setup"},{"location":"notes/md-raid-notes/#format-two-disk-setup","text":"mkfs.ext4 -v -L ${name} -b 4096 -E stride=128,stripe-width=256 /dev/${name}","title":"Format two disk setup"},{"location":"notes/mount-disk-using-fstab/","text":"Make a permanent mountpoint. http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION states The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. FHS addresses issues where file placements need to be coordinated between multiple parties such as local sites, distributions, applications, documentation, etc. So for the sake of this HowTo there is no standard as we are talking about Local placement of local files is a local issue and the following is therefore to be seen as a suggestion not a requirement. You are the user/owner of the system and you should choose whatever structure is logical to you. Location considerations If you are the one and only user of the system - i.e. it is not a shared system - you can create your mount points in your home folder - nothing wrong. But if it is a shared system you should create the mount structure beginning from the root e.g. /data/name-of-mount or for removable devices /media/media-name . The /mnt is a predefined location for temporary mounts - so avoid using it for permanent mounts - it can go oh-so-wrong. Also avoid the /run location as /run is a volatile structure created as a tmpfs and will be removed at reboot or shutdown. The following will use a substitute name for the root $mount mount e.g. /home/username or /data so replace with your $mount with whatever you choose. Locate the device and partition(s). $ lsblk sda 8:0 0 223,6G 0 disk \u251c\u2500sda1 8:1 0 512M 0 part \u251c\u2500sda2 8:2 0 60G 0 part \u251c\u2500sda3 8:3 0 130G 0 part \u2514\u2500sda4 8:4 0 33,1G 0 part [SWAP] sdb 8:16 0 477G 0 disk \u2514\u2500sdb1 8:17 0 419,1G Depending on your computers hardware you might get other device names and partition numbers. Modify the following according to your output. The /data folder To help yourself locating your folders easily you should use a consistent approach across your systems. When you share partitions across users it is preferable to use a location outside the /home structure and thus avoiding permissions issues across users. The /media folder Systemd uses a media folder located under /run to mount removable medias on the fly. The root folder /media is a folder commonly used for mounting removable media on a defined structure. Ubuntu and other distros used it and certain automount utilities use the folder. Permissions If you define the mount outside your home e.g. /data you must also define the access control for the folder. ACL is a topic on its own so to keep it simple just set the permissions so everyone can use it. This is not necessary if you create the mount point inside your home sudo chmod ugo+rwx $mount Make a permanent mountpoint. Create a folder for the purpose (change all references to mydisk as you would want a more descriptive name). If you have several partitions you should name the folders with decriptive names - what ever you feel appropriate :) $ mkdir $mount/mydisk Mount the partition. Replace the Xy with the device and the partition number you found. $ sudo mount /dev/sdXy $mount/mydisk Mount partition on boot (not removable media) To mount it permanently on boot modify your /etc/fstab to include the partition on boot. $ su - # echo \"UUID=$(lsblk -no UUID /dev/sdXy) $mount/mydisk $(lsblk -no FSTYPE /dev/sdXy) defaults,noatime 0 2\" >> /etc/fstab # mount -a If your drive has more than one partition repeat above steps as needed adjusting for each partition. The echo command looks cryptic right? It is not - try this $ lsblk -no UUID /dev/sdb1 bogus-id-4e9e-403d-bbd0-72e62301e07c This outputs the unique identifier of your partition. This is used in fstab to ensure the same partition is always mounted the right places. Now try this $ echo $(lsblk -no UUID /dev/sdb1) bogus-id-4e9e-403d-bbd0-72e62301e07c You see? We got the exact same result but with this approach we include it in a command which writes a lot more info. Note that we can use a similar construction to get the filesystem type for the partition. $ echo $(lsblk -no FSTYPE /dev/sdb1) ext4 To write this to a file we use a pipe - an arrow pointing to a file name. $ echo \"UUID=$(lsblk -no UUID /dev/sdb1) $mountmydisk $(lsblk -no FSTYPE /dev/sdXy) defaults,noatime 0 2\" > test.txt To avoid deleting the contents of a file we append to it with double arrow $ echo \"UUID=$(lsblk -no UUID /dev/sda2) $mount/myhome $(lsblk -no FSTYPE /dev/sdXy) defaults,noatime 0 2\" >> test.txt Have a look at the file $ cat test.txt UUID=bogusid1-4e9e-403d-bbd0-72e62301e07c $mount/mydisk ext4 defaults,noatime 0 2 UUID=bogusid2-314f-40a9-b82f-a8fcfabbccb4 $mount/myhome ext4 defaults,noatime 0 2 Network locations and removable devices For network locations and removable devices which needs a specific location e.g. a backup device targeted in scripting read the article on using systemd mount units. https://forum.manjaro.org/t/root-tip-use-systemd-to-mount-any-device/1185 https://forum.manjaro.org/t/howto-systemd-mount-unit-samples/1191 More reading https://forum.manjaro.org/t/tutorial-understanding-and-working-with-unix-filesystems-and-permissions/65793","title":"Permanent mounts using fstab"},{"location":"notes/mount-disk-using-fstab/#make-a-permanent-mountpoint","text":"http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION states The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. FHS addresses issues where file placements need to be coordinated between multiple parties such as local sites, distributions, applications, documentation, etc. So for the sake of this HowTo there is no standard as we are talking about Local placement of local files is a local issue and the following is therefore to be seen as a suggestion not a requirement. You are the user/owner of the system and you should choose whatever structure is logical to you.","title":"Make a permanent mountpoint."},{"location":"notes/mount-disk-using-fstab/#location-considerations","text":"If you are the one and only user of the system - i.e. it is not a shared system - you can create your mount points in your home folder - nothing wrong. But if it is a shared system you should create the mount structure beginning from the root e.g. /data/name-of-mount or for removable devices /media/media-name . The /mnt is a predefined location for temporary mounts - so avoid using it for permanent mounts - it can go oh-so-wrong. Also avoid the /run location as /run is a volatile structure created as a tmpfs and will be removed at reboot or shutdown. The following will use a substitute name for the root $mount mount e.g. /home/username or /data so replace with your $mount with whatever you choose.","title":"Location considerations"},{"location":"notes/mount-disk-using-fstab/#locate-the-device-and-partitions","text":"$ lsblk sda 8:0 0 223,6G 0 disk \u251c\u2500sda1 8:1 0 512M 0 part \u251c\u2500sda2 8:2 0 60G 0 part \u251c\u2500sda3 8:3 0 130G 0 part \u2514\u2500sda4 8:4 0 33,1G 0 part [SWAP] sdb 8:16 0 477G 0 disk \u2514\u2500sdb1 8:17 0 419,1G Depending on your computers hardware you might get other device names and partition numbers. Modify the following according to your output.","title":"Locate the device and partition(s)."},{"location":"notes/mount-disk-using-fstab/#the-data-folder","text":"To help yourself locating your folders easily you should use a consistent approach across your systems. When you share partitions across users it is preferable to use a location outside the /home structure and thus avoiding permissions issues across users.","title":"The /data folder"},{"location":"notes/mount-disk-using-fstab/#the-media-folder","text":"Systemd uses a media folder located under /run to mount removable medias on the fly. The root folder /media is a folder commonly used for mounting removable media on a defined structure. Ubuntu and other distros used it and certain automount utilities use the folder.","title":"The /media folder"},{"location":"notes/mount-disk-using-fstab/#permissions","text":"If you define the mount outside your home e.g. /data you must also define the access control for the folder. ACL is a topic on its own so to keep it simple just set the permissions so everyone can use it. This is not necessary if you create the mount point inside your home sudo chmod ugo+rwx $mount","title":"Permissions"},{"location":"notes/mount-disk-using-fstab/#make-a-permanent-mountpoint_1","text":"Create a folder for the purpose (change all references to mydisk as you would want a more descriptive name). If you have several partitions you should name the folders with decriptive names - what ever you feel appropriate :) $ mkdir $mount/mydisk","title":"Make a permanent mountpoint."},{"location":"notes/mount-disk-using-fstab/#mount-the-partition","text":"Replace the Xy with the device and the partition number you found. $ sudo mount /dev/sdXy $mount/mydisk","title":"Mount the partition."},{"location":"notes/mount-disk-using-fstab/#mount-partition-on-boot-not-removable-media","text":"To mount it permanently on boot modify your /etc/fstab to include the partition on boot. $ su - # echo \"UUID=$(lsblk -no UUID /dev/sdXy) $mount/mydisk $(lsblk -no FSTYPE /dev/sdXy) defaults,noatime 0 2\" >> /etc/fstab # mount -a If your drive has more than one partition repeat above steps as needed adjusting for each partition.","title":"Mount partition on boot (not removable media)"},{"location":"notes/mount-disk-using-fstab/#the-echo-command-looks-cryptic-right","text":"It is not - try this $ lsblk -no UUID /dev/sdb1 bogus-id-4e9e-403d-bbd0-72e62301e07c This outputs the unique identifier of your partition. This is used in fstab to ensure the same partition is always mounted the right places. Now try this $ echo $(lsblk -no UUID /dev/sdb1) bogus-id-4e9e-403d-bbd0-72e62301e07c You see? We got the exact same result but with this approach we include it in a command which writes a lot more info. Note that we can use a similar construction to get the filesystem type for the partition. $ echo $(lsblk -no FSTYPE /dev/sdb1) ext4 To write this to a file we use a pipe - an arrow pointing to a file name. $ echo \"UUID=$(lsblk -no UUID /dev/sdb1) $mountmydisk $(lsblk -no FSTYPE /dev/sdXy) defaults,noatime 0 2\" > test.txt To avoid deleting the contents of a file we append to it with double arrow $ echo \"UUID=$(lsblk -no UUID /dev/sda2) $mount/myhome $(lsblk -no FSTYPE /dev/sdXy) defaults,noatime 0 2\" >> test.txt Have a look at the file $ cat test.txt UUID=bogusid1-4e9e-403d-bbd0-72e62301e07c $mount/mydisk ext4 defaults,noatime 0 2 UUID=bogusid2-314f-40a9-b82f-a8fcfabbccb4 $mount/myhome ext4 defaults,noatime 0 2","title":"The echo command looks cryptic right?"},{"location":"notes/mount-disk-using-fstab/#network-locations-and-removable-devices","text":"For network locations and removable devices which needs a specific location e.g. a backup device targeted in scripting read the article on using systemd mount units. https://forum.manjaro.org/t/root-tip-use-systemd-to-mount-any-device/1185 https://forum.manjaro.org/t/howto-systemd-mount-unit-samples/1191","title":"Network locations and removable devices"},{"location":"notes/mount-disk-using-fstab/#more-reading","text":"https://forum.manjaro.org/t/tutorial-understanding-and-working-with-unix-filesystems-and-permissions/65793","title":"More reading"},{"location":"notes/mount-loop-img-files/","text":"Mounting an image file e.g. an ARM device image Use the first available loop device losetup -f disk.img List block devices to see which one got added e.g. loop0 partprobe /dev/loop0 Mount the partitions - e.g. a PinePhone image mount /dev/loop0p2 /mnt mount /dev/loop0p1 /mnt/boot When done unmount umount -r /mnt","title":"CLI mount .img files on Arch based system"},{"location":"notes/mount-storage-partition-mount-using-fstab/","text":"Storing personal files on different partition Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. That repeatedly creates the issue on how to handle the home folder with configurations and personal files. The purpose of this document is to create an easy and convenient way of safeguarding personal data files while retaining the home folder. Preparation http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION states The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. FHS addresses issues where file placements need to be coordinated between multiple parties such as local sites, distributions, applications, documentation, etc. So for the sake of this HowTo there is no standard as we are talking about Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a system with at least three partitions or more will suffice. EFI System Partition (ESP) Root with home User data Setting up the partition for single user Assuming you are the only user on the system, proceed to create a folder in your home e.g. Data and mount the extra partition there. $ mkdir ~/Data The simple and preferred method is to use the Gnome Disk Utility and modify the mount options so the partition mounts at boot time in the Data folder. If the system is a multi-user system the approach is different and is discussed here . Create the mount script When done and the partition mounts at boot, create a folder in the data folder. $ mkdir ~/Data/scripts Copy your /etc/fstab to the scripts folder $ cp /etc/fstab ~/Data/scripts/fstab.txt Edit the file fstab.txt and remove everything except the line which mounts your data partition. Proceed with creating a script in the scripts folder and make it executable $ touch ~/Data/scripts/20-mod-fstab $ chmod +x ~/Data/scripts/20-mod-fstab Edit the script file and paste the following content into it #!/bin/bash scriptdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi echo \"Modifying a copy of /etc/fstab -> ${scriptdir}/fstab.org ...\" cp /etc/fstab ${scriptdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${scriptdir}/fstab.org echo \"Merging `fstab.txt` into `fstab.org`\" cat ${scriptdir}/fstab.txt >> ${scriptdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab ...\" sudo mv -bi ${scriptdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" This script is a convenience script to be used when ever you have reinstalled your system and you you need to re-establish the mount point. The script expects the mount folder to be present . Link your data Depending in the folders you want to control you must ceate a symbolic link in your home to the new location. Create a new .home folder in your Data folder $ mkdir ~/Data/.home Decide which folders you want to control and create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/30-link-data $ chmod +x ~/Data/scripts/30-link-data Edit the file and and paste the following content into it. Modify the script to match your system and the folders you want to control and save the file. If want bulletproof folder structure consider the information here #!/bin/bash echo \"Moving and linking folders\" cd ~ # moving and linking documents mv -i Documents ~/Data/.home ln -s ~/Data/.home/Documents # moving and linking downloads mv -i Downloads ~/Data/.home ln -s ~/Data/.home/Downloads # moving and linking music mv -i Music ~/Data/.home ln -s ~/Data/.home/Music # moving and linking pictures mv -i Pictures ~/Data/.home ln -s ~/Data/.home/Pictures # moving and linking virtualbox vm's mv -i VirtualBox\\ VMs ~/Data/.home ln -s ~/Data/.home/VirtualBox\\ VMs The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist. Data structure Create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/10-create-data-structure $ chmod +x ~/Data/scripts/10-create-data-structure Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash datadir=\"/home/$USER/Data\" echo \"Creating Data mount structure\" mkdir -p ${datadir} The script is used to create your desired data structure. Add what you deem necessary. Conclusion You have now created three scripts and a text file which can be used whenever you have reinstalled your system. Just run the scripts in sequence 10- 20- 30- and your data is mounted, linked and available - all within minutes. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there. Reference files [details=\"mounting details\"] /data/private/scripts >>> cat fstab.txt UUID=456bf27c-7e14-48b4-9df8-a49254dcf79e /data/projects ext4 defaults,noatime 0 2 UUID=899b1bc4-219c-4b92-8539-0aa118d9780a /data/build ext4 defaults,noatime 0 2 UUID=1f3d1a6e-b4b5-46da-909a-8a87a45dd18b /data/private ext4 defaults,noatime 0 2 #UUID=67f922cd-a61f-4d5e-84c0-ac8335a7ce67 /data/virtualbox ext4 defaults,noatime 0 2 UUID=a27d7c58-0ebb-4c93-bcec-f9387f7d34f6 /data/virtualbox ext4 defaults,noatime 0 2 #UUID=b925148a-0729-447a-ad95-4d9e27dcb442 /data/usb/seagate ext4 defaults,noatime 0 2 tmpfs /var/spool tmpfs defaults,noatime,mode=1777 0 0 tmpfs /var/tmp tmpfs defaults,noatime,mode=1777 0 0 diskstation:/volume1/data /data/nfs/data nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/music /data/nfs/music nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/photo /data/nfs/photo nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/video /data/nfs/video nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/web /data/nfs/web nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 [/details] [details=\"10-net-services\"] /data/private/scripts >>> cat 10-net-services #!/bin/bash echo \"Using sudo ...\" echo \"Start and enable nfs-client.target\" sudo systemctl enable --now nfs-client.target sudo systemctl enable --now NetworkManager-wait-online.service [/details] [details=\"20-create-data-structure\"] /data/private/scripts >>> cat 20-create-data-structure #!/bin/bash datadir=\"/data/\" echo \"Creating Data mount structure\" sudo mkdir ${datadir} sudo mkdir ${datadir}/nfs sudo mkdir ${datadir}/build sudo mkdir ${datadir}/private sudo mkdir ${datadir}/projects sudo mkdir ${datadir}/virtualbox sudo chown $USER ${datadir}/nfs \\ ${datadir}/build \\ ${datadir}/private \\ ${datadir}/projects \\ ${datadir}/virtualbox mkdir ${datadir}/nfs/data \\ ${datadir}/nfs/music \\ ${datadir}/nfs/photo \\ ${datadir}/nfs/video \\ ${datadir}/nfs/web [/details] [details=\"30-mod-fstab\"] /data/private/scripts >>> cat 30-mod-fstab #!/bin/bash echo \"Modifying a copy of /etc/fstab...\" workdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi cp /etc/fstab ${workdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${workdir}/fstab.org echo \"Merging 'fstab.txt' with 'fstab.org'\" cat ${workdir}/fstab.txt >> ${workdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab...\" sudo mv ${workdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" [/details] [details=\"40-link-data\"] /data/private/scripts >>> cat 40-link-data #!/bin/bash cd ~ #linking root data folder ln -s /data ~/Data echo \"Linking Documents folder...\" rm -rf Documents ln -sf /data/private/.home/Documents echo \"Linking Downloads folder...\" rm -rf Downloads ln -sf /data/private/.home/Downloads echo \"Linking Music folder...\" rm -rf Music ln -sf /data/private/.home/Music echo \"Linking Pictures folder...\" rm -rf Pictures ln -sf /data/private/.home/Pictures echo \"Linking Manjaro tools config folder...\" ln -sf /data/private/manjaro-tools-config ~/.config/manjaro-tools echo \"Linking Thunderbird data folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking Virtual Environments folder...\" ln -sf /data/projects/.virtualenvs echo \"Linking VirtualBox VMs...\" ln -sf /data/virtualbox/VirtualBox\\ VMs echo \"Copying Git config...\" ln -sf /data/private/.home/.gitconfig echo \"Linking makepkg config...\" ln -sf /data/private/.home/.makepkg.conf echo \"Linking Transifex config...\" ln -sf /data/private/.home/.transifexrc echo \"Linking netrc config...\" ln -sf /data/private/.home/.netrc ~/ chown fh:fh ~/.netrc chmod u+rwx,go-rwx ~/.netrc echo \"Copying SSH config folder...\" cp -r /data/private/.home/.ssh ~/.ssh chown fh:fh ~/.ssh -R chmod u+rwx,go-rwx ~/.ssh -R echo \"Linking thunderbird folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking GPG keyring\" rm -f ~/.gnupg ln -sf /data/private/.home/.gnupg chown fh:fh ~/.gnupg -R chmod u+rwx,go-rwx ~/.gnupg -R echo \"Done!\" [/details]","title":"Store personal files using separate partition (fstab)"},{"location":"notes/mount-storage-partition-mount-using-fstab/#storing-personal-files-on-different-partition","text":"Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. That repeatedly creates the issue on how to handle the home folder with configurations and personal files. The purpose of this document is to create an easy and convenient way of safeguarding personal data files while retaining the home folder.","title":"Storing personal files on different partition"},{"location":"notes/mount-storage-partition-mount-using-fstab/#preparation","text":"http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION states The FHS document has a limited scope: Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. FHS addresses issues where file placements need to be coordinated between multiple parties such as local sites, distributions, applications, documentation, etc. So for the sake of this HowTo there is no standard as we are talking about Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a system with at least three partitions or more will suffice. EFI System Partition (ESP) Root with home User data","title":"Preparation"},{"location":"notes/mount-storage-partition-mount-using-fstab/#setting-up-the-partition-for-single-user","text":"Assuming you are the only user on the system, proceed to create a folder in your home e.g. Data and mount the extra partition there. $ mkdir ~/Data The simple and preferred method is to use the Gnome Disk Utility and modify the mount options so the partition mounts at boot time in the Data folder. If the system is a multi-user system the approach is different and is discussed here .","title":"Setting up the partition for single user"},{"location":"notes/mount-storage-partition-mount-using-fstab/#create-the-mount-script","text":"When done and the partition mounts at boot, create a folder in the data folder. $ mkdir ~/Data/scripts Copy your /etc/fstab to the scripts folder $ cp /etc/fstab ~/Data/scripts/fstab.txt Edit the file fstab.txt and remove everything except the line which mounts your data partition. Proceed with creating a script in the scripts folder and make it executable $ touch ~/Data/scripts/20-mod-fstab $ chmod +x ~/Data/scripts/20-mod-fstab Edit the script file and paste the following content into it #!/bin/bash scriptdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi echo \"Modifying a copy of /etc/fstab -> ${scriptdir}/fstab.org ...\" cp /etc/fstab ${scriptdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${scriptdir}/fstab.org echo \"Merging `fstab.txt` into `fstab.org`\" cat ${scriptdir}/fstab.txt >> ${scriptdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab ...\" sudo mv -bi ${scriptdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" This script is a convenience script to be used when ever you have reinstalled your system and you you need to re-establish the mount point. The script expects the mount folder to be present .","title":"Create the mount script"},{"location":"notes/mount-storage-partition-mount-using-fstab/#link-your-data","text":"Depending in the folders you want to control you must ceate a symbolic link in your home to the new location. Create a new .home folder in your Data folder $ mkdir ~/Data/.home Decide which folders you want to control and create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/30-link-data $ chmod +x ~/Data/scripts/30-link-data Edit the file and and paste the following content into it. Modify the script to match your system and the folders you want to control and save the file. If want bulletproof folder structure consider the information here #!/bin/bash echo \"Moving and linking folders\" cd ~ # moving and linking documents mv -i Documents ~/Data/.home ln -s ~/Data/.home/Documents # moving and linking downloads mv -i Downloads ~/Data/.home ln -s ~/Data/.home/Downloads # moving and linking music mv -i Music ~/Data/.home ln -s ~/Data/.home/Music # moving and linking pictures mv -i Pictures ~/Data/.home ln -s ~/Data/.home/Pictures # moving and linking virtualbox vm's mv -i VirtualBox\\ VMs ~/Data/.home ln -s ~/Data/.home/VirtualBox\\ VMs The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist.","title":"Link your data"},{"location":"notes/mount-storage-partition-mount-using-fstab/#data-structure","text":"Create a new file in your ~/Data/scripts folder and make it executable $ touch ~/Data/scripts/10-create-data-structure $ chmod +x ~/Data/scripts/10-create-data-structure Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash datadir=\"/home/$USER/Data\" echo \"Creating Data mount structure\" mkdir -p ${datadir} The script is used to create your desired data structure. Add what you deem necessary.","title":"Data structure"},{"location":"notes/mount-storage-partition-mount-using-fstab/#conclusion","text":"You have now created three scripts and a text file which can be used whenever you have reinstalled your system. Just run the scripts in sequence 10- 20- 30- and your data is mounted, linked and available - all within minutes. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there.","title":"Conclusion"},{"location":"notes/mount-storage-partition-mount-using-fstab/#reference-files","text":"[details=\"mounting details\"] /data/private/scripts >>> cat fstab.txt UUID=456bf27c-7e14-48b4-9df8-a49254dcf79e /data/projects ext4 defaults,noatime 0 2 UUID=899b1bc4-219c-4b92-8539-0aa118d9780a /data/build ext4 defaults,noatime 0 2 UUID=1f3d1a6e-b4b5-46da-909a-8a87a45dd18b /data/private ext4 defaults,noatime 0 2 #UUID=67f922cd-a61f-4d5e-84c0-ac8335a7ce67 /data/virtualbox ext4 defaults,noatime 0 2 UUID=a27d7c58-0ebb-4c93-bcec-f9387f7d34f6 /data/virtualbox ext4 defaults,noatime 0 2 #UUID=b925148a-0729-447a-ad95-4d9e27dcb442 /data/usb/seagate ext4 defaults,noatime 0 2 tmpfs /var/spool tmpfs defaults,noatime,mode=1777 0 0 tmpfs /var/tmp tmpfs defaults,noatime,mode=1777 0 0 diskstation:/volume1/data /data/nfs/data nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/music /data/nfs/music nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/photo /data/nfs/photo nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/video /data/nfs/video nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 diskstation:/volume1/web /data/nfs/web nfs auto,x-systemd.automount,x-systemd.device-timeout=10,timeo=14,x-systemd.idle-timeout=1min 0 0 [/details] [details=\"10-net-services\"] /data/private/scripts >>> cat 10-net-services #!/bin/bash echo \"Using sudo ...\" echo \"Start and enable nfs-client.target\" sudo systemctl enable --now nfs-client.target sudo systemctl enable --now NetworkManager-wait-online.service [/details] [details=\"20-create-data-structure\"] /data/private/scripts >>> cat 20-create-data-structure #!/bin/bash datadir=\"/data/\" echo \"Creating Data mount structure\" sudo mkdir ${datadir} sudo mkdir ${datadir}/nfs sudo mkdir ${datadir}/build sudo mkdir ${datadir}/private sudo mkdir ${datadir}/projects sudo mkdir ${datadir}/virtualbox sudo chown $USER ${datadir}/nfs \\ ${datadir}/build \\ ${datadir}/private \\ ${datadir}/projects \\ ${datadir}/virtualbox mkdir ${datadir}/nfs/data \\ ${datadir}/nfs/music \\ ${datadir}/nfs/photo \\ ${datadir}/nfs/video \\ ${datadir}/nfs/web [/details] [details=\"30-mod-fstab\"] /data/private/scripts >>> cat 30-mod-fstab #!/bin/bash echo \"Modifying a copy of /etc/fstab...\" workdir=${PWD} protected=$(grep 'PROTECT' /etc/fstab) if ! [[ -z $protected ]]; then echo \"\" echo \"Already modified! exit ...\" exit fi cp /etc/fstab ${workdir}/fstab.org echo \"# PROTECTION against double merge\" >> ${workdir}/fstab.org echo \"Merging 'fstab.txt' with 'fstab.org'\" cat ${workdir}/fstab.txt >> ${workdir}/fstab.org echo \"Using sudo: Replacing /etc/fstab...\" sudo mv ${workdir}/fstab.org /etc/fstab sudo chown root:root /etc/fstab echo \"Using sudo: Mounting /etc/fstab\" sudo mount -a echo \"Done!\" [/details] [details=\"40-link-data\"] /data/private/scripts >>> cat 40-link-data #!/bin/bash cd ~ #linking root data folder ln -s /data ~/Data echo \"Linking Documents folder...\" rm -rf Documents ln -sf /data/private/.home/Documents echo \"Linking Downloads folder...\" rm -rf Downloads ln -sf /data/private/.home/Downloads echo \"Linking Music folder...\" rm -rf Music ln -sf /data/private/.home/Music echo \"Linking Pictures folder...\" rm -rf Pictures ln -sf /data/private/.home/Pictures echo \"Linking Manjaro tools config folder...\" ln -sf /data/private/manjaro-tools-config ~/.config/manjaro-tools echo \"Linking Thunderbird data folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking Virtual Environments folder...\" ln -sf /data/projects/.virtualenvs echo \"Linking VirtualBox VMs...\" ln -sf /data/virtualbox/VirtualBox\\ VMs echo \"Copying Git config...\" ln -sf /data/private/.home/.gitconfig echo \"Linking makepkg config...\" ln -sf /data/private/.home/.makepkg.conf echo \"Linking Transifex config...\" ln -sf /data/private/.home/.transifexrc echo \"Linking netrc config...\" ln -sf /data/private/.home/.netrc ~/ chown fh:fh ~/.netrc chmod u+rwx,go-rwx ~/.netrc echo \"Copying SSH config folder...\" cp -r /data/private/.home/.ssh ~/.ssh chown fh:fh ~/.ssh -R chmod u+rwx,go-rwx ~/.ssh -R echo \"Linking thunderbird folder...\" ln -sf /data/private/.home/.thunderbird echo \"Linking GPG keyring\" rm -f ~/.gnupg ln -sf /data/private/.home/.gnupg chown fh:fh ~/.gnupg -R chmod u+rwx,go-rwx ~/.gnupg -R echo \"Done!\" [/details]","title":"Reference files"},{"location":"notes/mount-storage-partition-mount-using-systemd/","text":"Difficulty: \u2605\u2605\u2606\u2606\u2606 Storing personal files on different partition Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. That repeatedly creates the issue on how to handle the home folder with configurations and personal files. The purpose of this document is to create an easy and convenient way of safeguarding personal data files while retaining the home folder. Preparation http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION states ! The FHS document has a limited scope: ! * Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. ! * FHS addresses issues where file placements need to be coordinated between multiple parties such as local sites, distributions, applications, documentation, etc. So for the sake of this HowTo there is no standard as we are talking about Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a system with at least three partitions or more will suffice. EFI System Partition (ESP) Root with home User data Preparations Create a mount unit for the partition. For the sake of the guide we will use a non-existing device name - which you must substitute with your actual system. First list your devices - this may yield an output similar to this \u279c ~ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sdy 8:0 0 465,8G 0 disk \u251c\u2500sdy1 8:1 0 419,2G 0 part \u2514\u2500sdy2 8:2 0 46,6G 0 part sr0 11:0 1 1024M 0 rom nvme0n9 259:0 0 476,9G 0 disk \u251c\u2500nvme0n9p1 259:1 0 1000M 0 part \u251c\u2500nvme0n9p2 259:2 0 459G 0 part / \u2514\u2500nvme0n9p3 259:3 0 17G 0 part [SWAP] Using the sample output we will use sdy1 as the target. Because udev lists devices completely arbitrarily you cannot rely on the sdy namespace - we need the UUID for our mount - and the easiest way to obtain it in a usable manner is to pipe it into a file - then edit the file. Use this command to create the mount unit in your home then edit the file with your favorite editor. IMPORTANT : For systemd the mount point must match the filename Examples * /data/private = data-private.mount * /data/private/music = data-private-music.mount * /data/development/python = data-development-python.mount lsblk -no UUID /dev/sdy1 > ~/data-private.mount Modify the file to read like this - $UUID - is only a placeholder for the result on your system - modify accordingly \u279c ~ cat ~/data-private.mount [Unit] Description=Mount private partition [Mount] What=/dev/disk/by-uuid/$UUID Where=/data/private Type=ext4 Options=defaults,rw,noatime [Install] WantedBy=multi-user.target Now move the file to /etc/systemd/system and change owner to root. $ sudo mv ~/data-private.mount /etc/systemd/system $ sudo chown root:root /etc/systemd/system/data-private.mount Start and enable the mount unit $ sudo systemctl enable --now data-private.mount If the partition is newly created then you need to set permissions on the mount to allow for your username to be able to write to the partition. $ sudo chmod ugo+rwx /data/private Or you could change the ownership of the partition to your username sudo chown $USER:$USER /data/private Link your data Move the data to the new location - an example could be your music collection in the ~/Music folder. $ mv ~/Music /data/private Now create a symlink in your home the new location $ ln -s /data/private/Music ~/Music The process is a logic target for a script to handle. Create a new folder to hold some scripts $ mkdir /data/private/scripts Copy the mount unit to the script folder $ cp /etc/systemd/system/data-private.mount /data/private/scripts Create a new file /data/private/scripts/20-link-data.sh and make it executable. $ touch /data/private/scripts/20-link-data.sh $ chmod +x /data/private/scripts/20-link-data.sh Edit the file and and paste the following content into it. Modify the script and extend it to match your system and the folders you want to control and save the file. #!/bin/bash echo \"Moving and linking folders\" cd $HOME # moving and linking documents mv -i Music /data/private ln -s /data/private/Music Music The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist. Data structure Mount units creates the mount point automagically when started and the mountpoint is not yet existing. Create a new file in your /data/private/scripts folder and make it executable $ touch /data/private/scripts/10-mount-units $ chmod +x /data/private/scripts/10-mount-units Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash sudo cp ./data-private.mount /etc/systemd/system sudo chown root:root /etc/systemd/system/data-private.mount sudo systemctl enable --now data-private.mount Conclusion With these two scripts - you can have your data mounted and available with the few seconds these will take to run. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there.","title":"Store personal files using separate partition (systemd)"},{"location":"notes/mount-storage-partition-mount-using-systemd/#storing-personal-files-on-different-partition","text":"Some Linux users like to experiment with their system and more often than not it leads to the decision of reinstalling the system. That repeatedly creates the issue on how to handle the home folder with configurations and personal files. The purpose of this document is to create an easy and convenient way of safeguarding personal data files while retaining the home folder.","title":"Storing personal files on different partition"},{"location":"notes/mount-storage-partition-mount-using-systemd/#preparation","text":"http://www.pathname.com/fhs/pub/fhs-2.3.html#INTRODUCTION states ! The FHS document has a limited scope: ! * Local placement of local files is a local issue, so FHS does not attempt to usurp system administrators. ! * FHS addresses issues where file placements need to be coordinated between multiple parties such as local sites, distributions, applications, documentation, etc. So for the sake of this HowTo there is no standard as we are talking about Local placement of local files is a local issue . Your system would ideally have two disks but if that is not possible - laptops come to mind - then a system with at least three partitions or more will suffice. EFI System Partition (ESP) Root with home User data","title":"Preparation"},{"location":"notes/mount-storage-partition-mount-using-systemd/#preparations","text":"Create a mount unit for the partition. For the sake of the guide we will use a non-existing device name - which you must substitute with your actual system. First list your devices - this may yield an output similar to this \u279c ~ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sdy 8:0 0 465,8G 0 disk \u251c\u2500sdy1 8:1 0 419,2G 0 part \u2514\u2500sdy2 8:2 0 46,6G 0 part sr0 11:0 1 1024M 0 rom nvme0n9 259:0 0 476,9G 0 disk \u251c\u2500nvme0n9p1 259:1 0 1000M 0 part \u251c\u2500nvme0n9p2 259:2 0 459G 0 part / \u2514\u2500nvme0n9p3 259:3 0 17G 0 part [SWAP] Using the sample output we will use sdy1 as the target. Because udev lists devices completely arbitrarily you cannot rely on the sdy namespace - we need the UUID for our mount - and the easiest way to obtain it in a usable manner is to pipe it into a file - then edit the file. Use this command to create the mount unit in your home then edit the file with your favorite editor. IMPORTANT : For systemd the mount point must match the filename Examples * /data/private = data-private.mount * /data/private/music = data-private-music.mount * /data/development/python = data-development-python.mount lsblk -no UUID /dev/sdy1 > ~/data-private.mount Modify the file to read like this - $UUID - is only a placeholder for the result on your system - modify accordingly \u279c ~ cat ~/data-private.mount [Unit] Description=Mount private partition [Mount] What=/dev/disk/by-uuid/$UUID Where=/data/private Type=ext4 Options=defaults,rw,noatime [Install] WantedBy=multi-user.target Now move the file to /etc/systemd/system and change owner to root. $ sudo mv ~/data-private.mount /etc/systemd/system $ sudo chown root:root /etc/systemd/system/data-private.mount Start and enable the mount unit $ sudo systemctl enable --now data-private.mount If the partition is newly created then you need to set permissions on the mount to allow for your username to be able to write to the partition. $ sudo chmod ugo+rwx /data/private Or you could change the ownership of the partition to your username sudo chown $USER:$USER /data/private","title":"Preparations"},{"location":"notes/mount-storage-partition-mount-using-systemd/#link-your-data","text":"Move the data to the new location - an example could be your music collection in the ~/Music folder. $ mv ~/Music /data/private Now create a symlink in your home the new location $ ln -s /data/private/Music ~/Music The process is a logic target for a script to handle. Create a new folder to hold some scripts $ mkdir /data/private/scripts Copy the mount unit to the script folder $ cp /etc/systemd/system/data-private.mount /data/private/scripts Create a new file /data/private/scripts/20-link-data.sh and make it executable. $ touch /data/private/scripts/20-link-data.sh $ chmod +x /data/private/scripts/20-link-data.sh Edit the file and and paste the following content into it. Modify the script and extend it to match your system and the folders you want to control and save the file. #!/bin/bash echo \"Moving and linking folders\" cd $HOME # moving and linking documents mv -i Music /data/private ln -s /data/private/Music Music The script is designed to be run on your home folder or a newly created home where no files has yet been saved. A simple safeguard exist so you must verify the moving of the folders - if they exist.","title":"Link your data"},{"location":"notes/mount-storage-partition-mount-using-systemd/#data-structure","text":"Mount units creates the mount point automagically when started and the mountpoint is not yet existing. Create a new file in your /data/private/scripts folder and make it executable $ touch /data/private/scripts/10-mount-units $ chmod +x /data/private/scripts/10-mount-units Edit the file and paste the following content into it. Modify the script to match your system and save the file. #!/bin/bash sudo cp ./data-private.mount /etc/systemd/system sudo chown root:root /etc/systemd/system/data-private.mount sudo systemctl enable --now data-private.mount","title":"Data structure"},{"location":"notes/mount-storage-partition-mount-using-systemd/#conclusion","text":"With these two scripts - you can have your data mounted and available with the few seconds these will take to run. The scripts folder can be copied to a USB stick and run from it or be kept in the data partition and run from there.","title":"Conclusion"},{"location":"notes/mount-windows-partition/","text":"Your problem So you have installed Manjaro and you realize that your second disk is not writeable. You can access the data but you cannot change it. The primary cause is permissions and those can be solved by this guide. However the issue could also arise when you dualboot with Windows, and the partition you want to access is the Windows root partition. NTFS partition If your disk is a Windows disk - it can be as simple as Restart your system and load Windows. Disable features like Fastboot, hibernation and hybrid sleep. Run a disk check and fix any errors Create a mountpoint Locate the device and partition(s). $ lsblk sda 8:0 0 223,6G 0 disk \u251c\u2500sda1 8:1 0 512M 0 part \u251c\u2500sda2 8:2 0 60G 0 part \u251c\u2500sda3 8:3 0 130G 0 part \u2514\u2500sda4 8:4 0 33,1G 0 part [SWAP] sdb 8:16 0 477G 0 disk \u2514\u2500sdb1 8:17 0 419,1G Make a permanent mountpoint. Create a folder for the purpose (change all references to mydisk as you would want a more descriptive name). sudo mkdir -p /data/mydisk Mount the partition Replace the yX with the device and the partition number you found. $ sudo mount /dev/sdyX /data/mydisk Set owner Recursive change owner on the folder structure. Manjaro uses a group with the same name as the user which you can verify with: $ groups sys lp wheel network video optical storage scanner power $USER $ sudo chown -R $USER:$USER /data/mydisk Creating a permanent mountpoint for a partition https://archived.forum.manjaro.org/t/wiki-howto-permanent-mountpoint-for-partition/26187 Folders are locked, can access to them but can't delete permanently Unable to access my secondary interal ssd on my laptop","title":"Access my second harddrive"},{"location":"notes/mount-windows-partition/#your-problem","text":"So you have installed Manjaro and you realize that your second disk is not writeable. You can access the data but you cannot change it. The primary cause is permissions and those can be solved by this guide. However the issue could also arise when you dualboot with Windows, and the partition you want to access is the Windows root partition.","title":"Your problem"},{"location":"notes/mount-windows-partition/#ntfs-partition","text":"If your disk is a Windows disk - it can be as simple as Restart your system and load Windows. Disable features like Fastboot, hibernation and hybrid sleep. Run a disk check and fix any errors","title":"NTFS partition"},{"location":"notes/mount-windows-partition/#create-a-mountpoint","text":"","title":"Create a mountpoint"},{"location":"notes/mount-windows-partition/#locate-the-device-and-partitions","text":"$ lsblk sda 8:0 0 223,6G 0 disk \u251c\u2500sda1 8:1 0 512M 0 part \u251c\u2500sda2 8:2 0 60G 0 part \u251c\u2500sda3 8:3 0 130G 0 part \u2514\u2500sda4 8:4 0 33,1G 0 part [SWAP] sdb 8:16 0 477G 0 disk \u2514\u2500sdb1 8:17 0 419,1G","title":"Locate the device and partition(s)."},{"location":"notes/mount-windows-partition/#make-a-permanent-mountpoint","text":"Create a folder for the purpose (change all references to mydisk as you would want a more descriptive name). sudo mkdir -p /data/mydisk","title":"Make a permanent mountpoint."},{"location":"notes/mount-windows-partition/#mount-the-partition","text":"Replace the yX with the device and the partition number you found. $ sudo mount /dev/sdyX /data/mydisk","title":"Mount the partition"},{"location":"notes/mount-windows-partition/#set-owner","text":"Recursive change owner on the folder structure. Manjaro uses a group with the same name as the user which you can verify with: $ groups sys lp wheel network video optical storage scanner power $USER $ sudo chown -R $USER:$USER /data/mydisk","title":"Set owner"},{"location":"notes/mount-windows-partition/#creating-a-permanent-mountpoint-for-a-partition","text":"https://archived.forum.manjaro.org/t/wiki-howto-permanent-mountpoint-for-partition/26187 Folders are locked, can access to them but can't delete permanently Unable to access my secondary interal ssd on my laptop","title":"Creating a permanent mountpoint for a partition"},{"location":"notes/mouse-and-keyboard-sharing/","text":"Share mouse and keyboard Many users of Linux have several devices in use - different purposes. Hav\u00edng a laptop and workstation in use at the same time requires you to move your attention from one keyboard to another - from one screen to another. What if it was possible to use your workstations mouse and keyboard to operate your laptop? Synergy Such solution exist - Synergy . Unfortunately this is partly a commercial solution but based on Open Source code so the Github user debauchee has forked the code and created a rebranded fully Open Source solution which can be installed from AUR. Barrier What is it? Barrier is KVM software forked from Symless's synergy 1.9 codebase. Synergy was >a commercialized reimplementation of the original CosmoSynergy written by Chris Schoeneman. What's different? Whereas synergy has moved beyond its goals from the 1.x era, Barrier aims to >maintain that simplicity. Barrier will let you use your keyboard and mouse from >machine A to control machine B (or more). It's that simple. Installation Install the package from AUR on both systems with Pamac using either the GUI or the CLI pamac build barrier Naming terms The server is the system offering mouse and keyboard service The client is the computer to be controlled by the server Configure the server Launch the barrier app from your environments menu system. Select the Server checkbox Click the button Configure Server... In the center of the grid you see your server computer by name. Drag the monitor from the upper left corner and place in a logical position in relation to your server . E.g. if your client is located on left side of your server placed it the left in grid. Double click the newly placed client , name it and click OK . Make a note of the SSL Fingerprint show in the Server box. You will need it when connecting the *client for the first time. Click Apply and Start to start the server Note: you can setup several clients if you have more than one you want to control. Only requirement is a monitor attached to client . Save the server configuration to a file using the Barrier menu or press Ctrl Alt s , name the file .barrier.conf . Run barrier server at login If you want to run the barrier server at login you need to create a script and add this to your environments autostart. Use your preferred method of editing text files to create a script named barrier.sh and make it executable. touch ~/barrier.sh chmod +x ~/barrier.sh nano ~/barrier.sh Add the following content to the file SERVERNAME=$(hostname) CONFIG=/home/$USER/.barrier.conf barriers --no-tray \\ --debug INFO \\ --name $SERVERNAME \\ --enable-crypto \\ -c $CONFIG \\ --address :24800 If your environment uses a autostart file e.g. Openbox add the barrier.sh script to your autostart file nano ~/.config/openbox/autostart sleep 1; ~/barrier.sh Configure the client The first connection from your client has to be done manually as the server 's SSL fingerprint will have to be manually acknowledged before use. Run barrier client Like we did on the server , we will create a script to launch the client at login. Replace serverip with the IP of your server . Do not remove the brackets, they are part of the argument. touch ~/barrier.sh chmod +x ~/barrier.sh nano ~/barrier.sh CLIENTNAME=$(hostname) barrierc --no-tray \\ --debug INFO \\ --name $CLIENTNAME \\ --enable-crypto \\ [serverip]:24800 As with the server add the script to your environment's autostart. If the environment is Openbox add the barrier.sh script the clients autostart file nano ~/.config/openbox/autostart sleep 1; ~/barrier.sh Setup the client 's display manager to auto login. If you are using lightdm then install the package lightdm-settings and configure auto login and restart the client. Log off the server and re-login.","title":"Mouse and keyboard sharing"},{"location":"notes/mouse-and-keyboard-sharing/#share-mouse-and-keyboard","text":"Many users of Linux have several devices in use - different purposes. Hav\u00edng a laptop and workstation in use at the same time requires you to move your attention from one keyboard to another - from one screen to another. What if it was possible to use your workstations mouse and keyboard to operate your laptop?","title":"Share mouse and keyboard"},{"location":"notes/mouse-and-keyboard-sharing/#synergy","text":"Such solution exist - Synergy . Unfortunately this is partly a commercial solution but based on Open Source code so the Github user debauchee has forked the code and created a rebranded fully Open Source solution which can be installed from AUR.","title":"Synergy"},{"location":"notes/mouse-and-keyboard-sharing/#barrier","text":"","title":"Barrier"},{"location":"notes/mouse-and-keyboard-sharing/#what-is-it","text":"Barrier is KVM software forked from Symless's synergy 1.9 codebase. Synergy was >a commercialized reimplementation of the original CosmoSynergy written by Chris Schoeneman.","title":"What is it?"},{"location":"notes/mouse-and-keyboard-sharing/#whats-different","text":"Whereas synergy has moved beyond its goals from the 1.x era, Barrier aims to >maintain that simplicity. Barrier will let you use your keyboard and mouse from >machine A to control machine B (or more). It's that simple.","title":"What's different?"},{"location":"notes/mouse-and-keyboard-sharing/#installation","text":"Install the package from AUR on both systems with Pamac using either the GUI or the CLI pamac build barrier","title":"Installation"},{"location":"notes/mouse-and-keyboard-sharing/#naming-terms","text":"The server is the system offering mouse and keyboard service The client is the computer to be controlled by the server","title":"Naming terms"},{"location":"notes/mouse-and-keyboard-sharing/#configure-the-server","text":"Launch the barrier app from your environments menu system. Select the Server checkbox Click the button Configure Server... In the center of the grid you see your server computer by name. Drag the monitor from the upper left corner and place in a logical position in relation to your server . E.g. if your client is located on left side of your server placed it the left in grid. Double click the newly placed client , name it and click OK . Make a note of the SSL Fingerprint show in the Server box. You will need it when connecting the *client for the first time. Click Apply and Start to start the server Note: you can setup several clients if you have more than one you want to control. Only requirement is a monitor attached to client . Save the server configuration to a file using the Barrier menu or press Ctrl Alt s , name the file .barrier.conf .","title":"Configure the server"},{"location":"notes/mouse-and-keyboard-sharing/#run-barrier-server-at-login","text":"If you want to run the barrier server at login you need to create a script and add this to your environments autostart. Use your preferred method of editing text files to create a script named barrier.sh and make it executable. touch ~/barrier.sh chmod +x ~/barrier.sh nano ~/barrier.sh Add the following content to the file SERVERNAME=$(hostname) CONFIG=/home/$USER/.barrier.conf barriers --no-tray \\ --debug INFO \\ --name $SERVERNAME \\ --enable-crypto \\ -c $CONFIG \\ --address :24800 If your environment uses a autostart file e.g. Openbox add the barrier.sh script to your autostart file nano ~/.config/openbox/autostart sleep 1; ~/barrier.sh","title":"Run barrier server at login"},{"location":"notes/mouse-and-keyboard-sharing/#configure-the-client","text":"The first connection from your client has to be done manually as the server 's SSL fingerprint will have to be manually acknowledged before use.","title":"Configure the client"},{"location":"notes/mouse-and-keyboard-sharing/#run-barrier-client","text":"Like we did on the server , we will create a script to launch the client at login. Replace serverip with the IP of your server . Do not remove the brackets, they are part of the argument. touch ~/barrier.sh chmod +x ~/barrier.sh nano ~/barrier.sh CLIENTNAME=$(hostname) barrierc --no-tray \\ --debug INFO \\ --name $CLIENTNAME \\ --enable-crypto \\ [serverip]:24800 As with the server add the script to your environment's autostart. If the environment is Openbox add the barrier.sh script the clients autostart file nano ~/.config/openbox/autostart sleep 1; ~/barrier.sh Setup the client 's display manager to auto login. If you are using lightdm then install the package lightdm-settings and configure auto login and restart the client. Log off the server and re-login.","title":"Run barrier client"},{"location":"notes/ms-sql-notes/","text":"Unique Check Default Primary key Foreign key Not null basic syntax ALTER TABLE <table_name> ADD CONSTRAINT <constraint_name> TYPE; sample unique constraint ALTER TABLE <table_name> ADD CONSTRAINT <constraint_name> UNIQUE(<id_column>); Validation ALTER TABLE <table_name> ADD CONSTRAINT >constraint_name> CHECK(column_value > 0); Drop constraint ALTER TABLE <table_name> DROP CONSTRAINT <constraint_name>; Drop constraint only if exists ALTER TABLE <table_name> DROP CONSTRAINT IF EXISTS <constraint_name>;","title":"Contraints"},{"location":"notes/powershell-sql-queries/","text":"Push-Location # load sql module Write-Host \"Loading Powershell SQL ...\" Set-ExecutionPolicy -Scope CurrentUser Unrestricted Import-Module -DisableNameChecking SQLPS # variables $instance = \".\\sqlexpress\" $database = \"db\" $now = ((Get-Date -format s) -replace\":\",\"\") $workdir = \"\\\\server01\\share\" $companies_txt = $workdir + \"\\exports\\companies.txt\" $sqlCompanies = \"SELECT [ACCOUNT],[NAME],[ADDRESS1],[ADDRESS2],[ZIPCITY],[COUNTRY],[ATTENTION],[PHONE],[SALESREP],[EMAIL],[CELLPHONE] FROM [dbo].[CUSTTABLE]\" if (Test-Path -Path $companies_txt -PathType Leaf) { Remove-Item $companies_txt -Force } Write-Host \"Exporting companies\" Invoke-Sqlcmd -ServerInstance $instance -Database $database -Query $sqlCompanies | Export-Csv -Path $companies_txt -NoTypeInformation -Encoding UTF8 #$utf8 = New-Object System.Text.UTF8Encoding $False #$rawData = Get-Content -Raw $companies_txt #[System.IO.File]::WriteAllLines($companies_txt, $rawData, $utf8) Write-Host \"Done!\" cd $workdir","title":"Using Powershell for SQL queries"},{"location":"notes/systemd-boot-notes/","text":"mount /dev/sdxY /efi bootctl install --esp-path=/efi KERNEL-VERSION=$(uname -r) kernel-install add $KERNEL-VERSION /usr/lib/modules/$KERNEL-VERSION/vmlinuz kernel-install remove $KERNEL-VERSION","title":"Notes on systemd-boot"},{"location":"notes/tools-linux-recovery-tools-and-iso/","text":"packages Tool Download ddrescue pacman -S ddrescue testdisk pacman -S testdisk photorec part of testdisk foremost pacman -S foremost sleuthkit pacman -S sleuthkit r-linux pamac build r-linux mondo pamac build mondo safecopy pamac build safecopy bootable systems system download redo rescue (debian based ISO) http://redorescue.com/ sysrescd (arch based ISO) https://www.system-rescue.org/ knoppix (ISO) http://knoppix.net/ trk3 (ISO) https://sourceforge.net/projects/archiveos/files/t/trk rescatux (ISO) https://www.supergrubdisk.org/rescatux/ windows bootable system download Hirens Boot CD https://www.hirensbootcd.org/files/HBCD_PE_x64.iso Hirens Boot CD Legacy https://www.hirensbootcd.org/files/Hirens.BootCD.15.2.zip","title":"Tools Overview"},{"location":"notes/tools-linux-recovery-tools-and-iso/#packages","text":"Tool Download ddrescue pacman -S ddrescue testdisk pacman -S testdisk photorec part of testdisk foremost pacman -S foremost sleuthkit pacman -S sleuthkit r-linux pamac build r-linux mondo pamac build mondo safecopy pamac build safecopy","title":"packages"},{"location":"notes/tools-linux-recovery-tools-and-iso/#bootable-systems","text":"system download redo rescue (debian based ISO) http://redorescue.com/ sysrescd (arch based ISO) https://www.system-rescue.org/ knoppix (ISO) http://knoppix.net/ trk3 (ISO) https://sourceforge.net/projects/archiveos/files/t/trk rescatux (ISO) https://www.supergrubdisk.org/rescatux/","title":"bootable systems"},{"location":"notes/tools-linux-recovery-tools-and-iso/#windows-bootable","text":"system download Hirens Boot CD https://www.hirensbootcd.org/files/HBCD_PE_x64.iso Hirens Boot CD Legacy https://www.hirensbootcd.org/files/Hirens.BootCD.15.2.zip","title":"windows bootable"},{"location":"notes/ubiquiti-flash-usg-3p/","text":"Unifi Security Gateway (USG-3) Flash using console port with usb-to-serial rollover console cable and picocom Download the orginal complete firmware image, version 4.2: https://dl.ubnt-ut.com/cmb/USG-4_2_0-shipped.img.bz2 Extract the img file from the archive. Unplug the USG and remove the rubber feet from the USG. Unscrew the screws beneath the rubber feet. Remove the top plate to access the inside (gently pry the top off if necessary). Gently remove the USB drive and insert it into your computer. Use dd to write img to usb. Insert the USB drive into the USG. Connect the console cable and start minicom and power up the USG picocom -b 115200 You will be prompted for username/password which is ubnt:ubnt Now you need to tell the USG to update with software from a web address. Find the latest USG firmware from Unifi here or elsewhere on the Unifi site: https://www.ui.com/download/unifi-switching-routing/default/default/. Click the download button and agree to the terms - then copy the download link e.g. https://dl.ui.com/unifi/firmware/UGW3/4.4.57.5578372/UGW3.v4.4.57.5578372.tar. In picocom, enter: upgrade https://dl.ui.com/unifi/firmware/UGW3/4.4.57.5578372/UGW3.v4.4.57.5578372.tar If don't get any response leave let the device be for 5 or 10 minutes. The USG will reboot when finished updating. References: * https://www.reddit.com/r/Ubiquiti/comments/kw4bx3/how_to_flash_and_recover_unifi_security_gateway/ * https://support.hostifi.com/en/articles/6629721-unifi-how-to-fix-a-corrupted-usg-3p","title":"Flash USG-3P"},{"location":"notes/ubiquiti-flash-usg-3p/#unifi-security-gateway-usg-3","text":"Flash using console port with usb-to-serial rollover console cable and picocom Download the orginal complete firmware image, version 4.2: https://dl.ubnt-ut.com/cmb/USG-4_2_0-shipped.img.bz2 Extract the img file from the archive. Unplug the USG and remove the rubber feet from the USG. Unscrew the screws beneath the rubber feet. Remove the top plate to access the inside (gently pry the top off if necessary). Gently remove the USB drive and insert it into your computer. Use dd to write img to usb. Insert the USB drive into the USG. Connect the console cable and start minicom and power up the USG picocom -b 115200 You will be prompted for username/password which is ubnt:ubnt Now you need to tell the USG to update with software from a web address. Find the latest USG firmware from Unifi here or elsewhere on the Unifi site: https://www.ui.com/download/unifi-switching-routing/default/default/. Click the download button and agree to the terms - then copy the download link e.g. https://dl.ui.com/unifi/firmware/UGW3/4.4.57.5578372/UGW3.v4.4.57.5578372.tar. In picocom, enter: upgrade https://dl.ui.com/unifi/firmware/UGW3/4.4.57.5578372/UGW3.v4.4.57.5578372.tar If don't get any response leave let the device be for 5 or 10 minutes. The USG will reboot when finished updating. References: * https://www.reddit.com/r/Ubiquiti/comments/kw4bx3/how_to_flash_and_recover_unifi_security_gateway/ * https://support.hostifi.com/en/articles/6629721-unifi-how-to-fix-a-corrupted-usg-3p","title":"Unifi Security Gateway (USG-3)"},{"location":"notes/usb-clearing-a-stubborn-device/","text":"Possible methods to clear a disk WARNING: To avoid someone copy pasting thus wiping their primary disk - replace $DEViCE with the actual device - don't append any partitions - just the device path. To get device paths lsblk -no PATH Execute as root - adding a failsafe layer to the listed commands - any one command should suffice. OPTION Removes all traces of partition information including super blocks etc. bash # sgdisk --zapall $DEVICE OPTION Write zeroes to the first 10M - effectively removing partition information bash # dd if=/dev/zero of=$DEVICE bs=1M count=10 OPTION Creates a new GPT partition table with a single unformatted partition of Linux filesystem type bash # printf 'o\\ny\\nn\\n\\n\\n\\n\\nw\\ny\\n' | gdisk $DEVICE OPTION SSD memory cell cleaing * https://wiki.archlinux.org/index.php/Solid_state_drive/Memory_cell_clearing","title":"Clearing a stubborn storage device"},{"location":"notes/usb-clearing-a-stubborn-device/#possible-methods-to-clear-a-disk","text":"WARNING: To avoid someone copy pasting thus wiping their primary disk - replace $DEViCE with the actual device - don't append any partitions - just the device path. To get device paths lsblk -no PATH Execute as root - adding a failsafe layer to the listed commands - any one command should suffice. OPTION Removes all traces of partition information including super blocks etc. bash # sgdisk --zapall $DEVICE OPTION Write zeroes to the first 10M - effectively removing partition information bash # dd if=/dev/zero of=$DEVICE bs=1M count=10 OPTION Creates a new GPT partition table with a single unformatted partition of Linux filesystem type bash # printf 'o\\ny\\nn\\n\\n\\n\\n\\nw\\ny\\n' | gdisk $DEVICE OPTION SSD memory cell cleaing * https://wiki.archlinux.org/index.php/Solid_state_drive/Memory_cell_clearing","title":"Possible methods to clear a disk"},{"location":"notes/xorg-intel-x11-config/","text":"Make the best of Intel Install the mesa package. pacman -Syu mesa Enable early kms Edit /etc/mkinitcpio.conf MODULES=(i915) Then build initramfs mkinitcpio -P Xorg configuration Edit /etc/X11/xorg.conf.d/20-intel.conf Option 1 Section \"Device\" Identifier \"Intel Graphics\" Driver \"intel\" Option \"TearFree\" \"true\" EndSection Option 2 Section \"Device\" Identifier \"Intel Graphics\" Driver \"intel\" Option \"AccelMethod\" \"sna\" Option \"TearFree\" \"true\" Option \"SwapbuffersWait\" \"true\" Option \"DRI\" \"2\" EndSection Reboot","title":"Intel Xorg config"},{"location":"notes/xorg-intel-x11-config/#make-the-best-of-intel","text":"Install the mesa package. pacman -Syu mesa","title":"Make the best of Intel"},{"location":"notes/xorg-intel-x11-config/#enable-early-kms","text":"Edit /etc/mkinitcpio.conf MODULES=(i915) Then build initramfs mkinitcpio -P","title":"Enable early kms"},{"location":"notes/xorg-intel-x11-config/#xorg-configuration","text":"Edit /etc/X11/xorg.conf.d/20-intel.conf Option 1 Section \"Device\" Identifier \"Intel Graphics\" Driver \"intel\" Option \"TearFree\" \"true\" EndSection Option 2 Section \"Device\" Identifier \"Intel Graphics\" Driver \"intel\" Option \"AccelMethod\" \"sna\" Option \"TearFree\" \"true\" Option \"SwapbuffersWait\" \"true\" Option \"DRI\" \"2\" EndSection Reboot","title":"Xorg configuration"}]}